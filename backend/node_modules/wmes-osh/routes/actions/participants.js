// Part of <https://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

'use strict';

module.exports = async (app, module, req, res, next) =>
{
  const {
    User
  } = module;

  try
  {
    const users = await User
      .find({
        active: true,
        oshDepartment: +req.query.department
      })
      .select({
        login: 1,
        firstName: 1,
        lastName: 1
      })
      .sort({searchName: 1})
      .lean()
      .exec();

    res.json(users.map(user =>
    {
      return {
        id: user._id.toString(),
        label: `${user.lastName} ${user.firstName}`.trim() || user.login
      };
    }));
  }
  catch (err)
  {
    next(err);
  }
};
