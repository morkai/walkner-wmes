// Part of <https://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

'use strict';

const nearMissesRoutes = require('./nearMisses');
const dictionariesRoute = require('./dictionaries');

module.exports = (app, module) =>
{
  const {
    user,
    express,
    DICTIONARIES
  } = module;

  const canView = user.auth('USER');
  const canViewDictionaries = user.auth('OSH:DICTIONARIES:VIEW');
  const canManageDictionaries = user.auth('OSH:DICTIONARIES:MANAGE');

  nearMissesRoutes(app, module);

  express.get('/osh/dictionaries', canView, dictionariesRoute.bind(null, app, module));

  Object.keys(DICTIONARIES).forEach(k =>
  {
    const options = DICTIONARIES[k];
    const canViewDictionary = options.canView || canViewDictionaries;
    const canManageDictionary = options.canManage || canManageDictionaries;

    express.get(`/osh/${k}`, canViewDictionary, express.crud.browseRoute.bind(null, app, options));
    express.post(`/osh/${k}`, canManageDictionary, express.crud.addRoute.bind(null, app, options));
    express.get(`/osh/${k}/:id`, canViewDictionary, express.crud.readRoute.bind(null, app, options));
    express.put(`/osh/${k}/:id`, canManageDictionary, express.crud.editRoute.bind(null, app, options));
    express.delete(`/osh/${k}/:id`, canManageDictionary, express.crud.deleteRoute.bind(null, app, options));
  });
};
