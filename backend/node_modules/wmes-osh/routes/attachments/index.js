// Part of <https://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

'use strict';

const multer = require('multer');
const uploadRoute = require('./upload');
const sendRoute = require('./send');

module.exports = (app, module) =>
{
  const {
    user,
    express
  } = module;

  const canView = user.auth('USER');

  express.post(
    '/osh/attachments',
    canView,
    multer({
      dest: module.config.uploadsPath,
      limits: {
        files: 5,
        fileSize: 100 * 1024 * 1024
      }
    }).any(),
    uploadRoute.bind(null, app, module)
  );
  express.get(
    '/osh/:modelType/:modelId/attachments/:attachmentId',
    canView,
    sendRoute.bind(null, app, module)
  );
};
