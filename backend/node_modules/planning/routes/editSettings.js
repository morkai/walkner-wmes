// Part of <https://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

'use strict';

module.exports = (app, module, req, res, next) =>
{
  const {
    user,
    settings,
    PlanSettings
  } = module;

  const id = req.params.id;
  const input = req.body;

  if (!input || Object.keys(input).length === 0)
  {
    return next(app.createError(`Invalid input.`, 'INPUT', 400));
  }

  if (!/^[0-9]+-[0-9]+-[0-9]+$/.test(id))
  {
    return settings.updateRoute(req, res, next);
  }

  const userInfo = user.createUserInfo(req.session.user, req);

  PlanSettings.edit(id, userInfo, input, (err, planSettings) =>
  {
    if (err)
    {
      return next(err);
    }

    res.json(planSettings);
  });
};
