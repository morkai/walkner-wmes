// Part of <https://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

'use strict';

module.exports = (app, {user, editEntry}, req, res, next) =>
{
  const sessionUser = req.session.user || {};
  const {socketId, userLabel, data} = req.body;
  const input = {
    entryId: req.params.id,
    socketId: socketId || null,
    data: data || {},
    sessionUser,
    updater: user.createUserInfo(sessionUser, req)
  };

  if (!sessionUser.loggedIn
    && typeof userLabel === 'string'
    && userLabel.length < 50)
  {
    input.updater.label = req.body.userLabel;
  }

  editEntry(input, err =>
  {
    if (err)
    {
      return next(err);
    }

    res.sendStatus(204);
  });
};
