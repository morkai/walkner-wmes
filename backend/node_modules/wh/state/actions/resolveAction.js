// Part of <https://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

'use strict';

const resolveUser = require('./resolveUser');
const resolvePickupAction = require('./resolvePickupAction');
const resolveDeliveryAction = require('./resolveDeliveryAction');

exports.session = true;

exports.execute = async (app, module, {data, user, session}) =>
{
  const whUser = await resolveUser(app, module, {data, session});

  switch (data.source)
  {
    case 'pickup':
      return await resolvePickupAction(app, module, {
        data,
        user,
        session,
        whUser
      });

    case 'delivery':
      return await resolveDeliveryAction(app, module, {
        data,
        user,
        session,
        whUser
      });

    default:
      throw app.createError('Invalid type.', 'INVALID_TYPE', 400);
  }
};
