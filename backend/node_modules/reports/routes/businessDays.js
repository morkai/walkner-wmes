// Part of <https://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

'use strict';

const moment = require('moment');
const businessDays = require('../businessDays');

module.exports = (app, module, req, res, next) =>
{
  const from = parseDate(req.query.from);
  const to = parseDate(req.query.to || Date.now());

  if (!from.isValid() || !to.isValid())
  {
    return next(app.createError('Invalid date.', 'INPUT', 400));
  }

  const result = {
    from: from.format('YYYY-MM-DD'),
    to: to.format('YYYY-MM-DD'),
    days: []
  };

  const max = to.valueOf();

  while (from.valueOf() < max)
  {
    if (businessDays.countInDay(from.toDate()))
    {
      result.days.push(from.format('YYYY-MM-DD'));
    }

    from.add(1, 'days');
  }

  res.json(result);

  function parseDate(input)
  {
    return (/^-?[0-9]+$/.test(input) ? moment(+input) : moment(input, 'YYYY-MM-DD')).startOf('day');
  }
};
