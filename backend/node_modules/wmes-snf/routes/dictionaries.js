// Part of <https://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

'use strict';

const _ = require('lodash');
const step = require('h5.step');

module.exports = (app, module, req, res, next) =>
{
  step(
    function()
    {
      _.forEach(module.DICTIONARIES, modelName =>
      {
        const Model = module[modelName];

        Model
          .find()
          .select(Model.DICTIONARY_FIELDS || {})
          .lean()
          .exec(this.group());
      });
    },
    function(err, dictionaries)
    {
      if (err)
      {
        return next(err);
      }

      const result = {};

      Object.keys(module.DICTIONARIES).forEach((dictionaryName, i) =>
      {
        result[dictionaryName] = dictionaries[i];
      });

      res.json(result);
    }
  );
};
