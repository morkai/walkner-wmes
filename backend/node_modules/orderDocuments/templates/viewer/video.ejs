<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title><%- nc15 %>: <%= name || meta.title %></title>
<link rel="stylesheet" href="/assets/wmes-docs-viewer.css">
<style>
* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}
body {
  overflow: hidden;
}
h1 {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  margin: 0;
  padding: 7px 8px 8px 8px;
  height: 33px;
  overflow: hidden;
  white-space: nowrap;
  font-family: Verdana, sans-serif;
  font-size: 18px;
  font-weight: bold;
  text-transform: uppercase;
  text-shadow: 1px 1px 1px #333;
  text-overflow: ellipsis;
  text-align: center;
  color: #fff;
  background-color: #323639;
  background-image: linear-gradient(#323639, rgba(50, 54, 57, 0.95));
  border-bottom: 1px solid #000;
}
#controls {
  position: fixed;
  right: 15px;
  bottom: 15px;
  display: flex;
}
.control {
  flex: 0 0 auto;
  width: 72px;
  height: 72px;
  border-radius: 50%;
  background-color: #FFF;
  color: #333;
  font-size: 35px;
  line-height: 72px;
  box-shadow: 0 4px 12px #666;
  text-align: center;
}
.control:hover {
  background: #ffffd6;
  color: #333;
  text-shadow: none;
}
.control + .control {
  margin-left: 20px;
}
#progress + .control {
  margin-left: 20px;
}
#progress {
  flex: 1 1 auto;
  height: 72px;
  opacity: 0.25;
  background-color: transparent;
  -webkit-appearance: none;
}
#progress:focus {
  outline: none;
}
#progress::-webkit-slider-runnable-track {
  background: #ffffff;
  border: 0 solid #010101;
  border-radius: 1px;
  box-shadow: 0 4px 12px #666;
  width: 100%;
  height: 31px;
  cursor: pointer;
}
#progress::-webkit-slider-thumb {
  margin-top: -21.5px;
  width: 31px;
  height: 72px;
  background: #E00;
  cursor: pointer;
  -webkit-appearance: none;
}
#progress:focus::-webkit-slider-runnable-track {
  background: #ffffff;
}
#start {
  position: fixed;
  top: 50%;
  left: 50%;
  font-size: 300px;
  width: 300px;
  height: 300px;
  margin-top: -150px;
  margin-left: -150px;
  text-shadow: 4px 4px 16px #000;
  color: #FFF;
}
</style>
</head>
<body>
<h1 id="hd">
  <% if (!nc15.startsWith('000')) { %>
  <%- nc15 %>:
  <% } %>
  <%= name %>
</h1>
<i id="start" class="fa fa-play-circle-o"></i>
<div style="text-align: center">
  <video id="video" muted preload="auto" playsinline loop style="margin: 0 auto">
    <source src="/orderDocuments/<%- nc15 %>?original=1&hash=<%- hash %>&order=<%- orderNo %>" type="video/mp4">
  </video>
</div>
<div id="controls">
  <input id="progress" type="range" value="0" min="0" max="100" step="0.000001">
  <div id="play" class="control"><i class="fa fa-play"></i></div>
  <div id="pause" class="control"><i class="fa fa-pause"></i></div>
  <div id="stop" class="control"><i class="fa fa-step-backward"></i></div>
  <div id="end" class="control"><i class="fa fa-step-forward"></i></div>
  <div id="lockUi" class="control"><i class="fa fa-lock"></i></div>
</div>
<script>
var videoEl = document.getElementById('video');
var lockUiEl = document.getElementById('lockUi');
var progressEl = document.getElementById('progress');
var wasPlaying = false;

if (window.parent.WMES_DOCS_LOCK_UI)
{
  lockUiEl.addEventListener('click', function()
  {
    window.parent.WMES_DOCS_LOCK_UI(); // eslint-disable-line new-cap
  });
}
else
{
  lockUiEl.style.display = 'none';
}

resize();
togglePlayControls();

window.addEventListener('contextmenu', function(e)
{
  e.preventDefault();
});

window.addEventListener('touchstart', function(e)
{
  if (e.touches && e.touches.length > 1)
  {
    e.preventDefault();
  }
}, {passive: false});

window.addEventListener('resize', resize, {passive: true});

videoEl.addEventListener('click', function()
{
  if (videoEl.paused || videoEl.ended)
  {
    videoEl.play();
  }
  else
  {
    videoEl.pause();
  }
});

videoEl.addEventListener('play', function(e)
{
  var startEl = document.getElementById('start');

  if (startEl)
  {
    startEl.parentNode.removeChild(startEl);
  }

  togglePlayControls();
  showProgress();
});

videoEl.addEventListener('pause', function(e)
{
  togglePlayControls();
  showProgress();
});

videoEl.addEventListener('ended', function(e)
{
  togglePlayControls();
  showProgress();
});

videoEl.addEventListener('loadedmetadata', function(e)
{
  progressEl.max = videoEl.duration;
});

videoEl.addEventListener('timeupdate', function(e)
{
  progressEl.max = videoEl.duration;
  progressEl.value = videoEl.currentTime;
});

document.getElementById('play').addEventListener('click', function()
{
  videoEl.play();
});

document.getElementById('pause').addEventListener('click', function()
{
  videoEl.pause();
});

document.getElementById('stop').addEventListener('click', function()
{
  videoEl.pause();
  videoEl.currentTime = 0;
});

document.getElementById('end').addEventListener('click', function()
{
  videoEl.pause();
  videoEl.currentTime = videoEl.duration - 0.001;
});

progressEl.addEventListener('mousedown', function()
{
  wasPlaying = !videoEl.paused && !videoEl.ended;
});

progressEl.addEventListener('mouseup', function()
{
  if (wasPlaying)
  {
    wasPlaying = false;
    videoEl.play();
  }
});

progressEl.addEventListener('input', function(e)
{
  var value = parseFloat(progressEl.value);

  videoEl.pause();
  videoEl.currentTime = value >= videoEl.duration ? (videoEl.duration - 0.001) : value;
});

function resize()
{
  videoEl.style.width = window.innerWidth + 'px';
  videoEl.style.height = (window.innerHeight - 33) + 'px';

  progressEl.style.width = (window.innerWidth - 2 * 15 - 4 * (72 + 20)) + 'px';
}

function togglePlayControls()
{
  if (videoEl.paused || videoEl.ended)
  {
    document.getElementById('play').style.display = '';
    document.getElementById('pause').style.display = 'none';
  }
  else
  {
    document.getElementById('play').style.display = 'none';
    document.getElementById('pause').style.display = '';
  }
}

function scheduleHideProgress()
{
  clearTimeout(showProgress.hideTimer);
  showProgress.hideTimer = setTimeout(hideProgress, 2500);
}

function showProgress()
{
  scheduleHideProgress();

  progressEl.style.opacity = '1';
}

function hideProgress()
{
  progressEl.style.opacity = '0.25';
}
</script>
</body>
</html>
