// Part of <https://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

'use strict';

exports.name = 'MissingOrderDocument';

exports.setUp = (app, mongoose) =>
{
  const orderSchema = new mongoose.Schema({
    _id: String,
    mrp: String,
    availDate: Date,
    startDate: Date
  }, {
    id: false
  });

  const missingSchema = new mongoose.Schema({
    _id: String,
    name: String,
    orders: [orderSchema]
  }, {
    id: false
  });

  missingSchema.statics.BROWSE_LIMIT = 100;
  missingSchema.statics.TOPIC_PREFIX = 'orderDocuments.missing';

  missingSchema.index({'orders.mrp': 1});
  missingSchema.index({'orders.startDate': 1});

  mongoose.model(exports.name, missingSchema);
};
