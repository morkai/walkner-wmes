// Part of <https://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

'use strict';

const _ = require('lodash');

module.exports = (app, module, req, res, next) =>
{
  if (!_.isString(req.params.orderNo) || !/^[0-9]+$/.test(req.params.orderNo))
  {
    return next(app.createError('INPUT', 400));
  }

  if (!module.findOrderData)
  {
    return next(app.createError('UNAVAILABLE', 500));
  }

  const params = {
    orderNo: req.params.orderNo,
    line: req.query.line,
    station: parseInt(req.query.station, 10) || 0
  };

  module.findOrderData(params, (err, orderData) =>
  {
    if (err)
    {
      return next(err);
    }

    res.json(orderData);
  });
};
