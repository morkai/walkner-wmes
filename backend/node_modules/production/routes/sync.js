// Part of <https://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

'use strict';

module.exports = (app, {user, syncLogEntryStream}, req, res) =>
{
  const creator = user.createUserInfo(req.session.user, req);

  syncLogEntryStream(creator, req.body, (err, lockLogEntry) =>
  {
    if (err)
    {
      module.warn(err, `Failed to sync log entry stream.`);
    }

    if (lockLogEntry)
    {
      res.json({
        lock: {
          secretKey: lockLogEntry.secretKey,
          prodLine: lockLogEntry.prodLine
        }
      });
    }
    else
    {
      res.json({});
    }
  });
};
