// Part of <https://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

'use strict';

module.exports = (app, module, req, res, next) =>
{
  let finder = '';
  let filter = '';

  if (typeof req.query.no === 'string' && /[0-9]{3,9}/.test(req.query.no))
  {
    finder = 'findOrdersByNo';
    filter = req.query.no.match(/([0-9]{3,9})/)[1];
  }
  else if (typeof req.query.nc12 === 'string' && /^[0-9]{12},/.test(req.query.nc12))
  {
    finder = 'findOrdersByNc12';
    filter = req.query.nc12.split(',').filter(v => /^[0-9]{12}$/.test(v));
  }
  else if (typeof req.query.nc12 === 'string' && /[a-zA-Z0-9]{3,12}/.test(req.query.nc12))
  {
    finder = 'findOrdersByNc12';
    filter = req.query.nc12.match(/([a-zA-Z0-9]{3,12})/)[1];
  }

  if (!module.orderFinder[finder])
  {
    return res.json([]);
  }

  module.orderFinder[finder](filter, (err, orders) =>
  {
    if (err)
    {
      return next(err);
    }

    res.json(orders);
  });
};
