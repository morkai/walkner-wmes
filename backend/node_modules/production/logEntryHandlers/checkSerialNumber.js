// Part of <https://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

'use strict';

const step = require('h5.step');

module.exports = function(app, productionModule, prodLine, logEntry, done)
{
  if (logEntry.data.error)
  {
    return done();
  }

  step(
    function getModelsStep()
    {
      productionModule.checkSerialNumber(logEntry, null, this.next());
    },
    function(err)
    {
      if (err && err.message !== 'ALREADY_USED')
      {
        productionModule.error(err, '[checkSerialNumber] Failed to check SN.', {
          sn: logEntry.data._id,
          prodLogEntryId: logEntry._id
        });
      }
    },
    done
  );
};
