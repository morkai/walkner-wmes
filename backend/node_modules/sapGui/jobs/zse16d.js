// Part of <https://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

'use strict';

const checkOutputFile = require('./checkOutputFile');

module.exports = (app, sapGuiModule, job, done) =>
{
  const args = [
    '--output-file',
    Math.floor(Date.now() / 1000) + '@' + (job.outputFile || 'T_ZSE16D.txt'),
    '--table',
    job.table
  ];

  if (job.variant)
  {
    args.push('--variant', job.variant);
  }

  if (Array.isArray(job.criteria))
  {
    job.criteria.forEach(criteria =>
    {
      if (typeof criteria === 'string')
      {
        args.push('--criteria', criteria);
      }
      else if (typeof criteria === 'function')
      {
        criteria(job, args).forEach(criteria =>
        {
          args.push('--criteria', criteria);
        });
      }
    });
  }

  sapGuiModule.runScript(job, 'T_ZSE16D.exe', args, checkOutputFile.bind(null, done));
};
