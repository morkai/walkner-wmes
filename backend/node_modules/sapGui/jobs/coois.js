// Part of <https://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

'use strict';

const checkOutputFile = require('./checkOutputFile');

module.exports = (app, module, job, done) =>
{
  const args = [
    '--output-file',
    Math.floor(Date.now() / 1000) + '@' + (job.outputFile || 'T_COOIS.txt')
  ];

  [
    'variant',
    'variant-creator',
    'list',
    'layout',
    'plant',
    'from',
    'to',
    'deleted'
  ].forEach(arg =>
  {
    const opt = arg
      .split('-')
      .map((part, i) => i === 0 ? part : part.charAt(0).toUpperCase() + part.substring(1))
      .join('');

    if (job[opt] == null)
    {
      return;
    }

    args.push(`--${arg}`, String(job[opt]));
  });

  module.runScript(job, 'T_COOIS.exe', args, checkOutputFile.bind(null, done));
};
