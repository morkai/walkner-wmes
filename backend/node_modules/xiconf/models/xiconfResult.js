// Part of <https://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

'use strict';

exports.name = 'XiconfResult';

exports.setUp = (app, mongoose) =>
{
  const xiconfResultSchema = new mongoose.Schema({
    _id: {
      type: String,
      required: true,
      trim: true
    },
    order: {
      type: String,
      ref: 'XiconfOrderResult'
    },
    orderNo: String,
    nc12: String,
    counter: Number,
    startedAt: Date,
    finishedAt: Date,
    duration: Number,
    log: [],
    result: String,
    errorCode: String,
    exception: String,
    output: String,
    programName: String,
    featurePath: String,
    featureName: String,
    featureHash: String,
    workflowPath: String,
    workflow: String,
    srcIp: String,
    srcId: String,
    srcTitle: String,
    srcUuid: String,
    program: {
      type: Object,
      default: null
    },
    steps: {
      type: Object,
      default: null
    },
    metrics: {
      type: Object,
      default: null
    },
    serviceTag: {
      type: String,
      default: null
    },
    prodLine: {
      type: String,
      default: null
    },
    leds: [],
    hidLamps: [],
    gprsNc12: {
      type: String,
      default: null
    },
    gprsOrderFileHash: String,
    gprsInputFileHash: String,
    gprsOutputFileHash: String,
    cancelled: {
      type: Boolean,
      default: false
    }
  }, {
    id: false
  });

  xiconfResultSchema.index({startedAt: -1});
  xiconfResultSchema.index({search: 1, startedAt: -1});
  xiconfResultSchema.index({prodLine: 1, startedAt: -1});
  xiconfResultSchema.index({result: 1, startedAt: -1});
  xiconfResultSchema.index({orderNo: 1, serviceTag: 1, result: 1});

  mongoose.model(exports.name, xiconfResultSchema);
};
