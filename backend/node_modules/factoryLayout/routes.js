// Part of <https://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

'use strict';

module.exports = (app, module) =>
{
  const {express, settings, user, FactoryLayout} = module;

  const canManage = user.auth('FACTORY_LAYOUT:MANAGE');

  express.get(
    '/factoryLayout/settings',
    (req, res, next) =>
    {
      req.rql.selector = {
        name: 'regex',
        args: ['_id', '^(factoryLayout|production)\\.']
      };

      next();
    },
    express.crud.browseRoute.bind(null, app, settings.Setting)
  );

  express.put('/factoryLayout/settings/:id', canManage, settings.updateRoute);

  express.get('/factoryLayout/:id', canManage, express.crud.readRoute.bind(null, app, FactoryLayout));
};
