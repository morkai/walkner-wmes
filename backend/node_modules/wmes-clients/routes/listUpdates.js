// Part of <https://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

'use strict';

const fs = require('fs-extra');

module.exports = async (app, module, req, res, next) =>
{
  const versions = [];

  try
  {
    const files = await fs.readdir(module.config.updatesPath);

    files.forEach(file =>
    {
      if (/^[0-9]+\.7z$/.test(file))
      {
        versions.push(+file.replace('.7z', ''));
      }
    });
  }
  catch (err)
  {
    if (err.code === 'ENOENT')
    {
      try
      {
        await fs.mkdirp(module.config.updatesPath);
      }
      catch (err)
      {
        return next(err);
      }
    }
    else
    {
      return next(err);
    }
  }

  res.json(versions);
};
