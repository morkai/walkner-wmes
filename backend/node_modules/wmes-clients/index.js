// Part of <https://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

'use strict';

const fs = require('fs');
const https = require('https');
const rootCas = require('ssl-root-cas/latest').create();

exports.DEFAULT_CONFIG = {
  mongooseId: 'mongoose',
  expressId: 'express',
  userId: 'user',
  updatesPath: './data/clients/updates',
  apiKey: process.env.WMES_CLIENTS_API_KEY || '',
  caFile: null
};

exports.models = [
  require('./models/wmesClient')
];

exports.userPrivileges = ['WMES:CLIENTS:VIEW', 'WMES:CLIENTS:MANAGE'];

exports.republishTopics = ['wmes.clients.**'];

exports.optionalModules = {
  'mongoose user express': require('./routes')
};

exports.start = (app, module) =>
{
  if (module.config.caFile)
  {
    rootCas.push(fs.readFileSync(module.config.caFile));
  }

  module.httpsAgent = new https.Agent({
    ca: rootCas,
    rejectUnauthorized: false
  });
};
