// Part of <https://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

'use strict';

const mongoSerializer = require('h5.rql/lib/serializers/mongoSerializer');
const report = require('../reports/balancing');

module.exports = (app, module, req, res, next) =>
{
  const reports = app[module.config.reportsId];

  if (!reports)
  {
    return next(app.createError('Reports disabled.', 'UNAVAILABLE', 500));
  }

  const queryOptions = mongoSerializer.fromQuery(req.rql);
  const options = {
    selector: queryOptions.selector
  };

  reports.generateResponse(report, options, req, res, next);
};
