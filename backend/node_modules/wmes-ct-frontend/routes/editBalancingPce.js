// Part of <https://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

'use strict';

module.exports = async (app, module, req, res, next) =>
{
  const {
    CtBalancingPce
  } = module;

  let balancingPce = null;

  try
  {
    balancingPce = await CtBalancingPce.findById(req.params.id);

    if (!balancingPce)
    {
      return next(app.createError('Not found.', 'NOT_FOUND', 404));
    }

    balancingPce.comment = req.body.comment || '';

    await balancingPce.save();
  }
  catch (err)
  {
    return next(err);
  }

  res.json(balancingPce.toJSON());

  app.broker.publish(`${CtBalancingPce.TOPIC_PREFIX}.updated`, {
    updated: [{
      _id: balancingPce._id,
      comment: balancingPce.comment
    }]
  });
};
