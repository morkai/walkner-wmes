// Part of <https://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

'use strict';

const sources = require('./sources');

exports.DEFAULT_CONFIG = {
  mongooseId: 'mongoose',
  userId: 'user',
  expressId: 'express',
  currencies: {},
  updateInterval: 3600 * 1000
};

exports.recordTopics = {
  info: ['currencyRates.synced']
};

exports.republishTopics = [
  'currencyRates.synced',
  'currencyRates.updated'
];

exports.models = [
  require('./models/currencyRate')
];

exports.requiredModules = 'mongoose';

exports.optionalModules = {
  'mongoose': require('./updater'),
  'user express': require('./routes')
};

exports.start = (app, module) =>
{
  module.getSource = currency =>
  {
    if (!sources[currency])
    {
      throw app.createError(`Unknown currency.`, 'INPUT', 400, {currency});
    }

    return sources[currency](app, module, currency);
  };
};
