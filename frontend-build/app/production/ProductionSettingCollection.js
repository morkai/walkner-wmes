// Part of <http://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

define(["underscore","jquery","../settings/SettingCollection","./ProductionSetting"],function(t,e,i,n){"use strict";return i.extend({model:n,topicSuffix:"production.**",initialize:function(t,e){i.prototype.initialize.apply(this,arguments),e.localStorage&&this.setUpLocalStorage()},getValue:function(t){var e=this.get("production."+t);return e?e.getValue():null},prepareValue:function(e,i){return/rearmDowntimeReason$/.test(e)?t.isEmpty(i)?null:i:/spigot(Not)?Patterns$/.test(e)?this.prepareSpigotPatterns(i):/spigotLines$/.test(e)?this.prepareSpigotLines(i):/spigotFinish$/.test(e)?!!i:this.prepareNumericValue(i,0,60)},prepareSpigotPatterns:function(t){return"string"!=typeof t?void 0:t.split("\n").filter(function(t){try{new RegExp(t)}catch(e){return!1}return!!t.trim().length}).join("\n")},prepareSpigotLines:function(t){return"string"!=typeof t?void 0:t.split(",").filter(function(t){return!!t.length}).join(",")},setUpLocalStorage:function(){this.length||this.readLocalData(),this.on("reset change",this.saveLocalData.bind(this))},readLocalData:function(){try{this.reset(JSON.parse(localStorage["PRODUCTION:SETTINGS"]))}catch(t){}},saveLocalData:function(){localStorage["PRODUCTION:SETTINGS"]=JSON.stringify(this.models)}})});