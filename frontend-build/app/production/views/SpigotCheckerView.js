// Part of <http://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

define(["jquery","app/i18n","app/viewport","app/core/View","app/production/templates/spigotChecker"],function(i,t,e,s,o){"use strict";return s.extend({template:o,dialogClassName:"production-modal production-spigotChecker-modal",events:{submit:function(){var i=this.$id("submit").prop("disabled",!0),s=this.$id("nc12").val().match(/([0-9]{12})/),o=(s?s[1]:"").trim();return o.length&&this.model.checkSpigot(this.options.component,o)?(e.msg.show({type:"success",time:3e3,text:t("production",t("production","spigotChecker:success"))}),this.closeDialog()):(this.$id("nc12")[0].setCustomValidity(t("production","spigotChecker:nc12:invalid")),this.timers.submit=setTimeout(function(){i.prop("disabled",!1).click()},1)),!1}},initialize:function(){this.lastKeyPressAt=0,i(window).on("keydown."+this.idPrefix,this.onKeyDown.bind(this)).on("keypress."+this.idPrefix,this.onKeyPress.bind(this))},destroy:function(){i(window).off("."+this.idPrefix)},serialize:function(){return{idPrefix:this.idPrefix,component:this.options.component}},onDialogShown:function(i){this.closeDialog=i.closeDialog.bind(i),this.$id("nc12").focus()},closeDialog:function(){},onKeyDown:function(i){if(8===i.keyCode)return this.lastKeyPressAt=Date.now(),this.$id("nc12").val("")[0].setCustomValidity(""),!1},onKeyPress:function(i){if(13===i.keyCode&&this.$id("submit").click(),!(i.keyCode<32||i.keyCode>126)){var t=Date.now(),e=t-this.lastKeyPressAt>333?"":this.$id("nc12").val(),s=String.fromCharCode(i.keyCode);return this.$id("nc12").val(e+s)[0].setCustomValidity(""),this.lastKeyPressAt=t,!1}}})});