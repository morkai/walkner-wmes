define(["jquery","app/i18n","app/viewport","app/core/View","app/prodSerialNumbers/ProdSerialNumberCollection","../snManager","./SnListView","app/production/templates/snChecker"],function(e,o,i,s,t,r,a,n){"use strict";return s.extend({template:n,dialogClassName:"production-modal production-snChecker-modal",localTopics:{"production.taktTime.snScanned":function(e){this.$id("orderNo").val(e.orderNo||""),this.$id("serialNo").val(e.serialNo||""),this.$id("submit").click()}},events:{"click #-list":function(){i.closeDialog();var e=new a({collection:new t(null,{rqlQuery:"sort(-scannedAt)&limit(15)&prodLine=string:"+(this.model.get("prodLine")||"")})});i.showDialog(e,o("production","taktTime:list:title"))},submit:function(){for(var e=this.$id("message").removeClass("message-info message-error message-success").addClass("message-warning").html(o("production","taktTime:check:checking")),i=parseInt(this.$id("orderNo").val(),10),s=parseInt(this.$id("serialNo").val(),10),t=s.toString();t.length<4;)t="0"+t;for(var a="PL04."+i+"."+t,n=i+t;n.length<17;)n="0"+n;if(n="P"+n,r.contains(a)||r.contains(n))return e.removeClass("message-warning").addClass("message-info").html(o("production","taktTime:check:local")),!1;var l=this.ajax({url:"/prodSerialNumbers?orderNo="+i+"&serialNo="+s+"&limit(1)"}),c=this.model.get("prodLine")||null;return l.fail(function(){e.removeClass("message-warning").addClass("message-danger").html(o("production","taktTime:check:error"))}),l.done(function(i){e.removeClass("message-warning");var s=(i.collection||[])[0];s?e.addClass("message-info").html(o("production","taktTime:check:"+(s.prodLine===c?"local":"remote"),{prodLine:s.prodLine})):e.addClass("message-success").html(o("production","taktTime:check:notFound"))}),!1}},getTemplateData:function(){return{orderNo:this.model.prodShiftOrder.get("orderId")||""}},onDialogShown:function(e){this.closeDialog=e.closeDialog.bind(e),this.$id("orderNo").focus()},closeDialog:function(){}})});