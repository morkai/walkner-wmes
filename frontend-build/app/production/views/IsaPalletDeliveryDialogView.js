define(["app/i18n","app/core/View","app/data/localStorage","app/data/isaPalletKinds","app/production/templates/isaPalletDeliveryDialog"],function(t,i,e,a,n){"use strict";return i.extend({template:n,dialogClassName:"production-modal",nlsDomain:"production",events:{"input #-qty":"checkQtyValidity","click .btn[data-id]":function(t){this.$id("palletKind").find(".active").removeClass("active"),this.$(t.currentTarget).addClass("active").blur(),this.toggleSubmit()},submit:function(t){t.preventDefault();var i=this.$id("palletKind").find(".active").attr("data-id"),a=+this.$id("qty").val();e.setItem("PRODUCTION:ISA:LAST_DELIVERY",JSON.stringify({palletKind:i,qty:a})),this.trigger("picked",i,a)}},destroy:function(){this.options.vkb&&this.options.vkb.hide()},getTemplateData:function(){return{palletKinds:a.map(function(t){return{id:t.id,text:t.get("fullName")}})}},afterRender:function(){this.options.embedded&&this.options.vkb.show(this.$id("qty").addClass("is-embedded")[0],this.onVkbValueChange.bind(this));var t=JSON.parse(e.getItem("PRODUCTION:ISA:LAST_DELIVERY")||"{}");this.$id("qty").val(t.qty||8),this.$id("palletKind").find('.btn[data-id="'+t.palletKind+'"]').click(),this.checkQtyValidity()},toggleSubmit:function(){this.$id("submit").prop("disabled",!this.$id("palletKind").find(".active").length)},checkQtyValidity:function(){var i=this.$id("qty"),e=i.val().replace(/[^0-9]+/g,"")||0,a="";e<1?a=t("production","error:min",{min:1}):e>9&&(a=t("production","error:max",{max:9})),i.val(e||"")[0].setCustomValidity(a),this.toggleSubmit()},onVkbValueChange:function(){this.checkQtyValidity()},onDialogShown:function(t){this.closeDialog=t.closeDialog.bind(t),this.$id("qty").focus()},closeDialog:function(){}})});