define(["app/i18n","app/viewport","app/core/View","app/production/templates/unlockDialog"],function(i,o,t,e){"use strict";return t.extend({template:e,dialogClassName:"production-modal",events:{submit:function(i){i.preventDefault();var o=this.$id("submit")[0];if(!o.disabled){o.disabled=!0;var t={prodLine:this.model.prodLine.id,secretKey:this.model.getSecretKey(),login:this.$id("login").val(),password:this.$id("password").val()};this.socket.emit("production.lock",t,this.handleLockResponse.bind(this))}},"focus [data-vkb]":function(i){this.options.embedded&&this.options.vkb&&this.options.vkb.show(i.target)}},destroy:function(){this.options.vkb&&this.options.vkb.hide()},getTemplateData:function(){return{type:"lock",prodLine:this.model.prodLine.id}},onDialogShown:function(i){this.closeDialog=i.closeDialog.bind(i),this.$id("login").focus()},closeDialog:function(){},handleLockResponse:function(i){if(i)return this.$id("password").val(""),"INVALID_PASSWORD"===i.message?this.$id("password").focus():this.$id("login").val("").focus(),o.msg.show({type:"error",time:3e3,text:this.t.has("unlockDialog:error:"+i.message)?this.t("unlockDialog:error:"+i.message):this.t("unlockDialog:error:LOCK_FAILURE")}),this.$id("submit").prop("disabled",!1);this.model.setSecretKey(null),this.closeDialog()}})});