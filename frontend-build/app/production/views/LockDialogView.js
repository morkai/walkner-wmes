// Part of <https://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

define(["app/i18n","app/viewport","app/core/View","app/production/templates/unlockDialog"],function(i,e,o,s){"use strict";return o.extend({template:s,dialogClassName:"production-modal",events:{submit:function(i){i.preventDefault();var e=this.$id("submit")[0];if(!e.disabled){e.disabled=!0;var o={prodLine:this.model.prodLine.id,secretKey:this.model.getSecretKey(),login:this.$id("login").val(),password:this.$id("password").val()};this.socket.emit("production.lock",o,this.handleLockResponse.bind(this))}}},serialize:function(){return{idPrefix:this.idPrefix,type:"lock",prodLine:this.model.prodLine.id}},onDialogShown:function(i){this.closeDialog=i.closeDialog.bind(i)},closeDialog:function(){},handleLockResponse:function(o){if(o)return this.$id("password").val(""),"INVALID_PASSWORD"===o.message?this.$id("password").focus():this.$id("login").val("").focus(),e.msg.show({type:"error",time:3e3,text:i.has("production","unlockDialog:error:"+o.message)?i("production","unlockDialog:error:"+o.message):i("production","unlockDialog:error:LOCK_FAILURE")}),this.$id("submit").prop("disabled",!1);this.model.setSecretKey(null),this.closeDialog()}})});