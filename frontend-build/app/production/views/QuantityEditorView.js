define(["underscore","app/i18n","app/viewport","app/core/View","app/production/templates/quantityEditor"],function(t,i,e,a,n){"use strict";return a.extend({template:n,events:{'change input[name="hour"]':function(i){var e=this.$id("value").val(this.model.hours[i.target.value].value);this.checkValidity(),t.defer(function(){e.select()})},"input #-value":"checkValidity",submit:function(t){t.preventDefault();var i=parseInt(this.$('input[name="hour"]:checked').val(),10),e=parseInt(this.$id("value").val(),10),a=this.model.hours[i];a&&((isNaN(e)||e===a.value||e<0)&&(e=null),this.trigger("quantityChanged",i,e))}},destroy:function(){this.options.vkb&&this.options.vkb.hide()},serialize:function(){return{idPrefix:this.idPrefix,hours:this.model.hours,maxQuantity:this.model.maxQuantity,embedded:this.options.embedded}},afterRender:function(){this.$id("value").select()},onDialogShown:function(){this.options.vkb&&this.options.vkb.show(this.$id("value")[0],this.checkValidity.bind(this)),this.$('input[name="hour"][value="'+this.model.selected+'"]').click()},checkValidity:function(){var t=this.$id("value"),e=parseInt(t.val(),10);isNaN(e)||e<0?t.val("")[0].setCustomValidity(""):e>this.model.maxQuantity?t[0].setCustomValidity(i("production","quantityEditor:maxQuantity",{max:this.model.maxQuantity})):t[0].setCustomValidity("")}})});