define(["underscore","app/i18n","app/viewport","app/core/View","app/users/util/setUpUserSelect2","app/production/templates/personelPicker"],function(e,i,n,t,s,l){return t.extend({template:l,dialogClassName:"production-modal",localTopics:{"socket.connected":"render","socket.disconnected":"render"},events:{"keypress .select2-container":function(e){13===e.which&&(this.$el.submit(),e.preventDefault())},submit:function(e){e.preventDefault();var i=this.$(".btn-primary")[0];if(!i.disabled){i.disabled=!0;var n={id:null,label:null};if(this.socket.isConnected()){var t=this.$id("user").select2("data");t&&(n.id=t.id,n.label=t.name)}else n.label=this.$id("user").val().trim().replace(/[^0-9]+/g,"");this.trigger("userPicked",null!==n.label&&n.label.length?n:null)}}},initialize:function(){this.idPrefix=e.uniqueId("personelPicker")},destroy:function(){this.$('.select2-offscreen[tabindex="-1"]').select2("destroy")},serialize:function(){var e=!this.socket.isConnected();return{idPrefix:this.idPrefix,offline:e,label:i("production","personelPicker:"+(e?"offline":"online")+":label"),placeholder:i("production","personelPicker:"+(e?"offline":"online")+":placeholder")}},afterRender:function(){var e=this.$id("user");this.socket.isConnected()?(s(e.removeClass("form-control"),{dropdownCssClass:"production-dropdown"}),e.select2("focus")):e.focus()},onDialogShown:function(){this.$id("user").focus().select2("focus")}})});