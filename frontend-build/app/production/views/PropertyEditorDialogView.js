// Part of <https://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

define(["jquery","app/i18n","app/core/View","app/production/templates/propertyEditorDialog"],function(i,t,e,n){"use strict";return e.extend({template:n,dialogClassName:"production-modal",events:{"focus #-value":function(i){this.options.vkb&&this.options.vkb.show(i.target,this.onVkbValueChange)},"input #-value":"checkMinMaxValidity","blur #-value":"checkMinMaxValidity",submit:function(i){i.preventDefault();var t=this.parseInt("value");t!==this.options.getValue()&&this.options.setValue(t),this.closeDialog()}},initialize:function(){this.onVkbValueChange=this.onVkbValueChange.bind(this)},destroy:function(){this.options.vkb&&this.options.vkb.hide()},serialize:function(){return{idPrefix:this.idPrefix,property:this.options.property,value:this.options.value,min:this.options.min||0,max:this.options.max}},onDialogShown:function(i){this.closeDialog=i.closeDialog.bind(i),this.$id("value").select()},closeDialog:function(){},parseInt:function(i){var t=parseInt(this.$id(i).val(),10);return isNaN(t)||t<0?0:t},onVkbValueChange:function(i){this.checkMinMaxValidity({target:i})},checkMinMaxValidity:function(i){var e=i.target,n=parseInt(e.getAttribute("max"),10);if(!isNaN(n)){var o=parseInt(e.getAttribute("min"),10)||0,a=parseInt(e.value,10)||0,s="";a<o?s=t("production","error:min",{min:o}):a>n&&(s=t("production","error:max",{max:n})),e.setCustomValidity(s)}}})});