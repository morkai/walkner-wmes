define(["jquery","app/i18n","app/core/View","app/production/templates/propertyEditorDialog"],function(t,i,a,o){"use strict";return a.extend({template:o,dialogClassName:"production-modal",events:{"focus #-value":function(t){this.options.vkb&&this.options.vkb.show(t.target,this.onVkbValueChange)},"input #-value":"checkMinMaxValidity","blur #-value":"checkMinMaxValidity",submit:function(t){t.preventDefault();var i=this[this.options.float?"parseFloat":"parseInt"]("value");i!==this.options.getValue()&&this.options.setValue(i),this.closeDialog()}},initialize:function(){this.onVkbValueChange=this.onVkbValueChange.bind(this)},destroy:function(){this.options.vkb&&this.options.vkb.hide()},getTemplateData:function(){return{property:this.options.property,value:(this.options.value||0).toLocaleString(),min:this.options.min||0,max:this.options.max,pattern:this.options.pattern||"",float:this.options.float}},onDialogShown:function(t){this.closeDialog=t.closeDialog.bind(t),this.$id("value").select()},closeDialog:function(){},parseFloat:function(t){var i=Math.round(10*parseFloat(this.$id(t).val().replace(",",".")))/10;return isNaN(i)||i<0?0:i},parseInt:function(t){var i=parseInt(this.$id(t).val(),10);return isNaN(i)||i<0?0:i},onVkbValueChange:function(t){this.checkMinMaxValidity({target:t})},checkMinMaxValidity:function(t){var a=t.target,o=parseInt(a.getAttribute("max"),10);if(!isNaN(o)){var e=parseInt(a.getAttribute("min"),10)||0,n=this[this.options.float?"parseFloat":"parseInt"]("value"),s="";n<e?s=i("production","error:min",{min:e}):n>o&&(s=i("production","error:max",{max:o})),a.setCustomValidity(s)}}})});