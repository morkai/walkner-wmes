// Part of <http://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

define(["app/broker"],function(e){"use strict";function n(){var n=o.match(/^P0*([0-9]+)([0-9]{4})/),t="old";n||(n=o.match(/^[A-Z0-9]{4}\.([0-9]+)\.([0-9]+)/),t="new"),n&&e.publish("production.taktTime.snScanned",{_id:n[0],scannedAt:new Date,orderNo:n[1],serialNo:+n[2]}),o=""}var t="PRODUCTION:SN",i=null,o="",r=JSON.parse(localStorage[t]||"{}");return{handleKeyboardEvent:function(e){var t=e.which>=48&&e.which<=57,r=e.which>=65&&e.which<=90,a=190===e.which;(t||r||a)&&(o+=a?".":String.fromCharCode(e.which),clearTimeout(i),i=setTimeout(n,100))},contains:function(e){return!!r[e._id]},add:function(e){r[e._id]=1,localStorage[t]=JSON.stringify(r)},clear:function(){r={},localStorage.removeItem(t)}}});