define(["underscore","socket.io","app/broker","app/core/Socket"],function(n,o,e,c){"use strict";var t={};window.ArrayBuffer&&window.Uint8Array&&(t.binary="1"),window.WMES_GET_COMMON_HEADERS&&Object.assign(t,window.WMES_GET_COMMON_HEADERS());var i=new c(o({path:"/sio",transports:["websocket"],timeout:1e4,reconnectionDelay:500,autoConnect:!1,query:t})),s=!1,r=!1;return i.on("connecting",function(){e.publish("socket.connecting",!1)}),i.on("connect",function(){s||(s=!0,e.publish("socket.connected",!1))}),i.on("connect_error",function(){s||e.publish("socket.connectFailed",!1)}),i.on("message",function(n){e.publish("socket.message",n)}),i.on("disconnect",function(){e.publish("socket.disconnected")}),i.on("reconnecting",function(){r=!0,e.publish("socket.connecting",!0)}),i.on("reconnect",function(){r=!1,e.publish("socket.connected",!0)}),i.on("reconnect_error",function(){r&&(r=!1,e.publish("socket.connectFailed",!0))}),i.on("error",function(){r&&e.publish("socket.connectFailed",!0)}),window.socket=i,i});