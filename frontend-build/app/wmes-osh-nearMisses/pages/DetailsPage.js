define(["jquery","app/viewport","app/wmes-osh-common/pages/DetailsPage","../NearMiss","../views/InProgressFormView","app/wmes-osh-nearMisses/templates/props"],function(e,t,s,i,n,o){"use strict";return s.extend({propsTemplate:o,actions:function(){const e=s.prototype.actions.apply(this,arguments);return e.unshift(this.createNextStepAction()),e},createNextStepAction:function(){return i.can.inProgress(this.model)?{icon:"check",type:"info",label:this.t("nextStep:inProgress:action"),callback:this.handleInProgressAction.bind(this)}:null},handleInProgressAction:function(s){const o=e(s.target).closest(".btn").prop("disabled",!0);if(this.model.get("implementer")&&this.model.get("plannedAt")&&"unspecified"!==this.model.get("resolution").type){t.msg.saving();const e=this.ajax({method:"PATCH",url:this.model.url(),data:JSON.stringify({status:"inProgress"})});return e.fail(()=>t.msg.savingFailed()),e.done(()=>t.msg.saved()),void e.always(()=>o.prop("disabled",!1))}const r=new n({model:new i(JSON.parse(JSON.stringify(this.model.attributes)))});r.once("dialog:hidden",()=>o.prop("disabled",!1)),t.showDialog(r,this.t("nextStep:inProgress:title"))}})});