define(["require","app/i18n","app/time","app/user","app/wmes-osh-common/Entry"],function(e,t,i,n,o){"use strict";const s=o.extend({urlRoot:"/osh/nearMisses",clientUrlRoot:"#osh/nearMisses",topicPrefix:"osh.nearMisses",privilegePrefix:"OSH:NEAR_MISSES",nlsDomain:"wmes-osh-nearMisses",getModelType:function(){return"nearMiss"},serialize:function(){const i=e("app/wmes-osh-common/dictionaries"),n=o.prototype.serialize.apply(this,arguments);return n.priority=i.getLabel("priority",n.priority),n.materialLoss=t("core",`BOOL:${n.materialLoss}`),n},serializeRow:function(){const e=o.prototype.serializeRow.apply(this,arguments);return e.eventDate=e.eventDate?i.utc.format(e.eventDate,"L, LT"):"",e.resolution&&(e.resolution._id?e.resolution=t(this.nlsDomain,`resolution:link:${e.resolution.type}`,e.resolution):e.resolution=t(this.nlsDomain,`resolution:desc:${e.resolution.type}`)),e},serializeDetails:function(){const e=o.prototype.serializeDetails.apply(this,arguments);return e.eventDate=i.utc.format(e.eventDate,t(this.nlsDomain,"details:eventDate:format")),e.resolution._id?e.resolution=t(this.nlsDomain,`resolution:desc:${e.resolution.type}`)+", "+t(this.nlsDomain,`resolution:link:${e.resolution.type}`,e.resolution):e.resolution=t(this.nlsDomain,`resolution:desc:${e.resolution.type}`),e}},{RID_PREFIX:"Z",TIME_PROPS:["createdAt","startedAt","finishedAt"],USER_PROPS:["creator","implementer","coordinators"],DICT_PROPS:["division","workplace","department","building","location","station","kind","eventCategory","reasonCategory"],DESC_PROPS:["kind","eventCategory","reasonCategory"]});return s.can=Object.assign({},s.can,{manage:function(){return n.isAllowedTo("OSH:NEAR_MISSES:MANAGE")},editResolutionType:function(e){return!!(this.can||this).manage()||e.isCoordinator()},editResolutionId:function(e){return!!(this.can||this).manage()||(!!e.isCoordinator()||!("inProgress"!==e.get("status")||!e.isImplementer()))},inProgress:function(e){const t=e.get("status");return("new"===t||"paused"===t)&&(!!(this.can||this).manage()||e.isCoordinator())},paused:function(e){const t=e.get("status");return("new"===t||"inProgress"===t)&&(!!(this.can||this).manage()||e.isCoordinator())},cancelled:function(e){const t=e.get("status");return"finished"!==t&&"cancelled"!==t&&(!!(this.can||this).manage()||("new"===t?e.isCreator()||e.isCoordinator():"inProgress"===t&&e.isCoordinator()))}}),s});