define(["require","app/i18n","app/time","app/user","app/core/Model","app/core/templates/userInfo"],function(e,i,t,r,n,a){"use strict";const o={long:!1},s={long:!0};return n.extend({urlRoot:"/osh/nearMisses",clientUrlRoot:"#osh/nearMisses",topicPrefix:"osh.nearMisses",privilegePrefix:"OSH:DICTIONARIES",nlsDomain:"wmes-osh-nearMisses",labelAttribute:"_id",defaults:{},serialize:function(){const e=this.toJSON();return e.kind=i(this.nlsDomain,`kind:${e.kind}`),e.priority=i(this.nlsDomain,`priority:${e.priority}`),["creator","manager","coordinator","implementer"].forEach(i=>{e[i]=a({userInfo:e[i],noIp:!0})}),e},serializeRow:function(){const i=e("app/wmes-osh-common/dictionaries"),r=this.serialize(),n=i.eventCategories.get(r.eventCategory),a=i.reasonCategories.get(r.reasonCategory);return r.createdAt=t.format(r.createdAt,"L, LT"),r.workplace=i.getLabel("workplace",r.workplace,o),r.division=i.getLabel("division",r.division,o),r.building=i.getLabel("building",r.building,o),n&&(r.eventCategory=n.getLabel(o)),a&&(r.reasonCategory=a.getLabel(o)),r},serializeDetails:function(){const i=e("app/wmes-osh-common/dictionaries"),r=this.serialize(),n=i.eventCategories.get(r.eventCategory),a=i.reasonCategories.get(r.reasonCategory);return r.createdAt=t.format(r.createdAt,"LL, LT"),r.workplace=i.getLabel("workplace",r.workplace,s),r.division=i.getLabel("division",r.division,s),r.building=i.getLabel("building",r.building,s),n&&(r.eventCategory=n.getLabel(s)),a&&(r.reasonCategory=a.getLabel(s)),r},isParticipant:function(){return this.isCreator()||this.isImplementer()||this.isCoordinator()||this.isManager()},isCreator:function(){return this.get("creator").id===r.data._id},isImplementer:function(){return(this.get("implementer")||{}).id===r.data._id},isCoordinator:function(){return(this.get("coordinator")||{}).id===r.data._id},isManager:function(){return(this.get("manager")||{}).id===r.data._id}},{can:{manage:function(){return r.isAllowedTo("OSH:NEAR_MISSES:MANAGE")},edit:function(e){return(this.can||this).manage()||!!e&&e.isParticipant()}}})});