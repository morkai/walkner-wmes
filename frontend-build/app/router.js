// Part of <http://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

define(["backbone","h5.rql/specialOperators","app/broker","app/viewport","app/core/Router","app/core/pages/ErrorPage"],function(e,r,t,a,c,o){"use strict";Object.keys(r).forEach(function(e){delete r[e]}),e.Router.prototype._extractParameters=function(e,r){return e.exec(r).slice(1)};var n=new c(t),u=new e.Router;u.route("*catchall","catchall",function(e){n.dispatch(e)}),t.subscribe("router.navigate",function(e){var r=e.url,t=r.charAt(0);("#"===t||"/"===t)&&(r=r.substr(1));var a=e.trigger===!0,c=e.replace===!0;u.navigate(r,{trigger:a,replace:c}),!a&&c&&n.setCurrentRequest(r)});var i="/404";return t.subscribe("router.404",function(e){e.path===i?a.showPage(new o({code:404,req:e})):n.dispatch(i)}),window.router=n,n});