// Part of <http://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

define(["backbone","h5.rql/specialOperators","app/broker","app/viewport","app/core/Router","app/core/pages/ErrorPage"],function(e,r,t,a,o,u){"use strict";e.Router.prototype._extractParameters=function(e,r){return e.exec(r).slice(1)};var c=new o(t),i=new e.Router;i.route("*catchall","catchall",function(e){c.dispatch(e)}),t.subscribe("router.navigate",function(e){var r=e.url,t=r.charAt(0);"#"!==t&&"/"!==t||(r=r.substr(1));var a=e.trigger===!0,o=e.replace===!0;i.navigate(r,{trigger:a,replace:o}),!a&&o&&c.setCurrentRequest(r)});var s="/404";return t.subscribe("router.404",function(e){var r=e.req;r.path===s?a.showPage(new u({model:{code:404,req:r,previousUrl:c.previousUrl}})):c.dispatch(s)}),t.subscribe("viewport.page.loadingFailed",function(e){a.showPage(new u({model:{code:e.xhr.status,req:c.currentRequest,previousUrl:c.previousUrl,xhr:e.xhr}}))}),window.router=c,c});