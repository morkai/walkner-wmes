// Part of <https://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

define(["backbone","h5.rql/specialOperators","app/broker","app/viewport","app/core/Router","app/core/pages/ErrorPage"],function(r,e,t,a,o,u){"use strict";r.Router.prototype._extractParameters=function(r,e){return r.exec(e).slice(1)};var c=new o(t),i=new r.Router;i.route("*catchall","catchall",function(r){c.dispatch(r)}),t.subscribe("router.navigate",function(r){var e=r.url,t=e.charAt(0);"#"!==t&&"/"!==t||(e=e.substr(1));var a=r.trigger===!0,o=r.replace===!0;i.navigate(e,{trigger:a,replace:o}),!a&&o&&c.setCurrentRequest(e)});var s="/404";return t.subscribe("router.404",function(r){var e=r.req;e.path===s?a.showPage(new u({model:{code:404,req:e,previousUrl:c.previousUrl}})):c.dispatch(s)}),t.subscribe("viewport.page.loadingFailed",function(r){a.showPage(new u({model:{code:r.xhr?r.xhr.status:0,req:c.currentRequest,previousUrl:c.previousUrl,xhr:r.xhr}}))}),window.router=c,c});