define(function(){"use strict";var e=null,t=null,o=null;function n(a){var l=a.data;window.IS_EMBEDDED&&window.IS_LINUX&&"localStorage"===l.type&&(window.removeEventListener("message",n),o=l.data,0===Object.keys(o).length&&(Object.keys(localStorage).forEach(function(e){o[e]=localStorage[e]}),window.parent.postMessage({type:"localStorage",action:"write",data:o},"*")),t&&(clearTimeout(t),t=null),e&&(e(),e=null))}return window.addEventListener("message",n),{start:function(a){if(o)return a();if(e){var l=e;e=function(){l(),a()}}else e=a,t=setTimeout(function(){e(),window.removeEventListener("message",n),e=null,t=null},3333),window.parent.postMessage({type:"localStorage",action:"read"},"*")},getItem:function(e){var t=(o||localStorage)[e];return void 0===t?null:t},setItem:function(e,t){localStorage.setItem(e,t),o&&function(e,t){o[e]=t,window.parent.postMessage({type:"localStorage",action:"setItem",key:e,value:t},"*")}(e,t)},removeItem:function(e){localStorage.removeItem(e),o&&function(e){delete o[e],window.parent.postMessage({type:"localStorage",action:"removeItem",key:e},"*")}(e)},clear:function(){localStorage.clear(),o&&(o={},window.parent.postMessage({type:"localStorage",action:"clear"},"*"))}}});