define(function(){"use strict";var e=null,t=null,o=null;function a(n){var l=n.data;"localStorage"===l.type&&(window.removeEventListener("message",a),o=l.data,0===Object.keys(o).length&&(Object.keys(localStorage).forEach(function(e){o[e]=localStorage[e]}),window.parent.postMessage({type:"localStorage",action:"write",data:o},"*")),t&&(clearTimeout(t),t=null),e&&(e(),e=null))}return window.addEventListener("message",a),{start:function(n){if(o)return n();if(e){var l=e;e=function(){l(),n()}}else e=n,t=setTimeout(function(){e(),window.removeEventListener("message",a),e=null,t=null},333),window.parent.postMessage({type:"localStorage",action:"read"},"*")},getItem:function(e){var t=(o||localStorage)[e];return void 0===t?null:t},setItem:function(e,t){o?function(e,t){o[e]=t,window.parent.postMessage({type:"localStorage",action:"setItem",key:e,value:t},"*")}(e,t):localStorage.setItem(e,t)},removeItem:function(e){o?function(e){delete o[e],window.parent.postMessage({type:"localStorage",action:"removeItem",key:e},"*")}(e):localStorage.removeItem(e)},clear:function(){o?window.parent.postMessage({type:"localStorage",action:"clear"},"*"):localStorage.clear()}}});