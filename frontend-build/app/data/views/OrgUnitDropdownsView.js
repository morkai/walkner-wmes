define(["underscore","jquery","app/i18n","app/core/View","../divisions","../subdivisions","../mrpControllers","../prodFlows","../workCenters","../prodLines"],function(e,t,i,n,r,o,s,a,l,c){function u(e){return{id:e.id,text:e.getLabel()}}var p={DIVISION:1,SUBDIVISION:2,MRP_CONTROLLER:3,PROD_FLOW:4,WORK_CENTER:5,PROD_LINE:6},d={1:"division",2:"subdivision",3:"mrpController",4:"prodFlow",5:"workCenter",6:"prodLine"},h=function(){return!0};return n.extend({tagName:"div",className:"orgUnitDropdowns",initialize:function(){this.idPrefix=e.uniqueId("orgUnitDropdown")},afterRender:function(){0!==this.$el.children().length&&this.$el.empty(),this.options.noGrid!==!0&&this.$el.addClass("row");var e=this.options.orgUnit||p.DIVISION;e>=p.DIVISION&&this.renderDivisionDropdown(),e>=p.SUBDIVISION&&this.renderSubdivisionDropdown(),e>=p.MRP_CONTROLLER&&this.renderMrpControllerDropdown(),e>=p.PROD_FLOW&&this.renderProdFlowDropdown(),e>=p.WORK_CENTER&&this.renderWorkCenterDropdown(),e>=p.PROD_LINE&&this.renderProdLineDropdown()},focus:function(){return this.$id("division").select2("focus"),this},selectValue:function(e,t){var i=!t;switch(t||this.options.orgUnit){case p.DIVISION:this.selectDivision(e,i);break;case p.SUBDIVISION:this.selectSubdivision(e,i);break;case p.MRP_CONTROLLER:this.selectMrpController(e,i);break;case p.PROD_FLOW:this.selectProdFlow(e,i);break;case p.WORK_CENTER:this.selectWorkCenter(e,i);break;case p.PROD_LINE:this.selectProdLine(e,i)}return this},selectDivision:function(e,t){return this.selectModel(e,null,r,"division",t)},selectSubdivision:function(e,t){return this.selectModel(e,"selectDivision",o,"subdivision",t)},selectMrpController:function(e,t){return this.selectModel(e,"selectSubdivision",s,"mrpController",t)},selectProdFlow:function(e,t){return e?e.get("prodFlow")?this.selectModel(e,"selectMrpController",a,"prodFlow",t):e.get("mrpController")?(e=this.selectMrpController(e,t),e&&this.$id("prodFlow").select2("val",null),e):null:null},selectWorkCenter:function(e,t){return this.selectModel(e,"selectProdFlow",l,"workCenter",t)},selectProdLine:function(){throw new Error("TODO")},selectModel:function(e,t,i,n,r){if(!e)return null;var o=e.get(n);Array.isArray(o)&&(o=o[0]);var s=i.get(o);return null!==t&&(s=this[t](s,r)),s?(this.$id(n).select2("val",o).trigger({type:"change",val:o,selectFirst:r}),e):null},createDropdownElement:function(e,n){var r=this.idPrefix+"-"+e,o=t('<div class="form-group"><label for="'+r+'">'+i("core","ORG_UNIT:"+e)+"</label>"+'<input id="'+r+'" name="'+e+'">'+"</div>");return this.options.noGrid!==!0&&o.addClass("col-lg-"+Math.floor(12/this.options.orgUnit)),o.appendTo(this.el).find("input").select2({data:n||[],placeholder:" ",allowClear:this.options.allowClear||this.options.orgUnit===p.PROD_FLOW,multiple:this.options.multiple&&e===d[this.options.orgUnit]})},onChange:function(e,t,i,n){var r=[];null!==n.val&&(r=t.filter(function(e){var t=e.get(i);return Array.isArray(t)?-1!==t.indexOf(n.val):t===n.val}).map(u));var o={data:r,placeholder:" ",allowClear:!!this.options.allowClear||"mrpController"===i&&this.options.orgUnit===p.PROD_FLOW,multiple:this.options.multiple&&e.attr("name")===d[this.options.orgUnit]};e.select2("val",null),e.select2(o),r.length&&n.selectFirst!==!1&&e.select2("val",r[0].id),e.trigger({type:"change",val:r.length?r[0].id:null})},renderDivisionDropdown:function(){this.createDropdownElement("division",r.filter(this.options.divisionFilter||h).map(u))},renderSubdivisionDropdown:function(){var e=this.createDropdownElement("subdivision");this.$id("division").on("change",this.onChange.bind(this,e,o,"division"))},renderMrpControllerDropdown:function(){var e=this.createDropdownElement("mrpController");this.$id("subdivision").on("change",this.onChange.bind(this,e,s,"subdivision"))},renderProdFlowDropdown:function(){var e=this.createDropdownElement("prodFlow");this.$id("mrpController").on("change",this.onChange.bind(this,e,a,"mrpController"))},renderWorkCenterDropdown:function(){var e=this.createDropdownElement("workCenter");this.$id("prodFlow").on("change",this.onChange.bind(this,e,l,"prodFlow"))},renderProdLineDropdown:function(){var e=this.createDropdownElement("prodLine");this.$id("workCenter").on("change",this.onChange.bind(this,e,c,"prodLine"))}},{ORG_UNIT:p})});