define(["app/time","app/broker","app/pubsub"],function(e,n,u){"use strict";return function(e){var n=null,l=null,t=null;function i(){t=null,null!==l&&(n.destroy(),n=null,l=null)}return{acquire:function(){return null!==t&&(clearTimeout(t),t=null),null===l&&(n=u.sandbox(),l=e(n),function(e,n){var u=n.getTopicPrefix();e.subscribe(u+".added",function(e){n.add(e.model)}),e.subscribe(u+".edited",function(e){var u=n.get(e.model._id);u?u.set(e.model):n.add(e.model)}),e.subscribe(u+".deleted",function(e){n.remove(e.model._id)})}(n,l)),l},release:function(){null!==t&&clearTimeout(t),t=setTimeout(i,3e4)}}}});