define(["./divisions","./subdivisions","./mrpControllers","./prodFlows","./workCenters","./prodLines"],function(r,n,i,t,e,o){"use strict";var l={division:"subdivision",subdivision:"mrpController",mrpController:"prodFlow",mrpControllers:"prodFlow",prodFlow:"workCenter",workCenter:"prodLine",prodLine:null},s={prodLine:"workCenter",workCenter:"prodFlow",prodFlow:"mrpController",mrpController:"subdivision",mrpControllers:"subdivision",subdivision:"division",division:null},u={division:r,subdivision:n,mrpController:i,mrpControllers:i,prodFlow:t,workCenter:e,prodLine:o};return{TYPES:{division:!0,subdivision:!0,mrpController:!0,mrpControllers:!0,prodFlow:!0,workCenter:!0,prodLine:!0},getCollection:function(r){return u[r]||null},getProdFlowsForSubdivision:function(r){return"string"==typeof r&&(r=n.get(r)),r?t.filter(function(n){return n.getSubdivision()===r}):[]},getAllByType:function(r){return u[r].models},getActiveByType:function(r,n){return n||(n=function(){return!0}),u[r].models.filter(function(r){return!r.get("deactivatedAt")&&n(r)})},getAllDivisions:function(){return r.models},getAllForProdLine:function(l){"string"==typeof l&&(l=o.get(l));var s={division:null,subdivision:null,mrpControllers:null,prodFlow:null,workCenter:null,prodLine:null};if(!l)return s;s.prodLine=l.id;var u=e.get(l.get("workCenter"));if(!u)return s;s.workCenter=u.id;var d=t.get(u.get("prodFlow"));if(!d)return s;s.prodFlow=d.id;var p=d.get("mrpController");if(!Array.isArray(p)||!p.length)return s;if(s.mrpControllers=p,!(p=i.get(p[0])))return s;var f=n.get(p.get("subdivision"));if(!f)return s;s.subdivision=f.id;var g=r.get(f.get("division"));return g?(s.division=g.id,s):s},getType:function(l){if(null===l)return null;if(l.constructor===o.model)return"prodLine";if(l.constructor===e.model)return"workCenter";if(l.constructor===t.model)return"prodFlow";if(l.constructor===i.model)return"mrpController";if(l.constructor===n.model)return"subdivision";if(l.constructor===r.model)return"division";throw new Error("Unknown org unit type!")},getChildType:function(r){return l[r]||"division"},getChildren:function(r){var n=this.getType(r),i=this.getChildType(n),t=u[i];return t?function(r,n,i){return r.filter(function(r){var t=r.get(n);return!!t&&(Array.isArray(t)?-1!==t.indexOf(i.id):t===i.id)})}(t,n,r):[]},getByTypeAndId:function(r,n){var i=u[r];return i&&i.get(n)||null},getParent:function(r){if(!r)return null;var n=this.getType(r),i=s[n],t=r.get(i);return!t||Array.isArray(t)&&!t.length?null:this.getByTypeAndId(i,Array.isArray(t)?t[0]:t)},RELATION_TYPES:{SIBLINGS:"siblings",TYPES:"types",CHILD:"child",DIFFERENT_CHILD:"differentChild",PARENT:"parent",DIFFERENT_PARENT:"differentParent",UNRELATED:"unrelated"},getRelationType:function(r,n,i,t){if(null===r&&"division"===i)return this.RELATION_TYPES.CHILD;if("division"===r&&null===i)return this.RELATION_TYPES.PARENT;var e=this.getByTypeAndId(r,n),o=this.getByTypeAndId(i,t);return r===i?this.getParent(e)===this.getParent(o)?this.RELATION_TYPES.SIBLINGS:this.RELATION_TYPES.TYPES:l[r]===i?this.getParent(o)===e?this.RELATION_TYPES.CHILD:this.RELATION_TYPES.DIFFERENT_PARENT:s[r]===i?this.getParent(e)===o?this.RELATION_TYPES.PARENT:this.RELATION_TYPES.DIFFERENT_CHILD:this.RELATION_TYPES.UNRELATED},getDivisionFor:function(i){return i?i.constructor===r.model?i:(i.constructor!==n.model&&(i=this.getSubdivisionFor(i)),this.getParent(i)):null},getSubdivisionFor:function(i){return i&&i.constructor!==r.model?i.constructor===n.model?i:this.getSubdivisionFor(this.getParent(i)):null},containsProdLine:function(r,n,i){if("prodLine"===r)return Array.isArray(n)?-1!==n.indexOf(i):n===i;for(var t=this.getByTypeAndId("prodLine",i);;){var e=this.getParent(t);if(!e)return!1;if(this.getType(e)===r)return Array.isArray(n)?-1!==n.indexOf(e.id):n===e.id;t=e}}}});