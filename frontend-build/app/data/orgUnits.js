define(["./divisions","./subdivisions","./mrpControllers","./prodFlows","./workCenters","./prodLines"],function(r,i,n,t,e,o){"use strict";var s={division:"subdivision",subdivision:"mrpController",mrpController:"prodFlow",mrpControllers:"prodFlow",prodFlow:"workCenter",workCenter:"prodLine",prodLine:null},l={prodLine:"workCenter",workCenter:"prodFlow",prodFlow:"mrpController",mrpController:"subdivision",mrpControllers:"subdivision",subdivision:"division",division:null},u={division:r,subdivision:i,mrpController:n,mrpControllers:n,prodFlow:t,workCenter:e,prodLine:o};return{TYPES:{division:!0,subdivision:!0,mrpController:!0,mrpControllers:!0,prodFlow:!0,workCenter:!0,prodLine:!0},getProdFlowsForSubdivision:function(r){return"string"==typeof r&&(r=i.get(r)),r?t.filter(function(i){return i.getSubdivision()===r}):[]},getAllByType:function(r){return u[r].models},getActiveByType:function(r,i){return i||(i=function(){return!0}),u[r].models.filter(function(r){return!r.get("deactivatedAt")&&i(r)})},getAllDivisions:function(){return r.models},getAllForProdLine:function(s){"string"==typeof s&&(s=o.get(s));var l={division:null,subdivision:null,mrpControllers:null,prodFlow:null,workCenter:null,prodLine:null};if(!s)return l;l.prodLine=s.id;var u=e.get(s.get("workCenter"));if(!u)return l;l.workCenter=u.id;var d=t.get(u.get("prodFlow"));if(!d)return l;l.prodFlow=d.id;var p=d.get("mrpController");if(!Array.isArray(p)||!p.length)return l;if(l.mrpControllers=p,!(p=n.get(p[0])))return l;var f=i.get(p.get("subdivision"));if(!f)return l;l.subdivision=f.id;var g=r.get(f.get("division"));return g?(l.division=g.id,l):l},getType:function(s){if(null===s)return null;if(s.constructor===o.model)return"prodLine";if(s.constructor===e.model)return"workCenter";if(s.constructor===t.model)return"prodFlow";if(s.constructor===n.model)return"mrpController";if(s.constructor===i.model)return"subdivision";if(s.constructor===r.model)return"division";throw new Error("Unknown org unit type!")},getChildType:function(r){return s[r]||"division"},getChildren:function(r){var i=this.getType(r),n=this.getChildType(i),t=u[n];return t?function(r,i,n){return r.filter(function(r){var t=r.get(i);return!!t&&(Array.isArray(t)?-1!==t.indexOf(n.id):t===n.id)})}(t,i,r):[]},getByTypeAndId:function(r,i){var n=u[r];return n&&n.get(i)||null},getParent:function(r){if(!r)return null;var i=this.getType(r),n=l[i],t=r.get(n);return!t||Array.isArray(t)&&!t.length?null:this.getByTypeAndId(n,Array.isArray(t)?t[0]:t)},RELATION_TYPES:{SIBLINGS:"siblings",TYPES:"types",CHILD:"child",DIFFERENT_CHILD:"differentChild",PARENT:"parent",DIFFERENT_PARENT:"differentParent",UNRELATED:"unrelated"},getRelationType:function(r,i,n,t){if(null===r&&"division"===n)return this.RELATION_TYPES.CHILD;if("division"===r&&null===n)return this.RELATION_TYPES.PARENT;var e=this.getByTypeAndId(r,i),o=this.getByTypeAndId(n,t);return r===n?this.getParent(e)===this.getParent(o)?this.RELATION_TYPES.SIBLINGS:this.RELATION_TYPES.TYPES:s[r]===n?this.getParent(o)===e?this.RELATION_TYPES.CHILD:this.RELATION_TYPES.DIFFERENT_PARENT:l[r]===n?this.getParent(e)===o?this.RELATION_TYPES.PARENT:this.RELATION_TYPES.DIFFERENT_CHILD:this.RELATION_TYPES.UNRELATED},getDivisionFor:function(n){return n?n.constructor===r.model?n:(n.constructor!==i.model&&(n=this.getSubdivisionFor(n)),this.getParent(n)):null},getSubdivisionFor:function(n){return n&&n.constructor!==r.model?n.constructor===i.model?n:this.getSubdivisionFor(this.getParent(n)):null},containsProdLine:function(r,i,n){if("prodLine"===r)return Array.isArray(i)?-1!==i.indexOf(n):i===n;for(var t=this.getByTypeAndId("prodLine",n);;){var e=this.getParent(t);if(!e)return!1;if(this.getType(e)===r)return Array.isArray(i)?-1!==i.indexOf(e.id):i===e.id;t=e}}}});