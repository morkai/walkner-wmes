// Part of <http://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

define(["underscore","app/i18n","app/core/views/ListView"],function(t,e,i){"use strict";function s(t,e,i,s){var r="";e&&(r+=" "+e);var n=t.observer;return n&&n.notify&&n.changes&&(n.changes[i||this.id]||n.changes[s])&&(r+=" is-changed"),'class="'+r+'"'}return i.extend({className:"d8Entries-list is-clickable",serializeColumns:function(){var i=t.partial(s,t,"is-min"),r=t.partial(s,t,"is-min","strips");return[{id:"rid",className:"is-min is-number"},{id:"statusText",tdAttrs:i,label:e("d8Entries","PROPERTY:status")},{id:"entrySource",tdAttrs:i},{id:"stripNos",tdAttrs:r,label:e("d8Entries","PROPERTY:strips.no")},{id:"stripFamilies",tdAttrs:r,label:e("d8Entries","PROPERTY:strips.family")},{id:"subject",tdAttrs:s},{id:"problemSource",tdAttrs:s},{id:"team",tdAttrs:t.partial(s,t,null,"owner","members")},{id:"crsRegisterDate",tdAttrs:i,label:e("d8Entries","LIST:crsRegisterDate")},{id:"d5PlannedCloseDate",tdAttrs:i,label:e("d8Entries","LIST:d5PlannedCloseDate")},{id:"d5CloseDate",tdAttrs:i,label:e("d8Entries","LIST:d5CloseDate")},{id:"d8CloseDate",tdAttrs:i,label:e("d8Entries","LIST:d8CloseDate")}]},serializeActions:function(){var t=this.collection;return function(s){var r=t.get(s._id),n=r.get("attachment"),a=[i.actions.viewDetails(r),{id:"download",icon:"download",label:e("d8","LIST:ACTION:download"),href:n?"/d8/"+r.id+"/attachments/"+n._id+"?download=1":"/",disabled:!!n}];return r.canEdit()&&a.push(i.actions.edit(r)),r.canDelete()&&a.push(i.actions["delete"](r)),a}},afterRender:function(){i.prototype.afterRender.call(this);var t=this;this.$el.popover({selector:".list-item > td",container:this.el,trigger:"hover",placement:"auto right",html:!0,content:function(){var e=t.collection.get(this.parentNode.dataset.id);return"team"===this.dataset.id?t.serializeTeamPopoverContent(e):"subject"===this.dataset.id?t.serializeSubjectPopoverContent(e):void 0}})},serializeTeamPopoverContent:function(t){var e=t.get("team");if(!(e.length<=1)){for(var i='<ul class="d8Entries-list-team">',s=0;s<e.length;++s)i+="<li>"+e[s].rendered;return i+="</ul>"}},serializeSubjectPopoverContent:function(e){var i=e.get("problemDescription");if(!t.isEmpty(i))return i}})});