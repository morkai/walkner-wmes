define(["underscore","app/i18n","app/core/views/ListView"],function(t,e,i){"use strict";function s(t,e,i,s){var r="";e&&(r+=" "+e);var a=t.observer;return a&&a.notify&&a.changes&&(a.changes[i||this.id]||a.changes[s])&&(r+=" is-changed"),'class="'+r+'"'}return i.extend({className:"d8Entries-list is-clickable",serializeColumns:function(){var e=t.partial(s,t,"is-min"),i=t.partial(s,t,"is-min","strips");return[{id:"rid",className:"is-min is-number"},{id:"statusText",tdAttrs:e,label:this.t("PROPERTY:status")},{id:"entrySource",tdAttrs:e},{id:"stripNos",tdAttrs:i,label:this.t("PROPERTY:strips.no")},{id:"stripFamilies",tdAttrs:i,label:this.t("PROPERTY:strips.family")},{id:"subject",tdAttrs:s},{id:"problemSource",tdAttrs:s},{id:"team",tdAttrs:t.partial(s,t,null,"owner","members")},{id:"crsRegisterDate",tdAttrs:e,label:this.t("LIST:crsRegisterDate")},{id:"d5PlannedCloseDate",tdAttrs:e,label:this.t("LIST:d5PlannedCloseDate")},{id:"d5CloseDate",tdAttrs:e,label:this.t("LIST:d5CloseDate")},{id:"d8CloseDate",tdAttrs:e,label:this.t("LIST:d8CloseDate")}]},serializeActions:function(){var t=this,e=t.collection;return function(s){var r=e.get(s._id),a=r.get("attachment"),n=[i.actions.viewDetails(r),{id:"download",icon:"download",label:t.t("LIST:ACTION:download"),href:a?"/d8/"+r.id+"/attachments/"+a._id+"?download=1":"/",disabled:!!a}];return r.canEdit()&&n.push(i.actions.edit(r)),r.canDelete()&&n.push(i.actions.delete(r)),n}},afterRender:function(){i.prototype.afterRender.call(this);var t=this;this.$el.popover({selector:".list-item > td",container:this.el,trigger:"hover",placement:"auto right",html:!0,content:function(){var e=t.collection.get(this.parentNode.dataset.id);return"team"===this.dataset.id?t.serializeTeamPopoverContent(e):"subject"===this.dataset.id?t.serializeSubjectPopoverContent(e):void 0}})},serializeTeamPopoverContent:function(t){var e=t.get("team");if(!(e.length<=1)){for(var i='<ul class="d8Entries-list-team">',s=0;s<e.length;++s)i+="<li>"+e[s].rendered;return i+="</ul>"}},serializeSubjectPopoverContent:function(e){var i=e.get("problemDescription");if(!t.isEmpty(i))return i}})});