define(["jquery","../broker","../pubsub","../user","../d8Areas/D8AreaCollection","../d8EntrySources/D8EntrySourceCollection","../d8ProblemSources/D8ProblemSourceCollection"],function(e,r,n,u,l,o,t){"use strict";var s={area:"areas",entrySource:"entrySources",problemSource:"problemSources"},a=null,c=null,i=null,d=null,b={statuses:[],areas:new l,entrySources:new o,problemSources:new t,loaded:!1,load:function(){return null!==c&&(clearTimeout(c),c=null),b.loaded?null:null!==a?a:((a=e.ajax({url:"/d8/dictionaries"})).done(function(e){b.loaded=!0,b.statuses=e.statuses,f(e)}),a.fail(m),a.always(function(){a=null}),(i=n.sandbox()).subscribe("d8.areas.**",S),i.subscribe("d8.entrySources.**",S),i.subscribe("d8.problemSources.**",S),y(),a)},unload:function(){null!==c&&clearTimeout(c),c=setTimeout(m,3e4)},getLabel:function(e,r){if("string"==typeof e&&(e=this.forProperty(e)||b[e]),!e||Array.isArray(e))return r;var n=e.get(r);return n?n.getLabel():r},forProperty:function(e){return this[s[e]]||null}};function f(e){["areas","entrySources","problemSources"].forEach(function(r){b[r].reset(e?e[r]:[])})}function y(){i&&(d=i.subscribe("d8.entries.seen."+u.data._id,p))}function m(){c=null,null!==i&&(i.destroy(),i=null,d=null),b.loaded=!1,b.statuses=[],f()}function S(e,n){var u=n.split("."),l=b[u[1]];if(l){switch(u[2]){case"added":l.add(e.model);break;case"edited":var o=l.get(e.model._id);o&&o.set(e.model);break;case"deleted":l.remove(l.get(e.model._id))}r.publish(n,e)}}function p(e){r.publish("d8.entries.seen",e.entryId)}return r.subscribe("user.reloaded",function(){d&&(d.cancel(),d=null),y()}),b});