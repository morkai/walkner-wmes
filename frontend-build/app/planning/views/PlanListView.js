define(["underscore","app/time","app/i18n","app/user","app/core/views/ListView","app/planning/templates/list"],function(n,t,e,i,a,o){"use strict";return a.extend({template:o,remoteTopics:{"planning.generator.finished":function(n){this.$('.planning-list-day[data-id="'+n.date+'"]').length&&this.refreshCollection()}},events:{"mousedown .planning-list-day":function(n){1===n.button&&n.preventDefault()},"mouseup .planning-list-day":function(n){if(!n.currentTarget.classList.contains("planning-list-notExists")){var t="#planning/plans/"+n.currentTarget.dataset.id;return 0===n.button?window.location.href=t:1===n.button&&window.open(t),!1}},"click .btn-primary":function(n){var t=this.$(n.currentTarget).prop("disabled",!0),e=t.closest(".planning-list-day").attr("data-id");this.ajax({method:"POST",url:"/planning/plans/"+e+";generate"}).fail(function(){t.prop("disabled",!1)})},"click .planning-list-prev":function(){this.collection.prevMonth()},"click .planning-list-next":function(){this.collection.nextMonth()}},initialize:function(){this.once("afterRender",function(){this.listenTo(this.collection,"reset",this.render)})},getTemplateData:function(){for(var e=[],a=t.getMoment().startOf("isoWeek"),o=1;o<=7;++o)e.push(a.format("dddd")),a.add(1,"days");return{canManage:i.isAllowedTo("PLANNING:MANAGE"),weekDays:e,weeks:n.chunk(this.collection.toJSON(),7)}}})});