define(["underscore","app/i18n","app/viewport","app/core/View","app/planning/templates/orderLinesDialog"],function(e,i,r,t,n){"use strict";return t.extend({template:n,events:{submit:function(){return this.submitForm(),!1}},serialize:function(){var e=this.order;return{idPrefix:this.idPrefix,orderNo:e.id,mrp:e.get("mrp"),kind:e.get("kind"),urgent:e.get("urgent")}},afterRender:function(){var i=this.order.get("kind"),r=[],t=this.plan.settings.mrps.get(this.order.get("mrp")).lines.filter(function(r){return e.includes(r.get("orderPriority"),i)}).map(function(e){return r.push(e.id),{id:e.id,text:e.id}}),n=e.intersection(this.order.get("lines")||[],r).join(",");this.$id("lines").val(n).select2({allowClear:!0,placeholder:" ",data:t})},submitForm:function(){var e=this,t=e.$id("submit").prop("disabled",!0),n=t.find(".fa-spinner").removeClass("hidden"),s=e.ajax({method:"PATCH",url:"/planning/plans/"+e.plan.id+"/orders/"+e.order.id,data:JSON.stringify({urgent:this.$id("urgent").prop("checked"),lines:this.$id("lines").val().split(",").filter(function(e){return e.length>0})})});s.done(r.closeDialog),s.fail(function(){n.addClass("hidden"),t.prop("disabled",!1),r.msg.show({type:"error",time:3e3,text:i("planning","orders:menu:lines:failure")}),e.plan.settings.trigger("errored")})},onDialogShown:function(){this.$id("lines").select2("focus")}})});