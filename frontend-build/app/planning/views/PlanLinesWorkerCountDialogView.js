// Part of <https://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

define(["underscore","jquery","app/i18n","app/viewport","app/core/View","app/planning/templates/linesWorkerCountDialog"],function(e,i,n,t,r,s){"use strict";return r.extend({template:s,events:{submit:function(){return this.submitForm(),!1}},serialize:function(){var e=this;return{idPrefix:e.idPrefix,lines:e.mrp.lines.map(function(i){var n=i.mrpSettings(e.mrp.id);return{_id:i.id,workerCount:n?n.get("workerCount"):1}})}},submitForm:function(){var e=this,i=e.$id("submit").prop("disabled",!0),r=i.find(".fa-spinner").removeClass("hidden"),s=e.plan.settings;e.$("input[data-line-id]").each(function(){var i=e.mrp.lines.get(this.dataset.lineId);if(i){var n=i.mrpSettings(e.mrp.id),t=parseInt(this.value,10);!n||!t||t<0||n&&n.set("workerCount",t)}});var a=s.save();a.done(t.closeDialog),a.fail(function(){r.addClass("hidden"),i.prop("disabled",!1),t.msg.show({type:"error",time:3e3,text:n("planning","lines:menu:workerCount:failure")}),e.plan.settings.trigger("errored")})},onDialogShown:function(){this.$id("line").select2("focus")}})});