define(["underscore","jquery","app/i18n","app/viewport","app/core/View","app/planning/templates/linesWorkerCountDialog"],function(t,e,i,s,n,r){"use strict";return n.extend({template:r,events:{submit:function(){return this.submitForm(),!1}},getTemplateData:function(){const t=this.plan.settings.getVersion();return{lines:this.mrp.getSortedLines().map(e=>{const i=1===t?e.mrpSettings(this.mrp.id):e.settings;return{_id:e.id,workerCount:i?i.get("workerCount"):[0,0,0]}})}},submitForm:function(){const t=this.$id("submit").prop("disabled",!0),e=t.find(".fa-spinner").removeClass("hidden"),i=this.plan.settings,n=i.getVersion();this.$("[data-line-id]").each((t,e)=>{const i=this.mrp.lines.get(e.dataset.lineId);if(!i)return;const s=1===n?i.mrpSettings(this.mrp.id):i.settings;if(s){var r=this.$(e).find("[data-shift-no]").map((t,e)=>Math.max(0,+parseFloat(e.value).toFixed(2)||0)).get();s.set("workerCount",r)}}),s.msg.saving();const r=i.save();r.done(()=>{s.msg.saved(),s.closeDialog()}),r.fail(()=>{e.addClass("hidden"),t.prop("disabled",!1),s.msg.savingFailed(),this.plan.settings.trigger("errored")})},onDialogShown:function(){this.$id("line").select2("focus")}})});