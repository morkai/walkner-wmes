define(["underscore","jquery","app/i18n","app/viewport","app/core/View","app/planning/templates/linesWorkerCountDialog"],function(e,t,i,n,r,a){"use strict";return r.extend({template:a,events:{submit:function(){return this.submitForm(),!1}},getTemplateData:function(){var e=this;return{lines:e.mrp.getSortedLines().map(function(t){var i=t.mrpSettings(e.mrp.id);return{_id:t.id,workerCount:i?i.get("workerCount"):[0,0,0]}})}},submitForm:function(){n.msg.saving();var e=this,t=e.$id("submit").prop("disabled",!0),i=t.find(".fa-spinner").removeClass("hidden"),r=e.plan.settings;e.$("[data-line-id]").each(function(){var t=e.mrp.lines.get(this.dataset.lineId);if(t){var i=t.mrpSettings(e.mrp.id);if(i){var n=e.$(this).find("[data-shift-no]").map(function(){return Math.max(0,+parseFloat(this.value).toFixed(2)||0)}).get();i.set("workerCount",n)}}});var a=r.save();a.done(()=>{n.msg.saved(),n.closeDialog()}),a.fail(()=>{i.addClass("hidden"),t.prop("disabled",!1),n.msg.savingFailed(),e.plan.settings.trigger("errored")})},onDialogShown:function(){this.$id("line").select2("focus")}})});