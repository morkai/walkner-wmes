define(["underscore","jquery","app/i18n","app/viewport","app/core/View","app/core/util/resultTips","app/planning/templates/linesWorkerCountDialog"],function(t,e,i,n,s,a,o){"use strict";return s.extend({template:o,modelProperty:"plan",events:{submit:function(){return this.submitForm(),!1},'blur input[type="number"]':function(t){"0"===t.target.value&&(t.target.value="")},'click a[data-action="copy"]':function(t){this.copyData=this.$(t.target).closest(".form-group").find("input").map((t,e)=>e.value).get(),a.showCopied({e:t})},'click a[data-action="paste"]':function(t){this.$(t.target).closest(".form-group").find("input").each((t,e)=>e.value=this.copyData[t])},'click a[data-action="zero"]':function(t){this.$(t.target).closest(".form-group").find("input").each((t,e)=>e.value="")}},initialize:function(){this.copyData=["","",""]},getTemplateData:function(){const t=this.plan.settings.getVersion();return{lines:this.mrp.getSortedLines().map(e=>{const i=1===t?e.mrpSettings(this.mrp.id):e.settings;return{_id:e.id,workerCount:i?i.get("workerCount"):["","",""]}})}},submitForm:function(){const t=this.$id("submit").prop("disabled",!0),e=t.find(".fa-spinner").removeClass("hidden"),i=this.plan.settings,s=i.getVersion();this.$("[data-line-id]").each((t,e)=>{const i=this.mrp.lines.get(e.dataset.lineId);if(!i)return;const n=1===s?i.mrpSettings(this.mrp.id):i.settings;if(!n)return;const a=this.$(e).find("[data-shift-no]").map((t,e)=>Math.max(0,+parseFloat(e.value).toFixed(2)||0)).get();n.set("workerCount",a)}),n.msg.saving();const a=i.save();a.done(()=>{n.msg.saved(),n.closeDialog()}),a.fail(()=>{e.addClass("hidden"),t.prop("disabled",!1),n.msg.savingFailed(),this.plan.settings.trigger("errored")})},onDialogShown:function(){this.$id("line").select2("focus")}})});