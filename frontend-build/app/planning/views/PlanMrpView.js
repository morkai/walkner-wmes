// Part of <https://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

define(["underscore","app/time","app/i18n","app/user","app/core/View","app/data/orgUnits","./PlanMrpToolbarView","./PlanMrpLinesView","./PlanMrpOrdersView","./PlanMrpLateOrdersView","./PlanMrpLineOrdersView","./PlanMrpLineOrdersListView","app/planning/templates/planMrp"],function(e,i,s,n,r,t,l,a,d,p,o,h,m){"use strict";return r.extend({template:m,events:{"mouseleave #-lineOrders":function(){this.plan.displayOptions.isLineOrdersListEnabled()||(this.$els.crosshair.addClass("hidden"),this.$els.time.addClass("hidden"))},"mouseenter #-lineOrders":function(){this.plan.displayOptions.isLineOrdersListEnabled()||(this.$els.crosshair.removeClass("hidden"),this.$els.time.removeClass("hidden"))},"mousemove .planning-mrp-lineOrders-list":function(e){if(!this.plan.displayOptions.isLineOrdersListEnabled()){var s=288e5,n=132,r=50,t=this.$els.crosshair[0],l=this.$els.time[0],a=this.$els.lineOrders.position(),d=this.$els.lineOrders.outerWidth()-n,p=e.pageX-a.left-n,o=p/d,h=s*o,m=+e.currentTarget.dataset.shiftStartTime+h,O=d-2*r+15;t.style.height=this.$els.lineOrders.outerHeight()+6+"px",t.style.top=a.top+"px",t.style.left=e.pageX+"px",p-=r,l.style.left=Math.min(p,O)+"px",l.innerHTML=i.toString(h/1e3,!0)+"<br>"+i.utc.format(m,"HH:mm:ss")}},contextmenu:function(){return!1}},initialize:function(){var e=this;e.$els={lineOrders:null,timeline:null,crosshair:null,time:null},e.listenTo(e.plan.displayOptions,"change:lineOrdersList",this.onLineOrdersListChanged),e.setView("#-toolbar",new l({delayReasons:e.delayReasons,plan:e.plan,mrp:e.mrp})),e.setView("#-lines",new a({plan:e.plan,mrp:e.mrp})),e.setView("#-orders",new d({plan:e.plan,mrp:e.mrp})),e.setView("#-lateOrders",new p({delayReasons:e.delayReasons,plan:e.plan,mrp:e.mrp}))},destroy:function(){var e=this;Object.keys(e.$els).forEach(function(i){e.$els[i]=null})},serialize:function(){return{idPrefix:this.idPrefix,mrp:{_id:this.mrp.id,name:this.mrp.id,description:this.mrp.get("description")}}},afterRender:function(){var e=this;Object.keys(e.$els).forEach(function(i){e.$els[i]=e.$id(i)}),e.$els.timeline.toggleClass("hidden",0===e.mrp.lines.length||e.plan.displayOptions.isLineOrdersListEnabled()),e.renderLineOrders()},renderLineOrders:function(){var e=this;return e.removeView("#-lineOrders"),e.plan.displayOptions.isLineOrdersListEnabled()?void e.renderLineOrdersList():void e.mrp.lines.forEach(function(i){e.insertView("#-lineOrders",new o({plan:e.plan,mrp:e.mrp,line:i,prodLineState:e.prodLineStates.get(i.id)})).render()})},renderLineOrdersList:function(){this.setView("#-lineOrders",new h({plan:this.plan,mrp:this.mrp})).render()},onLineOrdersListChanged:function(){this.$els.timeline.addClass("hidden"),this.$els.crosshair.addClass("hidden"),this.$els.time.addClass("hidden"),this.renderLineOrders()}})});