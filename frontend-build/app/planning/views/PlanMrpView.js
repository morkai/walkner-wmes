// Part of <https://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

define(["underscore","app/time","app/i18n","app/user","app/core/View","app/data/orgUnits","./PlanMrpToolbarView","./PlanMrpLinesView","./PlanMrpOrdersView","./PlanMrpLineOrdersView","app/planning/templates/planMrp"],function(e,i,r,t,n,s,a,p,l,d,h){"use strict";return n.extend({template:h,events:{"mouseleave #-lineOrders":function(){this.$crosshair.addClass("hidden"),this.$time.addClass("hidden")},"mouseenter #-lineOrders":function(){this.$crosshair.removeClass("hidden"),this.$time.removeClass("hidden")},"mousemove .planning-mrp-lineOrders-list":function(e){var r=288e5,t=132,n=50,s=this.$crosshair[0],a=this.$time[0],p=this.$lineOrders.position(),l=this.$lineOrders.outerWidth()-t,d=e.pageX-p.left-t,h=d/l,o=r*h,m=+e.currentTarget.dataset.shiftStartTime+o,c=l-2*n+15;s.style.height=this.$lineOrders.outerHeight()+6+"px",s.style.top=p.top+"px",s.style.left=e.pageX+"px",d-=n,a.style.left=Math.min(d,c)+"px",a.innerHTML=i.toString(o/1e3,!0)+"<br>"+i.utc.format(m,"HH:mm:ss")}},initialize:function(){var e=this;e.setView("#-toolbar",new a({plan:e.plan,mrp:e.mrp})),e.setView("#-lines",new p({plan:e.plan,mrp:e.mrp})),e.setView("#-orders",new l({plan:e.plan,mrp:e.mrp}))},serialize:function(){return{idPrefix:this.idPrefix,mrp:{name:this.mrp.id,description:this.mrp.get("description")}}},afterRender:function(){this.$lineOrders=this.$id("lineOrders"),this.$crosshair=this.$id("crosshair"),this.$time=this.$id("time"),this.$id("timeline").toggleClass("hidden",0===this.mrp.lines.length),this.renderLineOrders()},renderLineOrders:function(){var e=this;e.removeView("#-lineOrders"),e.mrp.lines.forEach(function(i){e.insertView("#-lineOrders",new d({plan:e.plan,mrp:e.mrp,line:i})).render()})}})});