define(["app/i18n","app/viewport","app/core/View","app/planning/templates/lateOrderAddDialog"],function(e,t,i,r){"use strict";return i.extend({template:r,events:{submit:function(){return this.submitForm(),!1}},afterRender:function(){var e=this.mrp,t=this.plan.lateOrders.filter(function(t){return t.get("mrp")===e.id&&!e.orders.get(t.id)}).map(function(e){return{id:e.id,text:e.id+": "+e.get("name")}});this.$id("orders").select2({width:"100%",placeholder:" ",multiple:!0,data:t,formatSelection:function(e){return e.id}})},submitForm:function(){var i=this,r=i.$id("submit").prop("disabled",!0),n=r.find(".fa-spinner").removeClass("hidden"),d=i.ajax({method:"POST",url:"/planning/plans/"+i.plan.id+"/orders",data:JSON.stringify({orders:i.$id("orders").val().split(","),urgent:!0})});d.done(function(){t.closeDialog()}),d.fail(function(){n.addClass("hidden"),r.prop("disabled",!1),t.msg.show({type:"error",time:3e3,text:e("planning","lateOrders:add:failure")}),i.plan.settings.trigger("errored")})},onDialogShown:function(){this.$id("orders").focus()}})});