define(["underscore","Sortable","app/viewport","app/core/View","app/core/util/idAndLabel","app/core/util/resultTips","app/data/clipboard","app/planning/templates/linesOrderGroupPriorityDialog"],function(t,e,i,r,o,a,n,s){"use strict";return r.extend({template:s,modelProperty:"plan",events:{submit:function(){return this.submitForm(),!1},"change input":function(){i.adjustDialogBackdrop()},'click a[data-action="copy"]':function(t){this.copyData=this.$(t.target).closest(".form-group").find("input").select2("data"),a.showCopied({e:t})},'click a[data-action="paste"]':function(t){this.$(t.target).closest(".form-group").find("input").select2("data",this.copyData).trigger("change")}},initialize:function(){this.sortables=[],this.copyData=[]},destroy:function(){this.destroySortables()},destroySortables:function(){var t=this;t.$("input[data-line-id]").each(function(){var e=t.$(this);e.data("sortable").destroy(),e.removeData("sortable")})},getTemplateData:function(){return{lines:this.mrp.getSortedLines().map(function(t){return{_id:t.id,orderGroupPriority:(t.settings.get("orderGroupPriority")||[]).join(",")}})}},afterRender:function(){var t=this;t.$("input[data-line-id]").each(function(){t.setUpOrderGroupPriority(t.$(this))})},setUpOrderGroupPriority:function(t){var i=t.data("sortable");i&&i.destroy(),t.select2({allowClear:!0,multiple:!0,data:this.orderGroups.map(o)}),i=new e(t.select2("container").find(".select2-choices")[0],{draggable:".select2-search-choice",filter:".select2-search-choice-close",onStart:function(){t.select2("onSortStart")},onEnd:function(){t.select2("onSortEnd").select2("focus")}}),t.data("sortable",i)},submitForm:function(){var t=this,e=t.$id("submit").prop("disabled",!0),r=e.find(".fa-spinner").removeClass("hidden"),o=t.plan.settings;t.$("input[data-line-id]").each(function(){var e=t.mrp.lines.get(this.dataset.lineId);if(e){var i=this.value;i.length&&e.settings.set("orderGroupPriority",i.split(","))}});var a=o.save();a.done(i.closeDialog),a.fail(function(){r.addClass("hidden"),e.prop("disabled",!1),i.msg.show({type:"error",time:3e3,text:t.t("lines:menu:orderGroupPriority:failure")}),t.plan.settings.trigger("errored")})},onDialogShown:function(){this.$id("line").select2("focus")}})});