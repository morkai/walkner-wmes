// Part of <https://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

define(["underscore","app/i18n","app/time","app/core/View","app/mrpControllers/util/setUpMrpSelect2","app/users/ownMrps","app/planning/templates/planFilter"],function(e,t,i,n,a,s,r){"use strict";return n.extend({template:r,events:e.assign({"input #-date":"changeFilter","change #-date":"changeFilter","change #-mrp":"changeFilter"},s.events),initialize:function(){this.listenTo(this.model,"change:loading",this.onLoadingChanged),this.listenTo(this.model,"change:minDate change:maxDate",this.onMinMaxDateChanged)},serialize:function(){return e.assign({idPrefix:this.idPrefix,showOwnMrps:s.hasAny(),minDate:this.model.get("minDate")||"2017-01-01",maxDate:this.model.get("maxDate")||i.utc.getMoment().startOf("day").add(2,"days").format("YYYY-MM-DD")},this.model.getFilter())},afterRender:function(){a(this.$id("mrp"),{width:"600px",placeholder:t("planning","filter:mrp:placeholder"),sortable:!0,view:this})},changeFilter:function(){var e=this.$id("date").val(),t={mrp:this.$id("mrp").val().split(",").filter(function(e){return e.length>0})};/^[0-9]{4}-[0-9]{2}-[0-9]{2}$/.test(e)&&(t.date=e),this.model.setFilter(t)},onLoadingChanged:function(){var e=!!this.model.get("loading");this.$id("date").prop("disabled",e),this.$id("mrp").select2("enable",!e)},onMinMaxDateChanged:function(){this.$id("date").prop("min",this.model.get("minDate")),this.$id("date").prop("max",this.model.get("maxDate"))}})});