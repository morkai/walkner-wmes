// Part of <https://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

define(["underscore","app/i18n","app/time","app/core/View","app/mrpControllers/util/setUpMrpSelect2","app/users/ownMrps","app/planning/templates/planFilter"],function(t,i,e,n,a,s,p){"use strict";return n.extend({template:p,events:t.assign({"input #-date":"changeFilter","change #-date":"changeFilter","change #-mrps":"changeFilter"},s.events),initialize:function(){this.listenTo(this.plan,"change:loading",this.onLoadingChanged),this.listenTo(this.plan.displayOptions,"change:minDate change:maxDate",this.onMinMaxDateChanged)},serialize:function(){return t.assign({idPrefix:this.idPrefix,showOwnMrps:s.hasAny(),date:this.plan.id,mrps:this.plan.displayOptions.get("mrps"),minDate:this.plan.displayOptions.get("minDate"),maxDate:this.plan.displayOptions.get("maxDate")})},afterRender:function(){a(this.$id("mrps"),{width:"600px",placeholder:i("planning","filter:mrps:placeholder"),sortable:!0,view:this})},changeFilter:function(){var i=this.$id("date").val(),e={mrps:this.$id("mrps").val().split(",").filter(function(t){return t.length>0})};/^[0-9]{4}-[0-9]{2}-[0-9]{2}$/.test(i)&&(e.date=i),t.isEqual(e.mrps,this.plan.displayOptions.get("mrps"))||this.plan.displayOptions.set("mrps",e.mrps),e.date&&e.date!==this.plan.id&&this.plan.set("_id",e.date)},onLoadingChanged:function(){var t=this.plan.get("loading");this.$id("date").prop("disabled",t),this.$id("mrps").select2("enable",!t)},onMinMaxDateChanged:function(){this.$id("date").prop("min",this.plan.displayOptions.get("minDate")),this.$id("date").prop("max",this.plan.displayOptions.get("maxDate"))}})});