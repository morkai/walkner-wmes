// Part of <https://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

define(["underscore","jquery","app/i18n","app/time","app/core/View","app/mrpControllers/util/setUpMrpSelect2","app/planning/templates/whFilter"],function(e,t,i,a,n,s,p){"use strict";return n.extend({template:p,events:{"input #-date":"changeFilter","change #-date":"changeFilter","change #-mrps":"changeFilter","click #-useDarkerTheme":function(){this.plan.displayOptions.toggleDarkerThemeUse()}},initialize:function(){var e=this.plan,t=e.displayOptions;this.listenTo(e,"change:loading",this.onLoadingChanged),this.listenTo(e,"change:_id",this.onDateChanged),this.listenTo(t,"change:minDate change:maxDate",this.onMinMaxDateChanged),this.listenTo(t,"change:useDarkerTheme",this.updateToggles)},serialize:function(){var t=this.plan,i=t.displayOptions;return e.assign({idPrefix:this.idPrefix,date:t.id,mrps:i.get("mrps"),minDate:i.get("minDate"),maxDate:i.get("maxDate"),useDarkerTheme:i.isDarkerThemeUsed()})},afterRender:function(){s(this.$id("mrps"),{width:"600px",placeholder:i("planning","filter:mrps:placeholder"),sortable:!0,own:!1,view:this})},updateToggles:function(){this.$id("useDarkerTheme").toggleClass("active",this.plan.displayOptions.isDarkerThemeUsed())},changeFilter:function(){var t=this.$id("date")[0],i=t.value,a={mrps:this.$id("mrps").val().split(",").filter(function(e){return e.length>0})};t.checkValidity()&&/^[0-9]{4}-[0-9]{2}-[0-9]{2}$/.test(i)&&(a.date=i),e.isEqual(a.mrps,this.plan.displayOptions.get("mrps"))||this.plan.displayOptions.set("mrps",a.mrps),a.date&&a.date!==this.plan.id&&this.plan.set("_id",a.date)},onLoadingChanged:function(){var e=this.plan.get("loading");this.$id("date").prop("disabled",e),this.$id("mrps").select2("enable",!e)},onDateChanged:function(){this.$id("date").val(this.plan.id)},onMinMaxDateChanged:function(){this.$id("date").prop("min",this.plan.displayOptions.get("minDate")).prop("max",this.plan.displayOptions.get("maxDate"))}})});