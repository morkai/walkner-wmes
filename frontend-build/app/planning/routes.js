// Part of <https://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

define(["../broker","../router","../viewport","../user","../time","./Plan","./PlanSettings","./PlanSettingsCollection","./PlanChangesCollection","./pages/PlanPage","./pages/PlanListPage","./pages/PlanSettingsPage","./pages/PlanChangesPage","./pages/WhPage","i18n!app/nls/planning"],function(a,n,e,t,r,i,s,l,p,g,o,u,d,m){"use strict";function c(){var a=e.currentLayout.getView(".navbar");if(a){var n=r.getMoment(),t=n.hours(),i=n.day();a.$(".planning-navbar-2d").toggleClass("disabled",(1===i||2===i||3===i)&&t<17)}setTimeout(c,6e4)}var h=t.auth("PLANNING:VIEW"),P=t.auth("PLANNING:MANAGE");n.map("/planning/settings/:id",P,function(a){e.showPage(new u({model:new s({_id:a.params.id}),back:"1"===a.query.back}))}),n.map("/planning/changes",h,function(a){e.showPage(new d({collection:new p(null,{rqlQuery:a.rql,paginate:!1})}))}),n.map("/planning/plans",h,function(a){e.showPage(new o({collection:new l(null,{rqlQuery:a.rql,paginate:!1})}))}),n.map("/planning/plans/:id",h,function(n){/^-?[0-9]+d$/.test(n.params.id)&&(n.params.id=r.getMoment().subtract(r.getMoment().hours()<6?1:0,"days").startOf("day").add(+n.params.id.replace("d",""),"days").format("YYYY-MM-DD"),a.publish("router.navigate",{url:"/planning/plans/"+n.params.id,replace:!0,trigger:!1})),e.showPage(new g({date:n.params.id,mrps:void 0===n.query.mrps?null:n.query.mrps.split(/[^A-Z0-9]+/).filter(function(a){return a.length>0})}))}),n.map("/planning/wh/:id",h,function(n){/^-?[0-9]+d$/.test(n.params.id)&&(n.params.id=r.getMoment().subtract(r.getMoment().hours()<6?1:0,"days").startOf("day").add(+n.params.id.replace("d",""),"days").format("YYYY-MM-DD"),a.publish("router.navigate",{url:"/planning/wh/"+n.params.id,replace:!0,trigger:!1})),e.showPage(new m({date:n.params.id,mrps:void 0===n.query.mrps?null:n.query.mrps.split(/[^A-Z0-9]+/).filter(function(a){return a.length>0})}))}),e.once("afterRender",c)});