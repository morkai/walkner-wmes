// Part of <https://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

define(["../broker","../router","../viewport","../user","../time"],function(n,a,e,i,t){"use strict";function l(){var n=e.currentLayout.getView(".navbar");n&&n.$id("planning-2d").toggleClass("disabled",t.getMoment().hours()<17),setTimeout(l,6e4)}var p="i18n!app/nls/planning",r=i.auth("HOURLY_PLANS:VIEW","PROD_DATA:VIEW");a.map("/planning/settings/:id",r,function(n){e.loadPage(["app/planning/PlanSettings","app/planning/pages/PlanSettingsPage",p],function(a,e){return new e({model:new a({_id:n.params.id})})})}),a.map("/planning/changes",r,function(n){e.loadPage(["app/planning/PlanChangesCollection","app/planning/pages/PlanChangesPage",p],function(a,e){return new e({collection:new a(null,{rqlQuery:n.rql,paginate:!1})})})}),a.map("/planning/plans",r,function(n){e.loadPage(["app/planning/PlanSettingsCollection","app/planning/pages/PlanListPage",p],function(a,e){return new e({collection:new a(null,{rqlQuery:n.rql,paginate:!1})})})}),a.map("/planning/plans/:id",r,function(a){/^[0-9]+d$/.test(a.params.id)&&(a.params.id=t.utc.getMoment().startOf("day").add(a.params.id.replace("d",""),"days").format("YYYY-MM-DD"),n.publish("router.navigate",{url:"/planning/plans/"+a.params.id,replace:!0,trigger:!1})),e.loadPage(["app/planning/Plan","app/planning/pages/PlanPage",p],function(n,e){return new e({date:a.params.id,mrps:void 0===a.query.mrps?null:a.query.mrps.split(/[^A-Z0-9]+/).filter(function(n){return n.length>0})})})}),e.once("afterRender",l)});