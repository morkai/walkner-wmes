// Part of <https://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

define(["../core/Model","../data/orgUnits","./PlanOrderCollection","./PlanLineCollection"],function(t,e,i,n){"use strict";return t.extend({initialize:function(){var t=e.getByTypeAndId("mrpController",this.id);this.attributes.description=t?t.get("description"):"",this.orders=new i(null,{paginate:!1}),this.lines=new n(null,{paginate:!1}),this.attributes.orders&&(this.orders.reset(this.attributes.orders),delete this.attributes.orders),this.attributes.lines&&(this.lines.reset(this.attributes.lines),delete this.attributes.lines),Object.defineProperty(this,"plan",{get:function(){return this.collection?this.collection.plan:null}}),Object.defineProperty(this,"settings",{get:function(){return this.plan.settings.mrps.get(this.id)}})},getStats:function(){var t=this.orders,e=this.plan,i={manHours:{todo:0,late:0,plan:0,remaining:0},quantity:{todo:0,late:0,plan:0,remaining:0}};return this.lines.forEach(function(t){(t.get("shiftData")||[]).forEach(function(t){i.manHours.plan+=t.manHours,i.quantity.plan+=t.quantity})}),e&&(t.forEach(function(t){var n=e.sapOrders.get(t.id);if(n){var r=n.get("quantityTodo")-n.getQuantityDone();i.manHours.todo+=t.get("manHours"),i.quantity.todo+=t.getQuantityTodo(),i.manHours.remaining+=t.getManHours(r),i.quantity.remaining+=r}}),e.lateOrders.mrp(this.id).forEach(function(e){t.get(e.id)||(i.manHours.late+=e.get("manHours"),i.quantity.late+=e.getQuantityTodo())})),i}})});