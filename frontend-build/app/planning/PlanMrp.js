// Part of <https://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

define(["../core/Model","../data/orgUnits","./PlanOrderCollection","./PlanLineCollection"],function(t,e,i,n){"use strict";return t.extend({initialize:function(){var t=e.getByTypeAndId("mrpController",this.id);this.attributes.description=t?t.get("description"):"",this.orders=new i(null,{paginate:!1}),this.lines=new n(null,{paginate:!1}),this.attributes.orders&&(this.orders.reset(this.attributes.orders),delete this.attributes.orders),this.attributes.lines&&(this.lines.reset(this.attributes.lines),delete this.attributes.lines),Object.defineProperty(this,"plan",{get:function(){return this.collection.plan}}),Object.defineProperty(this,"settings",{get:function(){return this.plan.settings.mrps.get(this.id)}})},getStats:function(){var t=this.orders,e={manHours:{todo:0,done:0,late:0},quantity:{todo:0,done:0,late:0}};return t.forEach(function(t){e.manHours.todo+=t.get("manHours"),e.quantity.todo+=t.getQuantityTodo()}),this.lines.forEach(function(t){(t.get("shiftData")||[]).forEach(function(t){e.manHours.done+=t.manHours,e.quantity.done+=t.quantity})}),this.plan.lateOrders.mrp(this.id).forEach(function(i){t.get(i.id)||(e.manHours.late+=i.get("manHours"),e.quantity.late+=i.getQuantityTodo())}),e}})});