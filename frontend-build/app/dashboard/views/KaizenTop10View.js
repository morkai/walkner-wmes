// Part of <http://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

define(["underscore","app/core/View","app/dashboard/templates/kaizenTop10"],function(t,e,i){"use strict";return e.extend({template:i,top10Property:"top10",initialize:function(){this.state=this.getDataState(),"empty"===this.state?(this.listenToOnce(this.model,"request",this.onLoadingStart),this.listenToOnce(this.model,"error",this.onLoadingError),this.listenToOnce(this.model,"sync",this.onLoaded)):this.listenTo(this.model,"change:"+this.options.top10Property,this.render)},serialize:function(){return{idPrefix:this.idPrefix,state:this.state,month:(new Date).getMonth()+1+(this.options.month||0),top10:this.getData()}},getData:function(){return this.model.get(this.options.top10Property)},getDataState:function(){return t.isEmpty(this.getData())?"empty":"ready"},onLoadingStart:function(){this.state="loading",this.render()},onLoadingError:function(){this.state=this.getDataState(),this.render()},onLoaded:function(){this.state=this.getDataState(),this.render()}})});