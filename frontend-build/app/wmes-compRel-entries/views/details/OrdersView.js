define(["underscore","app/viewport","app/core/View","app/core/views/DialogView","app/wmes-compRel-entries/Entry","./ReleaseOrderView","app/wmes-compRel-entries/templates/details/orders","app/wmes-compRel-entries/templates/details/removeOrder"],function(e,t,o,r,i,n,s,a){"use strict";return o.extend({template:s,events:{'click .btn[data-action="add"]':function(){this.showReleaseOrderDialog()},'click .btn[data-action="remove"]':function(e){this.showRemoveOrderDialog(e.currentTarget.dataset.id)}},initialize:function(){var e=this,t=e.model;e.once("afterRender",function(){e.listenTo(t,"change:orders",e.render),e.listenTo(t,"change:status",e.toggleButtons)})},getTemplateData:function(){return{orders:this.model.serializeOrders()}},afterRender:function(){this.toggleButtons()},toggleButtons:function(){this.$(".btn").toggleClass("hidden",!i.can.releaseOrder(this.model))},showReleaseOrderDialog:function(){var e=new n({model:this.model});t.showDialog(e,this.t("orders:title"))},showRemoveOrderDialog:function(e){var o=this.model.get("orders").find(function(t){return t._id===e}),i=new r({template:a,model:{orderNo:o.orderNo}});t.showDialog(i,this.t("orders:remove:title")),this.listenTo(i,"answered",function(t){"yes"===t&&this.removeOrder(e)})},removeOrder:function(e){t.msg.saving();var o=this.ajax({method:"POST",url:"/compRel/entries/"+this.model.id+";release-order",data:JSON.stringify({remove:e})});o.fail(function(){t.msg.savingFailed()}),o.done(function(){t.msg.saved(),t.closeDialog()})}})});