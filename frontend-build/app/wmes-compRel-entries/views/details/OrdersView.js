define(["underscore","app/viewport","app/core/View","app/core/views/DialogView","app/wmes-compRel-entries/Entry","./ReleaseOrderView","./RemoveOrdersView","app/wmes-compRel-entries/templates/details/orders","app/wmes-compRel-entries/templates/details/removeOrder"],function(e,t,o,i,r,n,s,a,d){"use strict";return o.extend({template:a,events:{'click .btn[data-action="add"]':function(){this.showReleaseOrderDialog()},'click .btn[data-action="removeOne"]':function(e){this.showRemoveOrderDialog(e.currentTarget.dataset.id)},'click .btn[data-action="removeMany"]':function(){this.showRemoveOrdersDialog()}},initialize:function(){var e=this,t=e.model;e.once("afterRender",function(){e.listenTo(t,"change:orders",e.render),e.listenTo(t,"change:status",e.toggleButtons)})},getTemplateData:function(){return{orders:this.model.serializeOrders()}},afterRender:function(){this.toggleButtons()},toggleButtons:function(){this.$(".btn").toggleClass("hidden",!r.can.releaseOrder(this.model))},showReleaseOrderDialog:function(){var e=new n({model:this.model});t.showDialog(e,this.t("orders:title"))},showRemoveOrdersDialog:function(){var e=new s({model:this.model});t.showDialog(e,this.t("orders:removeMany:title"))},showRemoveOrderDialog:function(e){var o=this.model.get("orders").find(function(t){return t._id===e}),r=new i({nlsDomain:this.model.getNlsDomain(),template:d,model:{orderNo:o.orderNo}});t.showDialog(r,this.t("orders:removeOne:title")),this.listenTo(r,"answered",function(t){"yes"===t&&this.removeOrder(e)})},removeOrder:function(e){t.msg.saving();var o=this.ajax({method:"POST",url:"/compRel/entries/"+this.model.id+";release-order",data:JSON.stringify({remove:{_id:e}})});o.fail(function(){t.msg.savingFailed()}),o.done(function(){t.msg.saved(),t.closeDialog()})}})});