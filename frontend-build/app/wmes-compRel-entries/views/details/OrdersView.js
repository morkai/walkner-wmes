define(["underscore","app/viewport","app/core/View","app/core/views/DialogView","app/wmes-compRel-entries/Entry","./ReleaseOrderView","app/wmes-compRel-entries/templates/details/orders","app/wmes-compRel-entries/templates/details/removeOrder"],function(e,t,r,o,i,s,n,a){"use strict";return r.extend({template:n,events:{"click #-add":function(){this.showReleaseOrderDialog()},'click .btn[data-action="remove"]':function(e){this.showRemoveOrderDialog(e.currentTarget.dataset.order)}},initialize:function(){var e=this,t=e.model;e.once("afterRender",function(){e.listenTo(t,"change:orders",e.render),e.listenTo(t,"change:status",e.toggleButtons)})},getTemplateData:function(){return{orders:this.model.serializeOrders()}},afterRender:function(){this.toggleButtons()},toggleButtons:function(){this.$(".btn").toggleClass("hidden",!i.can.releaseOrder(this.model))},showReleaseOrderDialog:function(){var e=new s({model:this.model});t.showDialog(e,this.t("orders:title"))},showRemoveOrderDialog:function(e){var r=new o({template:a,model:{orderNo:e}});t.showDialog(r,this.t("orders:remove:title")),this.listenTo(r,"answered",function(t){"yes"===t&&this.removeOrder([e])})},removeOrder:function(e){t.msg.saving();var r=this.ajax({method:"POST",url:"/compRel/entries/"+this.model.id+";release-order",data:JSON.stringify({orders:e,remove:!0})});r.fail(function(){t.msg.savingFailed()}),r.done(function(){t.msg.saved(),t.closeDialog()})}})});