define(["app/viewport","app/core/View","app/users/util/setUpUserSelect2","app/wmes-compRel-entries/dictionaries","app/wmes-compRel-entries/templates/details/addUser"],function(e,i,t,s,n){"use strict";return i.extend({template:n,nlsDomain:"wmes-compRel-entries",events:{submit:function(){return this.submit(),!1}},afterRender:function(){var e=this.model.entry.get("funcs").map(function(e){return{id:e._id,text:s.funcs.getLabel(e._id)}});this.$id("func").val(this.model.func._id).select2({width:"100%",data:e}),t(this.$id("users"),{multiple:!0,allowClear:!0,noPersonnelId:!0})},onDialogShown:function(){this.$id("users").focus()},submit:function(){var i=this;e.msg.saving(),i.$(".btn-primary").prop("disabled",!0);var s=i.ajax({method:"POST",url:"/compRel/entries/"+i.model.entry.id+";add-user",data:JSON.stringify({func:i.$id("func").val(),users:t.getUserInfo(i.$id("users"))})});s.fail(function(){e.msg.savingFailed(),i.$(".btn-primary").prop("disabled",!1)}),s.done(function(){e.msg.saved(),e.closeDialog()})}})});