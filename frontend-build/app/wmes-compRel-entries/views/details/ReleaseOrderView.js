define(["app/time","app/viewport","app/core/View","app/wmes-compRel-entries/templates/details/releaseOrder"],function(e,t,i,a){"use strict";return i.extend({template:a,events:{"change #-orders":function(e){e.target.value=e.target.value.split(/[^0-9]+/).filter(function(e){return 9===e.length}).join(" ")},'change input[name="mode"]':function(){var e="orders"===this.$('input[name="mode"]:checked').val(),t=this.$('input[type="date"]'),i=this.$id("orders");t.prop("disabled",e),i.prop("disabled",!e)},submit:function(){return this.submit(),!1}},onDialogShown:function(){this.$id("validFrom").focus()},getTemplateData:function(){return{minDate:window.PRODUCTION_DATA_START_DATE||e.format(Date.now(),"YYYY-01-01"),maxDate:e.getMoment().add(1,"years").format("YYYY-MM-DD")}},submit:function(){var e=this;t.msg.saving(),e.$id("submit").prop("disabled",!0);var i=e.$('input[name="mode"]:checked').val(),a={comment:e.$id("comment").val().trim()};"orders"===i?a.orders=e.$id("orders").val().split(/[^0-9]+/).filter(function(e){return 9===e.length}):(a.validFrom=this.$id("validFrom").val()||"2000-01-01",a.validTo=this.$id("validTo").val()||"2100-01-01");var n=e.ajax({method:"POST",url:"/compRel/entries/"+e.model.id+";release-order",data:JSON.stringify(a)});n.fail(function(){t.msg.savingFailed(),e.$id("submit").prop("disabled",!1)}),n.done(function(){t.msg.saved(),t.closeDialog()})}})});