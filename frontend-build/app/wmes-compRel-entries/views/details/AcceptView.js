define(["app/viewport","app/core/View","app/wmes-compRel-entries/dictionaries","app/wmes-compRel-entries/Entry","app/wmes-compRel-entries/templates/details/accept"],function(e,t,n,i,c){"use strict";return t.extend({template:c,nlsDomain:"wmes-compRel-entries",events:{submit:function(){return!1},"click #-accept":function(){this.submit("accepted")},"click #-reject":function(){this.submit("rejected")},"click #-reset":function(){this.submit("pending")},"change #-func":function(){var e=this.model.entry.getFunc(this.$id("func").val());this.$id("comment").val(e.comment)}},afterRender:function(){var e=this,t=e.model.entry.get("funcs").filter(function(t){return i.can.acceptFunc(e.model.entry,t._id)}).map(function(e){return{id:e._id,text:n.funcs.getLabel(e._id)}});e.$id("func").val(e.model.func._id).select2({width:"100%",data:t}),e.$id("comment").val(e.model.func.comment)},onDialogShown:function(){this.$id("comment").focus()},submit:function(t){var n=this;e.msg.saving(),n.$(".btn[id]").prop("disabled",!0);var i=n.ajax({method:"POST",url:"/compRel/entries/"+n.model.entry.id+";accept",data:JSON.stringify({func:n.$id("func").val(),comment:n.$id("comment").val().trim(),status:t})});i.fail(function(){e.msg.savingFailed(),n.$(".btn[id]").prop("disabled",!1)}),i.done(function(){e.msg.saved(),e.closeDialog()})}})});