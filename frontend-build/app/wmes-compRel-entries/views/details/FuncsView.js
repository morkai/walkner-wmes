define(["jquery","app/viewport","app/core/View","app/core/views/DialogView","app/wmes-compRel-entries/Entry","./AcceptView","./AddUserView","./AddFuncView","app/wmes-compRel-entries/templates/details/funcs","app/wmes-compRel-entries/templates/details/notify"],function(e,i,t,n,o,s,c,a,l,d){"use strict";return t.extend({template:l,events:{"click .compRel-details-accept":function(e){this.showAcceptDialog(this.resolveFuncId(e))},'click [data-action="addUser"]':function(e){this.showAddUserDialog(this.resolveFuncId(e))},'click [data-action="addFunc"]':function(){this.showAddFuncDialog()},'click [data-action="notify"]':function(){this.showNotifyDialog()}},initialize:function(){this.once("afterRender",function(){this.listenTo(this.model,"change:funcs",this.render)}),e(window).on("resize."+this.idPrefix,this.onWindowResize.bind(this))},destroy:function(){e(window).off("."+this.idPrefix)},getTemplateData:function(){return{canAddUser:o.can.addUser(this.model),funcs:this.model.serializeFuncs()}},afterRender:function(){this.toggleOverflowX()},showAcceptDialog:function(e){var t=new s({model:{entry:this.model,func:this.model.getFunc(e)}});i.showDialog(t,this.t("accept:title"))},showAddUserDialog:function(e){var t=new c({model:{entry:this.model,func:this.model.getFunc(e)}});i.showDialog(t,this.t("addUser:title"))},showAddFuncDialog:function(){var e=new a({model:this.model});i.showDialog(e,this.t("addFunc:title"))},showNotifyDialog:function(){var e=new n({template:d,nlsDomain:this.model.getNlsDomain()});i.showDialog(e,this.t("notify:title")),this.listenTo(e,"answered",function(e){"yes"===e&&this.notify()})},notify:function(){i.msg.saving();var e=this.ajax({method:"POST",url:"/compRel/entries/"+this.model.id+";notify",data:JSON.stringify({})});e.fail(function(){i.msg.savingFailed()}),e.done(function(){i.msg.saved(),i.closeDialog()})},toggleOverflowX:function(){this.$(".compRel-details-funcs").css("overflow-x",this.$el.outerWidth()+50<window.innerWidth?"visible":"")},resolveFuncId:function(e){return this.$(e.target).closest(".compRel-details-func")[0].dataset.id},onWindowResize:function(){this.toggleOverflowX()}})});