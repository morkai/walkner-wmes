define(["app/time","app/viewport","app/core/View","app/wmes-compRel-entries/templates/details/removeOrders"],function(e,t,a,i){"use strict";return a.extend({template:i,events:{"change #-orders":function(e){e.target.value=e.target.value.split(/[^0-9]+/).filter(function(e){return 9===e.length}).join(" ")},submit:function(){return this.submit(),!1}},afterRender:function(){var t={},a={};this.model.get("orders").forEach(function(i){var r=Date.parse(i.releasedAt);t[r]||(t[r]={id:r,text:e.format(r,"L LT")}),a[i.releasedBy.id]||(a[i.releasedBy.id]={id:i.releasedBy.id,text:i.releasedBy.label})}),this.$id("releasedBy").select2({width:"100%",allowClear:!0,placeholder:" ",data:Object.values(a)}),this.$id("releasedAt").select2({width:"100%",allowClear:!0,placeholder:" ",data:Object.values(t)})},onDialogShown:function(){this.$id("orders").focus()},submit:function(){var e=this;t.msg.saving(),e.$id("submit").prop("disabled",!0);var a={remove:{orders:e.$id("orders").val().split(/[^0-9]+/).filter(function(e){return 9===e.length}),releasedBy:e.$id("releasedBy").val()||null,releasedAt:e.$id("releasedAt").val()||null},comment:e.$id("comment").val().trim()},i=e.ajax({method:"POST",url:"/compRel/entries/"+e.model.id+";release-order",data:JSON.stringify(a)});i.fail(function(){t.msg.savingFailed(),e.$id("submit").prop("disabled",!1)}),i.done(function(){t.msg.saved(),t.closeDialog()})}})});