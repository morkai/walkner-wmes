define(["underscore","app/time","app/user","app/core/views/FilterView","app/core/util/forms/dateTimeRange","app/core/util/idAndLabel","app/data/orgUnits","app/users/util/setUpUserSelect2","app/mrpControllers/util/setUpMrpSelect2","../dictionaries","../Entry","app/wmes-compRel-entries/templates/filter","app/core/util/ExpandableSelect"],function(e,t,r,s,i,a,n,o,p,l,u,d){"use strict";return s.extend({filterList:["createdAt","mrps","oldComponent","newComponent","orderNo","limit"],filterMap:{family:"mrps"},template:d,events:e.assign({"click a[data-date-time-range]":i.handleRangeEvent,'change input[name="userType"]':"toggleUserSelect2"},s.prototype.events),defaultFormData:function(){return{userType:"others"}},termToForm:{createdAt:i.rqlToForm,"orders.orderNo":function(e,t,r){r.orderNo=t.args[1]},"oldComponents._id":function(e,t,r){r.oldComponent=t.args[1]},newCode:function(e,t,r){r.newComponent=t.args[1]},"creator.id":function(e,t,r){r.userType="creator",r.user=t.args[1]},"funcs.acceptedBy.id":function(e,t,r){r.userType="acceptor",r.user=t.args[1]},users:function(e,t,s){"mine"===t.args[1]?(s.userType="mine",s.user=r.data._id):(s.userType=t.args[1]===r.data._id?"mine":"others",s.user=t.args[1])},status:function(e,t,r){r[e]="in"===t.name?t.args[1]:[t.args[1]]},mrps:function(e,t,r){r.mrp=Array.isArray(t.args[1])?t.args[1].join(","):""}},getTemplateData:function(){return{statuses:l.statuses}},serializeFormToQuery:function(t){var s=this.$('input[name="userType"]:checked').val(),a=(this.$id("status").val()||[]).filter(function(t){return!e.isEmpty(t)}),n=this.$id("user").val(),o=this.$id("orderNo").val().trim(),p=this.$id("oldComponent").val().trim(),l=this.$id("newComponent").val().trim(),u=this.$id("mrps").val();if(i.formToRql(this,t),"mine"===s&&(s="others",n=r.data._id),n){var d="users";"creator"===s?d="creator.id":"acceptor"===s&&(d="funcs.acceptedBy.id"),t.push({name:"eq",args:[d,n]})}a.length&&t.push({name:"in",args:["status",a]}),u&&u.length&&t.push({name:"in",args:["mrps",u.split(",")]}),9===o.length&&t.push({name:"eq",args:["orders.orderNo",o]}),p.length&&t.push({name:"eq",args:["oldComponents._id",p]}),l.length&&t.push({name:"eq",args:["newCode",l]})},afterRender:function(){s.prototype.afterRender.call(this),this.$id("limit").parent().attr("data-filter","limit"),this.$(".is-expandable").expandableSelect(),o(this.$id("user"),{view:this,width:"100%"}),p(this.$id("mrps"),{own:!0,view:this,width:"250px"}),this.toggleUserSelect2()},destroy:function(){s.prototype.destroy.call(this),this.$(".is-expandable").expandableSelect("destroy")},toggleUserSelect2:function(){this.$id("user").select2("enable","mine"!==this.$('input[name="userType"]:checked').val())},filterHasValue:function(e){if("createdAt"===e){var t=this.$id("from-date"),r=this.$id("to-date");return t.val().length>0||r.val().length>0}return s.prototype.filterHasValue.apply(this,arguments)},showFilter:function(e){if("creator"!==e)return s.prototype.showFilter.apply(this,arguments);this.$('input[value="creator"]').parent().click()}})});