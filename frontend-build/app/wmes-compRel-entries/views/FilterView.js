define(["underscore","app/time","app/user","app/core/views/FilterView","app/core/util/forms/dateTimeRange","app/core/util/idAndLabel","app/data/orgUnits","app/users/util/setUpUserSelect2","app/mrpControllers/util/setUpMrpSelect2","../dictionaries","../Entry","app/wmes-compRel-entries/templates/filter","app/core/util/ExpandableSelect"],function(e,t,r,a,i,s,n,o,l,p,d,u){"use strict";return a.extend({filterList:["createdAt","mrps","oldCode","newCode","orderNo","limit"],filterMap:{family:"mrps"},template:u,events:e.assign({"click a[data-date-time-range]":i.handleRangeEvent,'change input[name="userType"]':"toggleUserSelect2"},a.prototype.events),defaultFormData:function(){return{userType:"others"}},termToForm:{createdAt:i.rqlToForm,orderNo:function(e,t,r){r.order=t.args[1]},nc12:"orderNo","creator.id":function(e,t,r){r.userType="creator",r.user=t.args[1]},"funcs.acceptedBy.id":function(e,t,r){r.userType="acceptor",r.user=t.args[1]},users:function(e,t,a){a.userType=t.args[1]===r.data._id?"mine":"others",a.user=t.args[1]},status:function(e,t,r){r[e]="in"===t.name?t.args[1]:[t.args[1]]},mrps:function(e,t,r){r.mrp=Array.isArray(t.args[1])?t.args[1].join(","):""}},getTemplateData:function(){return{statuses:p.statuses}},serializeFormToQuery:function(t){var a=this.$('input[name="userType"]:checked').val(),s=(this.$id("status").val()||[]).filter(function(t){return!e.isEmpty(t)}),n=this.$id("user").val(),o=this.$id("orderNo").val().trim(),l=this.$id("oldCode").val().trim(),p=this.$id("newCode").val().trim(),d=this.$id("mrps").val();if(i.formToRql(this,t),"mine"===a&&(a="others",n=r.data._id),n){var u="users";"creator"===a?u="creator.id":"acceptor"===a&&(u="funcs.acceptedBy.id"),t.push({name:"eq",args:[u,n]})}s.length&&t.push({name:"in",args:["status",s]}),d&&d.length&&t.push({name:"in",args:["mrps",d.split(",")]}),9===o.length&&t.push({name:"eq",args:["orders._id",o]}),l.length&&t.push({name:"eq",args:["oldCode",l]}),p.length&&t.push({name:"eq",args:["newCode",p]})},afterRender:function(){a.prototype.afterRender.call(this),this.$id("limit").parent().attr("data-filter","limit"),this.$(".is-expandable").expandableSelect(),o(this.$id("user"),{view:this,width:"100%"}),l(this.$id("mrps"),{own:!0,view:this,width:"250px"}),this.toggleUserSelect2()},destroy:function(){a.prototype.destroy.call(this),this.$(".is-expandable").expandableSelect("destroy")},toggleUserSelect2:function(){this.$id("user").select2("enable","mine"!==this.$('input[name="userType"]:checked').val())},filterHasValue:function(e){if("createdAt"===e){var t=this.$id("from-date"),r=this.$id("to-date");return t.val().length>0||r.val().length>0}return a.prototype.filterHasValue.apply(this,arguments)},showFilter:function(e){if("creator"!==e)return a.prototype.showFilter.apply(this,arguments);this.$('input[value="creator"]').parent().click()}})});