define(["jquery","../broker","../pubsub","../user","./SettingCollection","app/wmes-compRel-funcs/FuncCollection"],function(e,n,t,r,l,o){"use strict";var u={funcs:"funcs"},i=null,s=null,a=null,c={statuses:["pending","accepted","rejected"],settings:new l,funcs:new o,loaded:!1,load:function(){return null!==s&&(clearTimeout(s),s=null),c.loaded?null:null!==i?i:((i=e.ajax({url:"/compRel/dictionaries"})).done(function(e){c.loaded=!0,d(e)}),i.fail(f),i.always(function(){i=null}),a=t.sandbox(),Object.keys(u).forEach(function(e){a.subscribe("compRel."+u[e]+".**",b)}),c.settings.setUpPubsub(a),i)},unload:function(){null!==s&&clearTimeout(s),s=setTimeout(f,3e4)},getLabel:function(e,n){if("string"==typeof e&&(e=this.forProperty(e)||c[e]),!e||Array.isArray(e))return n;var t=e.get(n);return t?t.getLabel():n},forProperty:function(e){return this[u[e]]||null},bind:function(e){var n=this;return e.on("beforeLoad",function(e,t){t.push(n.load())}),e.on("afterRender",n.load.bind(n)),e.once("remove",n.unload.bind(n)),e}};function d(e){Object.keys(u).forEach(function(n){var t=u[n];Array.isArray(c[t])?c[t]=e?e[t]:[]:c[t]&&c[t].reset&&c[t].reset(e?e[t]:[])}),c.settings.reset(e?e.settings:[])}function f(){s=null,null!==a&&(a.destroy(),a=null),c.loaded=!1,d()}function b(e,t){var r=t.split("."),l=c[r[1]];if(l){switch(r[2]){case"added":l.add(e.model);break;case"edited":var o=l.get(e.model._id);o&&o.set(e.model);break;case"deleted":l.remove(l.get(e.model._id))}n.publish(t,e)}}return c});