define(["jquery","../broker","../pubsub","../user","./SettingCollection","app/wmes-compRel-funcs/FuncCollection","app/wmes-compRel-reasons/ReasonCollection"],function(e,n,t,o,r,l,s){"use strict";var u={funcs:"funcs",reason:"reasons"},a=null,i=null,c=null,d={statuses:["pending","accepted","rejected"],settings:new r,funcs:new l,reasons:new s,loaded:!1,load:function(){return null!==i&&(clearTimeout(i),i=null),d.loaded?null:null!==a?a:((a=e.ajax({url:"/compRel/dictionaries"})).done(function(e){d.loaded=!0,f(e)}),a.fail(b),a.always(function(){a=null}),c=t.sandbox(),Object.keys(u).forEach(function(e){c.subscribe("compRel."+u[e]+".**",p)}),d.settings.setUpPubsub(c),a)},unload:function(){null!==i&&clearTimeout(i),i=setTimeout(b,3e4)},getLabel:function(e,n){if("string"==typeof e&&(e=this.forProperty(e)||d[e]),!e||Array.isArray(e))return n;var t=e.get(n);return t?t.getLabel():n},forProperty:function(e){return this[u[e]]||null},bind:function(e){var n=this;return e.on("beforeLoad",function(e,t){t.push(n.load())}),e.on("afterRender",n.load.bind(n)),e.once("remove",n.unload.bind(n)),e}};function f(e){Object.keys(u).forEach(function(n){var t=u[n];Array.isArray(d[t])?d[t]=e?e[t]:[]:d[t]&&d[t].reset&&d[t].reset(e?e[t]:[])}),d.settings.reset(e?e.settings:[])}function b(){i=null,null!==c&&(c.destroy(),c=null),d.loaded=!1,f()}function p(e,t){var o=t.split("."),r=d[o[1]];if(r){switch(o[2]){case"added":r.add(e.model);break;case"edited":var l=r.get(e.model._id);l&&l.set(e.model);break;case"deleted":r.remove(r.get(e.model._id))}n.publish(t,e)}}return d});