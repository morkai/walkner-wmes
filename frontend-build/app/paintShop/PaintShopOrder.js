// Part of <https://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

define(["underscore","../time","../i18n","../core/Model"],function(t,e,i,n){"use strict";function r(t){return["date","startedAt","finishedAt"].forEach(function(e){"string"==typeof t[e]&&(t[e]=new Date(t[e]))}),t}return n.extend({urlRoot:"/paintShop/orders",clientUrlRoot:"#paintShop/orders",topicPrefix:"paintShop.orders",privilegePrefix:"PAINT_SHOP",nlsDomain:"paintShop",parse:r,serialize:function(n){var r=this;if(!n&&r.collection&&r.collection.serializedMap&&r.collection.serializedMap[this.id])return r.collection.serializedMap[this.id];var o=r.toJSON(),a=o.childOrders.length,s=a-1;return o.rowSpan=a+1,o.rowSpanDetails=o.rowSpan,o.childOrders=o.childOrders.map(function(e,i){o.paintCount=0,e.components.forEach(function(t){o.paintCount+="G"===t.unit||"KG"===t?1:0});var n=e.components.length,r=n+(o.paintCount>1?1:0);return o.rowSpan+=n,o.rowSpanDetails+=r,t.assign({rowSpan:n+1,rowSpanDetails:r+1,last:i===s},e)}),o.startTime&&(o.startTimeText=e.utc.format(o.startTime,"HH:mm:ss")),o.startedAt&&(o.startedAtText=e.format(o.startedAt,"HH:mm:ss")),o.finishedAt&&(o.finishedAtText=e.format(o.finishedAt,"HH:mm:ss")),o.statusText=i("paintShop","status:"+o.status),o}},{parse:r})});