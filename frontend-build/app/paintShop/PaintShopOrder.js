// Part of <https://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

define(["underscore","../time","../i18n","../core/Model"],function(t,e,i,r){"use strict";function n(t){return["date","startedAt","finishedAt"].forEach(function(e){"string"==typeof t[e]&&(t[e]=new Date(t[e]))}),t}var a={777777777777:!0};return r.extend({urlRoot:"/paintShop/orders",clientUrlRoot:"#paintShop/orders",topicPrefix:"paintShop.orders",privilegePrefix:"PAINT_SHOP",nlsDomain:"paintShop",parse:n,serialize:function(r){var n=this;if(!r&&n.collection&&n.collection.serializedMap&&n.collection.serializedMap[this.id])return n.collection.serializedMap[this.id];var o=n.toJSON(),s=o.childOrders.length,p=s-1;return o.rowSpan=s+1,o.rowSpanDetails=o.rowSpan,o.childOrders=o.childOrders.map(function(e,i){var r=[];o.paintCount=0,e.components.forEach(function(t){a[t.nc12]||(o.paintCount+="G"===t.unit||"KG"===t?1:0,r.push(t))});var n=r.length,s=n+(o.paintCount>1?1:0);return o.rowSpan+=n,o.rowSpanDetails+=s,t.assign({rowSpan:n+1,rowSpanDetails:s+1,last:i===p},e,{components:r})}),o.startTime&&(o.startTimeText=e.utc.format(o.startTime,"HH:mm:ss")),o.startedAt&&(o.startedAtText=e.format(o.startedAt,"HH:mm:ss")),o.finishedAt&&(o.finishedAtText=e.format(o.finishedAt,"HH:mm:ss")),o.statusText=i("paintShop","status:"+o.status),o}},{parse:n})});