// Part of <https://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

define(["underscore","../time","../i18n","../core/Model"],function(t,e,i,n){"use strict";function r(t){return["date","startedAt","finishedAt"].forEach(function(e){"string"==typeof t[e]&&(t[e]=new Date(t[e]))}),t}var a={777777777777:!0};return n.extend({urlRoot:"/paintShop/orders",clientUrlRoot:"#paintShop/orders",topicPrefix:"paintShop.orders",privilegePrefix:"PAINT_SHOP",nlsDomain:"paintShop",parse:r,serialize:function(n){var r=this;if(!n&&r.collection&&r.collection.serializedMap&&r.collection.serializedMap[this.id])return r.collection.serializedMap[this.id];var s=r.toJSON(),o=s.childOrders.length,p=o-1;if(s.rowSpan=o+1,s.rowSpanDetails=s.rowSpan,s.childOrders=s.childOrders.map(function(e,i){var n=[];s.paintCount=0,e.components.forEach(function(t){a[t.nc12]||(s.paintCount+="G"===t.unit||"KG"===t?1:0,n.push(t))});var r=n.length,o=r+(s.paintCount>1?1:0);return s.rowSpan+=r,s.rowSpanDetails+=o,t.assign({rowSpan:r+1,rowSpanDetails:o+1,last:i===p},e,{components:n})}),s.startTime&&(s.startTimeTime=e.utc.format(s.startTime,"HH:mm:ss")),s.startedAt){var c=e.getMoment(s.startedAt);s.startedAtTime=c.format("HH:mm:ss"),s.startedAtDate=c.format("DD.MM, HH:mm:ss")}if(s.finishedAt){var d=e.getMoment(s.finishedAt);s.finishedAtTime=d.format("HH:mm:ss"),s.finishedAtDate=d.format("DD.MM, HH:mm:ss")}return s.statusText=i("paintShop","status:"+s.status),s}},{parse:r,isComponentBlacklisted:function(t){return a[t.nc12]}})});