// Part of <https://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

define(["underscore","../time","../i18n","../core/Model"],function(t,e,i,r){"use strict";function n(t){return["date","startedAt","finishedAt"].forEach(function(e){"string"==typeof t[e]&&(t[e]=new Date(t[e]))}),t}return r.extend({urlRoot:"/paintShop/orders",clientUrlRoot:"#paintShop/orders",topicPrefix:"paintShop.orders",privilegePrefix:"PAINT_SHOP",nlsDomain:"paintShop",parse:n,serialize:function(r){var n=this;if(!r&&n.collection&&n.collection.serializedMap&&n.collection.serializedMap[this.id])return n.collection.serializedMap[this.id];var s=n.toJSON(),o=s.childOrders.length,a=o-1;return s.rowSpan=o+1,s.childOrders=s.childOrders.map(function(e,i){return s.rowSpan+=e.components.length,t.assign({rowSpan:e.components.length+1,last:i===a},e)}),s.startTime&&(s.startTimeText=e.utc.format(s.startTime,"HH:mm:ss")),s.startedAt&&(s.startedAtText=e.format(s.startedAt,"HH:mm:ss")),s.finishedAt&&(s.finishedAtText=e.format(s.finishedAt,"HH:mm:ss")),s.statusText=i("paintShop","status:"+s.status),s}},{parse:n})});