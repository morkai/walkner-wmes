// Part of <https://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

define(["underscore","../time","../i18n","../core/Model"],function(t,e,r,i){"use strict";function n(t){return["date","startedAt","finishedAt"].forEach(function(e){"string"==typeof t[e]&&(t[e]=new Date(t[e]))}),t}return i.extend({urlRoot:"/paintShop/orders",clientUrlRoot:"#paintShop/orders",topicPrefix:"paintShop.orders",privilegePrefix:"PAINT_SHOP",nlsDomain:"paintShop",parse:n,serialize:function(){var i=this;if(i.collection&&i.collection.serialized){var n=t.find(i.collection.serialized,function(t){return t._id===i.id});if(n)return n}var o=i.toJSON(),s=o.childOrders.length,a=s-1;return o.rowSpan=s+1,o.childOrders.forEach(function(t,e){o.rowSpan+=t.components.length,t.rowSpan=t.components.length+1,t.last=e===a}),o.startTime&&(o.startTimeText=e.utc.format(o.startTime,"HH:mm:ss")),o.startedAt&&(o.startedAtText=e.format(o.startedAt,"HH:mm:ss")),o.finishedAt&&(o.finishedAtText=e.format(o.finishedAt,"HH:mm:ss")),o.statusText=r("paintShop","status:"+o.status),o}},{parse:n})});