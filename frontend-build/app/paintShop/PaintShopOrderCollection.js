// Part of <http://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

define(["jquery","../core/util/getShiftStartInfo","../core/Collection","./PaintShopOrder"],function(e,t,r,n){"use strict";return r.extend({model:n,rqlQuery:"sort(date)&limit(20)",parse:function(e){return r.prototype.parse.call(this,e).map(n.parse)},act:function(t,r){var n=this,i=n.url;t.requestId&&(i="/isaActiveRequests/"+this.get(t.requestId).getProdLineId());var s=e.ajax({method:"PATCH",url:i,data:JSON.stringify(t)});return n.trigger("request",this,s,{}),s.fail(function(e){var t=e.responseJSON?e.responseJSON.error:null;t||(t={message:e.statusText}),t.statusCode=e.status,r(t),n.trigger("error",s)}),s.done(function(e){r(null,e),n.trigger("sync",e,s)}),s},pickup:function(e,t){return this.act({action:"requestPickup",secretKey:e},t)},deliver:function(e,t,r){return this.act({action:"requestDelivery",secretKey:t,palletKind:e},r)},cancel:function(e,t,r){return this.act({action:"cancelRequest",secretKey:t,requestId:e},r)},accept:function(e,t,r){return this.act({action:"acceptRequest",responder:t,requestId:e},r)},finish:function(e,t){return this.act({action:"finishRequest",requestId:e},t)}},{forCurrentDate:function(){return this.forDate("current")},forDate:function(e){return new this(null,{rqlQuery:"date="+e})}})});