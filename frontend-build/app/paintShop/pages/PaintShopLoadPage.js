// Part of <https://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

define(["jquery","app/i18n","app/core/View","app/core/util/bindLoadingMessage","../PaintShopLoadStats","../views/PaintShopLoadStatsView","app/paintShop/templates/load/page"],function(t,i,e,o,n,s,a){"use strict";var p="ps-load",d=window.parent!==window||"/"!==window.location.pathname;return e.extend({template:a,layoutName:d?"blank":"page",pageId:"paintShopLoad",breadcrumbs:function(){return[{href:"#paintShop/"+(window.WMES_LAST_PAINT_SHOP_DATE||"0d"),label:i.bound("paintShop","BREADCRUMBS:base")},i.bound("paintShop","BREADCRUMBS:load")]},events:{"mousedown #-switchApps":function(t){this.startActionTimer("switchApps",t)},"touchstart #-switchApps":function(){this.startActionTimer("switchApps")},"mouseup #-switchApps":function(){this.stopActionTimer("switchApps")},"touchend #-switchApps":function(){this.stopActionTimer("switchApps")},"mousedown #-reboot":function(t){this.startActionTimer("reboot",t)},"touchstart #-reboot":function(){this.startActionTimer("reboot")},"mouseup #-reboot":function(){this.stopActionTimer("reboot")},"touchend #-reboot":function(){this.stopActionTimer("reboot")},"mousedown #-shutdown":function(t){this.startActionTimer("shutdown",t)},"touchstart #-shutdown":function(){this.startActionTimer("shutdown")},"mouseup #-shutdown":function(){this.stopActionTimer("shutdown")},"touchend #-shutdown":function(){this.stopActionTimer("shutdown")}},initialize:function(){this.actionTimer={action:null,time:null},this.defineModels(),this.defineViews(),this.defineBindings(),this.setView("#-stats",this.statsView)},destroy:function(){t(document.body).css("overflow","").removeClass("paintShopLoad-page paintShop-is-embedded")},defineModels:function(){this.stats=o(new n,this,"MSG:LOADING_FAILED:stats")},defineViews:function(){this.statsView=new s({model:this.stats})},defineBindings:function(){var t=this;t.once("afterRender",function(){d&&window.parent.postMessage({type:"ready",app:p},"*")})},load:function(t){return t(this.stats.fetch())},serialize:function(){return{idPrefix:this.idPrefix,embedded:d}},beforeRender:function(){d&&(document.body.style.overflow="hidden"),document.body.classList.toggle("paintShop-is-embedded",d),document.body.classList.add("paintShopLoad-page")},startActionTimer:function(t,i){this.actionTimer.action=t,this.actionTimer.time=Date.now(),i&&i.preventDefault()},stopActionTimer:function(t){if(this.actionTimer.action===t){var i=Date.now()-this.actionTimer.time>3e3;"switchApps"===t?i?window.parent.postMessage({type:"config"},"*"):window.parent.postMessage({type:"switch",app:p},"*"):"reboot"===t?i?window.parent.postMessage({type:"reboot"},"*"):window.parent.postMessage({type:"refresh"},"*"):i&&"shutdown"===t&&window.parent.postMessage({type:"shutdown"},"*"),this.actionTimer.action=null,this.actionTimer.time=null}}})});