// Part of <https://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

define(["underscore","jquery","app/i18n","app/viewport","app/core/View","app/paintShop/templates/list"],function(t,e,i,s,n,l){"use strict";return n.extend({template:l,events:{"mousedown .paintShop-list-item":function(t){this.lastClickEvent=t},"mouseup .paintShop-list-item":function(t){var e=this.lastClickEvent;e&&0===t.button&&((window.parent===window||e.offsetY===t.offsetY&&e.offsetX===t.offsetX&&e.screenX===t.screenX&&e.screenY===t.screenY)&&this.handleItemClick(t.currentTarget.dataset.orderId),this.lastClickEvent=null)},scroll:"onScroll"},initialize:function(){this.lastClickEvent=null,this.lastVisibleItem=null,this.onScroll=t.debounce(this.onScroll.bind(this),100,!1),this.listenTo(this.model,"reset",this.render),this.listenTo(this.model,"change",this.onChange),this.listenTo(this.model,"mrpSelected",this.onMrpSelected)},serialize:function(){return{idPrefix:this.idPrefix,showTimes:this.options.showTimes,selectedMrp:this.model.selectedMrp,orders:this.serializeOrders()}},serializeOrders:function(){var t=this.options.filter,e=this.options.sort,i=this.model.serialize();return t&&(i=i.filter(t)),e&&(i=i.sort(e)),i},afterRender:function(){var t=this.$item(this.lastVisibleItem);t.length&&(this.el.scrollTop=t[0].offsetTop)},$item:function(t){return this.$('.paintShop-list-item[data-order-id="'+t+'"]')},handleItemClick:function(t){t&&this.model.trigger("focus",t)},onScroll:function(){var t=this.$(".visible");if(t.length){this.lastVisibleItem=t[0].dataset.orderId;for(var e=this.el.scrollTop,i=0;i<t.length;++i){var s=t[i];if(s.offsetTop>e)break;this.lastVisibleItem=s.dataset.orderId,e>s.offsetTop+25&&t[i+1]&&(this.lastVisibleItem=t[i+1].dataset.orderId)}}},onChange:function(t){var e=this.$item(t.id);return this.options.filter?void((e.length||this.options.filter(t.serialize()))&&this.render()):void e.attr("data-status",t.get("status"))},onMrpSelected:function(){var t=this.model.selectedMrp,e="all"!==t;this.$(".paintShop-list-item").each(function(){var i=e&&this.dataset.mrp!==t;this.nextElementSibling&&(this.classList.toggle("hidden",i),this.classList.toggle("visible",!i))})}})});