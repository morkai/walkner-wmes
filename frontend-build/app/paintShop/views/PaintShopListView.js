define(["underscore","jquery","app/i18n","app/time","app/viewport","app/core/View","app/paintShop/templates/list"],function(t,i,e,s,n,o,l){"use strict";return o.extend({template:l,events:{"mousedown .paintShop-list-item":function(t){this.lastClickEvent=t},"mouseup .paintShop-list-item":function(t){var i=this.lastClickEvent;i&&0===t.button&&((window.parent===window||i.offsetY===t.offsetY&&i.offsetX===t.offsetX&&i.screenX===t.screenX&&i.screenY===t.screenY)&&this.handleItemClick(t.currentTarget.dataset.orderId),this.lastClickEvent=null)}},initialize:function(){this.onScroll=t.debounce(this.onScroll.bind(this),100,!1),this.lastClickEvent=null,this.lastVisibleItem=null,this.listenTo(this.model,"reset",t.after(2,this.render)),this.listenTo(this.model,"change",this.onChange),this.listenTo(this.model,"mrpSelected paintSelected",this.toggleVisibility)},serialize:function(){return{idPrefix:this.idPrefix,showTimes:this.options.showTimes,isVisible:this.model.isVisible.bind(this.model),orders:this.serializeOrders()}},serializeOrders:function(){var t=this.options.filter,i=this.options.sort,e=this.model.serialize();return t&&(e=e.filter(t)),i&&(e=e.sort(i)),e},afterRender:function(){var t=this.$item(this.lastVisibleItem);t.length&&(this.el.parentNode.scrollTop=t[0].offsetTop)},$item:function(t){return this.$('.paintShop-list-item[data-order-id="'+t+'"]')},handleItemClick:function(t){t&&this.model.trigger("focus",t)},onScroll:function(){var t=this.$(".visible");if(t.length){var i=this.el.parentNode;if(i){this.lastVisibleItem=t[0].dataset.orderId;for(var e=i.scrollTop,s=0;s<t.length;++s){var n=t[s];if(n.offsetTop>e)break;this.lastVisibleItem=n.dataset.orderId,e>n.offsetTop+25&&t[s+1]&&(this.lastVisibleItem=t[s+1].dataset.orderId)}}}},onChange:function(t){var i=this.options.filter,e=this.options.sort,s=this.$item(t.id);i||e?!s.length||i(t.serialize())?this.render():s.remove():s.attr("data-status",t.get("status"))},toggleVisibility:function(){var t=this.model;this.$(".paintShop-list-item").each(function(){if(this.nextElementSibling){var i=t.get(this.dataset.orderId),e=!i||!t.isVisible(i.serialize());this.classList.toggle("hidden",e),this.classList.toggle("visible",!e)}})}})});