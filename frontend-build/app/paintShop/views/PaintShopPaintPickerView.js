// Part of <https://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

define(["app/i18n","app/time","app/core/View","app/paintShop/templates/paintPicker"],function(t,i,e,n){"use strict";return e.extend({template:n,dialogClassName:"paintShop-paintPicker-dialog",events:{"focus [data-vkb]":function(t){this.options.vkb&&this.options.vkb.show(t.target,this.onVkbValueChange)},"click .paintShop-paintPicker-paint":function(t){this.$(".active").removeClass("active"),t.currentTarget.classList.add("active")},"input #-filter":"onVkbValueChange",submit:function(){return!1},"click #-select":function(){this.trigger("picked",this.$(".active").val())},"click #-msp":function(){this.trigger("picked","msp")},"click #-all":function(){this.trigger("picked","all")}},initialize:function(){this.onVkbValueChange=this.onVkbValueChange.bind(this)},destroy:function(){this.options.vkb&&this.options.vkb.hide()},getTemplateData:function(){var t=this.orders,i=this.dropZones,e={},n=[];t.serialize().forEach(function(t){Object.keys(t.paints).forEach(function(t){e[t]=1})});var a=t.settings.getValue("mspPaints")||[];return Object.keys(e).forEach(function(e){if(-1===a.indexOf(e)){var s=t.paints.get(e),c=t.totalQuantities[e];n.push({nc12:e,name:s?s.get("name"):"",dropped:i.getState(e),className:c&&c.new+c.started+c.partial!==0?"default":"success"})}}),n.sort(function(t,i){return t.nc12.localeCompare(i.nc12)}),{paints:n,mspDropped:i.getState("msp")}},afterRender:function(){var t=this.$('.paintShop-paintPicker-paint[value="'+this.orders.selectedPaint+'"]');t.length||(t=this.$(".paintShop-paintPicker-paint").first()),t.click().focus(),this.$id("filter").focus();var i=window.innerHeight-this.$(".paintShop-paintPicker-filter").outerHeight()-this.$(".paintShop-paintPicker-buttons").outerHeight()-60-60;this.$(".paintShop-paintPicker-paints").css("height",i+"px")},onVkbValueChange:function(){var t=this.$id("filter").val().trim();if(""===t)this.$(".hidden").removeClass("hidden");else{var i=null;this.$(".paintShop-paintPicker-paint").each(function(){var e=-1===this.value.indexOf(t);this.classList.toggle("hidden",e),i||e||(i=this)}),i&&i.click()}}})});