// Part of <https://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

define(["app/i18n","app/time","app/core/View","app/paintShop/templates/paintPicker"],function(i,t,e,n){"use strict";return e.extend({template:n,dialogClassName:"paintShop-paintPicker-dialog",events:{"focus [data-vkb]":function(i){this.options.vkb&&this.options.vkb.show(i.target,this.onVkbValueChange)},"click .paintShop-paintPicker-paint":function(i){this.$(".active").removeClass("active"),i.currentTarget.classList.add("active")},"input #-filter":"onVkbValueChange",submit:function(){return!1},"click #-select":function(){this.trigger("picked",this.$(".active").val())},"click #-msp":function(){this.trigger("picked","msp")},"click #-all":function(){this.trigger("picked","all")}},initialize:function(){this.onVkbValueChange=this.onVkbValueChange.bind(this)},destroy:function(){this.options.vkb&&this.options.vkb.hide()},getTemplateData:function(){var i=this.model,t={},e=[];return i.serialize().forEach(function(i){Object.keys(i.paints).forEach(function(i){t[i]=1})}),Object.keys(t).forEach(function(t){var n=i.paints.get(t);e.push({nc12:t,name:n?n.get("name"):""})}),e.sort(function(i,t){return i.nc12.localeCompare(t.nc12)}),{paints:e}},afterRender:function(){var i=this.$('.paintShop-paintPicker-paint[value="'+this.model.selectedPaint+'"]');i.length||(i=this.$(".paintShop-paintPicker-paint").first()),i.click().focus(),this.$id("filter").focus();var t=window.innerHeight-this.$(".paintShop-paintPicker-filter").outerHeight()-this.$(".paintShop-paintPicker-buttons").outerHeight()-60-60;this.$(".paintShop-paintPicker-paints").css("height",t+"px")},onVkbValueChange:function(){var i=this.$id("filter").val().trim();if(""===i)this.$(".hidden").removeClass("hidden");else{var t=null;this.$(".paintShop-paintPicker-paint").each(function(){var e=-1===this.value.indexOf(i);this.classList.toggle("hidden",e),t||e||(t=this)}),t&&t.click()}}})});