// Part of <https://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

define(["jquery","app/i18n","app/viewport","app/core/View","./PaintShopOrderDetailsView","app/paintShop/templates/queue","app/paintShop/templates/queueOrder"],function(e,t,i,r,n,o,s){"use strict";return r.extend({template:o,events:{"mousedown .paintShop-order":function(e){this.lastClickEvent=e},"mouseup .paintShop-order":function(e){var t=this.lastClickEvent;t&&((window.parent===window||0===e.button&&t.offsetY===e.offsetY&&t.offsetX===e.offsetX&&t.screenX===e.screenX&&t.screenY===e.screenY)&&this.handleOrderClick(e.currentTarget.dataset.orderId),this.lastClickEvent=null)}},initialize:function(){this.lastClickEvent=null,this.listenTo(this.model,"reset",this.render),this.listenTo(this.model,"change",this.onChange),this.listenTo(this.model,"focus",this.onFocus)},serialize:function(){return{idPrefix:this.idPrefix,groups:this.model.serializeGroups(),renderQueueOrder:s}},afterRender:function(){var e=this.$(".paintShop-groups");e.length&&(e[0].style.display="")},$order:function(e){return this.$('.paintShop-order[data-order-id="'+e+'"]')},handleOrderClick:function(e){if(!i.currentDialog){var t=this.$order(e)[0];t&&this.$el.animate({scrollTop:t.offsetTop+1},200);var r=new n({model:this.model.get(e),height:t?t.clientHeight:0});i.showDialog(r)}},onChange:function(e){this.$order(e.id).replaceWith(s({order:e.serialize()}))},onFocus:function(e){var t=this.$order(e)[0];t?this.$el.animate({scrollTop:t.offsetTop+1},200):this.handleOrderClick(e)}})});