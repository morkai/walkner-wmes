define(["underscore","jquery","app/i18n","app/time","app/core/View","app/core/util/embedded","app/paintShop/templates/load/recent"],function(e,t,i,n,r,o,a){"use strict";return r.extend({template:a,initialize:function(){var e=this;e.maxDuration=-1,e.colorCache={},e.once("afterRender",function(){e.listenTo(e.settings,"change",function(){e.reset(),e.render()}),e.listenTo(e.recent,"change",function(){e.reset(),e.render()}),e.listenTo(e.recent,"update",e.update),t(window).on("resize",e.resize.bind(e))})},destroy:function(){t(window).off("."+this.idPrefix)},afterRender:function(){this.resize(),o.isEnabled()||this.$el.tooltip({selector:".psLoad-recent-item",animation:!1,title:function(){return n.toString(+this.dataset.d,!1,!1)}})},reset:function(){const e=this.recent.get("counter");this.maxDuration=([].concat(this.settings.getValue(`load.statuses.${e}`)).sort((e,t)=>t.from-e.from)[0]||{from:100}).from,this.colorCache={}},resize:function(){o.isEnabled()&&this.el.parentNode&&(this.el.parentNode.style.width=window.innerWidth+"px"),this.el.scrollLeft=9999},update:function(e){for(var t=this,i=0;i<e.removed;++i)t.el.firstElementChild&&t.el.removeChild(t.el.firstElementChild);var n=e.added.map(function(e){var i=t.serializeItem(e);return'<div class="psLoad-recent-item" data-d="'+e+'" style="border-top-width: '+i.padding+"px; background: "+i.color+'"></div>'});t.$el.append(n.join("")),t.resize()},getTemplateData:function(){return-1===this.maxDuration&&this.reset(),{items:this.recent.get("collection").map(this.serializeItem,this)}},serializeItem:function(e){var t=this.colorCache[e];t||(t=this.colorCache[e]=this.settings.getLoadStatus(this.recent.get("counter"),e).color);var i=0;return e<this.maxDuration&&(i=174-e/this.maxDuration*174),{padding:Math.round(i),duration:e,color:t}}})});