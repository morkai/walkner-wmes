define(["underscore","app/i18n","app/time","app/core/View","app/paintShop/templates/load/stats"],function(t,e,s,i,a){"use strict";return i.extend({template:a,initialize:function(){this.listenTo(this.stats,"change",this.render),this.listenTo(this.settings,"change",this.render)},afterRender:function(){clearInterval(this.timers.update),this.timers.update=setInterval(this.update.bind(this),1e3)},update:function(){var t=this.serializeCurrent();this.$id("current").css("color",t.color),this.$id("current-duration").html(t.duration),this.$id("current-icon").find(".fa").removeClass().addClass("fa fa-"+t.icon)},getTemplateData:function(){return{current:this.serializeCurrent(),stats:this.serializeStats()}},serializeStats:function(){var e=this,s=e.stats.get("counter");return["1h","shift","8h","1d","7d","30d"].map(function(i){var a=e.stats.get(i),n=Math.ceil(a.avg/1e3);return t.assign({id:i,count:a.sum,duration:n},e.settings.getLoadStatus(s,n))})},serializeCurrent:function(){var e=this.stats.get("counter"),s=this.stats.get("last"),i=s?Math.max(0,Math.min(999,Math.floor((Date.now()-Date.parse(s._id.ts))/1e3))).toString():"";return t.assign({duration:i},this.settings.getLoadStatus(e,i))},serializeLast:function(){var e=this.stats.get("counter"),s=this.stats.get("last"),i=s?s.d:0;return t.assign({count:1,duration:i||"?"},this.settings.getLoadStatus(e,i))}})});