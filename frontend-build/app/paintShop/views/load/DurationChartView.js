define(["underscore","app/time","app/highcharts","app/core/View","app/reports/util/formatTooltipHeader","app/reports/util/formatXAxis"],function(t,e,i,o,a,r){"use strict";return o.extend({initialize:function(){this.chart=null,this.isLoading=!1,this.listenTo(this.model,"request",this.onModelLoading),this.listenTo(this.model,"sync",this.onModelLoaded),this.listenTo(this.model,"error",this.onModelError),this.listenTo(this.model,"change:groups",this.render)},destroy:function(){null!==this.chart&&(this.chart.destroy(),this.chart=null)},afterRender:function(){this.timers.createOrUpdate&&clearTimeout(this.timers.createOrUpdate),this.timers.createOrUpdate=setTimeout(this.createOrUpdate.bind(this),1)},createOrUpdate:function(){this.timers.createOrUpdate=null,this.chart?this.updateChart():(this.createChart(),this.isLoading&&this.chart.showLoading())},createChart:function(){this.chart=new i.Chart({chart:{renderTo:this.el,plotBorderWidth:1,height:400},exporting:{filename:this.t("load:report:duration:filename",{counter:this.options.counter}),chartOptions:{title:{text:this.t("load:report:duration:title",{counter:this.t("load:counters:"+this.options.counter)})}}},title:!1,noData:{},xAxis:{type:"datetime",labels:r.labels(this)},yAxis:[{title:!1,min:0,allowDecimals:!1,labels:{format:"{value}s"}},{title:!1,min:0,allowDecimals:!1,opposite:!0}],tooltip:{shared:!0,valueDecimals:0,headerFormatter:a.bind(this)},legend:{enabled:!0},series:this.serializeSeries()})},serializeSeries:function(){var t=this.serializeChartData();return"none"===this.model.get("interval")?[{id:"actual",name:this.t("load:report:duration:actual"),data:t.actual,type:"column",color:"#0af",yAxis:0,tooltip:{valueSuffix:"s"},turboThreshold:1501}]:[{id:"avg",name:this.t("load:report:duration:avg"),data:t.avg,type:"column",color:"#0af",yAxis:0,tooltip:{valueSuffix:"s"},turboThreshold:1501},{id:"count",name:this.t("load:report:duration:count"),data:t.count,type:"line",color:"#000",yAxis:1,tooltip:{valueSuffix:this.t("reports","quantitySuffix")},marker:{radius:0,states:{hover:{radius:4}}},turboThreshold:1501}]},serializeChartData:function(){var t=this,e=t.options.counter,i={actual:[],avg:[],count:[]};return"none"===t.model.get("interval")?i.actual=t.model.get("load")[e].map(function(e){return{x:e[0],y:e[1],color:t.settings.getLoadStatus(e[1]).color}}):t.model.get("groups").forEach(function(o){var a=o.counters[e];i.avg.push({x:o.key,y:a.avg,color:t.settings.getLoadStatus(a.avg).color}),i.count.push([o.key,a.count])}),i},updateChart:function(){this.chart.destroy(),this.createChart()},onModelLoading:function(){this.isLoading=!0,this.chart&&this.chart.showLoading()},onModelLoaded:function(){this.isLoading=!1,this.chart&&this.chart.hideLoading()},onModelError:function(){this.isLoading=!1,this.chart&&this.chart.hideLoading()}})});