define(["underscore","app/i18n","app/time","app/highcharts","app/core/View","app/reports/util/formatTooltipHeader","app/reports/util/formatXAxis"],function(t,i,e,a,o,r,s){"use strict";return o.extend({initialize:function(){this.chart=null,this.isLoading=!1,this.listenTo(this.model,"request",this.onModelLoading),this.listenTo(this.model,"sync",this.onModelLoaded),this.listenTo(this.model,"error",this.onModelError),this.listenTo(this.model,"change:groups",this.render)},destroy:function(){null!==this.chart&&(this.chart.destroy(),this.chart=null)},afterRender:function(){this.timers.createOrUpdate&&clearTimeout(this.timers.createOrUpdate),this.timers.createOrUpdate=setTimeout(this.createOrUpdate.bind(this),1)},createOrUpdate:function(){this.timers.createOrUpdate=null,this.chart?this.updateChart():(this.createChart(),this.isLoading&&this.chart.showLoading())},createChart:function(){var t=this.serializeChartData();this.chart=new a.Chart({chart:{renderTo:this.el,plotBorderWidth:1},exporting:{filename:i("paintShop","load:report:filename"),chartOptions:{title:{text:i("paintShop","load:report:title")}}},title:!1,noData:{},xAxis:{type:"datetime",labels:s.labels(this)},yAxis:[{title:!1,min:0,allowDecimals:!1,labels:{format:"{value}s"}},{title:!1,min:0,allowDecimals:!1,opposite:!0}],tooltip:{shared:!0,valueDecimals:0,headerFormatter:r.bind(this)},legend:{enabled:!0},series:[{id:"duration",name:i("paintShop","load:report:avgDuration"),data:t.duration,type:"column",color:"#0af",yAxis:0,tooltip:{valueSuffix:"s"}},{id:"count",name:i("paintShop","load:report:count"),data:t.count,type:"line",color:"#000",yAxis:1,tooltip:{valueSuffix:i("reports","quantitySuffix")}}]})},serializeChartData:function(){var t=this,i={duration:[],count:[]};return t.model.get("groups").forEach(function(e){i.duration.push({x:e.key,y:e.avgDuration,g:e,color:t.settings.getLoadStatus(e.avgDuration).color}),i.count.push([e.key,e.count])}),i},updateChart:function(){this.chart.destroy(),this.createChart()},onModelLoading:function(){this.isLoading=!0,this.chart&&this.chart.showLoading()},onModelLoaded:function(){this.isLoading=!1,this.chart&&this.chart.hideLoading()},onModelError:function(){this.isLoading=!1,this.chart&&this.chart.hideLoading()}})});