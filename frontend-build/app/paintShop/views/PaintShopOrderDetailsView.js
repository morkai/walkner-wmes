// Part of <https://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

define(["jquery","app/i18n","app/viewport","app/user","app/core/View","app/paintShop/templates/orderDetails","app/paintShop/templates/queueOrder"],function(e,i,t,o,n,r,a){"use strict";return n.extend({template:r,dialogClassName:"paintShop-orderDetails-dialog",events:{"click .btn[data-action]":function(e){var i=this,t=i.$(".btn").prop("disabled",!0);i.act(e.currentTarget.dataset.action).fail(function(){t.prop("disabled",!1)}).done(function(){i.closeDialog()})}},onDialogShown:function(e){this.closeDialog=e.closeDialog.bind(e)},closeDialog:function(){},serialize:function(){var e=window.parent!==window,i=o.isAllowedTo("LOCAL"),t=o.isAllowedTo("PAINT_SHOP:PAINTER"),n=o.isAllowedTo("PAINT_SHOP:MANAGE");return{idPrefix:this.idPrefix,order:this.model.serialize(),fillerHeight:this.calcFillerHeight(),renderQueueOrder:a,canAct:e&&i||t||n,canResetIgnore:n}},afterRender:function(){0===this.options.height&&(this.options.height=this.$("tbody")[0].clientHeight,this.$id("filler").css("height",this.calcFillerHeight()+"px"))},calcFillerHeight:function(){return Math.max(window.innerHeight-60-25-75-this.options.height,0)},act:function(e){return this.model.collection.act({action:e,orderId:this.model.id},function(o){if(o)return t.msg.show({type:"error",time:3e3,text:i("paintShop","MSG:"+e+":failure")})})}})});