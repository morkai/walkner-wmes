// Part of <https://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

define(["underscore","jquery","app/i18n","app/time","app/core/View","app/paintShop/templates/load/recent"],function(e,i,t,n,r,o){"use strict";return r.extend({template:o,initialize:function(){var e=this;e.colorCache={},e.listenTo(e.settings,"change",function(){e.isRendered()&&(e.colorCache={},e.render())}),e.listenTo(e.recent,"change",function(){e.isRendered()&&e.render()}),e.listenTo(e.recent,"update",this.update),i(window).on("resize",e.resize.bind(e))},destroy:function(){i(window).off("."+this.idPrefix)},afterRender:function(){this.resize()},resize:function(){this.options.embedded&&(this.el.parentNode.style.width=window.innerWidth+"px"),this.el.scrollLeft=2560},update:function(e){for(var i=this,t=0;t<e.removed;++t)i.el.removeChild(i.el.firstElementChild);var n=e.added.map(function(e){var t=i.serializeItem(e);return'<div class="paintShopLoad-recent-item" style="border-top-width: '+t.padding+"px; background: "+t.color+'"></div>'});i.$el.append(n.join("")),i.resize()},serialize:function(){return{idPrefix:this.idPrefix,items:this.recent.get("collection").map(this.serializeItem,this)}},serializeItem:function(e){var i=this.colorCache[e];return i||(i=this.colorCache[e]=this.settings.getLoadStatus(e).color),{padding:174-3*e,duration:e,color:i}}})});