// Part of <https://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

define(["underscore","jquery","app/i18n","app/time","app/core/View","app/paintShop/templates/load/recent"],function(e,t,i,n,r,o){"use strict";return r.extend({template:o,initialize:function(){var e=this;e.colorCache={},e.listenTo(e.settings,"change",function(){e.isRendered()&&(e.colorCache={},e.render())}),e.listenTo(e.recent,"change",function(){e.isRendered()&&e.render()}),e.listenTo(e.recent,"update",this.update),t(window).on("resize",function(){e.el.scrollLeft=2560})},destroy:function(){t(window).off("."+this.idPrefix)},afterRender:function(){this.el.scrollLeft=2560},update:function(e){for(var t=this,i=0;i<e.removed;++i)t.el.removeChild(t.el.firstElementChild);var n=e.added.map(function(e){var i=t.serializeItem(e);return'<div class="paintShopLoad-recent-item" style="border-top-width: '+i.padding+"px; background: "+i.color+'"></div>'});t.$el.append(n),t.el.scrollLeft=2560},serialize:function(){return{idPrefix:this.idPrefix,items:this.recent.get("collection").map(this.serializeItem,this)}},serializeItem:function(e){var t=this.colorCache[e];return t||(t=this.colorCache[e]=this.settings.getLoadStatus(e).color),{padding:174-3*e,duration:e,color:t}}})});