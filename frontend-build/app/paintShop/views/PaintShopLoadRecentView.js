define(["underscore","jquery","app/i18n","app/time","app/core/View","app/paintShop/templates/load/recent"],function(e,t,i,n,r,o){"use strict";return r.extend({template:o,initialize:function(){var e=this;e.maxDuration=-1,e.colorCache={},e.listenTo(e.settings,"change",function(){e.isRendered()&&(e.reset(),e.render())}),e.listenTo(e.recent,"change",function(){e.isRendered()&&e.render()}),e.listenTo(e.recent,"update",this.update),t(window).on("resize",e.resize.bind(e))},destroy:function(){t(window).off("."+this.idPrefix)},afterRender:function(){this.resize()},reset:function(){this.maxDuration=([].concat(this.settings.getValue("load.statuses")).sort(function(e,t){return t.from-e.from})[0]||{from:100}).from,this.colorCache={}},resize:function(){this.options.embedded&&this.el.parentNode&&(this.el.parentNode.style.width=window.innerWidth+"px"),this.el.scrollLeft=2560},update:function(e){for(var t=this,i=0;i<e.removed;++i)t.el.firstElementChild&&t.el.removeChild(t.el.firstElementChild);var n=e.added.map(function(e){var i=t.serializeItem(e);return'<div class="paintShopLoad-recent-item" style="border-top-width: '+i.padding+"px; background: "+i.color+'"></div>'});t.$el.append(n.join("")),t.resize()},serialize:function(){return-1===this.maxDuration&&this.reset(),{idPrefix:this.idPrefix,items:this.recent.get("collection").map(this.serializeItem,this)}},serializeItem:function(e){var t=this.colorCache[e];t||(t=this.colorCache[e]=this.settings.getLoadStatus(e).color);var i=0;return e<this.maxDuration&&(i=174-e/this.maxDuration*174),{padding:i,duration:e,color:t}}})});