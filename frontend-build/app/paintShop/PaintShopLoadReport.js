define(["underscore","app/i18n","app/time","app/core/Model","app/data/colorFactory"],function(e,s,o,r,t){"use strict";return r.extend({nlsDomain:"paintShop",url:"/paintShop/load/report",defaults:function(){var e=o.getMoment().startOf("today").subtract(13,"days");return{from:e.valueOf(),to:e.add(2,"weeks").valueOf(),interval:"day",bucketSize:5,reasonLabels:{},load:{},groups:[],reasons:{}}},fetch:function(s){return e.isObject(s)||(s={}),s.data=e.assign(s.data||{},e.pick(this.attributes,["from","to","interval","bucketSize"])),r.prototype.fetch.call(this,s)},genClientUrl:function(){return"/paintShop/load/report?from="+this.get("from")+"&to="+this.get("to")+"&interval="+this.get("interval")+"&bucketSize="+this.get("bucketSize")},parse:function(o){var r=this,a={reasonLabels:o.reasonLabels,load:o.load,groups:o.groups,reasons:{},losses:{}};return o.counters.forEach(function(n){a.reasons[n]={rows:[],series:{}},a.losses[n]={rows:[],series:{}};var l=o.totals[n].delayed;e.forEach(l.reasons,function(e,s){var r=t.getColor("paintShop/load/reasons",s);a.reasons[n].rows.push({id:s,abs:e[0],rel:e[0]/l.count,color:r,label:o.reasonLabels[s]}),a.reasons[n].series[s]={id:s,name:o.reasonLabels[s],type:"column",data:[],color:r},a.losses[n].rows.push({id:s,abs:e[1]/60,rel:e[1]/l.time,color:r,label:o.reasonLabels[s]}),a.losses[n].series[s]={id:s,name:o.reasonLabels[s],type:"column",data:[],color:r}}),a.reasons[n].rows.sort(function(e,s){return s.abs-e.abs}),a.losses[n].rows.sort(function(e,s){return s.abs-e.abs}),a.reasons[n].rows.push({id:"total",abs:l.count,rel:1,color:"#DDD",label:s(r.nlsDomain,"load:report:series:total")}),a.losses[n].rows.push({id:"total",abs:l.time/60,rel:1,color:"#DDD",label:s(r.nlsDomain,"load:report:series:total")})}),o.groups.forEach(function(e){o.counters.forEach(function(s){var o=e.counters[s],r=a.reasons[s],t=a.losses[s];r.rows.forEach(function(s){if("total"!==s.id){var a=o.delayed.reasons[s.id];r.series[s.id].data.push({x:e.key,y:a?a[0]:null}),t.series[s.id].data.push({x:e.key,y:a?a[1]/60:null,seconds:a?a[1]:0})}})})}),a}},{fromQuery:function(e){var s={};return e.from>0&&(s.from=+e.from),e.to>0&&(s.to=+e.to),e.interval&&(s.interval=e.interval),e.bucketSize&&(s.bucketSize=e.bucketSize),new this(s)}})});