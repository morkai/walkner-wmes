define(["underscore","app/i18n","app/time","app/core/Model","app/data/colorFactory"],function(s,o,e,r,a){"use strict";return r.extend({nlsDomain:"paintShop",url:"/paintShop/load/report",defaults:function(){var s=e.getMoment().startOf("today").subtract(13,"days");return{from:s.valueOf(),to:s.add(2,"weeks").valueOf(),interval:"day",reasonLabels:{},load:{},groups:[],reasons:{}}},fetch:function(o){return s.isObject(o)||(o={}),o.data=s.assign(o.data||{},s.pick(this.attributes,["from","to","interval"])),r.prototype.fetch.call(this,o)},genClientUrl:function(){return"/paintShop/load/report?from="+this.get("from")+"&to="+this.get("to")+"&interval="+this.get("interval")},parse:function(e){var r=this,t={reasonLabels:e.reasonLabels,load:e.load,groups:e.groups,reasons:{},losses:{}};return e.counters.forEach(function(n){t.reasons[n]={rows:[],series:{}},t.losses[n]={rows:[],series:{}};var l=e.totals[n].delayed;s.forEach(l.reasons,function(s,o){var r=a.getColor("paintShop/load/reasons",o);t.reasons[n].rows.push({id:o,abs:s[0],rel:s[0]/l.count,color:r,label:e.reasonLabels[o]}),t.reasons[n].series[o]={id:o,name:e.reasonLabels[o],type:"column",data:[],color:r},t.losses[n].rows.push({id:o,abs:s[1]/60,rel:s[1]/l.time,color:r,label:e.reasonLabels[o]}),t.losses[n].series[o]={id:o,name:e.reasonLabels[o],type:"column",data:[],color:r}}),t.reasons[n].rows.sort(function(s,o){return o.abs-s.abs}),t.losses[n].rows.sort(function(s,o){return o.abs-s.abs}),t.reasons[n].rows.push({id:"total",abs:l.count,rel:1,color:"#DDD",label:o(r.nlsDomain,"load:report:series:total")}),t.losses[n].rows.push({id:"total",abs:l.time/60,rel:1,color:"#DDD",label:o(r.nlsDomain,"load:report:series:total")})}),e.groups.forEach(function(s){e.counters.forEach(function(o){var e=s.counters[o],r=t.reasons[o],a=t.losses[o];r.rows.forEach(function(o){if("total"!==o.id){var t=e.delayed.reasons[o.id];r.series[o.id].data.push({x:s.key,y:t?t[0]:null}),a.series[o.id].data.push({x:s.key,y:t?t[1]/60:null,seconds:t?t[1]:0})}})})}),t}},{fromQuery:function(s){var o={};return s.from>0&&(o.from=+s.from),s.to>0&&(o.to=+s.to),s.interval&&(o.interval=s.interval),new this(o)}})});