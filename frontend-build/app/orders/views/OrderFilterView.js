define(["underscore","moment","js2form","reltime","app/i18n","app/core/View","app/core/util/fixTimeRange","app/orders/templates/filter"],function(e,t,i,r,a,n,s,l){return n.extend({template:l,events:{"submit .filter-form":function(e){e.preventDefault(),this.changeFilter()},"change input[name=from]":function(e){var t=this.$("input[name=to]");"true"!==t.attr("data-changed")&&t.val(e.target.value)},"change input[name=to]":function(e){e.target.setAttribute("data-changed","true")}},initialize:function(){this.idPrefix=e.uniqueId("orderFilter")},serialize:function(){return{idPrefix:this.idPrefix}},afterRender:function(){var e=this.serializeRqlQuery();i(this.el.querySelector(".filter-form"),e)},serializeRqlQuery:function(){var t=this.model.rqlQuery,i={_id:"",nc12:"",date:"finish",from:"",to:"",user:"",limit:t.limit<5?5:t.limit>100?100:t.limit,statuses:[]};return t.selector.args.forEach(function(t){var r=t.args[0];switch(r){case"startDate":case"finishDate":s.toFormData(i,t,"date");break;case"_id":case"nc12":var a=t.args[1];i[r]=e.isString(a)?a.replace(/[^0-9]/g,""):"-"}}),i},changeFilter:function(){var e=this.model.rqlQuery,t=s.fromView(this),i=[],r=this.$("input[name=date]:checked").val()+"Date";this.serializeRegexTerm(i,"_id",9),this.serializeRegexTerm(i,"nc12",12),t.from&&i.push({name:"ge",args:[r,t.from]}),t.to&&i.push({name:"le",args:[r,t.to]}),e.selector={name:"and",args:i},e.limit=parseInt(this.$id("limit").val(),10)||15,e.skip=0,this.trigger("filterChanged",e)},serializeRegexTerm:function(e,t,i){var r=this.$id(t),a=r.val().trim();"-"!==a&&(a=a.replace(/[^0-9]/g,"")),r.val(a),"-"===a&&(a=null),null===a||a.length===i?e.push({name:"eq",args:[t,a]}):a.length>0&&e.push({name:"regex",args:[t,a]})}})});