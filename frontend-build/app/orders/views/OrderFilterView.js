// Part of <https://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

define(["underscore","app/core/util/fixTimeRange","app/core/views/FilterView","app/users/ownMrps","app/orders/templates/filter"],function(e,t,r,a,i){"use strict";return r.extend({template:i,events:e.assign({},a.events,r.prototype.events),defaultFormData:{_id:"",nc12:"",from:"",to:"",mrp:""},termToForm:{scheduledStartDate:function(e,r,a){t.toFormData(a,r,"date")},_id:function(e,t,r){var a=t.args[1];r[e]="string"==typeof a?a.replace(/[^0-9]/g,""):"-"},mrp:function(e,t,r){r[e]=t.args[1].join(",")},nc12:"_id"},serialize:function(){return e.assign(r.prototype.serialize.apply(this,arguments),{showOwnMrps:a.hasAny()})},afterRender:function(){r.prototype.afterRender.call(this);var e=this.$id("mrp").select2({width:"300px",allowClear:!0,multiple:!0,data:[],formatNoMatches:null,minimumResultsForSearch:1,adaptDropdownCssClass:function(){return"hidden"},tokenizer:function(e,t,r){var a=e,i={};return t.forEach(function(e){i[e.id]=!0}),(e.match(/[A-Z0-9]{3}/gi)||[]).forEach(function(e){a=a.replace(e,""),e=e.toUpperCase(),i[e]||(r({id:e,text:e}),i[e]=!0)}),e===a?null:a.replace(/\s+/," ").trim()}});e.select2("data",e.val().split(",").filter(function(e){return e.length}).map(function(e){return{id:e,text:e}}))},serializeFormToQuery:function(e){var r=t.fromView(this),a=this.$id("mrp").val();this.serializeRegexTerm(e,"_id",9,null,!1,!0),this.serializeRegexTerm(e,"nc12",12,null,!1,!0),r.from&&e.push({name:"ge",args:["scheduledStartDate",r.from]}),r.to&&e.push({name:"lt",args:["scheduledStartDate",r.to]}),a.length&&e.push({name:"in",args:["mrp",a.split(",")]})}})});