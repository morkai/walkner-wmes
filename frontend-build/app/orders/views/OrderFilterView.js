define(["underscore","moment","js2form","reltime","app/i18n","app/core/View","app/core/util/fixTimeRange","app/orders/templates/filter"],function(e,t,n,r,i,o,a,s){return o.extend({template:s,events:{"submit .filter-form":function(e){e.preventDefault(),this.changeFilter()},"change input[name=from]":function(e){var t=this.$("input[name=to]");"true"!==t.attr("data-changed")&&t.val(e.target.value)},"change input[name=to]":function(e){e.target.setAttribute("data-changed","true")}},initialize:function(){this.idPrefix=e.uniqueId("orderFilter")},serialize:function(){return{idPrefix:this.idPrefix}},afterRender:function(){var e=this.serializeRqlQuery();n(this.el.querySelector(".filter-form"),e)},serializeRqlQuery:function(){var t=this.model.rqlQuery,n={_id:"",nc12:"",date:"finish",from:"",to:"",user:"",limit:t.limit<5?5:t.limit>100?100:t.limit,statuses:[]};return t.selector.args.forEach(function(t){var r=t.args[0];switch(r){case"startDate":case"finishDate":a.toFormData(n,t,"date");break;case"_id":case"nc12":var i=t.args[1];n[r]=e.isString(i)?i.replace(/[^0-9]/g,""):"-"}}),n},changeFilter:function(){var e=this.model.rqlQuery,t=a.fromView(this),n=[],r=this.$("input[name=date]:checked").val()+"Date";this.serializeRegexTerm(n,"_id",9),this.serializeRegexTerm(n,"nc12",12),t.from&&n.push({name:"ge",args:[r,t.from]}),t.to&&n.push({name:"le",args:[r,t.to]}),e.selector={name:"and",args:n},e.limit=parseInt(this.$id("limit").val(),10)||15,e.skip=0,this.trigger("filterChanged",e)},serializeRegexTerm:function(e,t,n){var r=this.$id(t),i=r.val().trim();"-"!==i&&(i=i.replace(/[^0-9]/g,"")),r.val(i),"-"===i&&(i=null),null===i||i.length===n?e.push({name:"eq",args:[t,i]}):i.length>0&&e.push({name:"regex",args:[t,i]})}})});