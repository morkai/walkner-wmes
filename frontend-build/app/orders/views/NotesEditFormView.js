define(["app/viewport","app/core/views/FormView","app/orders/templates/notesForm"],function(t,e,n){"use strict";return e.extend({template:n,events:Object.assign({'click .btn[data-action="up"]':function(t){var e=this.$(t.currentTarget).closest("tr"),n=e.prev();n.length?e.insertBefore(n):e.appendTo(this.$id("notes")),this.recountNotes(),t.currentTarget.focus()},'click .btn[data-action="down"]':function(t){var e=this.$(t.currentTarget).closest("tr"),n=e.next();n.length?e.insertAfter(n):e.prependTo(this.$id("notes")),this.recountNotes(),t.currentTarget.focus()},"click #-add":function(){this.addNote("")},"click #-clear":function(){this.$id("notes").html(""),this.addNote("")}},e.prototype.events),afterRender:function(){e.prototype.afterRender.apply(this,arguments),this.$template=this.$id("notes").children().first().detach(),(this.model.get("notes")||[]).forEach(this.addNote,this),this.addNote("")},addNote:function(t){var e=this.$id("notes"),n=this.$template.clone(),i=n.find("td");i[0].textContent=e[0].childElementCount+1+".",i[1].firstElementChild.value=t,e.append(n)},recountNotes:function(){this.$("tbody > tr > td:first-child").each(function(t){this.textContent=t+1+"."})},serializeForm:function(t){return t.notes=(t.notes||[]).map(function(t){return t.trim().replace(/\n+/g,"\n")}).filter(function(t){return t.length>0}),t},request:function(t){return this.ajax({method:"POST",url:this.model.url(),data:JSON.stringify(t)})},handleSuccess:function(){t.closeDialog()}})});