// Part of <https://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

define(["underscore","app/user","app/core/views/FormView","app/core/util/idAndLabel","app/orders/templates/commentForm"],function(e,t,s,a,i){"use strict";return s.extend({template:i,updateOnChange:!1,events:e.extend({"change #-delayReason":function(e){var t=e.target.value!==(this.model.get("delayReason")||"");this.$id("submit-comment").toggleClass("hidden",t),this.$id("submit-edit").toggleClass("hidden",!t),this.$id("comment").prop("required",!t).prev().toggleClass("is-required",!t)}},s.prototype.events),afterRender:function(){s.prototype.afterRender.call(this),this.$id("delayReason").select2({allowClear:!0,placeholder:" ",data:this.delayReasons.map(a)});var e=t.isAllowedTo("PAINT_SHOP:PAINTER"),i=t.isAllowedTo("PLANNING:WHMAN"),o=e&&i||!e&&!i?"other":i?"wh":"ps";this.$('input[name="source"][value="'+o+'"]').prop("checked",!0),this.$id("comment").val("")},request:function(e){return e.delayReason||(e.delayReason=""),this.ajax({type:"POST",url:"/orders/"+this.model.id,data:JSON.stringify(e)})},handleSuccess:function(){this.$id("comment").val("").focus()}})});