define(["jquery","app/i18n","app/core/View","app/orders/templates/eto"],function(e,t,o,n){"use strict";return o.extend({template:n,remoteTopics:{"orderDocuments.eto.synced":function(e){e.nc12===this.model.get("nc12")&&this.tryLoadDocument()}},events:{"click #-external":function(){window.open(this.$("iframe").prop("src"),"ETO_"+this.model.id)},"click #-toggle":function(){var e=this.$("iframe");if(e.length){var t=!!e.data("expanded"),o=e[0].contentWindow.document.body,n=o.parentNode.getClientRects()[0].height;o.style.overflowY="scroll",t&&(n=250),e.stop(!0,!1).animate({height:n}).data("expanded",!t),this.$id("toggle").find(".fa").removeClass("fa-chevron-up fa-chevron-down").addClass("fa-chevron-"+(t?"down":"up"))}}},afterRender:function(){this.tryLoadDocument()},tryLoadDocument:function(){var e=this,t="/orderDocuments/ETO?order="+e.model.id+"&header=0";this.$el.hasClass("orders-eto-loaded")?this.$("iframe")[0].contentWindow.location.reload():e.ajax({method:"HEAD",url:t}).fail(function(t){t.status>=500?e.$el.removeClass("panel-default").addClass("panel-danger").find(".fa-spin").removeClass("fa-spin"):(e.$(".panel-body").text(e.t("ETO:NO_DATA")),e.$el.addClass("hidden"),e.model.trigger("panelToggle"))}).done(function(){e.loadDocument(t)})},loadDocument:function(t){var o=e("<iframe></iframe>").prop("src",t);this.$el.addClass("orders-eto-loaded"),this.$(".panel-body").empty().append(o),this.$el.removeClass("hidden"),this.model.trigger("panelToggle")}})});