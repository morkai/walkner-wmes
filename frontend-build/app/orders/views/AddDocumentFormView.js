define(["app/viewport","app/core/views/FormView","app/orders/templates/addDocumentForm"],function(t,e,i){"use strict";return e.extend({template:i,updateOnChange:!1,events:Object.assign({"change #-item":function(){var t=this.$id("item")[0],e=this.model.get("documents").find({item:t.value.padStart(4,"0")});t.setCustomValidity(e?this.t("documents:add:exists"):"")},"input #-nc15":function(){var t=this,e=t.$id("nc15"),i=e.val();if(e.data("valid",!1),e[0].setCustomValidity(""),/^[0-9]{15}$/.test(i))if(t.model.get("documents").get(i))e[0].setCustomValidity(t.t("documents:add:exists"));else{t.$id("submit").prop("disabled",!0);var d=t.ajax({url:"/orderDocuments/files/"+i+"?select(name)"});d.fail(function(){e[0].setCustomValidity(t.t("documents:add:notFound"))}),d.done(function(d){e.data("valid",!0),t.$id("name").val(d.name||i)}),d.always(function(){t.$id("submit").prop("disabled",!1)})}}},e.prototype.events),afterRender:function(){e.prototype.afterRender.apply(this,arguments)},checkValidity:function(){return this.$id("nc15").data("valid")},serializeToForm:function(){return{}},serializeForm:function(t){var e=this.model.get("documents").toJSON();return e.forEach(function(t){null==t.added&&(t.added=!1)}),t.item=t.item.padStart(4,"0"),t.added=!0,e.push(t),{documents:e}},request:function(t){return this.ajax({method:"POST",url:this.model.url(),data:JSON.stringify(t)})},handleSuccess:function(){t.closeDialog()}})});