// Part of <https://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

define(["underscore","app/i18n","app/viewport","app/core/View","../util/openOrderPrint","app/orders/templates/openOrdersPrint"],function(r,i,e,t,n,o){"use strict";return t.extend({template:o,events:{"input #-orders":function(r){r.target.setCustomValidity("")},"change #-orders":function(){this.$id("orders").val(this.serializeOrders().join(", "))},submit:function(){return this.findAndPrint(this.serializeOrders()),!1}},onDialogShown:function(){this.$id("orders").focus()},serializeOrders:function(){return this.$id("orders").val().split(/[^0-9]/).filter(function(r){return!!r.length})},findAndPrint:function(t){var o=this,s=this.ajax({url:"/orders?select(_id)&limit(100)&_id=in=("+t+")"});s.fail(function(){e.msg.error({type:"error",time:3e3,text:i("orders","openOrdersPrint:msg:findFailure")})}),s.done(function(e){if(e.totalCount!==t.length){var s=r.pluck(e.collection,"_id"),d=r.filter(t,function(i){return!r.includes(s,i)});return o.$id("orders")[0].setCustomValidity(i("orders","openOrdersPrint:msg:notFound",{count:d.length,orders:d.join(", ")})),void o.$id("submit").click()}n(t)})}})});