define(["app/time","app/core/templates/userInfo","app/core/util/decimalSeparator"],function(e,o,r){"use strict";return function(n,a){var t=[],s={},m={},c=!1,d=[];return(a||[]).forEach(function(e){e.newComponents.forEach(function(e){m[e._id]||(m[e._id]=[])}),0===e.oldComponents.length&&d.push(e),e.oldComponents.forEach(function(o){s[o._id]||(s[o._id]=[]),s[o._id].push(e),e.newComponents.forEach(function(r){m[r._id].push({compRel:e,oldComponent:o})})})}),(n||[]).forEach(function(n){if(n.attributes&&(n=n.toJSON()),n.nc12){var a=(Math.round(1e3*n.qty)/1e3).toString().split(".");if(n.qty=[a[0].toString(),a[1]?r+a[1]:""],n.rowClassName="",n.validFrom){var d=e.utc.getMoment(n.validFrom);n.validFrom=d.format("L"),Math.abs(d.diff(Date.now(),"days"))<30&&(n.rowClassName+=" is-recent")}t.push(n);var l=s[n.nc12];if(l)return c=!0,n.rowClassName+=" danger",void l.forEach(function(r){r.newComponents.forEach(function(a){t.push({compRel:!0,rowClassName:"success",orderNo:n.orderNo,mrp:n.mrp,nc12:a._id,name:a.name,releasedAt:e.format(r.releasedAt,"L HH:mm"),releasedBy:o({userInfo:r.releasedBy,noIp:!0})})})});var i=m[n.nc12];i&&(c=!0,n.rowClassName+=" success",i.forEach(function(r){var a=r.compRel;n.releasedAt=e.format(a.releasedAt,"L HH:mm"),n.releasedBy=o({userInfo:a.releasedBy,noIp:!0}),t.push({compRel:!0,rowClassName:"danger",orderNo:n.orderNo,mrp:n.mrp,nc12:r.oldComponent._id,name:r.oldComponent.name})}))}}),d.length&&(c=!0,d.forEach(o=>{o.newComponents.forEach(r=>{t.unshift({compRel:!0,rowClassName:"success",orderNo:"",mrp:"",nc12:r._id,name:r.name,releasedAt:e.format(o.releasedAt,"L HH:mm"),releasedBy:o.releasedBy.label})})})),{colored:c,components:t}}});