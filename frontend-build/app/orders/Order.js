// Part of <https://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

define(["../time","../i18n","../core/Model","../data/orderStatuses","./util/resolveProductName","./OperationCollection","./DocumentCollection","./ComponentCollection","app/orderStatuses/util/renderOrderStatusLabel"],function(t,e,o,n,r,a,s,i,l){"use strict";var d=["startDate","finishDate","scheduledStartDate","scheduledFinishDate"],u=["sapCreatedAt","createdAt","updatedAt"];return o.extend({urlRoot:"/orders",clientUrlRoot:"#orders",topicPrefix:"orders",privilegePrefix:"ORDERS",nlsDomain:"orders",labelAttribute:"_id",parse:function(t,e){return t=o.prototype.parse.call(this,t,e),t.operations=new a(t.operations),t.documents=new s(t.documents),t.bom=new i(t.bom),t},toJSON:function(t){var e=o.prototype.toJSON.call(this);return e.operations=e.operations?e.operations.toJSON():[],Array.isArray(e.documents)||(e.documents=e.documents&&e.documents.toJSON?e.documents.toJSON():[]),Array.isArray(e.bom)||(e.bom=e.bom&&e.bom.toJSON?e.bom.toJSON():[]),e},serialize:function(o){var a=this.toJSON();a.name=r(a),d.forEach(function(e){a[e]&&(a[e+"Text"]=t.format(a[e],"LL"))}),u.forEach(function(e){a[e]&&(a[e+"Text"]=t.format(a[e],"LLL"))}),a.unit||(a.unit="PCE"),a.qtyMax||(a.qtyMax=a.qty),a.qty&&(a.qtyUnit=a.qty+" "+a.unit),a.qtyMax&&(a.qtyMaxUnit=a.qtyMax+" "+a.unit),a.qtyDone&&(a.qtyDoneUnit=(a.qtyDone.total||0)+" "+a.unit),a.qtys="",a.qtyDone&&a.qtyDone.total>=0&&(a.qtys+=a.qtyDone.total),a.qty&&(a.qtys.length&&(a.qtys+="/"),a.qtys+=a.qty),a.statusLabels=n.findAndFill(a.statuses).map(l).join(" ");var s=o&&o.delayReasons&&o.delayReasons.get(a.delayReason);if(a.delayReason=s?s.getLabel():null,a.m4){var i=a.m4;if(a.m4=e("orders","m4:"+i),a.delayReason){var y=(s.get("drm")||{})[i];y&&(a.m4+=" ("+y+")")}}return a}})});