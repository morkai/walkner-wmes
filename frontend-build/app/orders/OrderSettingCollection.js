define(["underscore","jquery","../settings/SettingCollection","./OrderSetting"],function(e,r,t,n){"use strict";return t.extend({model:n,topicSuffix:"orders.**",nlsDomain:"orders",getValue:function(e){var r=this.get("orders."+e);return r?r.getValue():null},prepareValue:function(e,r){return/documents.remoteServer$/.test(e)?r:/documents.extra$/.test(e)?this.prepareExtraDocumentsValue(r):/operations.groups$/.test(e)?this.prepareOperationGroups(r):/operations.timeCoeffs$/.test(e)?this.prepareOperationTimeCoeffs(r):/toBusinessDays$/.test(e)?this.prepareNumericValue(r,1,9):/mrps$/i.test(e)?(Array.isArray(r)||(r=String(r).split(",")),r.filter(function(e){return e.length})):void 0},prepareExtraDocumentsValue:function(r){var t={},n="";r.split("\n").forEach(function(e){if((e=e.trim()).length){var r=e.match(/^([0-9]{15})\s+(.*?)$/);if(r){if(!t[n])return;t[n][r[1]]=r[2]}else t[n=e]={}}});var i=[];return e.forEach(t,function(e,r){var t=Object.keys(e);t.length&&(i.push(r),t.forEach(function(r){i.push(r+" "+e[r])}))}),i.join("\n")},prepareOperationGroups:function(e){return e.split("\n").map(function(e){return e.split("|").map(function(e){var r=e.split("@");return{name:r[0].trim(),workCenter:(r[1]||"").trim()}}).filter(function(e){return e.name.length})}).filter(function(e){return e.length>1}).map(function(e){return e.map(function(e){var r=e.name;return e.workCenter.length&&(r+=" @ "+e.workCenter),r}).join(" | ")}).join("\n")},prepareOperationTimeCoeffs:function(e){var r={LABOR:"labor",MACHINE:"machine",LABORSETUP:"laborSetup",MACHINESETUP:"machineSetup"},t={};return e.split("\n").forEach(function(e){for(var r,n={},i=e,o=/((?:labor|machine)(?:setup)?).*?([0-9]+(?:(?:\.|,)[0-9]+)?)/gi,a=0;null!==(r=o.exec(e));)n[r[1].toUpperCase()]=parseFloat(r[2].replace(",",".")),i=i.replace(r[0],""),a+=1;var u=i.split(/[^A-Za-z0-9]/)[0].toUpperCase();a&&u.length&&(t[u]=n)}),Object.keys(t).map(function(e){var n=e+":";return Object.keys(t[e]).forEach(function(i){n+=" "+r[i]+"="+t[e][i]}),n}).join("\n")}})});