define(["underscore","jquery","../settings/SettingCollection","./OrderSetting"],function(e,t,r,n){"use strict";return r.extend({model:n,topicSuffix:"orders.**",getValue:function(e){var t=this.get("orders."+e);return t?t.getValue():null},prepareValue:function(e,t){return/useCatalog$/.test(e)?!!t:/documents.(path|remoteServer)$/.test(e)?t:/documents.extra$/.test(e)?this.prepareExtraDocumentsValue(t):/operations.groups$/.test(e)?this.prepareOperationGroups(t):/operations.timeCoeffs$/.test(e)?this.prepareOperationTimeCoeffs(t):/toBusinessDays$/.test(e)?this.prepareNumericValue(t,1,9):/mrps$/.test(e)?(Array.isArray(t)||(t=String(t).split(",")),t.filter(function(e){return e.length})):void 0},prepareExtraDocumentsValue:function(t){var r={},n="";t.split("\n").forEach(function(e){if((e=e.trim()).length){var t=e.match(/^([0-9]{15})\s+(.*?)$/);if(t){if(!r[n])return;r[n][t[1]]=t[2]}else r[n=e]={}}});var i=[];return e.forEach(r,function(e,t){var r=Object.keys(e);r.length&&(i.push(t),r.forEach(function(t){i.push(t+" "+e[t])}))}),i.join("\n")},prepareOperationGroups:function(e){return e.split("\n").map(function(e){return e.split("|").map(function(e){var t=e.split("@");return{name:t[0].trim(),workCenter:(t[1]||"").trim()}}).filter(function(e){return e.name.length})}).filter(function(e){return e.length>1}).map(function(e){return e.map(function(e){var t=e.name;return e.workCenter.length&&(t+=" @ "+e.workCenter),t}).join(" | ")}).join("\n")},prepareOperationTimeCoeffs:function(e){var t={LABOR:"labor",MACHINE:"machine",LABORSETUP:"laborSetup",MACHINESETUP:"machineSetup"},r={};return e.split("\n").forEach(function(e){for(var t,n={},i=e,a=/((?:labor|machine)(?:setup)?).*?([0-9]+(?:(?:\.|,)[0-9]+)?)/gi,o=0;null!==(t=a.exec(e));)n[t[1].toUpperCase()]=parseFloat(t[2].replace(",",".")),i=i.replace(t[0],""),o+=1;var u=i.split(/[^A-Za-z0-9]/)[0].toUpperCase();o&&u.length&&(r[u]=n)}),Object.keys(r).map(function(e){var n=e+":";return Object.keys(r[e]).forEach(function(i){n+=" "+t[i]+"="+r[e][i]}),n}).join("\n")}})});