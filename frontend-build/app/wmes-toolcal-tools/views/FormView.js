define(["underscore","jquery","app/i18n","app/time","app/user","app/core/util/buttonGroup","app/core/util/idAndLabel","app/core/views/FormView","app/users/util/setUpUserSelect2","../dictionaries","../Tool","app/wmes-toolcal-tools/templates/form"],function(t,e,s,r,i,a,n,l,o,u,p,c){"use strict";function d(t,e){return e}return l.extend({template:c,events:t.assign({"change #-interval":function(t){var e=t.target.value.match(/([0-9]+)\s*([mwd])/i);e&&(t.target.value=this.t("interval:"+e[2],{v:e[1]}))}},l.prototype.events),serialize:function(){return t.assign(l.prototype.serialize.call(this),{statuses:u.statuses})},serializeToForm:function(){var t=this.model.toJSON();return t.lastDate=t.lastDate?r.format(t.lastDate,"YYYY-MM-DD"):"",t.users=(t.users||[]).map(function(t){return t.id}),t},serializeForm:function(t){t.users=this.$id("users").select2("data").map(function(t){return{id:t.id,label:t.text}}).filter(function(t){return!!t.id}),t.interval=+t.interval;var e=r.getMoment(t.lastDate,"YYYY-MM-DD");return t.lastDate=e.isValid()?e.toISOString():null,t},afterRender:function(){l.prototype.afterRender.call(this),this.$id("type").select2({data:u.types.map(n)}),a.toggle(this.$id("status")),this.setUpUsersSelect2()},setUpUsersSelect2:function(){var t=this.options.editMode,e=this.model,s=[];if(t){var r=e.get("users");Array.isArray(r)&&r.length&&(s=r.map(function(t){return{id:t.id,text:t.label}}))}o(this.$id("users"),{multiple:!0,textFormatter:d}).select2("data",s).select2("enable",i.isAllowedTo("TOOLCAL:MANAGE"))}})});