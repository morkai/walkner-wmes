define(["underscore","app/time","app/user","app/core/views/FilterView","app/core/util/forms/dateTimeRange","app/users/util/setUpUserSelect2","app/wmes-toolcal-tools/dictionaries","app/wmes-toolcal-tools/templates/filter"],function(e,t,s,a,i,r,n,u){"use strict";return a.extend({template:u,events:e.assign({"click a[data-date-time-range]":i.handleRangeEvent,'change input[name="userType"]':"toggleUserSelect2"},a.prototype.events),defaultFormData:function(){return{dateType:"next",userType:"others"}},termToForm:{lastDate:function(e,t,s){s.dateType=e,i.rqlToForm.call(this,e,t,s)},nextDate:"lastDate",status:function(e,t,s){s[e]=t.args[1]},"users.id":function(e,t,a){t.args[1]===s.data._id?(a.userType="mine",a.user=s.data._id):(a.userType="others",a.user=t.args[1])},name:function(e,t,s){s[e]=this.unescapeRegExp(t.args[1])},sn:"name",type:function(e,t,s){s[e]="in"===t.name?t.args[1]:[t.args[1]]}},serialize:function(){return e.assign(a.prototype.serialize.call(this),{statuses:n.statuses,types:n.types.toJSON()})},serializeFormToQuery:function(t){var a=this.$('input[name="dateType"]:checked').val(),r=this.$('input[name="userType"]:checked').val(),n=this.$id("status").val(),u=(this.$id("type").val()||[]).filter(function(t){return!e.isEmpty(t)}),l=this.$id("user").val();i.formToRql(this,t),t.forEach(function(e){"date"===e.args[0]&&(e.args[0]=a)}),"mine"===r?t.push({name:"eq",args:["users.id",s.data._id]}):l&&t.push({name:"eq",args:["users.id",l]}),this.serializeRegexTerm(t,"name",100,null,!0,!1),this.serializeRegexTerm(t,"sn",100,null,!0,!1),n.length&&t.push({name:"eq",args:["status",n]}),u.length&&t.push({name:"in",args:["type",u]})},afterRender:function(){a.prototype.afterRender.call(this),r(this.$id("user"),{width:"280px",view:this}),this.toggleUserSelect2()},toggleUserSelect2:function(){var e=this.$('input[name="userType"]:checked').val();this.$id("user").select2("enable","others"===e)}})});