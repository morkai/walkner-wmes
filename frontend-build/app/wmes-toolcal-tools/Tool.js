define(["underscore","../i18n","../time","../user","../core/Model","./dictionaries","app/core/templates/userInfo"],function(t,e,i,r,s,n,a){"use strict";return s.extend({urlRoot:"/toolcal/tools",clientUrlRoot:"#toolcal/tools",topicPrefix:"toolcal.tools",privilegePrefix:"TOOLCAL",nlsDomain:"wmes-toolcal-tools",labelAttribute:"rid",defaults:function(){return{status:"in-use",interval:3,intervalUnit:"month"}},serialize:function(){var t=this.toJSON();if(t.className="","retired"!==t.status){var r=Date.now(),s=Date.parse(t.nextDate),a=Math.floor((r-s)/864e5);t.className=a>=0?"danger":a>=-14?"warning":"success",t.remaining=-1*a}return t.type=n.types.getLabel(t.type)||"-",t.status=e(this.nlsDomain,"status:"+t.status),t.lastDate=i.format(t.lastDate,"L"),t.nextDate=i.format(t.nextDate,"L"),t.interval=e(this.nlsDomain,"interval:"+t.intervalUnit,{v:t.interval}),t.url=this.url(),t},serializeRow:function(){var t=this.serialize(),e=this.groupUsers(!0);return Object.keys(e).forEach(function(i){t["all"===i?"users":i+"Users"]=e[i].join(", ")}),t},serializeDetails:function(){var t=this.serialize(),e=this.groupUsers(!0);return Object.keys(e).forEach(function(i){var r="all"===i?"users":i+"Users";1===e[i].length?t[r]=e[i][0]:t[r]="<ul>"+e[i].map(function(t){return"<li>"+t})+"</ul>"}),t},groupUsers:function(e){var i={all:{},current:[],individual:[]};return(this.get("users")||[]).forEach(function(t){var r=e?a({userInfo:t}):t;i[t.kind]||(i[t.kind]=[]),i[t.kind].push(r),i.all[t.id]=r}),i.all=t.values(i.all),i},isOwner:function(){return t.some(this.attributes.users,function(t){return t.id===r.data._id})},canEdit:function(){return!!r.isAllowedTo(this.privilegePrefix+":MANAGE")||"retired"!==this.get("status")&&this.isOwner()},canDelete:function(){return r.isAllowedTo(this.privilegePrefix+":MANAGE")}})});