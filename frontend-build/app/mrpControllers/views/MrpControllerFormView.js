// Copyright (c) 2014, ≈Åukasz Walukiewicz <lukasz@walukiewicz.eu>. Some Rights Reserved.
// Licensed under CC BY-NC-SA 4.0 <http://creativecommons.org/licenses/by-nc-sa/4.0/>.
// Part of the walkner-wmes project <http://lukasz.walukiewicz.eu/p/walkner-wmes>

define(["app/time","app/data/mrpControllers","app/data/views/OrgUnitDropdownsView","app/core/views/FormView","app/mrpControllers/templates/form"],function(e,t,i,r,o){"use strict";return r.extend({template:o,initialize:function(){r.prototype.initialize.call(this),this.orgUnitDropdownsView=new i({orgUnit:i.ORG_UNIT.SUBDIVISION,required:!0}),this.setView(".orgUnitDropdowns-container",this.orgUnitDropdownsView)},afterRender:function(){r.prototype.afterRender.call(this);var e=this.options.editMode;e&&this.$id("_id").attr("disabled",!0);var i=t.map(function(e){return{id:e.id,text:e.getLabel()}});if(e){var o=this.model.id;i=i.filter(function(e){return e.id!==o})}this.$id("replacedBy").select2({allowClear:!0,placeholder:" ",data:i});var n=this.orgUnitDropdownsView;this.listenToOnce(n,"afterRender",function(){n.selectValue(this.model).focus(),n.$id("division").select2("enable",!e),n.$id("subdivision").select2("enable",!e)})},serializeToForm:function(){var t=r.prototype.serializeToForm.call(this);return t.deactivatedAt&&(t.deactivatedAt=e.format(t.deactivatedAt,"YYYY-MM-DD")),t},serializeForm:function(t){var i=e.getMoment(t.deactivatedAt||null);return t.deactivatedAt=i.isValid()?i.toISOString():null,t}})});