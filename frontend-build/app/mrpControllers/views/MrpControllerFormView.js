define(["app/time","app/data/mrpControllers","app/orgUnits/views/OrgUnitDropdownsView","app/orgUnits/util/changeWarning","app/core/views/FormView","app/mrpControllers/templates/form"],function(t,e,i,r,n,o){"use strict";return n.extend({template:o,initialize:function(){n.prototype.initialize.call(this),this.orgUnitDropdownsView=new i({orgUnit:i.ORG_UNIT.SUBDIVISION,required:!0}),this.setView(".orgUnitDropdowns-container",this.orgUnitDropdownsView)},afterRender:function(){n.prototype.afterRender.call(this);var t=this.options.editMode;t&&this.$id("_id").attr("disabled",!0);var i=e.map(function(t){return{id:t.id,text:t.getLabel()}});if(t){var o=this.model.id;i=i.filter(function(t){return t.id!==o})}this.$id("replacedBy").select2({allowClear:!0,placeholder:" ",data:i});var a=this.orgUnitDropdownsView;this.listenToOnce(a,"afterRender",function(){a.selectValue(this.model).focus(),a.$id("division").select2("enable",!t),a.$id("subdivision").select2("enable",!t)}),r(this)},serializeToForm:function(){var e=n.prototype.serializeToForm.call(this);return e.deactivatedAt&&(e.deactivatedAt=t.format(e.deactivatedAt,"YYYY-MM-DD")),e},serializeForm:function(e){var i=t.getMoment(e.deactivatedAt||null);return e.deactivatedAt=i.isValid()?i.toISOString():null,e}})});