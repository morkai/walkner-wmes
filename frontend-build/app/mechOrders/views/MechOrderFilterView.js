define(["underscore","js2form","app/i18n","app/core/View","app/mechOrders/templates/filter"],function(e,t,n,i,r){return i.extend({template:r,events:{"submit .filter-form":function(e){e.preventDefault(),this.changeFilter()}},initialize:function(){this.idPrefix=e.uniqueId("mechOrderFilter")},serialize:function(){return{idPrefix:this.idPrefix}},afterRender:function(){var e=this.serializeRqlQuery();t(this.el.querySelector(".filter-form"),e)},serializeRqlQuery:function(){var t=this.model.rqlQuery,n={_id:"",limit:t.limit<5?5:t.limit>100?100:t.limit};return t.selector.args.forEach(function(t){var i=t.args[0];switch(i){case"_id":var r=t.args[1];n[i]=e.isString(r)?r.replace(/[^0-9a-zA-Z]/g,""):""}}),n},changeFilter:function(){var e=this.model.rqlQuery,t=[];this.serializeRegexTerm(t,"_id",12),e.selector={name:"and",args:t},e.limit=parseInt(this.$id("limit").val(),10)||15,e.skip=0,this.trigger("filterChanged",e)},serializeRegexTerm:function(e,t,n){var i=this.$id(t),r=i.val().trim();"-"!==r&&(r=r.replace(/[^0-9a-zA-Z]/g,"")),i.val(r),"-"===r&&(r=null),null===r||r.length===n?e.push({name:"eq",args:[t,r]}):r.length>0&&e.push({name:"regex",args:[t,r]})}})});