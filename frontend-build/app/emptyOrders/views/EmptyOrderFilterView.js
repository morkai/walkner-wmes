define(["underscore","moment","js2form","app/i18n","app/core/View","app/emptyOrders/templates/filter"],function(e,t,i,n,r,o){return r.extend({template:o,events:{"submit .filter-form":function(e){e.preventDefault(),this.changeFilter()}},initialize:function(){this.idPrefix=e.uniqueId("orderFilter")},serialize:function(){return{idPrefix:this.idPrefix}},afterRender:function(){var e=this.serializeRqlQuery();i(this.el.querySelector(".filter-form"),e)},serializeRqlQuery:function(){var e=this.model.rqlQuery,i={dateType:"start",date:"",limit:e.limit<5?5:e.limit>100?100:e.limit};return e.selector.args.forEach(function(e){var n=e.args[0];switch(n){case"startDate":case"finishDate":i.date=t(e.args[1]).format("YYYY-MM-DD")}}),i},changeFilter:function(){var e=this.model.rqlQuery,i=[],n=t(this.$id("date").val()),r=this.$("[name=dateType]:checked").val()+"Date";n.isValid()&&i.push({name:"eq",args:[r,n.valueOf()]}),e.selector={name:"and",args:i},e.limit=parseInt(this.$id("limit").val(),10)||15,e.skip=0,this.trigger("filterChanged",e)}})});