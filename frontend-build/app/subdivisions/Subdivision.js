// Part of <https://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

define(["underscore","app/i18n","app/time","app/data/aors","app/data/downtimeReasons","app/data/divisions","app/core/Model"],function(t,e,i,n,a,o,r){"use strict";return r.extend({urlRoot:"/subdivisions",clientUrlRoot:"#subdivisions",topicPrefix:"subdivisions",privilegePrefix:"DICTIONARIES",nlsDomain:"subdivisions",labelAttribute:"name",defaults:function(){return{division:null,type:"assembly",name:null,prodTaskTags:null,aor:null,autoDowntimes:[],deactivatedAt:null}},serialize:function(r){var s=this.toJSON(),u=o.get(s.division);u&&(s.division=r&&r.renderOrgUnitPath?r.renderOrgUnitPath(u,!0,!1):u.getLabel()),s.deactivatedAt=s.deactivatedAt?i.format(s.deactivatedAt,"LL"):"",s.type=e("subdivisions","TYPE:"+s.type),s.prodTaskTags=s.prodTaskTags&&s.prodTaskTags.length?s.prodTaskTags.join("; "):null;var d=n.get(s.aor);return s.aor=d?d.getLabel():"-",s.autoDowntimes=t.map(s.autoDowntimes,function(t){var e=a.get(t.reason);return e?{reason:e.getLabel(),when:t.when,time:(t.time||[]).map(function(t){return{d:t.d,h:(t.h<10?"0":"")+t.h,m:(t.m<10?"0":"")+t.m}})}:null}).filter(function(t){return!!t}),s},serializeRow:function(t){var e=this.serialize(t);return e.autoDowntimes=0===e.autoDowntimes.length?"-":e.autoDowntimes.map(function(t){return t.reason}).join("; "),e},isActive:function(t){var e=this.get("deactivatedAt");return!e||(t||Date.now())<Date.parse(e)}})});