// Copyright (c) 2014, ≈Åukasz Walukiewicz <lukasz@walukiewicz.eu>. Some Rights Reserved.
// Licensed under CC BY-NC-SA 4.0 <http://creativecommons.org/licenses/by-nc-sa/4.0/>.
// Part of the walkner-wmes project <http://lukasz.walukiewicz.eu/p/walkner-wmes>

define(["underscore","../time","../i18n","../core/Model","../xiconf/util/serializeXiconfLicenseFeatures","../licenses/util/compareVersions"],function(e,s,n,i,r,c){"use strict";return i.extend({urlRoot:"/xiconf/clients",clientUrlRoot:"#xiconf/clients",privilegePrefix:"XICONF",nlsDomain:"xiconfClients",serialize:function(i){var l=this.toJSON();l.className=l.connectedAt?"success":"danger",l.lastSeenAt=s.format(l.connectedAt||l.disconnectedAt,"LLLL"),l.order&&(l.orderLink='<a href="#xiconf/orders/'+l.order+'">'+l.order+"</a>"),e.isObject(l.license)?(l.features=r(l.license.features),l.license=l.license._id):l.features=null,l.license||(l.license="00000000-0000-0000-0000-000000000000"),!l.licenseError&&/^0000.+0000$/.test(l.license)&&(l.licenseError="NO_KEY");var o="licenses-id",t=l.license;return l.licenseError&&(o+=" licenses-invalid",t+="\r\n"+n("licenses","error:"+l.licenseError)),l.shortLicense='<span class="'+o+'" title="'+t+'">'+l.license.substr(0,4)+"..."+l.license.substr(-4)+"</span>",l.appVersionCmp=c(l.appVersion,i.appVersion),i&&i.appVersion&&l.appVersion&&-1===l.appVersionCmp&&(l.appVersion='<span class="licenses-version licenses-invalid" title="&lt; '+i.appVersion+'">'+l.appVersion+"</span>"),l}})});