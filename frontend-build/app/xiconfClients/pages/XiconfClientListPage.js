// Part of <http://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

define(["app/i18n","app/viewport","app/core/util/bindLoadingMessage","app/core/views/DialogView","app/core/pages/FilteredListPage","app/xiconf/settings","../views/XiconfClientListView","../views/XiconfClientFilterView","app/xiconfClients/templates/updateAllDialog"],function(e,t,i,n,s,l,o,c,r){"use strict";return s.extend({FilterView:c,ListView:o,breadcrumbs:function(){return[e.bound("xiconfClients","BREADCRUMBS:base"),e.bound("xiconfClients","BREADCRUMBS:browse")]},actions:function(){return[{label:e.bound("xiconfClients","page:update"),icon:"forward",privileges:"XICONF:MANAGE",callback:this.updateAll.bind(this)},{label:e.bound("xiconfClients","page:settings"),icon:"cogs",privileges:"XICONF:MANAGE",href:"#xiconf;settings?tab=clients"}]},destroy:function(){s.prototype.destroy.call(this),l.release()},defineModels:function(){this.collection=i(this.collection,this),this.settings=i(l.acquire(),this)},createListView:function(){return new o({collection:this.collection,settings:this.settings})},load:function(e){return this.settings.isEmpty()?e(this.collection.fetch({reset:!0}),this.settings.fetch({reset:!0})):e(this.collection.fetch({reset:!0}))},afterRender:function(){s.prototype.afterRender.call(this),l.acquire()},updateAll:function(i){var s=this.$(".action-update").filter(function(){return!this.classList.contains("disabled")});if(!s.length)return t.msg.show({type:"warning",time:2e3,text:e("xiconfClients","MSG:NO_APPS_TO_UPDATE")}),!1;i.currentTarget.blur();var l=this,o=new n({template:r});return this.listenTo(o,"answered",function(e){"yes"===e&&(i.currentTarget.classList.add("disabled"),l.timers.updateAll=setTimeout(function(){i.currentTarget.classList.remove("disabled")},1e4),s.click())}),t.showDialog(o,e("xiconfClients","updateAllDialog:title")),!1}})});