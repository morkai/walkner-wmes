define(["underscore","jquery","app/viewport","app/core/View","app/wmes-trw-tests/templates/workstationPicker"],function(t,i,e,n,s){"use strict";return n.extend({template:s,events:{"focus [data-vkb]":function(t){this.options.vkb&&this.options.vkb.show(t.currentTarget)},"click #-lines .btn":function(t){this.$(".active").removeClass("active"),t.currentTarget.classList.add("active")},submit:function(t){t.preventDefault();var i={workstation:parseInt(this.$id("workstation").val(),10),line:this.$id("lines").find(".active").attr("data-id")};i.workstation>=1&&i.workstation<=7?i.line?(this.options.vkb&&this.options.vkb.hide(),this.trigger("picked",i)):this.$id("lines").children().first().focus():this.$id("workstation").focus()}},initialize:function(){i(window).on("resize."+this.idPrefix,this.resize.bind(this))},destroy:function(){i(window).off("."+this.idPrefix),this.options.vkb&&this.options.vkb.hide()},onDialogShown:function(){this.resize(),this.$id("workstation").focus()},afterRender:function(){this.$id("workstation").val(this.model.get("workstation")||""),this.loadLines()},resize:function(){this.heightOffset||(this.heightOffset=this.$el.closest(".modal-content").outerHeight()-this.$id("lineGroup").outerHeight()+25+60);var t=window.innerHeight-this.heightOffset;this.$id("lines").css("height",t+"px")},loadLines:function(){var i=this,e=i.ajax({url:"/prodLines?select(_id)&sort(_id)&limit(0)&deactivatedAt=null"});e.fail(function(){i.$(".fa-spin").removeClass("fa-spin")}),e.done(function(e){var n="",s=i.model.get("line");e.collection.sort(function(t,i){return t._id.localeCompare(i._id,void 0,{numeric:!0,ignorePunctuation:!0})}),e.collection.forEach(function(i){var e=t.escape(i._id),o=i._id===s?"active":"";n+='<button type="button" class="btn btn-lg btn-block btn-default '+o+'" data-id="'+e+'">'+e+"</button>"}),n+='<div class="trw-testing-list-last"></div>',i.$id("lines").html(n);var o=i.$(".active");o.length&&o[0].scrollIntoView({block:"center"})})}})});