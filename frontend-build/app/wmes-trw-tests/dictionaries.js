define(["jquery","../broker","../pubsub","../wmes-trw-testers/TesterCollection","../wmes-trw-bases/BaseCollection","../wmes-trw-programs/ProgramCollection"],function(e,r,t,n,o,l){"use strict";var s={tester:"testers",bases:"bases",program:"programs"},a=null,u=null,i=null,d={testers:new n,bases:new o,programs:new l,loaded:!1,load:function(){return null!==u&&(clearTimeout(u),u=null),d.loaded?null:null!==a?a:((a=e.ajax({url:"/trw/dictionaries"})).done(function(e){d.loaded=!0,c(e)}),a.fail(f),a.always(function(){a=null}),i=t.sandbox(),Object.keys(s).forEach(function(e){i.subscribe("trw."+s[e]+".**",b)}),a)},unload:function(){null!==u&&clearTimeout(u),u=setTimeout(f,3e4)},getLabel:function(e,r){if("string"==typeof e&&(e=this.forProperty(e)||d[e]),!e||Array.isArray(e))return r;var t=e.get(r);return t?t.getLabel():r},forProperty:function(e){return this[s[e]]||null},bind:function(e){var r=this;return e.on("beforeLoad",function(e,t){t.push(r.load())}),e.on("afterRender",r.load.bind(r)),e.once("remove",r.unload.bind(r)),e}};function c(e){e&&e.types&&(d.types=e.types),Object.keys(s).forEach(function(r){var t=s[r];d[t].reset(e?e[t]:[])})}function f(){u=null,null!==i&&(i.destroy(),i=null),d.loaded=!1,c()}function b(e,t){var n=t.split("."),o=d[n[1]];if(o){switch(n[2]){case"added":o.add(e.model);break;case"edited":var l=o.get(e.model._id);l&&l.set(e.model);break;case"deleted":o.remove(o.get(e.model._id))}r.publish(t,e)}}return d});