define(["underscore","app/core/Model","app/prodShifts/ProdShift","app/prodShiftOrders/ProdShiftOrderCollection","app/prodDowntimes/ProdDowntimeCollection"],function(r,e,t,i,d){"use strict";return e.extend({nlsDomain:"heff",initialize:function(){this.prodShift=new t,this.prodShiftOrders=new i,this.planShiftOrders=new i,this.prodDowntimes=new d},url:function(){return"/heff/"+this.get("prodLine")},parse:function(r){if(r)return r.prodDowntimes&&this.prodDowntimes.reset(r.prodDowntimes),r.planShiftOrders&&this.planShiftOrders.reset(r.planShiftOrders),r.prodShiftOrders&&this.prodShiftOrders.reset(r.prodShiftOrders),r.prodShift&&this.prodShift.set(r.prodShift),delete r.prodShift,delete r.prodShiftOrders,delete r.planShiftOrders,delete r.prodDowntimes,r},update:function(r){var e=this,t=!1;if(r.prodShift&&(r.prodShift._id&&r.prodShift._id!==e.prodShift.id?t=!0:e.prodShift.set(r.prodShift)),!t&&r.finishedPso&&r.finishedPso.forEach(function(r){var i;"string"==typeof r?(i=e.prodShiftOrders.get(r))?i.set("finishedAt",(new Date).toISOString()):t=!0:(i=e.prodShiftOrders.get(r._id))&&i.set(r)}),!t&&r.prodShiftOrder)if(r.prodShiftOrder._id){var i=e.prodShiftOrders.get(r.prodShiftOrder._id);i?i.set(r.prodShiftOrder):r.prodShiftOrder.operations?e.prodShiftOrders.add(r.prodShiftOrder):t=!0}else{var d=e.prodShiftOrders.find({finishedAt:null});d?d.set(r.prodShiftOrder):t=!0}if(!t&&r.prodDowntime)if(r.prodDowntime._id){var o=e.prodDowntimes.get(r.prodDowntime._id);o?o.set(r.prodDowntime):r.prodDowntime.orderData?e.prodDowntimes.add(r.prodDowntime):t=!0}else{var n=e.prodDowntimes.find({finishedAt:null});n?n.set(r.prodDowntime):t=!0}else if(null===r.prodDowntime){var s=e.prodDowntimes.find({finishedAt:null});s?s.set("finishedAt",(new Date).toISOString()):t=!0}t&&this.fetch()}})});