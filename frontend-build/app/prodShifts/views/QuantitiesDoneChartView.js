// Copyright (c) 2014, ≈Åukasz Walukiewicz <lukasz@walukiewicz.eu>. Some Rights Reserved.
// Licensed under CC BY-NC-SA 4.0 <http://creativecommons.org/licenses/by-nc-sa/4.0/>.
// Part of the walkner-wmes project <http://lukasz.walukiewicz.eu/p/walkner-wmes>

define(["underscore","app/time","app/i18n","app/core/View","app/highcharts"],function(t,e,a,i,s){return i.extend({initialize:function(){this.chart=null,this.listenTo(this.model,"change:quantitiesDone",this.updateChart)},destroy:function(){null!==this.chart&&(this.chart.destroy(),this.chart=null)},afterRender:function(){this.chart||setTimeout(this.createChart.bind(this),1)},createChart:function(){var t=this.serializeChartData();this.chart=new s.Chart({chart:{renderTo:this.el},title:{text:a("prodShifts","charts:quantitiesDone:title"),style:{fontSize:"18px",color:"#333"}},noData:{},tooltip:{shared:!0},xAxis:{categories:t.categories},yAxis:{title:!1},plotOptions:{column:{tooltip:{valueSuffix:a("prodShifts","charts:quantitiesDone:unit")}}},series:[{name:a("prodShifts","charts:quantitiesDone:series:planned"),type:"column",data:t.planned},{name:a("prodShifts","charts:quantitiesDone:series:actual"),type:"column",data:t.actual}]}),this.chart.reflow()},updateChart:function(){if(this.chart){var t=this.serializeChartData();this.chart.series[0].setData(t.planned,!0),this.chart.series[1].setData(t.actual,!0)}},serializeChartData:function(){for(var t={categories:[],planned:[],actual:[]},a=Date.parse(this.model.get("date")),i=0;8>i;++i)t.categories.push(e.format(a,"HH:mm")),a+=36e5;return this.model.get("quantitiesDone").forEach(function(e){t.planned.push(e.planned),t.actual.push(e.actual)}),t}})});