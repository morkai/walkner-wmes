define(["underscore","app/time","app/i18n","app/core/View","app/highcharts"],function(t,e,a,i,s){"use strict";return i.extend({initialize:function(){this.chart=null,this.listenTo(this.model,"change:quantitiesDone",this.updateChart)},destroy:function(){null!==this.chart&&(this.chart.destroy(),this.chart=null)},afterRender:function(){this.chart||setTimeout(this.createChart.bind(this),1)},createChartOptions:function(t){return{chart:{renderTo:this.el,height:this.options.height||350,reflow:!1!==this.options.reflow,spacingBottom:0},exporting:{enabled:!1!==this.options.exporting},title:!1===this.options.showTitle?null:{text:this.t("charts:quantitiesDone:title"),style:{fontSize:"18px",color:"#333"}},noData:{enabled:!1!==this.options.noData},legend:{enabled:!1!==this.options.showLegend},tooltip:{shared:!0,valueDecimals:0},xAxis:{categories:t.categories},yAxis:{title:!1},plotOptions:{column:{dataLabels:{enabled:!0},tooltip:{valueSuffix:this.t("charts:quantitiesDone:unit")}}},series:[{name:this.t("charts:quantitiesDone:series:planned"),type:"column",data:t.planned,color:"#00aaff"},{name:this.t("charts:quantitiesDone:series:actual"),type:"column",data:t.actual,color:"#ffaa00"}]}},createChart:function(){var t=this.serializeChartData();this.chart=new s.Chart(this.createChartOptions(t)),this.chart.reflow()},updateChart:function(){if(this.chart){var t=this.serializeChartData();this.chart.xAxis[0].setCategories(t.categories,!1),this.chart.series[0].setData(t.planned,!1),this.chart.series[1].setData(t.actual,!0)}},serializeChartData:function(){var t={categories:[],planned:[],actual:[]},a=Date.parse(this.model.get("date"));if(!a)return t;for(var i=0;i<8;++i)t.categories.push(e.format(a,"LT")),a+=36e5;return this.model.get("quantitiesDone").forEach(function(e){t.planned.push(e.planned),t.actual.push(e.actual)}),t}})});