// Part of <http://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

define(["../i18n","../time","../core/Model","../core/util/getShiftStartInfo"],function(e,t,r,s){"use strict";function o(e){return e&&e.label?e.label:null}return r.extend({urlRoot:"/pressWorksheets",clientUrlRoot:"#pressWorksheets",topicPrefix:"pressWorksheets",privilegePrefix:"PRESS_WORKSHEETS",nlsDomain:"pressWorksheets",labelAttribute:"rid",defaults:function(){var e=s(Date.now());return{rid:null,date:t.format(e.moment.valueOf(),"YYYY-MM-DD"),shift:e.shift,type:"mech",divisions:[],prodLines:[],startedAt:null,finishedAt:null,master:null,operator:null,operators:null,orders:null,createdAt:null,creator:null}},serialize:function(){var r=this.toJSON();return r.date=t.format(r.date,"YYYY-MM-DD"),r.shift=e("core","SHIFT:"+r.shift),r.master=o(r.master),r.operator=o(r.operator),r.operators=(r.operators||[]).map(o).filter(function(e){return!!e}),r.creator=o(r.creator),r.createdAt=r.createdAt?t.format(r.createdAt,"LLLL"):null,"paintShop"===r.type&&r.orders&&(r.orders=r.orders.map(function(e){return e.startedAt=t.getMoment(e.startedAt).format("HH:mm:ss"),e.finishedAt=t.getMoment(e.finishedAt).format("HH:mm:ss"),e})),Array.isArray(r.divisions)&&(r.divisions=r.divisions.join("; ")),Array.isArray(r.prodLines)&&(r.prodLines=r.prodLines.join("; ")),r.type=e("pressWorksheets","PROPERTY:type:"+r.type),r}})});