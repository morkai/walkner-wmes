// Copyright (c) 2014, ≈Åukasz Walukiewicz <lukasz@walukiewicz.eu>. Some Rights Reserved.
// Licensed under CC BY-NC-SA 4.0 <http://creativecommons.org/licenses/by-nc-sa/4.0/>.
// Part of the walkner-wmes project <http://lukasz.walukiewicz.eu/p/walkner-wmes>

define(["app/time","app/core/views/FilterView","app/users/util/setUpUserSelect2","app/pressWorksheets/templates/filter"],function(e,t,s,r){return t.extend({template:r,defaultFormData:function(){return{date:"",shift:0,type:"any",mine:!1,userType:"operators",user:{id:null,text:null}}},termToForm:{date:function(t,s,r){if("in"===s.name)r.date=e.format(s.args[1][0],"YYYY-MM-DD");else{var a=e.getMoment(s.args[1]);r.date=a.format("YYYY-MM-DD"),r.shift=this.getShiftNoFromMoment(a)}},shift:function(e,t,s){s[e]=t.args[1]},"master.id":function(e,t,s){s.userType=e.split(".")[0],s.user.id=t.args[1],null===s.user.text&&(s.user.text=t.args[1])},user:function(e,t,s){s.user.text=t.args[1]},type:"shift",mine:"shift","operator.id":"master.id","operators.id":"master.id"},afterRender:function(){t.prototype.afterRender.call(this),this.toggleButtonGroup("shift"),this.toggleButtonGroup("type"),this.toggleButtonGroup("mine"),s(this.$id("user")).select2("data",null===this.formData.user.id?null:this.formData.user)},serializeFormToQuery:function(t,s){var r=e.getMoment(this.$id("date").val()),a=parseInt(this.$("input[name=shift]:checked").val(),10),i=this.$("input[name=type]:checked").val(),n=this.$("input[name=mine]:checked").val(),u=this.$("input[name=userType]:checked").val(),o=this.$id("user").select2("data");if(this.setHoursByShiftNo(r,a),r.isValid())if(0===a){var h=r.valueOf();t.push({name:"in",args:["date",[h+216e5,h+504e5,h+792e5]]})}else t.push({name:"eq",args:["date",r.valueOf()]});else 0!==a&&t.push({name:"eq",args:["shift",a]});"any"!==i&&t.push({name:"eq",args:["type",i]}),o&&(t.push({name:"eq",args:[u+".id",o.id]}),t.push({name:"eq",args:["user",o.text]})),n?(t.push({name:"eq",args:["mine",1]}),s.sort={createdAt:-1}):s.sort={date:-1}},getShiftNoFromMoment:function(e){var t=e.hours();return 6===t?1:14===t?2:22===t?3:0},setHoursByShiftNo:function(e,t){e.hours(1===t?6:2===t?14:3===t?22:0)}})});