define(["underscore","../user","../time","../core/Collection","./PressWorksheet"],function(e,r,t,s,a){"use strict";return s.extend({model:a,rqlQuery:function(e){var s=[{name:"ge",args:["date",t.getMoment().startOf("week").subtract(7,"days").valueOf()]}],a=r.getDivision();return a&&s.push({name:"eq",args:["divisions",a.id]}),e.Query.fromObject({fields:{orders:0,operators:0},sort:{date:-1},limit:-1,selector:{name:"and",args:s}})},sync:function(r,t,a){if("read"===r&&!a.data){var i=e.find(this.rqlQuery.selector.args,function(e){return"eq"===e.name&&"user"===e.args[0]});i&&(this.rqlQuery.selector.args=e.without(this.rqlQuery.selector.args,i)),a.data=this.rqlQuery.toString(),i&&this.rqlQuery.selector.args.push(i)}return s.prototype.sync.call(this,r,t,a)}})});