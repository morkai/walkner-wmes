define(["underscore","../core/Collection","./OrderDocumentFile"],function(e,t,r){"use strict";return t.extend({model:r,rqlQuery:"sort(_id)&folders=null",initialize:function(e,t){this.parentFolderId=null,this.searchPhrase="",this.totalCount=0,t&&t.parentFolderId&&this.setParentFolderId(t.parentFolderId),t&&t.searchPhrase&&this.setSearchPhrase(t.searchPhrase)},parse:function(e){return this.totalCount=e.totalCount||0,e.collection||[]},setParentFolderId:function(e){this.parentFolderId=e,this.updateRqlQuery()},setSearchPhrase:function(e){this.searchPhrase=e,this.updateRqlQuery()},updateRqlQuery:function(){var e="sort(_id)",t=this.searchPhrase;if(t)if(e+="&limit(75)",t.length<15||/[#*]/.test(t)){var r=t.replace(/#/g,".").replace(/\*/g,".+");e+="&_id=regex="+encodeURIComponent("^"+r+"$")}else if(t.length>15){e+="&_id=in=("+t.split(/\s+/).map(function(e){return"string:"+e}).join(",")+")"}else e="_id=string:"+t;else e+="&folders="+(this.parentFolderId||"null");this.rqlQuery=this.createRqlQuery(e)},handleFileRemoved:function(e){var t=this.get(e);t&&t.trash()},handleFileRecovered:function(e){var t=this.get(e);t&&t.recover()},handleFilePurged:function(e){var t=this.get(e);t&&this.remove(t)},handleFileUnlinked:function(e,t){var r=this.get(e);r&&r.unlinkFolder(t)},handleFileEdited:function(t,r){var i=this.get(t._id);i?i.set(t):e.includes(t.folders,r)&&this.add(t)},handleFileAdded:function(e){var t=this.get(e._id);t?t.set(e):this.add(e)}})});