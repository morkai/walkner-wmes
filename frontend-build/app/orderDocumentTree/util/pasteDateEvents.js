// Part of <http://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

define(["app/time"],function(t){"use strict";return{'keydown input[type="date"]':function(t){if(t.ctrlKey&&17===t.keyCode){var e=this.$(t.target);e.attr("data-type","date").css("width",e.outerWidth()+"px").prop("type","text").select()}},'keyup input[data-type="date"]':function(e){if(!e.ctrlKey&&17===e.keyCode){var a=this.$(e.target),i=a.val(),n=i.match(/([0-9]{4}).([0-9]{1,2}).([0-9]{1,2})/);if(n||(n=i.match(/([0-9]{1,2}).([0-9]{1,2}).([0-9]{4})/),n||(n=i.match(/([0-9]{1,2}).([0-9]{1,2}).([0-9]{1,2})/))),n){var r=n[1],p=n[2],d=n[3];(4===n[1].length||4===n[3].length)&&(r=4===n[1].length?n[1]:n[3],d=4===n[1].length?n[3]:n[1]);var c=t.getMoment(r+"-"+p+"-"+d,"YYYY-MM-DD");i=c.isValid()?c.format("YYYY-MM-DD"):""}else i="";a.attr("data-type","").css("width","").prop("type","date").val(i).change().focus()}}}});