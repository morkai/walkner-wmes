// Part of <http://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

define(["underscore","jquery","app/i18n","app/time","app/viewport","app/core/views/FormView","app/orderDocumentTree/util/pasteDateEvents","app/orderDocumentTree/templates/editFileDialog"],function(e,t,i,r,n,o,s,a){"use strict";return o.extend({template:a,events:e.assign({},s,o.prototype.events),initialize:function(e){if(o.prototype.initialize.apply(this,arguments),this.tree=e.tree,!this.tree)throw new Error("The `tree` option is required!")},serialize:function(){var t=this.tree;return e.assign(o.prototype.serialize.apply(this,arguments),{folders:e.map(this.model.get("folders"),function(e){return{id:e,path:t.getPath(t.folders.get(e)).map(function(e){return e.getLabel()}).join(" > ")}}).filter(function(e){return e.path.length>0})})},serializeToForm:function(){var e=this.model.toJSON();return e.files=e.files.map(function(e){return{hash:e.hash,type:e.type,date:r.utc.format(e.date,"YYYY-MM-DD")}}),e},afterRender:function(){o.prototype.afterRender.apply(this,arguments)},request:function(e){return this.promised(this.tree.editFile(this.model,e))},getFailureText:function(){return i("orderDocumentTree","editFile:msg:failure")},handleSuccess:function(){e.isFunction(this.closeDialog)&&this.closeDialog(),n.msg.show({type:"success",time:2500,text:i("orderDocumentTree","editFile:msg:success")})},onDialogShown:function(e){this.closeDialog=e.closeDialog.bind(e)}})});