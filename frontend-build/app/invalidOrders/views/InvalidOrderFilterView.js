// Part of <https://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

define(["underscore","app/core/views/FilterView","app/core/util/ExpandableSelect","app/users/ownMrps","app/invalidOrders/templates/filter"],function(e,t,a,r,n){"use strict";return t.extend({template:n,events:e.assign({},r.events,t.prototype.events),defaultFormData:{status:[],_id:"",mrp:""},termToForm:{_id:function(e,t,a){a[e]=t.args[1]},mrp:function(e,t,a){a[e]=t.args[1].join(",")},status:function(e,t,a){a[e]="in"===t.name?t.args[1]:[t.args[1]]}},destroy:function(){t.prototype.destroy.call(this),this.$(".is-expandable").expandableSelect("destroy")},serialize:function(){return e.assign(t.prototype.serialize.apply(this,arguments),{showOwnMrps:r.hasAny()})},afterRender:function(){t.prototype.afterRender.call(this),this.$(".is-expandable").expandableSelect();var e=this.$id("mrp").select2({width:"300px",allowClear:!0,multiple:!0,data:[],formatNoMatches:null,minimumResultsForSearch:1,dropdownCssClass:"hidden",tokenizer:function(e,t,a){var r=e,n={};return t.forEach(function(e){n[e.id]=!0}),(e.match(/[A-Z0-9]{3}/gi)||[]).forEach(function(e){r=r.replace(e,""),e=e.toUpperCase(),n[e]||(a({id:e,text:e}),n[e]=!0)}),e===r?null:r.replace(/\s+/," ").trim()}});e.select2("data",e.val().split(",").filter(function(e){return e.length}).map(function(e){return{id:e,text:e}}))},serializeFormToQuery:function(t){var a=this.$id("_id").val(),r=this.$id("mrp").val();a.length&&t.push({name:"eq",args:["_id",a]}),r.length&&t.push({name:"in",args:["mrp",r.split(",")]});var n=(this.$id("status").val()||[]).filter(function(t){return!e.isEmpty(t)});1===n.length?t.push({name:"eq",args:["status",n[0]]}):n.length&&t.push({name:"in",args:["status",n]})}})});