// Part of <https://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

define(["underscore","app/core/views/FilterView","app/core/util/ExpandableSelect","app/invalidOrders/templates/filter"],function(t,e,r,i){"use strict";return e.extend({template:i,events:t.assign({"click #-ownMrps":function(){return this.$id("mrp").select2("data",this.model.mrps.map(function(t){return{id:t,text:t}})),!1}},e.prototype.events),defaultFormData:{status:[],_id:"",mrp:""},termToForm:{_id:function(t,e,r){r[t]=e.args[1]},mrp:function(t,e,r){r[t]=e.args[1].join(",")},status:function(t,e,r){r[t]="in"===e.name?e.args[1]:[e.args[1]]}},destroy:function(){e.prototype.destroy.call(this),this.$(".is-expandable").expandableSelect("destroy")},serialize:function(){return t.assign(e.prototype.serialize.apply(this,arguments),{mrps:this.model.mrps})},afterRender:function(){e.prototype.afterRender.call(this),this.$(".is-expandable").expandableSelect();var t=this.$id("mrp").select2({width:"300px",allowClear:!0,multiple:!0,data:[],formatNoMatches:null,minimumResultsForSearch:1,dropdownCssClass:"hidden",tokenizer:function(t,e,r){var i=t,n={};return e.forEach(function(t){n[t.id]=!0}),(t.match(/[A-Z0-9]{3}/gi)||[]).forEach(function(t){i=i.replace(t,""),t=t.toUpperCase(),n[t]||(r({id:t,text:t}),n[t]=!0)}),t===i?null:i.replace(/\s+/," ").trim()}});t.select2("data",t.val().split(",").filter(function(t){return t.length}).map(function(t){return{id:t,text:t}}))},serializeFormToQuery:function(e){var r=this.$id("_id").val(),i=this.$id("mrp").val();r.length&&e.push({name:"eq",args:["_id",r]}),i.length&&e.push({name:"in",args:["mrp",i.split(",")]});var n=(this.$id("status").val()||[]).filter(function(e){return!t.isEmpty(e)});1===n.length?e.push({name:"eq",args:["status",n[0]]}):n.length&&e.push({name:"in",args:["status",n]})}})});