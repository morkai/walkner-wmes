// Copyright (c) 2014, ≈Åukasz Walukiewicz <lukasz@walukiewicz.eu>. Some Rights Reserved.
// Licensed under CC BY-NC-SA 4.0 <http://creativecommons.org/licenses/by-nc-sa/4.0/>.
// Part of the walkner-wmes project <http://lukasz.walukiewicz.eu/p/walkner-wmes>

define(["app/i18n","app/user","app/core/util/bindLoadingMessage","app/core/View","app/orders/Order","app/orders/views/OrderDetailsView","app/delayReasons/storage","../views/XiconfOrderDetailsView","app/xiconfOrders/templates/detailsPage"],function(e,r,i,s,t,n,d,a,o){"use strict";return s.extend({template:o,layoutName:"page",remoteTopics:function(){function e(){this.promised(this.model.fetch())}var r={};return r["xiconf.orders.synced"]=e,r["xiconf.orders."+this.model.id+".*"]=e,r},breadcrumbs:function(){return[e.bound("xiconfOrders","BREADCRUMBS:base"),{label:e.bound("xiconfOrders","BREADCRUMBS:browse"),href:this.model.genClientUrl("base")},this.model.id]},initialize:function(){this.parentOrder=new t(this.model.id),this.order=i(this.model,this),this.delayReasons=i(d.acquire(),this),this.parentOrderDetailsView=new n({panelTitle:e("xiconfOrders","PANEL:TITLE:details:parentOrder"),linkOrderNo:r.isAllowedTo("ORDERS:VIEW"),model:this.parentOrder,delayReasons:this.delayReasons}),this.orderDetailsView=new a({model:this.model}),this.setView(".xiconfOrders-parentOrderDetailsContainer",this.parentOrderDetailsView),this.setView(".xiconfOrders-orderDetailsContainer",this.orderDetailsView)},destroy:function(){d.release()},load:function(e){var r=this,i=this.order.fetch({url:this.order.url()+"?exclude(items.serialNumbers)"});return i.done(function(){r.parentOrder.set(r.order.get("parentOrder"))}),e(i,this.delayReasons.isEmpty()?this.delayReasons.fetch({reset:!0}):null)},afterRender:function(){d.acquire()}})});