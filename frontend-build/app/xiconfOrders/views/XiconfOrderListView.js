// Copyright (c) 2014, ≈Åukasz Walukiewicz <lukasz@walukiewicz.eu>. Some Rights Reserved.
// Licensed under CC BY-NC-SA 4.0 <http://creativecommons.org/licenses/by-nc-sa/4.0/>.
// Part of the walkner-wmes project <http://lukasz.walukiewicz.eu/p/walkner-wmes>

define(["underscore","app/i18n","app/time","app/user","app/core/views/ListView"],function(e,i,t,n,a){return a.extend({className:"is-colored is-clickable",remoteTopics:{"xiconf.orders.**":"refreshCollection"},columns:[{id:"orderNo",label:i("xiconf","PROPERTY:no"),className:"is-min"},{id:"nc12",label:i("xiconf","PROPERTY:nc12"),className:"is-min"},{id:"quantity",label:i("xiconf","PROPERTY:quantity"),className:"is-min"},{id:"reqDate",className:"is-min"},{id:"startedAt",className:"is-min"},{id:"duration",className:"is-min"},"name"],serializeActions:function(){return null},serializeRows:function(){function e(e){return i?'<a href="#orders/'+e.id+'">'+e.id+"</a>":e.id}var i=n.isAllowedTo("ORDERS:VIEW");return this.collection.map(function(i){var n=Date.parse(i.get("startedAt"))||0,a=Date.parse(i.get("finishedAt"))||Date.now(),s=n?(a-n)/1e3:null;return{_id:i.id,className:"xiconfOrders-list-item "+i.getStatusClassName(),orderNo:e(i),nc12:i.get("nc12")[0],name:i.get("name"),quantity:i.get("quantityDone").toLocaleString()+"/"+i.get("quantityTodo").toLocaleString(),reqDate:t.format(i.get("reqDate"),"YYYY-MM-DD"),startedAt:n?t.format(n,"YYYY-MM-DD HH:mm:ss"):null,duration:null!==s?t.toString(s):null}})}})});