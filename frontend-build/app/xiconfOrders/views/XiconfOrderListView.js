// Copyright (c) 2014, ≈Åukasz Walukiewicz <lukasz@walukiewicz.eu>. Some Rights Reserved.
// Licensed under CC BY-NC-SA 4.0 <http://creativecommons.org/licenses/by-nc-sa/4.0/>.
// Part of the walkner-wmes project <http://lukasz.walukiewicz.eu/p/walkner-wmes>

define(["underscore","app/i18n","app/time","app/user","app/core/views/ListView"],function(e,t,i,n,a){"use strict";return a.extend({className:"is-colored is-clickable",remoteTopics:{"xiconf.orders.**":"refreshCollection"},columns:[{id:"orderNo",label:t.bound("xiconf","PROPERTY:no"),className:"is-min"},{id:"nc12",label:t.bound("xiconf","PROPERTY:nc12"),className:"is-min"},{id:"quantity",label:t.bound("xiconf","PROPERTY:quantity"),className:"is-min"},{id:"reqDate",className:"is-min"},{id:"startedAt",className:"is-min"},{id:"duration",className:"is-min"},"name"],serializeActions:function(){return null},serializeRows:function(){function e(e){return t?'<a href="#orders/'+e.id+'">'+e.id+"</a>":e.id}var t=n.isAllowedTo("ORDERS:VIEW");return this.collection.map(function(t){var n=t.get("quantityDone")||0,a=t.get("quantityTodo")||0,s=Date.parse(t.get("startedAt"))||0,r=Date.parse(t.get("finishedAt"))||Date.now(),o=s?(r-s)/1e3:null;return{_id:t.id,className:"xiconfOrders-list-item "+t.getStatusClassName(),orderNo:e(t),nc12:t.get("nc12")[0],name:t.get("name"),quantity:n.toLocaleString()+"/"+a.toLocaleString(),reqDate:i.format(t.get("reqDate"),"YYYY-MM-DD"),startedAt:s?i.format(s,"YYYY-MM-DD HH:mm:ss"):null,duration:null!==o?i.toString(o):null}})}})});