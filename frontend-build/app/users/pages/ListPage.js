define(["require","jquery","app/i18n","app/viewport","app/core/util/bindLoadingMessage","app/core/util/pageActions","app/core/pages/FilteredListPage","app/data/loadedModules","../UserCollection","../views/FilterView","../views/ListView"],function(s,e,i,n,t,c,o,a,r,l,d){"use strict";return o.extend({FilterView:l,ListView:d,remoteTopics:{"users.synced":"onSynced","users.syncFailed":"onSyncFailed"},actions:function(){var s=this;return[c.add(this.collection)].concat({label:s.t("PAGE_ACTION:sync"),icon:"refresh",privileges:"USERS:MANAGE",callback:function(){return s.$syncAction=e("button",this),s.syncUsers(),!1}},{label:s.t("PAGE_ACTION:settings"),icon:"cogs",privileges:"USERS:MANAGE",href:"#users;settings"})},initialize:function(){o.prototype.initialize.apply(this,arguments),a.isLoaded("wmes-osh")&&s("app/wmes-osh-common/dictionaries").bind(this),this.$syncAction=null},syncUsers:function(){var s=this,e=s.$syncAction;e.hasClass("disabled")||(e.addClass("disabled"),e.find("i").removeClass("fa-refresh").addClass("fa-spinner fa-spin"),this.socket.emit("users.sync",function(e){e&&(console.error(e),n.msg.show({type:"error",text:s.t("MSG:SYNC_FAILURE")}),s.unlockSync())}))},unlockSync:function(){this.$syncAction.removeClass("disabled"),this.$syncAction.find("i").removeClass("fa-spinner fa-spin").addClass("fa-refresh"),this.$syncAction=null},onSynced:function(){null!==this.$syncAction&&(n.msg.show({type:"success",text:this.t("MSG:SYNCED"),time:2500}),this.unlockSync())},onSyncFailed:function(){null!==this.$syncAction&&(n.msg.show({type:"error",text:this.t("MSG:SYNC_FAILURE"),time:5e3}),this.unlockSync())}})});