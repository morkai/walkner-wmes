// Part of <https://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

define(["app/i18n","app/user","app/viewport","app/core/util/pageActions","app/core/pages/DetailsPage","app/core/views/DialogView","../views/UserDetailsView","app/users/templates/anonymizeDialog"],function(e,i,t,n,s,o,a,l){"use strict";return s.extend({DetailsView:a,breadcrumbs:function(){return i.isAllowedTo("USERS:VIEW")?s.prototype.breadcrumbs.call(this):[e.bound("users","BREADCRUMBS:myAccount")]},actions:function(){var t=this.model,s=[];return i.isAllowedTo("USERS:MANAGE")?(s.push(n.edit(t,!1),n.delete(t,!1)),i.isAllowedTo("SUPER")&&s.push({label:e.bound("users","PAGE_ACTION:anonymize"),icon:"user-secret",callback:this.handleAnonymizeAction.bind(this)})):i.data._id===t.id&&s.push({label:e.bound("users","PAGE_ACTION:editAccount"),icon:"edit",href:t.genClientUrl("edit")}),s},handleAnonymizeAction:function(){var e=this,i=new o({template:l});e.listenToOnce(i,"answered",function(i){"yes"===i&&(e.ajax({method:"POST",url:"/users/"+e.model.id+"/anonymize"}),t.msg.show({type:"warning",time:3e3,text:e.t("anonymize:started")}))}),t.showDialog(i,e.t("anonymize:title"))}})});