define(["underscore","app/i18n","app/core/Model","app/data/aors","app/data/companies","app/data/prodFunctions","app/data/orgUnits","app/data/loadedModules","app/orgUnits/util/renderOrgUnitPath"],function(e,t,r,n,a,i,s,o,u){"use strict";var l=["fap_sms","fm24_sms","fm24_email"];function p(e){var t=e.split(":"),r=parseInt(t[0],10),n=parseInt(t[1],10);return{hours:r,minutes:n,value:1e3*r+n}}return r.extend({urlRoot:"/users",clientUrlRoot:"#users",topicPrefix:"users",privilegePrefix:"USERS",nlsDomain:"users",labelAttribute:"login",defaults:function(){return{privileges:[],aors:[]}},getLabel:function(){var e=this.get("lastName")||"",t=this.get("firstName")||"";return e.length&&t.length?e+" "+t:this.get("login")},url:function(){var e=r.prototype.url.apply(this,arguments);return this.isNew()||!o.isLoaded("vendors")?e:e+"?populate(vendor)"},serialize:function(){var e=this.toJSON(),r=a.get(e.company);e.name="",e.lastName&&(e.name=e.lastName),e.firstName&&(e.name&&(e.name+=" "),e.name+=e.firstName),e.company=r?r.getLabel():"",e.active=t("users","active:"+e.active),Array.isArray(e.aors)?e.aors=e.aors.map(function(e){var t=n.get(e);return t?t.getLabel():null}).filter(function(e){return!!e}):e.aors=[];var o=i.get(e.prodFunction);if(e.prodFunction=o?o.getLabel():"",e.orgUnitType&&e.orgUnitId){var l=s.getByTypeAndId(e.orgUnitType,e.orgUnitId);l&&(e.orgUnit=u(l,!1,!1))}else e.orgUnit="";return e.vendor&&(e.vendor.name?e.vendor=e.vendor.name+" ("+e.vendor._id+")":e.vendor._id&&(e.vendor=e.vendor._id)),e},serializeDetails:function(){var t=this.serialize();return t.notifications=[],l.forEach(function(e){t.preferences&&t.preferences[e]&&t.notifications.push(e)}),t.mrps=e.isEmpty(t.mrps)?"":t.mrps.join("; "),t},getMobile:function(){var t=new Date,r=1e3*t.getHours()+t.getMinutes(),n=this.get("mobile")||[],a=n.length?n[0].number:"";return n.length>1&&e.forEach(n,function(e){var t=!0,n=p(e.fromTime),i=p("00:00"===e.toTime?"24:00":e.toTime);return i.value<n.value?t=r<i.value||r>=n.value:n.value<i.value&&(t=r>=n.value&&r<i.value),t&&(a=e.number),t}),12===a.length?a.substr(0,3)+" "+a.substr(3,3)+" "+a.substr(6,3)+" "+a.substr(9,3):10===a.length?a.substr(0,3)+" "+a.substr(3,3)+" "+a.substr(6,2)+" "+a.substr(8,2):a}},{NOTIFICATIONS:l})});