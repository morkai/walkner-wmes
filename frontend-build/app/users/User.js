define(["require","underscore","app/i18n","app/core/Model","app/data/loadedModules","app/data/aors","app/data/companies","app/data/prodFunctions","app/data/orgUnits","app/orgUnits/util/renderOrgUnitPath"],function(e,t,a,r,n,s,o,i,p,l){"use strict";var u=[];function m(e){var t=e.split(":"),a=parseInt(t[0],10),r=parseInt(t[1],10);return{hours:a,minutes:r,value:1e3*a+r}}return n.isLoaded("wmes-fap")&&u.push("fap_sms"),n.isLoaded("kaizen")&&u.push("fm24_sms","fm24_email"),r.extend({urlRoot:"/users",clientUrlRoot:"#users",topicPrefix:"users",privilegePrefix:"USERS",nlsDomain:"users",labelAttribute:"login",getLabel:function(){var e=this.get("lastName")||"",t=this.get("firstName")||"";return e.length&&t.length?e+" "+t:this.get("login")},url:function(){var e=r.prototype.url.apply(this,arguments);return this.isNew()||!n.isLoaded("vendors")?e:e+"?populate(vendor)"},serialize:function(){var e=this.toJSON(),t=o.get(e.company);e.name="",e.lastName&&(e.name=e.lastName),e.firstName&&(e.name&&(e.name+=" "),e.name+=e.firstName),e.company=t?t.getLabel():"",e.active=a("users","active:"+e.active),Array.isArray(e.aors)?e.aors=e.aors.map(function(e){var t=s.get(e);return t?t.getLabel():null}).filter(function(e){return!!e}):e.aors=[];var r=i.get(e.prodFunction);if(e.prodFunction=r?r.getLabel():"",e.orgUnitType&&e.orgUnitId){var n=p.getByTypeAndId(e.orgUnitType,e.orgUnitId);n&&(e.prodOrgUnit=l(n,!1,!1))}else e.prodOrgUnit="";return e.vendor&&(e.vendor.name?e.vendor=e.vendor.name+" ("+e.vendor._id+")":e.vendor._id&&(e.vendor=e.vendor._id)),e},serializeRow:function(){var t=this.serialize();if(this.get("active")||(t.className="danger"),n.isLoaded("wmes-osh")){var a=e("app/wmes-osh-common/dictionaries");t.oshDivision=a.getLabel("division",t.oshDivision),t.oshWorkplace=a.getLabel("workplace",t.oshWorkplace),t.oshDepartment=a.getLabel("department",t.oshDepartment),!t.oshWorkplace&&t.syncData.workplace&&(t.oshWorkplace=`<em>${t.syncData.workplace}</em>`),!t.oshDepartment&&t.syncData.department&&(t.oshDepartment=`<em>${t.syncData.department}</em>`)}return!t.company&&t.syncData.company&&(t.company=`<em>${t.syncData.company}</em>`),t},serializeDetails:function(){var a=this.serialize();if(a.notifications=[],u.forEach(function(e){a.preferences&&a.preferences[e]&&a.notifications.push(e)}),a.mrps=t.isEmpty(a.mrps)?"":a.mrps.join("; "),n.isLoaded("wmes-osh")){var r=e("app/wmes-osh-common/dictionaries");a.oshDivision=r.getLabel("division",a.oshDivision,{long:!0}),a.oshWorkplace=r.getLabel("workplace",a.oshWorkplace,{long:!0}),a.oshDepartment=r.getLabel("department",a.oshDepartment,{long:!0})}return a},getMobile:function(){var e=new Date,a=1e3*e.getHours()+e.getMinutes(),r=this.get("mobile")||[],n=r.length?r[0].number:"";return r.length>1&&t.forEach(r,function(e){var t=!0,r=m(e.fromTime),s=m("00:00"===e.toTime?"24:00":e.toTime);return s.value<r.value?t=a<s.value||a>=r.value:r.value<s.value&&(t=a>=r.value&&a<s.value),t&&(n=e.number),t}),12===n.length?n.substr(0,3)+" "+n.substr(3,3)+" "+n.substr(6,3)+" "+n.substr(9,3):10===n.length?n.substr(0,3)+" "+n.substr(3,3)+" "+n.substr(6,2)+" "+n.substr(8,2):n}},{NOTIFICATIONS:u})});