define(["require","underscore","app/i18n","app/core/Model","app/data/loadedModules","app/data/aors","app/data/companies","app/data/prodFunctions","app/data/orgUnits","app/orgUnits/util/renderOrgUnitPath"],function(e,r,t,n,a,i,s,o,u,l){"use strict";var p=["fap_sms","fm24_sms","fm24_email"];function d(e){var r=e.split(":"),t=parseInt(r[0],10),n=parseInt(r[1],10);return{hours:t,minutes:n,value:1e3*t+n}}return n.extend({urlRoot:"/users",clientUrlRoot:"#users",topicPrefix:"users",privilegePrefix:"USERS",nlsDomain:"users",labelAttribute:"login",getLabel:function(){var e=this.get("lastName")||"",r=this.get("firstName")||"";return e.length&&r.length?e+" "+r:this.get("login")},url:function(){var e=n.prototype.url.apply(this,arguments);return this.isNew()||!a.isLoaded("vendors")?e:e+"?populate(vendor)"},serialize:function(){var r=this.toJSON(),n=s.get(r.company);r.name="",r.lastName&&(r.name=r.lastName),r.firstName&&(r.name&&(r.name+=" "),r.name+=r.firstName),r.company=n?n.getLabel():"",r.active=t("users","active:"+r.active),Array.isArray(r.aors)?r.aors=r.aors.map(function(e){var r=i.get(e);return r?r.getLabel():null}).filter(function(e){return!!e}):r.aors=[];var p=o.get(r.prodFunction);if(r.prodFunction=p?p.getLabel():"",r.orgUnitType&&r.orgUnitId){var d=u.getByTypeAndId(r.orgUnitType,r.orgUnitId);d&&(r.orgUnit=l(d,!1,!1))}else r.orgUnit="";if(r.vendor&&(r.vendor.name?r.vendor=r.vendor.name+" ("+r.vendor._id+")":r.vendor._id&&(r.vendor=r.vendor._id)),a.isLoaded("wmes-osh")){var m=e("app/wmes-osh-common/dictionaries");r.oshWorkplace=m.getLabel("workplace",r.oshWorkplace,{long:!0}),r.oshDivision=m.getLabel("division",r.oshDivision,{long:!0})}return r},serializeDetails:function(){var e=this.serialize();return e.notifications=[],p.forEach(function(r){e.preferences&&e.preferences[r]&&e.notifications.push(r)}),e.mrps=r.isEmpty(e.mrps)?"":e.mrps.join("; "),e},getMobile:function(){var e=new Date,t=1e3*e.getHours()+e.getMinutes(),n=this.get("mobile")||[],a=n.length?n[0].number:"";return n.length>1&&r.forEach(n,function(e){var r=!0,n=d(e.fromTime),i=d("00:00"===e.toTime?"24:00":e.toTime);return i.value<n.value?r=t<i.value||t>=n.value:n.value<i.value&&(r=t>=n.value&&t<i.value),r&&(a=e.number),r}),12===a.length?a.substr(0,3)+" "+a.substr(3,3)+" "+a.substr(6,3)+" "+a.substr(9,3):10===a.length?a.substr(0,3)+" "+a.substr(3,3)+" "+a.substr(6,2)+" "+a.substr(8,2):a}},{NOTIFICATIONS:p})});