// Part of <http://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

define(["underscore","../data/loadedModules","../core/Model","./util/decorateUser"],function(e,t,r,s){"use strict";function i(e){var t=e.split(":"),r=parseInt(t[0],10),s=parseInt(t[1],10);return{hours:r,minutes:s,value:1e3*r+s}}return r.extend({urlRoot:"/users",clientUrlRoot:"#users",topicPrefix:"users",privilegePrefix:"USERS",nlsDomain:"users",labelAttribute:"login",defaults:{},initialize:function(){Array.isArray(this.get("privileges"))||this.set("privileges",[]),Array.isArray(this.get("aors"))||this.set("aors",[])},getLabel:function(){var e=this.get("lastName")||"",t=this.get("firstName")||"";return e.length&&t.length?e+" "+t:this.get("login")},url:function(){var e=r.prototype.url.apply(this,arguments);return this.isNew()||!t.isLoaded("vendors")?e:e+"?populate(vendor)"},serialize:function(){return s(this)},getMobile:function(){var t=new Date,r=1e3*t.getHours()+t.getMinutes(),s=this.get("mobile")||[],u=s.length?s[0].number:"";return s.length>1&&e.forEach(s,function(e){var t=!0,s=i(e.fromTime),n=i("00:00"===e.toTime?"24:00":e.toTime);return n.value<s.value?t=r<n.value||r>=s.value:s.value<n.value&&(t=r>=s.value&&r<n.value),t&&(u=e.number),t}),12===u.length?u.substr(0,3)+" "+u.substr(3,3)+" "+u.substr(6,3)+" "+u.substr(9,3):10===u.length?u.substr(0,3)+" "+u.substr(3,3)+" "+u.substr(6,2)+" "+u.substr(8,2):u}})});