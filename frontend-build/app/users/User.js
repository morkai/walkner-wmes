define(["require","underscore","app/i18n","app/core/Model","app/data/loadedModules","app/data/aors","app/data/companies","app/data/prodFunctions","app/data/orgUnits","app/orgUnits/util/renderOrgUnitPath"],function(e,t,r,a,s,n,o,i,p,l){"use strict";var u=[];function m(e){var t=e.split(":"),r=parseInt(t[0],10),a=parseInt(t[1],10);return{hours:r,minutes:a,value:1e3*r+a}}return s.isLoaded("wmes-fap")&&u.push("fap_sms"),s.isLoaded("kaizen")&&u.push("fm24_sms","fm24_email"),a.extend({urlRoot:"/users",clientUrlRoot:"#users",topicPrefix:"users",privilegePrefix:"USERS",nlsDomain:"users",labelAttribute:"login",getLabel:function(){var e=this.get("lastName")||"",t=this.get("firstName")||"";return e.length&&t.length?e+" "+t:this.get("login")},url:function(){var e=a.prototype.url.apply(this,arguments);return this.isNew()||!s.isLoaded("vendors")?e:e+"?populate(vendor)"},serialize:function(){var e=this.toJSON(),t=o.get(e.company);e.name="",e.lastName&&(e.name=e.lastName),e.firstName&&(e.name&&(e.name+=" "),e.name+=e.firstName),e.company=t?t.getLabel():"",e.active=r("users","active:"+e.active),Array.isArray(e.aors)?e.aors=e.aors.map(function(e){var t=n.get(e);return t?t.getLabel():null}).filter(function(e){return!!e}):e.aors=[];var a=i.get(e.prodFunction);if(e.prodFunction=a?a.getLabel():"",e.orgUnitType&&e.orgUnitId){var s=p.getByTypeAndId(e.orgUnitType,e.orgUnitId);s&&(e.prodOrgUnit=l(s,!1,!1))}else e.prodOrgUnit="";return e.vendor&&(e.vendor.name?e.vendor=e.vendor.name+" ("+e.vendor._id+")":e.vendor._id&&(e.vendor=e.vendor._id)),e},serializeRow:function(){var t=this.serialize();if(this.get("active")||(t.className="danger"),s.isLoaded("wmes-osh")){var r=e("app/wmes-osh-common/dictionaries");t.oshDivision=r.getLabel("division",t.oshDivision),t.oshWorkplace=r.getLabel("workplace",t.oshWorkplace),t.oshDepartment=r.getLabel("department",t.oshDepartment),!t.oshWorkplace&&t.syncData.workplace&&(t.oshWorkplace=`<em>${t.syncData.workplace}</em>`),!t.oshDepartment&&t.syncData.department&&(t.oshDepartment=`<em>${t.syncData.department}</em>`)}return t},serializeDetails:function(){var r=this.serialize();if(r.notifications=[],u.forEach(function(e){r.preferences&&r.preferences[e]&&r.notifications.push(e)}),r.mrps=t.isEmpty(r.mrps)?"":r.mrps.join("; "),s.isLoaded("wmes-osh")){var a=e("app/wmes-osh-common/dictionaries");r.oshDivision=a.getLabel("division",r.oshDivision,{long:!0}),r.oshWorkplace=a.getLabel("workplace",r.oshWorkplace,{long:!0}),r.oshDepartment=a.getLabel("department",r.oshDepartment,{long:!0})}return r},getMobile:function(){var e=new Date,r=1e3*e.getHours()+e.getMinutes(),a=this.get("mobile")||[],s=a.length?a[0].number:"";return a.length>1&&t.forEach(a,function(e){var t=!0,a=m(e.fromTime),n=m("00:00"===e.toTime?"24:00":e.toTime);return n.value<a.value?t=r<n.value||r>=a.value:a.value<n.value&&(t=r>=a.value&&r<n.value),t&&(s=e.number),t}),12===s.length?s.substr(0,3)+" "+s.substr(3,3)+" "+s.substr(6,3)+" "+s.substr(9,3):10===s.length?s.substr(0,3)+" "+s.substr(3,3)+" "+s.substr(6,2)+" "+s.substr(8,2):s}},{NOTIFICATIONS:u})});