define(["require","underscore","app/i18n","app/core/Model","app/data/loadedModules","app/data/aors","app/data/companies","app/data/prodFunctions","app/data/orgUnits","app/orgUnits/util/renderOrgUnitPath"],function(e,t,r,n,a,s,i,o,u,l){"use strict";var p=["fap_sms","fm24_sms","fm24_email"];function m(e){var t=e.split(":"),r=parseInt(t[0],10),n=parseInt(t[1],10);return{hours:r,minutes:n,value:1e3*r+n}}return n.extend({urlRoot:"/users",clientUrlRoot:"#users",topicPrefix:"users",privilegePrefix:"USERS",nlsDomain:"users",labelAttribute:"login",getLabel:function(){var e=this.get("lastName")||"",t=this.get("firstName")||"";return e.length&&t.length?e+" "+t:this.get("login")},url:function(){var e=n.prototype.url.apply(this,arguments);return this.isNew()||!a.isLoaded("vendors")?e:e+"?populate(vendor)"},serialize:function(){var t=this.toJSON(),n=i.get(t.company);t.name="",t.lastName&&(t.name=t.lastName),t.firstName&&(t.name&&(t.name+=" "),t.name+=t.firstName),t.company=n?n.getLabel():"",t.active=r("users","active:"+t.active),Array.isArray(t.aors)?t.aors=t.aors.map(function(e){var t=s.get(e);return t?t.getLabel():null}).filter(function(e){return!!e}):t.aors=[];var p=o.get(t.prodFunction);if(t.prodFunction=p?p.getLabel():"",t.orgUnitType&&t.orgUnitId){var m=u.getByTypeAndId(t.orgUnitType,t.orgUnitId);m&&(t.orgUnit=l(m,!1,!1))}else t.orgUnit="";if(t.vendor&&(t.vendor.name?t.vendor=t.vendor.name+" ("+t.vendor._id+")":t.vendor._id&&(t.vendor=t.vendor._id)),a.isLoaded("wmes-osh")){var d=e("app/wmes-osh-common/dictionaries");t.oshWorkplace=d.getLabel("workplace",t.oshWorkplace,{long:!0}),t.oshDepartment=d.getLabel("department",t.oshDepartment,{long:!0})}return t},serializeDetails:function(){var e=this.serialize();return e.notifications=[],p.forEach(function(t){e.preferences&&e.preferences[t]&&e.notifications.push(t)}),e.mrps=t.isEmpty(e.mrps)?"":e.mrps.join("; "),e},getMobile:function(){var e=new Date,r=1e3*e.getHours()+e.getMinutes(),n=this.get("mobile")||[],a=n.length?n[0].number:"";return n.length>1&&t.forEach(n,function(e){var t=!0,n=m(e.fromTime),s=m("00:00"===e.toTime?"24:00":e.toTime);return s.value<n.value?t=r<s.value||r>=n.value:n.value<s.value&&(t=r>=n.value&&r<s.value),t&&(a=e.number),t}),12===a.length?a.substr(0,3)+" "+a.substr(3,3)+" "+a.substr(6,3)+" "+a.substr(9,3):10===a.length?a.substr(0,3)+" "+a.substr(3,3)+" "+a.substr(6,2)+" "+a.substr(8,2):a}},{NOTIFICATIONS:p})});