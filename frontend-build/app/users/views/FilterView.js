define(["require","underscore","app/user","app/data/loadedModules","app/data/prodFunctions","app/data/companies","app/data/privileges","app/core/util/idAndLabel","app/core/views/FilterView","app/orgUnits/views/OrgUnitPickerView","app/users/util/setUpUserSelect2","app/users/templates/filter"],function(e,i,t,s,n,r,o,a,p,l,c,d){"use strict";return p.extend({filterList:function(){return["login","personnelId","card",s.isLoaded("companies")?"company":null,s.isLoaded("prodFunctions")?"prodFunction":null,s.isLoaded("orgUnits")?"prodOrgUnit":null,s.isLoaded("wmes-osh")?"oshOrgUnit":null,"active",t.isAllowedTo("USERS:MANAGE")?"privileges":null,"limit"].filter(e=>!!e)},filterMap:{lastName:"searchName",oshWorkplace:"oshOrgUnit",oshDepartment:"oshOrgUnit"},template:d,termToForm:{login:function(e,i,t){t[e]=this.unescapeRegExp(i.args[1]).replace(/^\^/,"")},searchName:"login",card:function(e,i,t){t[e]=i.args[1]},personnelId:"card",company:"card",prodFunction:"card",active:"card"},events:Object.assign({"click #-active .btn":function(e){e.currentTarget.classList.contains("active")&&setTimeout(()=>{this.$(e.currentTarget).removeClass("active").find("input").prop("checked",!1)},1)}},p.prototype.events),initialize:function(){p.prototype.initialize.apply(this,arguments),s.isLoaded("orgUnits")&&this.setUpProdOrgUnit(),s.isLoaded("wmes-osh")&&this.setUpOshOrgUnit()},getTemplateData:function(){return{prodFunctions:s.isLoaded("prodFunctions")?n.map(a):[],companies:s.isLoaded("companies")?r.map(a):[],privileges:t.isAllowedTo("USERS:MANAGE")?o:[],prodOrgUnit:s.isLoaded("orgUnits"),oshOrgUnit:s.isLoaded("wmes-osh")}},afterRender:function(){p.prototype.afterRender.apply(this,arguments),this.$id("company").select2({width:"150px",allowClear:!0}),this.$id("prodFunction").select2({width:"250px",allowClear:!0}),this.$id("privileges").select2({width:"250px",allowClear:!0}),this.toggleButtonGroup("active")},serializeFormToQuery:function(e){const i=c.transliterate(this.$id("searchName").val());i.length&&e.push({name:"regex",args:["searchName",`^${i}`]}),this.serializeRegexTerm(e,"login",null,null,!0,!0);const t=this.getButtonGroupValue("active",null);null!==t&&e.push({name:"eq",args:["active","true"===t]}),["personnelId","company","prodFunction","privileges","card"].forEach(i=>{const t=this.$id(i).val()||"";t.length&&e.push({name:"eq",args:[i,t]})})},setUpProdOrgUnit:function(){this.setView("#-prodOrgUnit",new l({filterView:this,orgUnitTypes:["division","subdivision"],divisionFilter:()=>!0}))},setUpOshOrgUnit:function(){const i=e("app/wmes-osh-common/views/OrgUnitPickerFilterView");this.setView("#-oshOrgUnit",new i({filterView:this,emptyLabel:this.t("PROPERTY:orgUnit"),orgUnitTerms:{oshDivision:"division",oshWorkplace:"workplace",oshDepartment:"department"},orgUnitTypes:["division","workplace","department"]}))}})});