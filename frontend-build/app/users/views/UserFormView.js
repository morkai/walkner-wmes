define(["underscore","app/i18n","app/data/views/OrgUnitDropdownsView","app/core/Model","app/core/views/FormView","app/data/aors","app/data/companies","app/data/divisions","app/data/subdivisions","app/data/prodFunctions","app/data/privileges","app/users/templates/form"],function(i,s,t,e,o,n,a,r,d,p,l,u){var w=t.ORG_UNIT;return o.extend({template:u,idPrefix:"userForm",events:{submit:"submitForm",'input input[type="password"]':function(i){null!==this.timers.validatePasswords&&clearTimeout(this.timers.validatePasswords),this.timers.validatePasswords=setTimeout(this.validatePasswords.bind(this,i),100)}},initialize:function(){o.prototype.initialize.call(this),this.orgUnitDropdownsView=new t({orgUnit:w.SUBDIVISION,allowClear:!0}),this.setView(".orgUnitDropdowns-container",this.orgUnitDropdownsView)},afterRender:function(){o.prototype.afterRender.call(this),this.options.editMode||this.$('input[type="password"]').attr("required",!0),this.$id("aors").select2({width:"100%",allowClear:!0}),this.listenToOnce(this.orgUnitDropdownsView,"afterRender",function(){var i=null,s=null;switch(this.model.get("orgUnitType")){case"division":s=w.DIVISION,i=new e({division:this.model.get("orgUnitId")});break;case"subdivision":s=w.SUBDIVISION,i=new e({subdivision:this.model.get("orgUnitId")})}this.orgUnitDropdownsView.selectValue(i,s)})},validatePasswords:function(){var i=this.$id("password"),t=this.$id("password2");i.val()===t.val()?t[0].setCustomValidity(""):t[0].setCustomValidity(s("users","FORM:ERROR:passwordMismatch")),this.timers.validatePassword=null},serialize:function(){return i.extend(o.prototype.serialize.call(this),{aors:n.toJSON(),companies:a.toJSON(),prodFunctions:p,privileges:l})},serializeForm:function(s){return s=i.defaults(s,{privileges:[],aors:[]}),"string"==typeof s.aors&&(s.aors=s.aors.split(",")),"null"===s.company&&(s.company=null),s.subdivision?(s.orgUnitType="subdivision",s.orgUnitId=s.subdivision):s.division?(s.orgUnitType="division",s.orgUnitId=s.division):(s.orgUnitType="unspecified",s.orgUnitId=null),s}})});