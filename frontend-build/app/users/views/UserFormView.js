define(["underscore","app/i18n","app/data/views/OrgUnitDropdownsView","app/core/Model","app/core/views/FormView","app/data/aors","app/data/companies","app/data/divisions","app/data/subdivisions","app/data/prodFunctions","app/data/privileges","app/users/templates/form","i18n!app/nls/users"],function(e,t,n,r,i,o,a,s,l,d,u,c){var p=n.ORG_UNIT;return i.extend({template:c,idPrefix:"userForm",events:{submit:"submitForm",'input input[type="password"]':function(e){null!==this.timers.validatePasswords&&clearTimeout(this.timers.validatePasswords),this.timers.validatePasswords=setTimeout(this.validatePasswords.bind(this,e),100)}},initialize:function(){i.prototype.initialize.call(this),this.orgUnitDropdownsView=new n({orgUnit:p.SUBDIVISION,allowClear:!0}),this.setView(".orgUnitDropdowns-container",this.orgUnitDropdownsView)},afterRender:function(){i.prototype.afterRender.call(this),this.options.editMode||this.$('input[type="password"]').attr("required",!0),this.$id("aors").select2({width:"100%",allowClear:!0}),this.listenToOnce(this.orgUnitDropdownsView,"afterRender",function(){var e=null,t=null;switch(this.model.get("orgUnitType")){case"division":t=p.DIVISION,e=new r({division:this.model.get("orgUnitId")});break;case"subdivision":t=p.SUBDIVISION,e=new r({subdivision:this.model.get("orgUnitId")})}this.orgUnitDropdownsView.selectValue(e,t)})},validatePasswords:function(){var e=this.$id("password"),n=this.$id("password2");e.val()===n.val()?n[0].setCustomValidity(""):n[0].setCustomValidity(t("users","FORM:ERROR:passwordMismatch")),this.timers.validatePassword=null},serialize:function(){return e.extend(i.prototype.serialize.call(this),{aors:o.toJSON(),companies:a.toJSON(),prodFunctions:d,privileges:u})},serializeForm:function(t){return t=e.defaults(t,{privileges:[],aors:[]}),"string"==typeof t.aors&&(t.aors=t.aors.split(",")),"null"===t.company&&(t.company=null),t.subdivision?(t.orgUnitType="subdivision",t.orgUnitId=t.subdivision):t.division?(t.orgUnitType="division",t.orgUnitId=t.division):(t.orgUnitType="unspecified",t.orgUnitId=null),t}})});