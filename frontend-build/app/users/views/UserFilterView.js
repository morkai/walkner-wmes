define(["underscore","moment","js2form","reltime","app/i18n","app/core/View","app/core/util/fixTimeRange","app/users/templates/filter","i18n!app/nls/users","select2"],function(e,t,n,r,i,o,a,s){return o.extend({template:s,events:{"submit .filter-form":function(e){e.preventDefault(),this.changeFilter()}},initialize:function(){this.idPrefix=e.uniqueId("userFilter")},serialize:function(){return{idPrefix:this.idPrefix}},afterRender:function(){var e=this.serializeRqlQuery();n(this.el.querySelector(".filter-form"),e)},serializeRqlQuery:function(){var e=this.model.rqlQuery,t={personellId:"",lastName:"",limit:e.limit<5?5:e.limit>100?100:e.limit};return e.selector.args.forEach(function(e){var n=e.args[0];switch(n){case"personellId":case"lastName":"regex"===e.name&&(t[n]=e.args[1].replace("^",""))}}),t},changeFilter:function(){var e=this.model.rqlQuery,t=[],n=parseInt(this.$id("personellId").val().trim(),10),r=this.$id("lastName").val().trim();isNaN(n)||t.push({name:"regex",args:["personellId","^"+n,"i"]}),r.length&&t.push({name:"regex",args:["lastName","^"+r,"i"]}),e.selector={name:"and",args:t},e.limit=parseInt(this.$id("limit").val(),10)||15,e.skip=0,this.trigger("filterChanged",e)}})});