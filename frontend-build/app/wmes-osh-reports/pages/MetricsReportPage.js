define(["app/core/View","app/core/util/bindLoadingMessage","app/wmes-osh-common/dictionaries","../views/TableAndChartView","../views/metrics/FilterView","app/wmes-osh-reports/templates/metrics/page"],function(e,i,t,s,a,n){"use strict";const r=["ipr","ips","ipc","entries","users","fte"],l=["total","division","workplace","department"],o={ipr:{valueDecimals:3,allowDecimals:!0,absDecimals:!0,relColumn:!1},ips:{valueDecimals:1,unit:"%",absUnit:!0,relColumn:!1},ipc:{valueDecimals:1,unit:"%",absUnit:!0,relColumn:!1}};return e.extend({layoutName:"page",template:n,events:{"click a[data-group]":function(e){const{metric:i,group:t}=e.currentTarget.dataset,s=this.$(`a[data-metric="${i}"].active`).removeClass("active").attr("data-group");e.currentTarget.classList.add("active"),this.$id(`${i}-${s}`).addClass("hidden"),this.$id(`${i}-${t}`).removeClass("hidden")}},breadcrumbs:function(){return[this.t("breadcrumb"),this.t("metrics:breadcrumb")]},initialize:function(){this.defineModels(),this.defineViews(),this.defineBindings()},defineModels:function(){this.model=i(this.model,this)},defineViews:function(){this.filterView=new a({model:this.model}),this.setView("#-filter",this.filterView),r.forEach(e=>{l.forEach(i=>{const t={metric:`${e}-${i}`,model:this.model,filename:this.t(`metrics:filename:${e}`),title:this.t(`metrics:title:${e}`),stackingLimit:10};Object.assign(t,o[e]),this.setView(`#-${e}-${i}`,new s(t))})})},defineBindings:function(){this.listenTo(this.filterView,"filterChanged",this.onFilterChanged)},load:function(e){return e(t.load().done(()=>this.model.fetch()))},getTemplateData:function(){return{metrics:r,groups:l}},afterRender:function(){const e=new Set;this.$("a[data-metric]").each((i,t)=>{const s=t.dataset.metric;e.has(s)||(e.add(s),t.click())})},onFilterChanged:function(e){this.model.rqlQuery=e,this.promised(this.model.fetch()),this.broker.publish("router.navigate",{url:this.model.genClientUrl(),trigger:!1,replace:!0})}})});