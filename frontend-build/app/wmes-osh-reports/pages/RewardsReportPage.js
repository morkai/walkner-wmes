define(["app/viewport","app/core/View","app/core/util/bindLoadingMessage","app/wmes-osh-common/dictionaries","../views/rewards/FilterView","../views/rewards/UsersView","../views/rewards/PayoutView","app/wmes-osh-reports/templates/rewards/page"],function(e,i,t,s,r,o,n,a){"use strict";return i.extend({layoutName:"page",template:a,events:{"click #-warning":function(){this.filterView.$id("submit").click()}},breadcrumbs:function(){return[this.t("breadcrumb"),this.t("rewards:breadcrumb")]},actions:function(){return[{icon:"money",label:this.t("rewards:payout:pageAction"),privilege:"OSH:REWARDS:MANAGE",disabled:!this.model.hasAnyPayouts(),callback:this.showPayoutDialog.bind(this)},{icon:"list",label:this.t("rewards:list:pageAction"),href:"#osh/rewards"},{icon:"cogs",label:this.t("settings:pageAction"),href:"#osh/reports;settings?tab=rewards",privilege:"OSH:REPORTS:MANAGE"}]},remoteTopics:function(){return{"osh.rewards.updated":function(){this.$id("warning").removeClass("hidden")}}},initialize:function(){this.model=t(this.model,this),this.filterView=new r({model:this.model}),this.usersView=new o({model:this.model}),this.listenTo(this.filterView,"filterChanged",this.onFilterChanged),this.listenToOnce(this.filterView,"afterRender",()=>{this.filterView.$id("submit").click()}),this.listenTo(this.model,"change:loading",()=>{this.$id("warning").addClass("hidden"),this.layout&&this.layout.setActions(this.actions,this)}),this.setView("#-filter",this.filterView),this.setView("#-users",this.usersView)},setUpLayout:function(e){this.layout=e},load:function(e){return e(s.load())},onFilterChanged:function(e){this.model.rqlQuery=e,this.promised(this.model.fetch()),this.broker.publish("router.navigate",{url:this.model.genClientUrl(),trigger:!1,replace:!0})},showPayoutDialog:function(){const i=this.model.getPayouts();if(!i.length)return;const t=new n({model:{payouts:i}});this.listenToOnce(t,"saved",()=>{this.filterView.$id("submit").click()}),e.showDialog(t,this.t("rewards:payout:title"))}})});