define(["app/user","app/core/views/FilterView","app/users/util/setUpUserSelect2","app/wmes-osh-common/dictionaries","app/wmes-osh-common/views/OrgUnitPickerFilterView","app/wmes-osh-reports/templates/rewards/filter"],function(e,t,i,s,a,n){"use strict";return t.extend({template:n,events:Object.assign({'change input[name="mode"]':function(){this.toggleMode()},'change select[name="status"]':function(){this.toggleDate()}},t.prototype.events),defaultFormData:{type:["kaizen","observation"],company:""},termToForm:{division:(e,t,i)=>{i.mode="orgUnit"},workplace:"division",department:"division",type:(e,t,i)=>{i[e]=t.args[1]},status:"type",paidAt:"type",employee:(e,t,i)=>{i[e]=t.args[1],i.mode="employee"},company:(e,t,i)=>{i[e]=t.args[1].join(",")}},initialize:function(){t.prototype.initialize.apply(this,arguments),this.canViewAll()&&(this.orgUnitPickerView=new a({filterView:this,emptyLabel:this.t("wmes-osh-reports","filter:orgUnit"),orgUnitTypes:["division","workplace","department"],labelInput:{name:"mode",value:"orgUnit"}}),this.setView("#-orgUnit",this.orgUnitPickerView))},serializeFormToQuery:function(t){const i=this.$id("status").val();if(t.push({name:"eq",args:["status",i]}),"paid"===i){const e=this.$id("paidAt").val();e&&t.push({name:"eq",args:["paidAt",e]})}const s=this.$('input[name="mode"]:checked').val();if("orgUnit"!==s)if(this.canViewAll()){const e=this.$id(s).val();e&&t.push({name:"eq",args:[s,e]})}else t.push({name:"eq",args:[s,e.data._id]});const a=this.$id("type").val()||[];a.length&&a.length!==this.$id("type")[0].length&&t.push({name:"in",args:["type",a]});const n=this.$id("company").select2("data");n.length&&t.push({name:"in",args:["company",n.map(e=>e.id)]})},getTemplateData:function(){return{showOrgUnitFilter:this.canViewAll()}},afterRender:function(){t.prototype.afterRender.call(this),this.$(".is-expandable").expandableSelect(),i(this.$id("employee"),{view:this,width:"300px"}),this.setUpCompanySelect2(),this.toggleMode(),this.toggleDate()},setUpCompanySelect2:function(){this.$id("company").select2({width:"300px",multiple:!0,placeholder:" ",data:s.settings.getValue("rewards.companies",[])})},toggleMode:function(){const t=this.$('input[name="mode"]:checked').val();if(t)if(this.canViewAll())this.orgUnitPickerView.toggle("orgUnit"===t),this.$id("employee").select2("enable","employee"===t);else{const t=i.userToData(Object.assign({},e.data));this.$id("employee").select2("data",t).select2("enable",!1)}else this.$('input[name="mode"]').first().click()},toggleDate:function(){const e="paid"!==this.$('select[name="status"]').val();this.$id("paidAtGroup").toggleClass("hidden",e),e&&this.$id("paidAt").val("")},canViewAll:function(){return e.isAllowedTo("OSH:REWARDS:VIEW")||s.isCoordinator()}})});