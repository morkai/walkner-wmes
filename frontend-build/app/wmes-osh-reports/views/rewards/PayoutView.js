define(["app/viewport","app/core/View","app/wmes-osh-common/dictionaries","app/wmes-osh-reports/templates/rewards/payout"],function(t,e,s,a){"use strict";return e.extend({template:a,nlsDomain:"wmes-osh-reports",events:{submit:function(e){e.preventDefault(),this.$id("submit").prop("disabled",!0);const s=new Set;if(this.$('input[name="users[]"]:checked').each((t,e)=>s.add(e.value)),!s.size)return void t.closeDialog();t.msg.saving();const a=[];this.model.payouts.forEach(t=>{s.has(t.recipient.id)&&a.push({recipient:t.recipient.id,entries:t.unpaid})});const o=this.ajax({method:"POST",url:"/osh/rewards;payout",data:JSON.stringify({payouts:a})});o.fail(()=>{t.msg.savingFailed(),this.$id("submit").prop("disabled",!1)}),o.done(()=>{t.msg.saved(),t.closeDialog(),this.trigger("saved")})},'change input[name="users[]"]':function(){this.updateTotals()},"change #-toggle":function(t){this.$("tbody").find("input").prop("checked",t.target.checked),this.updateTotals()}},getTemplateData:function(){return{currencyFormatter:s.currencyFormatter,payouts:this.model.payouts,totals:this.calcTotals(!1)}},getSelected:function(){const t=new Set;return this.$('input[name="users[]"]:checked').each((e,s)=>t.add(s.value)),t},calcTotals:function(t){const e={count:0,amount:0},s=t?this.getSelected():null;return this.model.payouts.forEach(t=>{s&&!s.has(t.recipient.id)||(e.count+=t.payout[0],e.amount+=t.payout[1])}),e},updateTotals:function(){const t=this.calcTotals(!0);this.$id("totalCount").text(t.count.toLocaleString()),this.$id("totalAmount").text(s.currencyFormatter.format(t.amount))}})});