define(["app/viewport","app/core/View","app/wmes-osh-common/dictionaries","app/wmes-osh-reports/templates/rewards/payout"],function(t,s,i,o){"use strict";return s.extend({template:o,nlsDomain:"wmes-osh-reports",events:{submit:function(s){s.preventDefault(),this.$id("submit").prop("disabled",!0),t.msg.saving();const i=[];this.payouts.forEach(t=>{i.push({recipient:t.recipient,entries:t.unpaid})});const o=this.ajax({method:"POST",url:"/osh/payouts",data:JSON.stringify({description:this.$id("description").val().trim(),options:this.model.get("options"),payouts:i})});o.fail(()=>{t.msg.savingFailed(),this.$id("submit").prop("disabled",!1)}),o.done(s=>{t.msg.saved(),t.closeDialog(),this.trigger("saved",s)})}},initialize:function(){this.payouts=this.model.getPayouts()},getTemplateData:function(){return{currencyFormatter:i.currencyFormatter,payouts:this.payouts,options:this.serializeOptions(),totals:this.calcTotals()}},serializeOptions:function(){const t=this.model.get("companies"),s=this.model.get("options");return{type:s.type,company:s.company.map(s=>t[s]||s)}},calcTotals:function(){const t={count:0,amount:0};return this.payouts.forEach(s=>{t.count+=s.payout[0],t.amount+=s.payout[1]}),t}})});