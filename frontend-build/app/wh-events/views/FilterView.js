define(["underscore","app/core/views/FilterView","app/core/util/idAndLabel","app/core/util/forms/dateTimeRange","app/users/util/setUpUserSelect2","app/data/orgUnits","../WhEvent","app/wh-events/templates/filter","app/core/util/ExpandableSelect"],function(e,t,a,r,i,n,s,p){"use strict";return t.extend({template:p,events:e.assign({"click a[data-date-time-range]":r.handleRangeEvent},t.prototype.events),termToForm:{time:r.rqlToForm,order:function(e,t,a){a[e]=t.args[1]},line:function(e,t,a){a[e]=Array.isArray(t.args[1])?t.args[1].join(","):t.args[1]},user:"order"},destroy:function(){this.$(".is-expandable").expandableSelect("destroy")},getTemplateData:function(){return{TYPES:s.TYPES}},afterRender:function(){t.prototype.afterRender.apply(this,arguments),i(this.$id("user"),{width:"275px",view:this}),this.$id("line").select2({width:"175px",data:n.getActiveByType("prodLine").map(a)}),this.$(".is-expandable").expandableSelect()},serializeFormToQuery:function(e){var t=this.$id("user").val(),a=this.$id("type").val(),i=this.$id("order").val(),n=this.$id("line").val();r.formToRql(this,e),a&&a.length!==s.TYPES.length&&e.push({name:"in",args:["type",a]}),t&&e.push({name:"eq",args:["user",t]}),i&&e.push({name:"eq",args:["order",i]}),n&&e.push({name:"eq",args:["line",n]})}})});