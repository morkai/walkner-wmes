define(["underscore","app/core/views/FilterView","app/core/util/idAndLabel","app/core/util/forms/dateTimeRange","app/users/util/setUpUserSelect2","app/data/orgUnits","../WhEvent","app/wh-events/templates/filter","app/core/util/ExpandableSelect"],function(e,t,a,r,i,s,n,p){"use strict";return t.extend({template:p,events:e.assign({"click a[data-date-time-range]":r.handleRangeEvent},t.prototype.events),termToForm:{time:r.rqlToForm,order:function(e,t,a){a[e]=t.args[1]},line:function(e,t,a){a[e]=Array.isArray(t.args[1])?t.args[1].join(","):t.args[1]},set:function(e,t,a){var r=t.args[1].match(/^([0-9]{4}-[0-9]{2}-[0-9]{2})(?:-([0-9]+))$/);r&&(a.setDate=r[1],a.setNo=r[2]||"")},user:"order",type:"order"},destroy:function(){this.$(".is-expandable").expandableSelect("destroy")},getTemplateData:function(){return{TYPES:n.TYPES}},afterRender:function(){t.prototype.afterRender.apply(this,arguments),i(this.$id("user"),{width:"275px",view:this}),this.$id("line").select2({width:"175px",allowClear:!0,data:s.getActiveByType("prodLine").map(a)}),this.$(".is-expandable").expandableSelect()},serializeFormToQuery:function(e){var t=this.$id("user").val(),a=this.$id("type").val(),i=this.$id("order").val(),s=this.$id("line").val(),p=this.$id("setDate").val(),l=parseInt(this.$id("setNo").val(),10);r.formToRql(this,e),a&&a.length!==n.TYPES.length&&e.push({name:"in",args:["type",a]}),t&&e.push({name:"eq",args:["user",t]}),i&&e.push({name:"eq",args:["order",i]}),s&&e.push({name:"eq",args:["line",s]}),p&&(l>0&&(p+="-"+l),e.push({name:"eq",args:["set",p]}))}})});