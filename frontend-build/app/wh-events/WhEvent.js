define(["underscore","app/i18n","app/time","app/core/Model","app/core/templates/userInfo"],function(e,r,t,s,n){"use strict";function i(e,t){return'<span class="wh-events-prop"><span class="wh-events-prop-name">'+r("data:"+e)+'</span><span class="wh-events-prop-value">'+t+"</span></span>"}return r=r.forDomain("wh-events"),s.extend({urlRoot:"/old/wh/events",clientUrlRoot:"#wh/events",topicPrefix:"old.wh.events",privilegePrefix:"WH",nlsDomain:"wh-events",serialize:function(){var e=this.toJSON();return e.type=r("type:"+e.type),e.time=t.format(e.time,"L, HH:mm:ss"),e.user=n({userInfo:e.user}),e.data.whUser&&(e.whUser=n({userInfo:e.data.whUser})),e.data=this.serializeData(),e},serializeData:function(){var s=this.get("type"),n=this.get("data"),d={},a=[];if(!n.func&&n.whUser&&n.whUser.func&&(n.func=n.whUser.func),n.func&&a.push(i("func",r("func:"+n.func))),n.oldValue&&n.newValue&&a.push(i(s,r("status:"+s+":"+n.newValue))),Array.isArray(n.lines)&&n.lines.length&&(/Redir/.test(s)?n.lines.length>1?(a.push(i("sourceLine",n.lines[0])),a.push(i("targetLine",n.lines[1]))):a.push(i("targetLine",n.lines[0])):a.push(i(1===n.lines.length?"line":"lines",n.lines.map(e.escape).join(", ")))),Array.isArray(n.orders)&&n.orders.length){var o=[];n.orders.forEach(function(e){e.sapOrder&&(d[e.date]||(d[e.date]={}),d[e.date][e.set||"?"]=1,o.push(e.sapOrder))}),o.length&&a.push(i("orders",e.uniq(e.map(n.orders,"sapOrder")).join(", ")))}if(Array.isArray(n.setCarts)&&n.setCarts.length&&a.push(i("setCarts",e.map(n.setCarts,"cart").join(", "))),n.kind&&a.push(i("kind",r("kind:"+n.kind))),e.isEmpty(d)||a.push(i("sets",e.map(d,function(e,r){return t.utc.format(r,"L")+": "+Object.keys(e).join(", ")}).join("; "))),["qty","problemArea"].forEach(function(r){null!=n[r]&&a.push(i(r,e.escape(String(n[r]))))}),["oldStartedPlan","newStartedPlan"].forEach(function(e){null!=n[e]&&a.push(i(e,t.utc.format(n[e],"L")))}),n.duration&&a.push(i("duration",t.toString(n.duration/1e3))),"deliveredOrderEdited"===s||"deliveredQtyEdited"===s){var u=n.oldDeliveredOrder,l=n.newDeliveredOrder;l.status&&a.push(i("status",r("status:deliveredOrder:"+n.newDeliveredOrder.status))),e.isNumber(l.qtyDone)&&a.push(i("qty",u.qtyDone+"/"+u.qtyTodo+" âžœ "+l.qtyDone+"/"+l.qtyTodo))}else"deliveredOrderRedired"===s?(n.sourceQtyTodo&&a.push(i("sourceQty",n.sourceQtyDone+"/"+n.sourceQtyTodo)),a.push(i("targetQty",n.targetQtyDone+"/"+n.targetQtyTodo))):/^lineRedir/.test(s)&&a.push(i("redirDelivered",r("core","BOOL:"+!!n.redirDelivered)));return n.redirReason&&n.redirReason.label&&a.push(i("redirReason",e.escape(n.redirReason.label))),n.forceLine&&a.push(i("forceLine",e.escape(n.forceLine))),n.comment&&a.push(i("comment",e.escape(n.comment))),a.join("")}},{TYPES:["newSetStarted","assignedToSet","unassignedFromSet","setContinued","picklistDone","picklist","pickup","labelsPrinted","ordersCancelled","ordersReset","ordersFinished","problemSolved","deliveryStarted","deliveryFinished","deliveredOrderEdited","deliveredQtyEdited","deliveredOrderRedired","startedPlanEdited","lineRedirStarted","lineRedirStopped"]})});