define(["underscore","app/i18n","app/time","app/core/Model","app/core/templates/userInfo"],function(e,r,t,s,n){"use strict";function i(e,t){return'<span class="wh-events-prop"><span class="wh-events-prop-name">'+r("data:"+e)+'</span><span class="wh-events-prop-value">'+t+"</span></span>"}return r=r.forDomain("wh-events"),s.extend({urlRoot:"/old/wh/events",clientUrlRoot:"#wh/events",topicPrefix:"old.wh.events",privilegePrefix:"WH",nlsDomain:"wh-events",serialize:function(){var e=this.toJSON();return e.type=r("type:"+e.type),e.time=t.format(e.time,"L, HH:mm:ss"),e.user=n({userInfo:e.user}),e.data.whUser&&(e.whUser=n({userInfo:e.data.whUser})),e.data=this.serializeData(),e},serializeData:function(){var s=this.get("type"),n=this.get("data"),a={},d=[];if(n.func&&d.push(i("func",r("func:"+n.func))),n.oldValue&&n.newValue&&d.push(i(s,r("status:"+s+":"+n.newValue))),Array.isArray(n.lines)&&n.lines.length&&(/^lineRedir/.test(s)?(d.push(i("sourceLine",n.lines[0])),d.push(i("targetLine",n.lines[1]))):d.push(i("lines",n.lines.map(e.escape).join(", ")))),Array.isArray(n.orders)&&n.orders.length){var o=[];n.orders.forEach(function(e){e.sapOrder&&(a[e.date]||(a[e.date]={}),a[e.date][e.set]=1,o.push(e.sapOrder))}),o.length&&d.push(i("orders",e.map(n.orders,"sapOrder").join(", ")))}if(Array.isArray(n.setCarts)&&n.setCarts.length&&d.push(i("setCarts",e.map(n.setCarts,"cart").join(", "))),n.kind&&d.push(i("kind",r("kind:"+n.kind))),e.isEmpty(a)||d.push(i("sets",e.map(a,function(e,r){return t.utc.format(r,"L")+": "+Object.keys(e).join(", ")}).join("; "))),n.qty&&d.push(i("qty",n.qty)),n.duration&&d.push(i("duration",t.toString(n.duration/1e3))),n.problemArea&&d.push(i("problemArea",e.escape(n.problemArea))),"deliveredOrderEdited"===s){var p=n.oldDeliveredOrder,l=n.newDeliveredOrder;l.status&&d.push(i("status",r("status:deliveredOrder:"+n.newDeliveredOrder.status))),e.isNumber(l.qtyDone)&&d.push(i("qty",p.qtyDone+"/"+p.qtyTodo+" âžœ "+l.qtyDone+"/"+l.qtyTodo))}else/^lineRedir/.test(s)&&d.push(i("redirDelivered",r("core","BOOL:"+!!n.redirDelivered)));return d.join("")}},{TYPES:["newSetStarted","assignedToSet","setContinued","picklistDone","picklist","pickup","labelsPrinted","ordersCancelled","ordersReset","problemSolved","deliveryStarted","deliveryFinished","deliveredOrderEdited","lineRedirStarted","lineRedirStopped"]})});