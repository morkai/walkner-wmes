define(["underscore","jquery","app/core/View","app/wmes-fap-entries/templates/attachments"],function(e,t,i,n){"use strict";return i.extend({template:n,events:{'mouseenter .fap-attachment[data-preview="1"]':function(e){this.showPreview(e.currentTarget.dataset.attachmentId)},"mouseleave .fap-attachment":function(){this.hidePreview()},mouseleave:function(){this.hidePreview()}},initialize:function(){this.listenTo(this.model,"focusAttachment",this.focusAttachment),t(window).on("keydown."+this.idPrefix,this.onKeyDown.bind(this))},destroy:function(){t(window).off("."+this.idPrefix)},getTemplateData:function(){return{model:this.model.serializeDetails()}},showPreview:function(t){var i=e.findWhere(this.model.get("attachments"),{_id:t});if(i){var n=this.$id("preview").removeClass("hidden");n.find("span").text(i.name),n.find("img").prop("src","/fap/entries/"+this.model.id+"/attachments/"+t)}},hidePreview:function(){this.$id("preview").addClass("hidden")},focusAttachment:function(e){var t=this.$('.fap-attachment[data-attachment-id="'+e+'"]');t.length&&(t[0].scrollIntoViewIfNeeded?t[0].scrollIntoViewIfNeeded():t[0].scrollIntoView(),this.$(".highlight").removeClass("highlight"),clearTimeout(this.timers.highlight),t.addClass("highlight"),this.timers.highlight=setTimeout(function(){t.removeClass("highlight")},1100),"1"===t[0].dataset.preview&&this.showPreview(e))},onKeyDown:function(e){"Escape"===e.originalEvent.key&&this.hidePreview()}})});