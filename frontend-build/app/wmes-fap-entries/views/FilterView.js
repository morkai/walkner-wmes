define(["underscore","app/time","app/user","app/core/views/FilterView","app/core/util/forms/dateTimeRange","app/core/util/idAndLabel","app/users/util/setUpUserSelect2","app/mrpControllers/util/setUpMrpSelect2","../dictionaries","app/wmes-fap-entries/templates/filter","app/core/util/ExpandableSelect"],function(e,t,s,a,i,r,n,p,l,o){"use strict";return a.extend({template:o,events:e.assign({"click a[data-date-time-range]":i.handleRangeEvent,'change input[name="userType"]':"toggleUserSelect2",'change input[name="statusType"]':"toggleStatus"},a.prototype.events),defaultFormData:function(){return{userType:"others",statusType:"specific"}},termToForm:{createdAt:i.rqlToForm,orderNo:function(e,t,s){s.order=t.args[1]},nc12:"orderNo","observers.user.id":function(e,t,a){t.args[1]===s.data._id?(a.userType="mine",a.user=s.data._id):(a.userType="others",a.user=t.args[1])},status:function(e,t,s){s[e]="in"===t.name?t.args[1]:[t.args[1]]},mrp:function(e,t,s){s.mrp=Array.isArray(t.args[1])?t.args[1].join(","):""},category:"mrp",analysisNeed:function(e,t,s){s[e]=t.args[1],s.statusType=void 0===s.analysisNeed||void 0===s.analysisDone?"specific":"analysis"},analysisDone:"analysisNeed"},serialize:function(){return e.assign(a.prototype.serialize.call(this),{statuses:["pending","started","finished"]})},serializeFormToQuery:function(t){var a=this.$('input[name="userType"]:checked').val(),r=this.$('input[name="statusType"]:checked').val(),n=(this.$id("status").val()||[]).filter(function(t){return!e.isEmpty(t)}),p=this.$id("user").val(),l=this.$id("order").val().trim(),o=this.$id("mrp").val(),u=this.$id("category").val();i.formToRql(this,t),"mine"===a?t.push({name:"eq",args:["observers.user.id",s.data._id]}):p&&t.push({name:"eq",args:["observers.user.id",p]}),9===l.length?t.push({name:"eq",args:["orderNo",l]}):7!==l.length&&12!==l.length||t.push({name:"eq",args:["nc12",l]}),"specific"===r&&n.length?t.push({name:"in",args:["status",n]}):"analysis"===r&&t.push({name:"eq",args:["analysisNeed",!0]},{name:"eq",args:["analysisDone",!1]}),o&&o.length&&t.push({name:"in",args:["mrp",o.split(",")]}),u&&u.length&&t.push({name:"in",args:["category",u.split(",")]})},afterRender:function(){a.prototype.afterRender.call(this),this.$(".is-expandable").expandableSelect(),p(this.$id("mrp"),{own:!0,view:this,width:"280px"}),n(this.$id("user"),{view:this,width:"280px"}),this.toggleUserSelect2(),this.toggleStatus(),this.$id("category").select2({width:"280px",multiple:!0,allowClear:!0,data:l.categories.map(r)})},destroy:function(){a.prototype.destroy.call(this),this.$(".is-expandable").expandableSelect("destroy")},toggleUserSelect2:function(){var e=this.$('input[name="userType"]:checked').val();this.$id("user").select2("enable","others"===e)},toggleStatus:function(){var e=this.$('input[name="statusType"]:checked').val();this.$id("status").prop("disabled","specific"!==e)}})});