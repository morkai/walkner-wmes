define(["underscore","app/time","app/user","app/core/views/FilterView","app/core/util/forms/dateTimeRange","app/core/util/idAndLabel","app/users/util/setUpUserSelect2","app/mrpControllers/util/setUpMrpSelect2","../dictionaries","app/wmes-fap-entries/templates/filter","app/core/util/ExpandableSelect"],function(e,s,t,a,i,r,n,l,p,u){"use strict";return a.extend({template:u,events:e.assign({"click a[data-date-time-range]":i.handleRangeEvent,'change input[name="userType"]':function(){this.toggleUserSelect2(!0)},'change input[name="statusType"]':"toggleStatus"},a.prototype.events),defaultFormData:function(){return{userType:"others",statusType:"specific"}},termToForm:{createdAt:i.rqlToForm,orderNo:function(e,s,t){t.order=s.args[1]},nc12:"orderNo","observers.user.id":function(e,s,a){s.args[1]===t.data._id?(a.userType="mine",a.user=t.data._id):"unseen"===s.args[1]?(a.userType="unseen",a.user=null):(a.userType="others",a.user=s.args[1])},status:function(e,s,t){t[e]="in"===s.name?s.args[1]:[s.args[1]]},mrp:function(e,s,t){t.mrp=Array.isArray(s.args[1])?s.args[1].join(","):""},category:"mrp",analysisNeed:function(e,s,t){t[e]=s.args[1],t.statusType=void 0===t.analysisNeed||void 0===t.analysisDone?"specific":"analysis"},analysisDone:"analysisNeed"},serialize:function(){return e.assign(a.prototype.serialize.call(this),{statuses:["pending","started","finished"]})},serializeFormToQuery:function(s){var a=this.$('input[name="userType"]:checked').val(),r=this.$('input[name="statusType"]:checked').val(),n=(this.$id("status").val()||[]).filter(function(s){return!e.isEmpty(s)}),l=this.$id("user").val(),p=this.$id("order").val().trim(),u=this.$id("mrp").val(),o=this.$id("category").val();i.formToRql(this,s),"mine"===a?s.push({name:"eq",args:["observers.user.id",t.data._id]}):"unseen"===a?s.push({name:"eq",args:["observers.user.id",a]}):l&&s.push({name:"eq",args:["observers.user.id",l]}),9===p.length?s.push({name:"eq",args:["orderNo",p]}):7!==p.length&&12!==p.length||s.push({name:"eq",args:["nc12",p]}),"specific"===r&&n.length?s.push({name:"in",args:["status",n]}):"analysis"===r&&s.push({name:"eq",args:["analysisNeed",!0]},{name:"eq",args:["analysisDone",!1]}),u&&u.length&&s.push({name:"in",args:["mrp",u.split(",")]}),o&&o.length&&s.push({name:"in",args:["category",o.split(",")]})},afterRender:function(){a.prototype.afterRender.call(this),this.$(".is-expandable").expandableSelect(),n(this.$id("user"),{view:this,width:"300px"}),l(this.$id("mrp"),{own:!0,view:this,width:"250px"}),this.$id("category").select2({width:"280px",multiple:!0,allowClear:!0,data:p.categories.map(r)}),this.toggleUserSelect2(!1),this.toggleStatus()},destroy:function(){a.prototype.destroy.call(this),this.$(".is-expandable").expandableSelect("destroy")},toggleUserSelect2:function(e){var s=this.$('input[name="userType"]:checked').val(),a=this.$id("user").select2("enable","others"===s);e&&a.val()===t.data._id&&a.select2("data",null)},toggleStatus:function(){var e=this.$('input[name="statusType"]:checked').val();this.$id("status").prop("disabled","specific"!==e)}})});