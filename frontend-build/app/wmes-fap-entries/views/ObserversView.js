define(["underscore","app/core/View","app/users/util/setUpUserSelect2","app/wmes-fap-entries/templates/observers"],function(e,s,i,t){"use strict";return s.extend({template:t,events:{"change #-observer":function(){var s=this.$id("observer"),i=s.select2("data");if(s.select2("data",null),!e.some(this.model.get("observers"),function(e){return e.user.id===i.id})){var t=[{id:i.id,label:i.text}];this.model.change("subscribers",t,null)}this.timers.focus=setTimeout(this.focusObserver.bind(this,i.id),1)}},initialize:function(){this.listenTo(this.model,"change:observers",e.debounce(this.onObserversChanged.bind(this),1)),this.listenTo(this.model,"change:presence",this.onPresenceChanged)},getTemplateData:function(){return{observers:this.model.serializeDetails().observers}},afterRender:function(){var e=this.$id("observer"),s=this.model.serializeDetails().auth.observers;i(e,{width:"100%",noPersonnelId:!0,placeholder:this.t("observers:placeholder"+(s?"":":auth"))}),s||e.select2("enable",!1)},focusObserver:function(e){var s=this.$('.fap-observer[data-observer-id="'+e+'"]');s.length&&(s[0].scrollIntoViewIfNeeded?s[0].scrollIntoViewIfNeeded():s[0].scrollIntoView(),this.$(".highlight").removeClass("highlight"),clearTimeout(this.timers.highlight),s.addClass("highlight"),this.timers.highlight=setTimeout(function(){s.removeClass("highlight")},1100))},hideUserInfoPopover:function(){this.$(".userInfoPopover").prev().popover("destroy")},onObserversChanged:function(){var e=this.renderPartial(t,{observers:this.model.serializeObservers()}).find(".fap-details-panel-bd");this.$(".fap-details-panel-bd").replaceWith(e),e.on("scroll",this.hideUserInfoPopover.bind(this))},onPresenceChanged:function(e,s,i){this.$('.fap-observer[data-observer-id="'+i.userId+'"]').toggleClass("fap-is-online",i.online)}})});