define(["underscore","jquery","app/i18n","app/core/views/ListView"],function(e,s,t,i){"use strict";return i.extend({className:function(){var e=["fap-entries-list","is-clickable"];return this.options.orderDetails||e.push("is-colored"),e.join(" ")},remoteTopics:function(){var e={},s=this.collection.getTopicPrefix();return s&&(e[s+".added"]="refreshCollection",e[s+".updated.*"]="onModelUpdated",e[s+".deleted"]="onModelDeleted"),e},localTopics:{"fap.entries.seen":function(e){var s=this,t=0;e.seenEntries.forEach(function(e){t+=s.$('.fap-is-unseen[data-id="'+e+'"]').removeClass("fap-is-unseen").length}),t&&s.refreshCollection()}},events:e.assign({"click .is-filter":function(e){this.trigger("showFilter",e.currentTarget.dataset.columnId)},"click .action-seen":function(e){var s=this.$(e.currentTarget).addClass("disabled"),t=this.collection.get(s.closest("tr")[0].dataset.id);t&&t.multiChange({})}},i.prototype.events),serializeColumns:function(){var e=this.options.orderDetails?"":"is-filter",s=[{id:"rid",className:"is-min is-number",thClassName:e}];return this.options.orderDetails||s.push({id:"orderNo",className:"is-min",tdClassName:"text-mono",thClassName:e},{id:"nc12",className:"is-min",tdClassName:"text-mono",thClassName:e},{id:"productName",className:"is-min",thClassName:e,label:this.t("LIST:COLUMN:name")},{id:"mrp",className:"is-min",thClassName:e},{id:"subdivisionType",className:"is-min",thClassName:e}),s.push({id:"category",className:"is-min",thClassName:e},{id:"createdAt",className:"is-min",thClassName:e},{id:"divisions",className:"is-min",thClassName:e},{id:"lines",className:"is-min"},{id:"problem",className:"is-min",thClassName:e},{id:"level",valueProperty:"levelIndicator",className:"is-min",thClassName:e},"-"),s},serializeActions:function(){var e=this,s=e.collection;return this.options.orderDetails?null:function(t){var a=s.get(t._id),n=[];return n.push({id:"seen",icon:"eye",label:e.t("markAsSeen:listAction"),className:t.observer.changes.any?"":"disabled"}),n.push(i.actions.viewDetails(a)),a.canDelete()&&n.push(i.actions.delete(a)),n}},afterRender:function(){i.prototype.afterRender.apply(this,arguments),this.$("tbody").popover({container:this.el,placement:"auto left",selector:"td[data-id]",trigger:"hover",html:!0,content:function(){var e=this.firstElementChild;if(e&&"SPAN"===e.tagName)return e.scrollWidth>s(this).width()?this.textContent.trim():void 0},template:function(e){return s(e).addClass("fap-list-popover")}})},onModelUpdated:function(e){(e.change.comment||Object.keys(e.change.data).length)&&this.refreshCollection(e)}})});