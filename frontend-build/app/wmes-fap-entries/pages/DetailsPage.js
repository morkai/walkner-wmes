define(["app/socket","app/core/pages/DetailsPage","app/core/util/onModelDeleted","app/core/util/pageActions","../dictionaries","../views/DetailsView"],function(t,e,i,s,n,o){"use strict";return e.extend({DetailsView:o,remoteTopics:function(){var t={"fap.entries.deleted":"onDeleted"};return t["fap.entries.updated."+this.model.id]="onUpdated",t["fap.entries.presence."+this.model.id]="onPresence",t},localTopics:{"socket.connected":"join"},actions:function(){var t=[],e=this.model.serializeDetails().auth;return e.restart&&"finished"===this.model.get("status")?t.push({type:"info",icon:"thumbs-down",label:this.t("PAGE_ACTION:restart"),callback:this.restart.bind(this)}):e.status&&"started"===this.model.get("status")&&t.push({type:"success",icon:"thumbs-up",label:this.t("PAGE_ACTION:finish"),callback:this.finish.bind(this)}),e.delete&&t.push(s.delete(this.model,!1)),t},initialize:function(){e.prototype.initialize.apply(this,arguments),this.listenTo(this.model,"updateFailure",function(){this.model.fetch()}),this.listenToOnce(this.model,"sync",function(){this.listenTo(this.model,"sync",this.render)}),this.listenTo(this.model,"change:status",this.updateStatus)},setUpLayout:function(t){this.layout=t},destroy:function(){this.leave(),n.unload()},load:function(t){return t(this.model.fetch(),n.load())},afterRender:function(){e.prototype.afterRender.apply(this,arguments),n.load(),this.join()},join:function(){this.socket.emit("fap.entries.join",this.model.id)},leave:function(){this.socket.emit("fap.entries.leave",this.model.id)},finish:function(){this.model.change("status","finished")},restart:function(){this.model.change("status","started")},updateStatus:function(){this.layout&&this.layout.setActions(this.actions,this)},onDeleted:function(t){i(this.broker,this.model,t)},onUpdated:function(e){e._id===this.model.id&&t.getId()!==e.socketId&&this.model.handleChange(e.change)},onPresence:function(t){this.model.handlePresence(t.userId,t.presence)}})});