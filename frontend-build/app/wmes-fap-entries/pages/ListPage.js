define(["jquery","app/i18n","app/viewport","app/notifications","app/core/pages/FilteredListPage","app/core/util/pageActions","../dictionaries","../views/FilterView","../views/ListView","app/wmes-fap-entries/templates/markAsSeenAction"],function(e,t,i,n,s,r,o,a,c,l){"use strict";return s.extend({FilterView:a,ListView:c,actions:function(e){var t=this;return[r.jump(t,t.collection),{template:l,afterRender:function(e){e.find("a[data-filter]").on("click",t.markAsSeen.bind(t))}},r.export(e,t,t.collection,!1),{label:t.t("PAGE_ACTION:settings"),icon:"cogs",privileges:"FAP:MANAGE",href:"#fap/settings"}]},defineViews:function(){s.prototype.defineViews.apply(this,arguments),this.listenTo(this.listView,"showFilter",function(t){"rid"===t?e(".page-actions-jump").find('input[name="phrase"]').focus():this.filterView.showFilter(t)})},load:function(e){return e(o.load(),this.collection.fetch({reset:!0}))},destroy:function(){s.prototype.destroy.call(this),o.unload()},afterRender:function(){s.prototype.afterRender.call(this),o.load(),n.renderRequest(this)},markAsSeen:function(e){var t=this,n=t.ajax({method:"POST",url:"/fap/entries;seen",data:JSON.stringify({filter:e.currentTarget.dataset.filter})});n.fail(function(){i.msg.show({type:"error",time:3e3,text:t.t("markAsSeen:failure")})}),n.done(function(e){i.msg.show({type:"success",time:2500,text:t.t("markAsSeen:success",{count:e.length})})})}})});