define(["underscore","app/time","app/i18n","app/data/divisions","app/data/subdivisions","app/orgUnits/util/renderOrgUnitPath","app/core/views/ListView","app/events/templates/list","app/core/templates/userInfo"],function(e,t,a,r,s,i,o,d,n){"use strict";return o.extend({template:d,remoteTopics:{"events.saved":"refreshCollection"},serialize:function(){var e=this;return{events:this.collection.map(function(r){var s=r.get("type"),i=e.prepareData(s,r.get("data")),o=r.get("user"),d=null;return o&&(d={id:o._id,label:o.name,ip:o.ipAddress}),{severity:r.getSeverityClassName(),time:t.format(r.get("time"),"L, LTS"),user:n({userInfo:d}),type:a("events","TYPE:"+s),text:a("events","TEXT:"+i.$text,a.flatten(i))}})}},refreshCollection:function(e,t){if("function"!=typeof this.options.filter||!Array.isArray(e)||e.some(this.options.filter))return o.prototype.refreshCollection.call(this,e,t)},prepareData:function(e,o){if(o.$prepared)return o;switch(o.$prepared=!0,o.$text=e,o.date&&(o.dateUtc=t.utc.format(o.date,"L"),o.date=t.format(o.date,"L")),o.timestamp&&(o.timestamp=t.format(o.timestamp,"L, LTS")),e){case"fte.leader.created":case"fte.leader.locked":case"fte.leader.deleted":case"fte.master.created":case"fte.master.locked":case"fte.master.deleted":var d=s.get(o.model.subdivision);o.model._subdivision=d?i(d,!1,!1):"?",o.model.date=t.format(o.model.date,"L"),o.model.shift=a("core","SHIFT:"+o.model.shift);break;case"hourlyPlans.created":case"hourlyPlans.locked":case"hourlyPlans.deleted":var n=r.get(o.model.division);o.model._division=n?i(n,!1,!1):"?",o.model.date=t.format(o.model.date,"L"),o.model.shift=a("core","SHIFT:"+o.model.shift);break;case"purchaseOrders.synced":o.importedAt=t.format(o.importedAt,"LLL");break;case"orders.synced":o.removed=o.removed||0;break;case"orderDocuments.synced":o.minDate&&(o.minDate===o.maxDate?o.$text+=":date":o.$text+=":minMax",o.minDate=t.format(o.minDate,"L"),o.maxDate=t.format(o.maxDate,"L"))}return o}})});