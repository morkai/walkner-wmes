define(["underscore","app/core/views/FormView","../Tester","app/wmes-trw-testers/templates/form"],function(e,t,i,n){"use strict";return t.extend({template:n,events:e.assign({"click #-addIo":function(){this.addIo()},'click [data-action="removeIo"]':function(e){var t=this.$(e.currentTarget).closest("tr");t.fadeOut("fast",function(){t.remove()})},"click .trw-testers-form-tearDown":function(e){if("TD"===e.target.tagName){var t=e.currentTarget.querySelector("input");t.disabled||(t.checked=!t.checked)}},'change input[name$=".type"]':function(e){this.toggleIo(this.$(e.currentTarget).closest("tr"))}},t.prototype.events),initialize:function(){t.prototype.initialize.apply(this,arguments),this.ioI=0},afterRender:function(){var e=this;(e.model.get("io")||[]).forEach(e.addIo,e),t.prototype.afterRender.call(e),e.$id("io").children().each(function(){e.toggleIo(e.$(this))}),e.addIo(),e.options.editMode?(e.$id("_id").prop("readonly",!0),e.$id("name").focus()):e.$id("_id").focus()},serialize:function(){return e.assign(t.prototype.serialize.apply(this,arguments),{ioTypes:i.IO_TYPES})},serializeForm:function(e){return e.io||(e.io=[]),e.io.forEach(function(e){e.name||(e.name=e._id),e.device=parseInt(e.device,10),e.channel=parseInt(e.channel,10),e.min=parseInt(e.min,10)||0,e.max=parseInt(e.max,10)||0,e.tearDown=!!e.tearDown}),e.io=e.io.filter(function(e){return!!e._id&&e.device>=0&&e.channel>=0}),e.io.sort(function(e,t){return e.device===t.device?e.channel-t.channel:e.device-t.device}),e},addIo:function(){var e=this.$id("io");this.ioTemplate||(this.ioTemplate=e.html(),e.html(""));var t=this.ioTemplate.replace(/io\[]/g,"io["+this.ioI+"]");e.append(t),this.toggleIo(e.children().last()),++this.ioI},toggleIo:function(e){var t=e.find('input[name$=".type"]:checked').val();e.find('input[name$=".min"]').prop("disabled","analog"!==t),e.find('input[name$=".max"]').prop("disabled","analog"!==t)}})});