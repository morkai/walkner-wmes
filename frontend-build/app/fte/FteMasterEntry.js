define(["moment","../data/subdivisions","../data/prodFunctions","../data/views/renderOrgUnitPath","../core/Model"],function(t,e,n,i,a){return a.extend({urlRoot:"/fte/master",clientUrlRoot:"#fte/master",topicPrefix:"fte.master",privilegePrefix:"FTE:LEADER",nlsDomain:"fte",defaults:{subdivision:null,date:null,shift:null,flows:null,tasks:null,locked:!1,createdAt:null,creatorId:null,creatorLabel:null,updatedAt:null,updaterId:null,updaterLabel:null,absentUsers:null},serializeWithTotals:function(){var a=e.get(this.get("subdivision")),o={},s={};this.get("tasks").length&&this.get("tasks")[0].functions.forEach(function(t){var e=n.get(t.id);s[t.id]={prodFunction:e?e.getLabel():t.id,total:0,companies:{}},t.companies.forEach(function(e){s[t.id].companies[e.id]=0,o[e.id]={name:e.name,total:0}})});var l=this.serializeTasks(o,s),r=0;return Object.keys(o).forEach(function(t){r+=o[t].total}),{subdivision:a?i(a,!1,!1):"?",date:t(this.get("date")).format("LL"),shift:this.get("shift"),companyCount:Object.keys(o).length,totalByCompany:o,totalByProdFunction:s,total:r,tasks:l,locked:!!this.get("locked"),absentUsers:(this.get("absentUsers")||[]).filter(function(t){return!!t})}},serializeTasks:function(t,e){return this.get("tasks").map(function(n){return n.totalByCompany={},n.functions.forEach(function(i){i.companies.forEach(function(a){"number"!=typeof n.totalByCompany[a.id]&&(n.totalByCompany[a.id]=0),n.totalByCompany[a.id]+=a.count,t&&(t[a.id].total+=a.count),e&&(e[i.id].total+=a.count,e[i.id].companies[a.id]+=a.count)})}),n})}})});