define(["moment","../data/subdivisions","../data/views/renderOrgUnitPath","../core/Model"],function(t,e,n,i){return i.extend({urlRoot:"/fte/master",clientUrlRoot:"#fte/master",topicPrefix:"fte.master",privilegePrefix:"FTE:LEADER",nlsDomain:"fte",defaults:{subdivision:null,date:null,shift:null,flows:null,tasks:null,locked:!1,createdAt:null,creatorId:null,creatorLabel:null,updatedAt:null,updaterId:null,updaterLabel:null,absentUsers:null},serializeWithTotals:function(){var i=e.get(this.get("subdivision")),a={},o={};this.get("tasks").length&&this.get("tasks")[0].functions.forEach(function(t){o[t.id]={total:0,companies:{}},t.companies.forEach(function(e){o[t.id].companies[e.id]=0,a[e.id]={name:e.name,total:0}})});var s=this.serializeTasks(a,o),l=0;return Object.keys(a).forEach(function(t){l+=a[t].total}),{subdivision:i?n(i,!1,!1):"?",date:t(this.get("date")).format("LL"),shift:this.get("shift"),companyCount:Object.keys(a).length,totalByCompany:a,totalByProdFunction:o,total:l,tasks:s,locked:!!this.get("locked"),absentUsers:(this.get("absentUsers")||[]).filter(function(t){return!!t})}},serializeTasks:function(t,e){return this.get("tasks").map(function(n){return n.totalByCompany={},n.functions.forEach(function(i){i.companies.forEach(function(a){"number"!=typeof n.totalByCompany[a.id]&&(n.totalByCompany[a.id]=0),n.totalByCompany[a.id]+=a.count,t&&(t[a.id].total+=a.count),e&&(e[i.id].total+=a.count,e[i.id].companies[a.id]+=a.count)})}),n})}})});