define(["moment","../data/subdivisions","../data/views/renderOrgUnitPath","../core/Model"],function(e,t,i,n){return n.extend({urlRoot:"/fte/master",clientUrlRoot:"#fte/master",topicPrefix:"fte.master",privilegePrefix:"FTE:LEADER",nlsDomain:"fte",defaults:{subdivision:null,date:null,shift:null,flows:null,tasks:null,locked:!1,createdAt:null,creatorId:null,creatorLabel:null,updatedAt:null,updaterId:null,updaterLabel:null,absentUsers:null},serializeWithTotals:function(){var n=t.get(this.get("subdivision")),r={},o={};this.get("tasks").length&&this.get("tasks")[0].functions.forEach(function(e){o[e.id]={total:0,companies:{}},e.companies.forEach(function(t){o[e.id].companies[t.id]=0,r[t.id]={name:t.name,total:0}})});var s=this.serializeTasks(r,o),a=0;return Object.keys(r).forEach(function(e){a+=r[e].total}),{subdivision:n?i(n,!1,!1):"?",date:e(this.get("date")).format("LL"),shift:this.get("shift"),companyCount:Object.keys(r).length,totalByCompany:r,totalByProdFunction:o,total:a,tasks:s,locked:!!this.get("locked"),absentUsers:(this.get("absentUsers")||[]).filter(function(e){return!!e})}},serializeTasks:function(e,t){return this.get("tasks").map(function(i){return i.totalByCompany={},i.functions.forEach(function(n){n.companies.forEach(function(r){"number"!=typeof i.totalByCompany[r.id]&&(i.totalByCompany[r.id]=0),i.totalByCompany[r.id]+=r.count,e&&(e[r.id].total+=r.count),t&&(t[n.id].total+=r.count,t[n.id].companies[r.id]+=r.count)})}),i})}})});