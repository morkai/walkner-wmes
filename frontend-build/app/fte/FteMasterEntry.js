define(["moment","../data/subdivisions","../data/prodFunctions","../data/views/renderOrgUnitPath","../core/Model"],function(e,t,i,n,r){return r.extend({urlRoot:"/fte/master",clientUrlRoot:"#fte/master",topicPrefix:"fte.master",privilegePrefix:"FTE:LEADER",nlsDomain:"fte",defaults:{subdivision:null,date:null,shift:null,flows:null,tasks:null,locked:!1,createdAt:null,creatorId:null,creatorLabel:null,updatedAt:null,updaterId:null,updaterLabel:null,absentUsers:null},serializeWithTotals:function(){var r=t.get(this.get("subdivision")),o={},s={};this.get("tasks").length&&this.get("tasks")[0].functions.forEach(function(e){var t=i.get(e.id);s[e.id]={prodFunction:t?t.getLabel():e.id,total:0,companies:{}},e.companies.forEach(function(t){s[e.id].companies[t.id]=0,o[t.id]={name:t.name,total:0}})});var a=this.serializeTasks(o,s),l=0;return Object.keys(o).forEach(function(e){l+=o[e].total}),{subdivision:r?n(r,!1,!1):"?",date:e(this.get("date")).format("LL"),shift:this.get("shift"),companyCount:Object.keys(o).length,totalByCompany:o,totalByProdFunction:s,total:l,tasks:a,locked:!!this.get("locked"),absentUsers:(this.get("absentUsers")||[]).filter(function(e){return!!e})}},serializeTasks:function(e,t){return this.get("tasks").map(function(i){return i.totalByCompany={},i.functions.forEach(function(n){n.companies.forEach(function(r){"number"!=typeof i.totalByCompany[r.id]&&(i.totalByCompany[r.id]=0),i.totalByCompany[r.id]+=r.count,e&&(e[r.id].total+=r.count),t&&(t[n.id].total+=r.count,t[n.id].companies[r.id]+=r.count)})}),i})}})});