define(["underscore","js2form","app/time","app/data/divisions","app/data/subdivisions","app/orgUnits/views/OrgUnitDropdownsView","app/core/Model","app/core/views/FilterView","app/core/util/forms/dateTimeRange","app/fte/templates/filter"],function(i,n,s,t,e,o,r,a,d,p){"use strict";var l=o.ORG_UNIT;return a.extend({template:p,events:i.assign({"click a[data-date-time-range]":d.handleRangeEvent},a.prototype.events),defaultFormData:{division:"",subdivision:"",shift:0},termToForm:{date:d.rqlToForm,division:function(i,n,s){s[i]=n.args[1],("division"===i?t:e).get(s[i])||(s[i]="")},shift:function(i,n,s){s.shift=n.args[1]},subdivision:"division"},initialize:function(){this.orgUnitDropdownsView=new o({orgUnit:this.options.divisionOnly?l.DIVISION:l.SUBDIVISION,divisionFilter:this.options.divisionFilter||null,allowClear:!0,noGrid:!0}),this.setView(".orgUnitDropdowns-container",this.orgUnitDropdownsView)},afterRender:function(){a.prototype.afterRender.call(this),this.toggleButtonGroup("shift"),this.listenToOnce(this.orgUnitDropdownsView,"afterRender",function(){var i=null,n=null,s=this.formData;""!==s.subdivision?(n=l.SUBDIVISION,i=new r({subdivision:s.subdivision})):""!==s.division&&(n=l.DIVISION,i=new r({division:s.division})),this.orgUnitDropdownsView.selectValue(i,n)})},serializeFormToQuery:function(n){var s=this.orgUnitDropdownsView.$id("division").val(),t=this.orgUnitDropdownsView.$id("subdivision").val(),e=parseInt(this.$("input[name=shift]:checked").val(),10);d.formToRql(this,n),i.isEmpty(t)?i.isEmpty(s)||n.push({name:"eq",args:["division",s]}):n.push({name:"eq",args:["subdivision",t]}),0!==e&&n.push({name:"eq",args:["shift",e]})}})});