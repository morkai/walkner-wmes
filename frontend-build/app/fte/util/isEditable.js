// Copyright (c) 2014, ≈Åukasz Walukiewicz <lukasz@walukiewicz.eu>. Some Rights Reserved.
// Licensed under CC BY-NC-SA 4.0 <http://creativecommons.org/licenses/by-nc-sa/4.0/>.
// Part of the walkner-wmes project <http://lukasz.walukiewicz.eu/p/walkner-wmes>

define(["app/core/util/getShiftEndDate","app/data/subdivisions"],function(e,i){"use strict";return function(t,r){if(r.isAllowedTo("PROD_DATA:MANAGE"))return!0;if(!r.isAllowedTo(t.getPrivilegePrefix()+":MANAGE"))return!1;var n=Date.parse(t.get("createdAt")),a=Date.now();if(a>=n+288e5&&a>=e(t.get("date")).getTime())return!1;var d=r.getDivision();if(!d||r.isAllowedTo(t.getPrivilegePrefix()+":ALL"))return!0;var o=i.get(t.get("subdivision"));if(!o)return!1;var u=o.get("division");if(!u||d.id!==u)return!1;var s=r.getSubdivision();return s?s.id===o.id:!0}});