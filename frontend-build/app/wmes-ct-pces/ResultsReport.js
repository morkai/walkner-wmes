define(["underscore","app/i18n","app/time","app/core/Model","app/data/localStorage"],function(n,t,r,i,a){"use strict";return i.extend({urlRoot:"/ct/reports/results",nlsDomain:"wmes-ct-pces",defaults:function(){return{from:0,to:0,ignoredMrps:null,includedMrps:null,minLineWorkDuration:null,minUpphWorkDuration:null,shiftCount:null,availableWorkDuration:null,minMrpUnbalance:null,minMrpEfficiency:null,tab:"mrps",upph:a.getItem("WMES_CT_RESULTS_UPPH_MODE")||"standard",report:null}},initialize:function(){this.on("change:upph",function(){a.setItem("WMES_CT_RESULTS_UPPH_MODE",this.get("upph"))})},fetch:function(t){return n.isObject(t)||(t={}),t.data=n.assign(t.data||{},n.pick(this.attributes,["from","to","ignoredMrps","includedMrps","minLineWorkDuration","minUpphWorkDuration","shiftCount","availableWorkDuration","minMrpUnbalance","minMrpEfficiency"])),Object.keys(t.data).forEach(function(n){Array.isArray(t.data[n])&&(t.data[n]=t.data[n].join(","))}),i.prototype.fetch.call(this,t)},genClientUrl:function(){var t=this.attributes,r=this.urlRoot+"?from="+(t.from||"")+"&to="+(t.to||"")+"&tab="+t.tab;return n.forEach({ignoredMrps:"xm",includedMrps:"im",minLineWorkDuration:"mlwd",minUpphWorkDuration:"muwd",shiftCount:"sc",availableWorkDuration:"awd",minMrpUnbalance:"mmu",minMrpEfficiency:"mme"},function(n,i){var a=t[i];null!=a&&(r+="&"+n+"="+(Array.isArray(a)?a.join(","):a))}),r},parse:function(n){return{report:n}}},{fromQuery:function(t){var i={from:+t.from||0,to:+t.to||0,tab:t.tab||void 0,upph:t.upph||void 0};if(!i.from&&!i.to){var a=r.getMoment();a.isoWeekday()>=4?a.startOf("isoWeek").add(7,"days"):a.startOf("isoWeek"),i.to=a.valueOf(),i.from=a.subtract(4,"weeks").valueOf()}t.xm&&(i.ignoredMrps=t.xm.split(",").filter(function(n){return!!n.length})),t.im&&(i.includedMrps=t.im.split(",").filter(function(n){return!!n.length}));return n.forEach({minLineWorkDuration:"mlwd",minUpphWorkDuration:"muwd",shiftCount:"sc",availableWorkDuration:"awd",minMrpUnbalance:"mmu",minMrpEfficiency:"mme"},function(n,r){var a=parseFloat(t[n]);isNaN(a)||null==a||(i[r]=a)}),new this(i)}})});