define(["underscore","app/time","app/user","app/core/Model","app/data/localStorage"],function(n,t,r,i,e){"use strict";return i.extend({urlRoot:"/ct/reports/results",nlsDomain:"wmes-ct-pces",defaults:function(){return{from:0,to:0,ignoredMrps:null,includedMrps:null,minLineWorkDuration:null,minUpphWorkDuration:null,shiftCount:null,availableWorkDuration:null,minMrpUnbalance:null,minMrpEfficiency:null,tab:"mrps",upph:e.getItem("WMES_CT_RESULTS_UPPH_MODE")||"standard",report:null}},initialize:function(){this.on("change:upph",function(){e.setItem("WMES_CT_RESULTS_UPPH_MODE",this.get("upph"))})},fetch:function(t){return n.isObject(t)||(t={}),t.data=n.assign(t.data||{},n.pick(this.attributes,["from","to","ignoredMrps","includedMrps","minLineWorkDuration","minUpphWorkDuration","shiftCount","availableWorkDuration","minMrpUnbalance","minMrpEfficiency"])),Object.keys(t.data).forEach(function(n){Array.isArray(t.data[n])&&(t.data[n]=t.data[n].join(","))}),i.prototype.fetch.call(this,t)},genClientUrl:function(){var t=this.attributes,r=this.urlRoot+"?from="+(t.from||"")+"&to="+(t.to||"")+"&tab="+t.tab;return n.forEach({ignoredMrps:"xm",includedMrps:"im",minLineWorkDuration:"mlwd",minUpphWorkDuration:"muwd",shiftCount:"sc",availableWorkDuration:"awd",minMrpUnbalance:"mmu",minMrpEfficiency:"mme"},function(n,i){var e=t[i];null!=e&&(r+="&"+n+"="+(Array.isArray(e)?e.join(","):e))}),r},parse:function(n){return{report:n}}},{can:{manage:function(){return r.isAllowedTo("PROD_DATA:MANAGE","FN:*process-engineer*")}},fromQuery:function(r){var i={from:+r.from||0,to:+r.to||0,tab:r.tab||void 0,upph:r.upph||void 0};if(!i.from&&!i.to){var e=t.getMoment();e.isoWeekday()>=4?e.startOf("isoWeek").add(7,"days"):e.startOf("isoWeek"),i.to=e.valueOf(),i.from=e.subtract(4,"weeks").valueOf()}r.xm&&(i.ignoredMrps=r.xm.split(",").filter(function(n){return!!n.length})),r.im&&(i.includedMrps=r.im.split(",").filter(function(n){return!!n.length}));return n.forEach({minLineWorkDuration:"mlwd",minUpphWorkDuration:"muwd",shiftCount:"sc",availableWorkDuration:"awd",minMrpUnbalance:"mmu",minMrpEfficiency:"mme"},function(n,t){var e=parseFloat(r[n]);isNaN(e)||null==e||(i[t]=e)}),new this(i)}})});