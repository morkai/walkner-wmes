define(["underscore","app/i18n","app/time","app/core/Model"],function(n,r,t,i){"use strict";return i.extend({urlRoot:"/ct/reports/results",nlsDomain:"wmes-ct-pces",defaults:function(){return{from:0,to:0,ignoredMrps:null,minLineWorkDuration:null,minUpphWorkDuration:null,shiftCount:null,availableWorkDuration:null,minMrpUnbalance:null,minMrpEfficiency:null,tab:"mrps",report:null}},initialize:function(){},fetch:function(r){return n.isObject(r)||(r={}),r.data=n.assign(r.data||{},n.pick(this.attributes,["from","to","ignoredMrps","minLineWorkDuration","minUpphWorkDuration","shiftCount","availableWorkDuration","minMrpUnbalance","minMrpEfficiency"])),Object.keys(r.data).forEach(function(n){Array.isArray(r.data[n])&&(r.data[n]=r.data[n].join(","))}),i.prototype.fetch.call(this,r)},genClientUrl:function(){var r=this.attributes,t=this.urlRoot+"?from="+(r.from||"")+"&to="+(r.to||"")+"&tab="+r.tab;return n.forEach({ignoredMrps:"im",minLineWorkDuration:"mlwd",minUpphWorkDuration:"muwd",shiftCount:"sc",availableWorkDuration:"awd",minMrpUnbalance:"mmu",minMrpEfficiency:"mme"},function(n,i){var a=r[i];null!=a&&(t+="&"+n+"="+(Array.isArray(a)?a.join(","):a))}),t},parse:function(n){return{report:n}}},{fromQuery:function(r){var i={from:+r.from||0,to:+r.to||0,tab:r.tab||void 0};if(!i.from&&!i.to){var a=t.getMoment();a.isoWeekday()>=4?a.startOf("isoWeek").add(7,"days"):a.startOf("isoWeek"),i.to=a.valueOf(),i.from=a.subtract(4,"weeks").valueOf()}r.im&&(i.ignoredMrps=r.im.split(",").filter(function(n){return!!n.length}));return n.forEach({minLineWorkDuration:"mlwd",minUpphWorkDuration:"muwd",shiftCount:"sc",availableWorkDuration:"awd",minMrpUnbalance:"mmu",minMrpEfficiency:"mme"},function(n,t){var a=parseFloat(r[n]);isNaN(a)||null==a||(i[t]=a)}),new this(i)}})});