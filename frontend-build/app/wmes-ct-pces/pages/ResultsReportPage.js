define(["underscore","app/i18n","app/viewport","app/core/View","app/core/util/bindLoadingMessage","app/wmes-ct-state/settings","../ResultsReport","../views/resultsReport/FilterView","../views/resultsReport/VsChartView","../views/resultsReport/AvgOutputChartView","../views/resultsReport/TableView","../views/resultsReport/UpphQuarterlyConfigView","app/wmes-ct-pces/templates/resultsReport/page"],function(e,t,s,i,r,n,a,o,l,p,h,u,d){"use strict";return i.extend({layoutName:"page",template:d,events:{"click #-editUpphConfig":function(){var e=new u;s.showDialog(e,this.t("upphQuarterlyConfig:title"))},"click .ct-reports-results-mode":function(e){this.model.set(e.currentTarget.dataset.prop,e.currentTarget.dataset.value)}},breadcrumbs:function(){return[{href:"#ct",label:this.t("BREADCRUMB:base")},this.t("BREADCRUMB:reports:results")]},actions:function(){return[{label:this.t("PAGE_ACTION:settings"),icon:"cogs",privileges:"PROD_DATA:MANAGE",href:"#ct/settings?tab=resultsReport"}]},initialize:function(){n.bind(this),this.model=r(this.model,this),this.setView("#-filter",new o({model:this.model,settings:this.settings})),this.setView("#-vs",new l({model:this.model})),this.setView("#-avgOutput",new p({model:this.model})),this.setView("#-table",new h({model:this.model})),this.listenTo(this.model,"filtered",this.onFiltered),this.listenTo(this.model,"change:tab",this.updateUrl),this.listenTo(this.model,"change:upph",this.onUpphChanged)},load:function(e){return e(this.model.fetch())},getTemplateData:function(){return{canManage:a.can.manage()}},afterRender:function(){this.updateUpphMode()},onFiltered:function(){this.promised(this.model.fetch()),this.updateUrl()},onUpphChanged:function(){this.updateUpphMode(),this.updateUrl()},updateUrl:function(){this.broker.publish("router.navigate",{url:this.model.genClientUrl(),trigger:!1,replace:!0})},updateUpphMode:function(){this.$(".active[data-prop]").removeClass("active"),this.$('.ct-reports-results-mode[data-value="'+this.model.get("upph")+'"]').addClass("active")}})});