define(["underscore","app/i18n","app/highcharts","app/core/View"],function(t,e,i,r){"use strict";return r.extend({initialize:function(){this.chart=null,this.isLoading=!1,this.listenTo(this.model,"request",this.onModelLoading),this.listenTo(this.model,"sync",this.onModelLoaded),this.listenTo(this.model,"error",this.onModelError),this.listenTo(this.model,"change:report",this.render)},destroy:function(){null!==this.chart&&(this.chart.destroy(),this.chart=null)},afterRender:function(){this.timers.createOrUpdate&&clearTimeout(this.timers.createOrUpdate),this.timers.createOrUpdate=setTimeout(this.createOrUpdate.bind(this),1)},createOrUpdate:function(){this.timers.createOrUpdate=null,this.chart?this.updateChart():(this.createChart(),this.isLoading&&this.chart.showLoading())},createChart:function(){var t=this.serializeSeries();this.chart=new i.Chart({chart:{renderTo:this.el,plotBorderWidth:1,spacing:[15,1,15,1],type:"column",zoomType:void 0},exporting:{filename:this.t("resultsReport:vs:filename"),chartOptions:{title:{text:this.t("resultsReport:vs:title")}}},title:!1,noData:{},xAxis:{categories:this.serializeCategories()},yAxis:[{title:!1,min:0,allowDecimals:!1,opposite:!1},{title:!1,min:0,max:100,allowDecimals:!1,opposite:!0,labels:{format:"{value}%"}}],tooltip:{shared:!0,valueDecimals:0},legend:{enabled:!1},plotOptions:{column:{dataLabels:{enabled:!0,formatter:function(){return i.numberFormat(this.y,0)}},grouping:!1}},series:t})},updateChart:function(){this.chart.destroy(),this.createChart()},serializeCategories:function(){var t=this.model.get("report");return[this.t("resultsReport:allLineCount:category"),this.t("resultsReport:workingLineCount:category"),this.t("resultsReport:availableLineUsage:category"),this.t("resultsReport:mrpCount:category"),this.t("resultsReport:unbalancedMrpCount:category",{min:t&&t.options.minMrpUnbalance||0}),this.t("resultsReport:bottleneckedMrpCount:category"),this.t("resultsReport:efficientMrpCount:category",{min:t&&t.options.minMrpEfficiency||0})]},serializeSeries:function(){var t=this.model.get("report");return[{name:this.t("resultsReport:allLineCount:series"),data:[t.allLineCount||0]},{name:this.t("resultsReport:workingLineCount:series"),data:[null,t.workingLineCount||0]},{name:this.t("resultsReport:availableLineUsage:series"),yAxis:1,data:[null,null,t.availableLineUsage||0],tooltip:{valueSuffix:"%"},dataLabels:{format:"{y}%"}},{name:this.t("resultsReport:mrpCount:series"),data:[null,null,null,(t.mrps||[]).length]},{name:this.t("resultsReport:unbalancedMrpCount:series"),data:[null,null,null,null,t.unbalancedMrpCount||0]},{name:this.t("resultsReport:bottleneckedMrpCount:series"),data:[null,null,null,null,null,t.bottleneckedMrpCount||0]},{name:this.t("resultsReport:efficientMrpCount:series"),data:[null,null,null,null,null,null,t.efficientMrpCount||0]}]},onModelLoading:function(){this.isLoading=!0,this.chart&&this.chart.showLoading()},onModelLoaded:function(){this.isLoading=!1,this.chart&&this.chart.hideLoading()},onModelError:function(){this.isLoading=!1,this.chart&&this.chart.hideLoading()}})});