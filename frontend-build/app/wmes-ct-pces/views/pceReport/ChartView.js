define(["underscore","app/i18n","app/highcharts","app/core/View"],function(t,e,i,r){"use strict";return r.extend({initialize:function(){this.chart=null,this.isLoading=!1,this.listenTo(this.model,"request",this.onModelLoading),this.listenTo(this.model,"sync",this.onModelLoaded),this.listenTo(this.model,"error",this.onModelError),this.listenTo(this.product,"change:metrics",this.render)},destroy:function(){null!==this.chart&&(this.chart.destroy(),this.chart=null)},afterRender:function(){this.timers.createOrUpdate&&clearTimeout(this.timers.createOrUpdate),this.timers.createOrUpdate=setTimeout(this.createOrUpdate.bind(this),1)},createOrUpdate:function(){this.timers.createOrUpdate=null,this.chart?this.updateChart():(this.createChart(),this.isLoading&&this.chart.showLoading())},createChart:function(){var t=this.serializeSeries();this.chart=new i.Chart({chart:{renderTo:this.el,plotBorderWidth:1,spacing:[15,1,15,1],type:"column"},exporting:{filename:this.t("pceReport:chart:filename"),chartOptions:{title:{text:this.t("pceReport:chart:title")}}},title:!1,noData:{},xAxis:{categories:this.serializeCategories()},yAxis:[{title:!1,min:0,allowDecimals:!1,opposite:!1}],tooltip:{shared:!0,valueDecimals:0},legend:{enabled:t.length>1},plotOptions:{column:{dataLabels:{enabled:!1},borderWidth:3}},series:t})},updateChart:function(){this.chart.destroy(),this.createChart()},serializeCategories:function(){for(var t=[],e=this.model.getStationCount(),i=1;i<=e;++i)t.push(i.toString());return t},serializeSeries:function(){var t=[],e=this.product.get("sapTaktTime"),i=this.product.get("metrics");if(!i)return t;if(i.product)i=i.product;else if(i.order)i=i.order;else{if(!i.pso)return t;i=i.pso}return t.push({id:"med",type:"column",name:this.t("pceReport:metric:med"),data:i.med.map(function(t){return{borderColor:(t/=1e3)>e?"#e00":"#00af00",y:t}}),tooltip:{valueSuffix:"s"}},{id:"avg",type:"column",name:this.t("pceReport:metric:avg"),data:i.avg.map(function(t){return{borderColor:(t/=1e3)>e?"#e00":"#00af00",y:t}}),tooltip:{valueSuffix:"s"}},{id:"stt",type:"line",color:"orange",name:this.t("pceReport:metric:stt"),data:i.med.map(function(){return e}),tooltip:{valueSuffix:"s"}}),t},onModelLoading:function(){this.isLoading=!0,this.chart&&this.chart.showLoading()},onModelLoaded:function(){this.isLoading=!1,this.chart&&this.chart.hideLoading()},onModelError:function(){this.isLoading=!1,this.chart&&this.chart.hideLoading()}})});