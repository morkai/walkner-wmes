define(["underscore","app/broker","app/core/Viewport"],function(e,d,o){"use strict";var n=new o({el:document.body,selector:"#app-viewport"});return d.subscribe("router.executing",function(){window.scrollTo(0,0)}),d.subscribe("viewport.page.loaded",function(){window.parent!==window&&window.parent.postMessage({type:"viewport.page.embeddedLoaded",app:window.WMES_APP_ID,loaded:!0},"*")}),d.subscribe("viewport.page.loadingFailed",function(){window.parent!==window&&window.parent.postMessage({type:"viewport.page.embeddedLoaded",app:window.WMES_APP_ID,loaded:!1},"*")}),window.addEventListener("message",function(e){var o=e.data;switch(o.type){case"viewport.page.embeddedLoaded":d.publish("viewport.page.embeddedLoaded",{app:o.app,loaded:o.loaded})}}),window.addEventListener("resize",e.debounce(d.publish.bind(d,"viewport.resized"),1e3/30)),window.viewport=n,Object.defineProperty(window,"page",{get:function(){return n.currentPage}}),Object.defineProperty(window,"dialog",{get:function(){return n.currentDialog}}),Object.defineProperty(window,"model",{get:function(){var e=n.currentDialog||n.currentPage;return e&&e.model||e.collection}}),n});