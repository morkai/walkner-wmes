define(["app/broker","app/core/Viewport"],function(e,o){"use strict";var d=new o({el:document.body,selector:"#app-viewport"});return e.subscribe("router.executing",function(){window.scrollTo(0,0)}),e.subscribe("viewport.page.loaded",function(){window.parent!==window&&window.parent.postMessage({type:"viewport.page.embeddedLoaded",app:window.WMES_APP_ID,loaded:!0},"*")}),e.subscribe("viewport.page.loadingFailed",function(){window.parent!==window&&window.parent.postMessage({type:"viewport.page.embeddedLoaded",app:window.WMES_APP_ID,loaded:!1},"*")}),window.addEventListener("message",function(o){var d=o.data;switch(d.type){case"viewport.page.embeddedLoaded":e.publish("viewport.page.embeddedLoaded",{app:d.app,loaded:d.loaded})}}),window.viewport=d,Object.defineProperty(window,"page",{get:function(){return d.currentPage}}),Object.defineProperty(window,"dialog",{get:function(){return d.currentDialog}}),Object.defineProperty(window,"model",{get:function(){var e=d.currentDialog||d.currentPage;return e&&e.model||e.collection}}),d});