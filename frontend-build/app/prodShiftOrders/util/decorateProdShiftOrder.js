define(["app/time","app/i18n","app/user","app/data/subdivisions","app/data/mrpControllers","app/data/prodFlows","app/data/prodLines","app/orgUnits/util/renderOrgUnitPath","app/core/util/getShiftStartInfo","app/core/templates/userInfo","app/orders/util/resolveProductName"],function(e,t,r,o,a,i,d,n,p,s,f){"use strict";return function(a,d){var n=a.toJSON(),m=Date.parse(n.startedAt),l=Date.parse(n.finishedAt);if(n.date)n.date=e.format(n.date,"L");else{var c=p(n.startedAt);n.date=c.moment.format("L"),n.shift=c.shift}if(n.shift=t("core","SHIFT:"+n.shift),n.startedAt=e.format(n.startedAt,"LTS"),n.finishedAt=e.format(n.finishedAt,"LTS"),n.duration=l?e.toString((l-m)/1e3):"",n.creator=s({userInfo:n.creator}),d.orgUnits){var h=o.get(n.subdivision),u=i.get(n.prodFlow);n.subdivision=h?h.getLabel():"?",n.prodFlow=u?u.getLabel():"?",n.mrpControllers=Array.isArray(n.mrpControllers)&&n.mrpControllers.length?n.mrpControllers.join("; "):"?"}if(n.prodShift=n.prodShift?'<a href="#prodShifts/'+n.prodShift+'">'+n.date+", "+n.shift+"</a>":n.date+", "+n.shift,n.orderData){var T=(n.orderData.operations||{})[n.operationNo]||{};n.order=n.orderId+": <em>"+(f(n.orderData)||"?")+"</em>",n.operation=n.operationNo+": <em>"+(T.name||"?")+"</em>"}else n.order=n.orderId,n.operation=n.operationNo;d.orderUrl&&r.isAllowedTo("ORDERS:VIEW")&&(n.orderUrl="#"+(n.mechOrder?"mechOrders":"orders")+"/"+encodeURIComponent(n.orderId)),n.taktTimeOk=a.isTaktTimeOk(),n.taktTimeSap=a.getTaktTime(),n.taktTime=a.getActualTaktTime(),n.taktTimeEff=a.getTaktTimeEfficiency(),n.workerCountSap=a.getWorkerCountSap(),n.efficiency="";var g=a.getEfficiency();return g?n.efficiency=Math.round(100*g)+"%":n.taktTimeEff&&(n.efficiency=n.taktTimeEff+"%"),n}});