define(["underscore","app/user","app/viewport","app/core/views/ListView","app/data/prodLines","app/orgUnits/util/renderOrgUnitPath"],function(e,i,t,s,r,a){"use strict";return s.extend({className:"is-clickable is-colored",refreshDelay:6e3,remoteTopics:{"prodShiftOrders.created.*":"refreshIfMatches","prodShiftOrders.updated.*":"refreshIfMatches","prodShiftOrders.deleted.*":"refreshIfMatches"},events:e.assign({"click .is-filter":function(e){this.trigger("showFilter",e.currentTarget.dataset.columnId)}},s.prototype.events),serializeColumns:function(){var e=this.collection.findRqlTerm("mechOrder","eq"),t=!e||!e.args[1];return[{id:"mrpControllers",titleProperty:"mrpControllersText",className:"is-overflow w100",thClassName:"is-filter"},{id:"prodFlow",className:"is-overflow w200",thClassName:"is-filter"},{id:"prodLine",className:"is-overflow w100",thClassName:"is-filter"},{id:"orderId",className:"is-min",thClassName:"is-filter",visible:t},{id:"product",className:"is-overflow w450",thClassName:"is-filter"},{id:"operation",titleProperty:"operationName",className:"is-overflow w175"},{id:"prodShift",className:"is-min",width:"105px",thClassName:"is-filter"},{id:"startedAt",className:"is-min",thClassName:"is-filter"},{id:"duration",className:"is-min"},{id:"quantityDone",className:"is-min is-number"},{id:"workerCount",className:"is-min is-number"},{id:"efficiency",className:"is-min is-number",visible:i.isAllowedTo("PROD_DATA:VIEW:EFF")},{id:"planOrderGroup",className:"is-min",visible:t},"-"]},serializeRow:function(e){return e.serializeRow({orgUnits:!0})},serializeActions:function(){var e=this.collection;return function(i){return[s.actions.viewDetails(e.get(i._id))]}},afterRender:function(){s.prototype.afterRender.call(this);var e=this;this.$('.list-item > td[data-id="prodLine"]').popover({container:this.el,trigger:"hover",placement:"auto right",html:!0,content:function(){var i=a(r.get(e.$(this).text().trim()),!1,!1);return i?i.split(" \\ ").join("<br>\\ "):"?"}})},refreshIfMatches:function(e,i){this.collection.hasOrMatches(e)&&(this.isQuantityDoneMessage(i,e)||this.refreshCollection())},isQuantityDoneMessage:function(i,t){return!!/updated/.test(i)&&(/updated/.test(i)&&e.isNumber(t.quantityDone)&&e.isNumber(t.totalQuantity)&&e.isNumber(t.avgTaktTime)&&e.isNumber(t.lastTaktTime))}})});