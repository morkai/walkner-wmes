define(["underscore","app/i18n","app/viewport","app/core/views/FormView","app/users/util/setUpUserSelect2","app/production/util/orderPickerHelpers","app/prodShiftOrders/templates/editForm"],function(e,r,t,o,s,i,a){return o.extend({template:a,idPrefix:"prodShiftOrderEditForm",destroy:function(){this.$('.select2-offscreen[tabindex="-1"]').select2("destroy")},afterRender:function(){o.prototype.afterRender.call(this),this.setUpUserSelect2("master"),this.setUpUserSelect2("leader"),this.setUpUserSelect2("operator"),i.setUpOrderSelect2(this.$id("order"),this.$id("operation"),this.model),i.setUpOperationSelect2(this.$id("operation"),[]),i.selectOrder(this.$id("order"),this.model),this.$id("master").select2("focus")},setUpUserSelect2:function(e){var r=s(this.$id(e)),t=this.model.get(e);t&&t.id&&t.label&&r.select2("data",{id:t.id,text:t.label,name:t.label})},checkValidity:function(e){return"string"==typeof e.orderId&&e.orderId.length?"string"==typeof e.operationNo&&e.operationNo.length?!0:(this.$errorMessage=t.msg.show({type:"error",text:r("prodShiftOrders","FORM:ERROR:operation")}),!1):(this.$errorMessage=t.msg.show({type:"error",text:r("prodShiftOrders","FORM:ERROR:order")}),!1)},serializeForm:function(e){return e.master=this.serializeUserInfo("master"),e.leader=this.serializeUserInfo("leader"),e.operator=this.serializeUserInfo("operator"),e.operators=e.operator?[e.operator]:[],e.quantityDone=parseInt(e.quantityDone,10),e.workerCount=parseInt(e.workerCount,10),(isNaN(e.quantityDone)||e.quantityDone<0)&&(e.quantityDone=0),(isNaN(e.workerCount)||e.workerCount<1)&&(e.workerCount=1),e.operationNo=this.$id("operation").select2("val"),e.orderData=this.$id("order").select2("data"),e.orderData?e.orderData.sameOrder?(delete e.sameOrder,e.orderId=this.model.get("orderId")):(i.prepareOrderInfo(this.model,e.orderData),e.mechOrder=null===e.orderData.no,e.orderId=e.orderData[e.mechOrder?"nc12":"no"]):e.orderId=null,e},serializeUserInfo:function(e){var r=this.$id(e).select2("data");return null===r?null:{id:r.id,label:r.name}},handleFailure:function(e){e.responseJSON&&e.responseJSON.error&&"INVALID_CHANGES"===e.responseJSON.error.message?this.$errorMessage=t.msg.show({type:"warning",time:5e3,text:r("prodShiftOrders","FORM:ERROR:INVALID_CHANGES")}):o.prototype.handleFailure.apply(this,arguments)}})});