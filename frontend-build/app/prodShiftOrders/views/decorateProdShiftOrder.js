define(["app/time","app/i18n","app/user","app/data/subdivisions","app/data/mrpControllers","app/data/prodFlows","app/data/prodLines","app/data/views/renderOrgUnitPath","app/core/util/getShiftStartInfo","app/core/templates/userInfo"],function(e,t,n,r,i,o,a,s,l,d){return function(i,a){var s=i.toJSON(),u=Date.parse(s.startedAt),c=Date.parse(s.finishedAt);if(s.date)s.date=e.format(s.date,"YYYY-MM-DD");else{var p=l(s.startedAt);s.date=p.moment.format("YYYY-MM-DD"),s.shift=p.shift}if(s.shift=t("core","SHIFT:"+s.shift),s.startedAt=e.format(s.startedAt,"HH:mm:ss"),s.finishedAt=e.format(s.finishedAt,"HH:mm:ss"),s.duration=c?e.toString((c-u)/1e3):"-",s.creator=d({userInfo:s.creator}),a.orgUnits){var f=r.get(s.subdivision),m=o.get(s.prodFlow);s.subdivision=f?f.getLabel():"?",s.prodFlow=m?m.getLabel():"?",s.mrpControllers=Array.isArray(s.mrpControllers)&&s.mrpControllers.length?s.mrpControllers.join("; "):"?"}if(s.prodShift=s.prodShift?'<a href="#prodShifts/'+s.prodShift+'">'+s.date+", "+s.shift+"</a>":s.date+", "+s.shift,s.orderData){var h=(s.orderData.operations||{})[s.operationNo]||{};s.order=s.orderId+": <em>"+(s.orderData.name||"?")+"</em>",s.operation=s.operationNo+": <em>"+(h.name||"?")+"</em>"}else s.order=s.orderId,s.operation=s.operationNo;return a.orderUrl&&n.isAllowedTo("ORDERS:VIEW")&&(s.orderUrl="#"+(s.mechOrder?"mechOrders":"orders")+"/"+encodeURIComponent(s.orderId)),s.taktTimeSap=i.getTaktTime(),s.taktTime=i.getActualTaktTime(),s.workerCountSap=i.getWorkerCountSap(),s}});