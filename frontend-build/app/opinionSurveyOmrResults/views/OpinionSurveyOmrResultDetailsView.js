// Copyright (c) 2014, ≈Åukasz Walukiewicz <lukasz@walukiewicz.eu>. Some Rights Reserved.
// Licensed under CC BY-NC-SA 4.0 <http://creativecommons.org/licenses/by-nc-sa/4.0/>.
// Part of the walkner-wmes project <http://lukasz.walukiewicz.eu/p/walkner-wmes>

define(["underscore","app/core/views/DetailsView","app/opinionSurveyOmrResults/templates/details"],function(e,t,i){"use strict";return t.extend({template:i,events:{"click .nav-tabs a":function(e){e.preventDefault();var t=this.$(e.target).tab("show").parent().attr("data-tab");this.broker.publish("router.navigate",{url:this.model.genClientUrl()+"?tab="+t,trigger:!1,replace:!0})}},serialize:function(){return e.extend(t.prototype.serialize.call(this),{circles:this.serializeCircles()})},serializeCircles:function(){var t=[];return e.forEach(this.model.get("omrOutput"),function(i){"circles"===i.type&&e.forEach(i.circles,function(r,a){t.push({top:i.top+r.y-r.r,left:i.left+r.x-r.r,width:2*r.r,height:2*r.r,marked:e.includes(i.marked,a)})})}),t},afterRender:function(){t.prototype.afterRender.call(this),this.activateTab(this.options.tab||"omrPreview")},activateTab:function(e){this.$('.nav-tabs > li[data-tab="'+e+'"] > a').tab("show")},onModelEdited:function(e){var t=e.model;t&&t._id===this.model.id&&(delete t.survey,this.model.set(t))}})});