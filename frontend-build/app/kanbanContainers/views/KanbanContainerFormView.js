// Part of <https://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

define(["underscore","app/viewport","app/core/views/FormView","app/kanbanContainers/templates/form"],function(t,e,i,a){"use strict";return i.extend({template:a,events:t.assign({"input #-_id":"validateId"},i.prototype.events),initialize:function(){i.prototype.initialize.apply(this,arguments),this.validateId=t.debounce(this.validateId.bind(this),500)},afterRender:function(){i.prototype.afterRender.apply(this,arguments),this.options.editMode?(this.$id("_id").prop("readonly",!0),this.$id("name").focus()):this.$id("_id").focus()},validateId:function(){var t=this,e=t.$id("_id"),i=t.ajax({method:"HEAD",url:"/kanban/containers/"+e.val()});i.fail(function(){e[0].setCustomValidity("")}),i.done(function(){e[0].setCustomValidity(200===i.status?t.t("FORM:ERROR:alreadyExists"):"")})},submitRequest:function(t,e){var a=this;if(!e.image)return i.prototype.submitRequest.call(a,t,e);var n=new FormData;n.append("image",this.$id("image")[0].files[0]);var s=a.ajax({type:"POST",url:"/kanban/containers/"+e._id+".jpg",data:n,processData:!1,contentType:!1});s.fail(function(){a.showErrorMessage(a.t("FORM:ERROR:imageFailure")),t.prop("disabled",!1)}),s.done(function(n){e.image=n,i.prototype.submitRequest.call(a,t,e)})}})});