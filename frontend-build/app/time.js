define(["moment-timezone","app/socket","moment-timezone-data"],function(e,t){function n(e,t){for(e=String(e);e.length<t;)e="0"+e;return e}var r="TIME:OFFSET",i="TIME:ZONE",o={synced:!1,offset:parseFloat(localStorage.getItem(r))||0,zone:localStorage.getItem(i)||"Europe/Warsaw",appData:window.TIME||0};return delete window.TIME,o.sync=function(){var e=Date.now();t.emit("time",function(t,n){o.offset=(t-e+(t-Date.now()))/2,o.zone=n,o.synced=!0,localStorage.setItem(r,o.offset.toString()),localStorage.setItem(i,o.zone)})},o.getServerMoment=function(){return e(Date.now()+o.offset).tz(o.zone)},o.getMoment=function(t){return e(t).tz(o.zone)},o.format=function(e,t){var n=o.getMoment(e);return n.isValid()?n.format(t):null},o.toSeconds=function(e){if("number"==typeof e)return e;if("string"!=typeof e)return 0;var t={g:3600,h:3600,m:60,s:1},n=e.trim(),r=parseInt(n,10);if(/^[0-9]+\.?[0-9]*$/.test(n)===!1){var i,o=/([0-9\.]+) *(h|m|s)[a-z]*/gi;for(r=0;i=o.exec(n);)r+=i[1]*t[i[2].toLowerCase()]}return r},o.toString=function(e,t){if("number"!=typeof e||0>=e)return t?"00:00:00":"0s";var r="",i=Math.floor(e/3600);i>0?(r+=t?n(i,2)+":":" "+i+"h",e%=3600):t&&(r+="00:");var o=Math.floor(e/60);o>0?(r+=t?n(o,2)+":":" "+o+"min",e%=60):t&&(r+="00:");var a=e;return a>=1?r+=t?n(Math.round(a),2):" "+Math.round(a)+"s":a>0&&""===r?r+=" "+1e3*a+"ms":t&&(r+="00"),t?r:r.substr(1)},t.on("connect",function(){o.sync()}),t.isConnected()&&o.sync(),window.time=o,o});