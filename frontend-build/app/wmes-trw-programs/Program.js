define(["require","underscore","../i18n","../user","../core/Model"],function(t,e,r,n,o){"use strict";return o.extend({urlRoot:"/trw/programs",clientUrlRoot:"#trw/programs",topicPrefix:"trw.programs",privilegePrefix:"TRW",nlsDomain:"wmes-trw-programs",labelAttribute:"name",defaults:function(){return{steps:[],messages:[]}},url:function(){var t=o.prototype.url.apply(this,arguments);return this.isNew()?t:t+"?populate(base)"},serialize:function(){var e=this.toJSON();if(e.base&&e.base.name)e.base=e.base.name;else{var r=t("app/wmes-trw-tests/dictionaries").bases.get(e.base);r&&(e.base=r.get("name"))}return e},serializeDetails:function(){var t=this.constructor,e=this.serialize(),r=this.get("base");return e.steps=e.steps.map(function(e){return{source:t.formatEndpoint(e.source,r),target:t.formatEndpoint(e.target,r),color:t.formatColor(e.color,"?"),length:t.formatLength(e.length,"?")}}),e},serializeForm:function(){var t=this.toJSON();return t.base&&t.base._id&&(t.base=t.base._id),t},getStep:function(t){return e.find(this.attributes.steps,function(e){return e._id===t})},getStepIndex:function(t){return e.findIndex(this.attributes.steps,function(e){return e._id===t})},getCluster:function(t){var r=this.get("base");return r?e.find(r.clusters,function(e){return e._id===t}):null},getMessage:function(t){return e.find(this.attributes.messages,function(e){return e._id===t})}},{can:{manage:function(){return n.isAllowedTo("TRW:PROGRAM","TRW:MANAGE")}},COLORS:["white","brown","black","red","purple","blue","orange","pink","grey","green","yellow"],ENDPOINT_TO_ANCHOR:{top:"Top",left:"Left",right:"Right",bottom:"Bottom"},formatColor:function(t,e){return t.length?1===t.length?r("wmes-trw-programs","colors:"+t[0]):t.map(function(e,n){return r("wmes-trw-programs","colors:"+e+(n+1===t.length?"":":multi"))}).join("-"):e||""},formatLength:function(t,e){return t>0?t+"mm":e||""},formatEndpoint:function(t,r){if(!t)return"?";if(!r)return this.formatUnknownEndpoint(t);var n=e.find(r.clusters,function(e){return e._id===t.cluster});if(!n||!n.rows[t.row]||!n.rows[t.row][t.col])return this.formatUnknownEndpoint(t);var o=n.rows[t.row][t.col];return n.label.text+(/[0-9]$/.test(n.label.text)?":":"")+o.label||this.formatUnknownEndpoint(t)},formatUnknownEndpoint:function(t){return t.cluster?[t.cluster,t.row,t.col].join(":"):"?"},formatEndpointUuid:function(t){return[t.cluster,t.row,t.col,t.endpoint].join(":")},formatMessage:function(t,e){var r=[],n=[],o=["align-items: "+t.vAlign,"justify-content: "+t.hAlign];return e&&r.push("is-editable"),null===t.top?r.push("is-centered-top"):n.push("top: "+t.top+"px"),null===t.left?r.push("is-centered-left"):n.push("left: "+t.left+"px"),null!==t.width&&o.push("width: "+t.width+"px"),null!==t.height&&o.push("height: "+t.height+"px"),t.fontSize&&o.push("font-size: "+t.fontSize+"px"),t.fontColor&&o.push("color: "+t.fontColor),t.bgColor&&o.push("background: "+t.bgColor),t.borderColor&&o.push("border-color: "+t.borderColor),t.borderWidth&&(n.push("outline-offset: -"+t.borderWidth+"px"),o.push("border-width: "+t.borderWidth+"px","border-style: solid")),{id:t._id,text:t.text,className:r.join(" "),outerStyle:n.join("; "),innerStyle:o.join("; "),editable:e}}})});