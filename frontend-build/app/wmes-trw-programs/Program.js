define(["underscore","../core/Model"],function(e,t){"use strict";function r(e){return(e||"").replace(/<(#.*?)>(.*?)<\/>/g,function(e,t,r){var n=[];return t.split(/\s+/).forEach(function(e,t){/^#([A-F0-9]{3}|[A-F0-9]{6})$/.test(e)?n.push((0===t?"color: ":"background-color: ")+e):/^#[a-z]+$/.test(e)?n.push((0===t?"color: ":"background-color: ")+e.substring(1)):"bold"===e?n.push("font-weight: bold"):"italic"===e||"oblique"===e?n.push("font-style: "+e):"line-through"!==e&&"underline"!==e&&"overline"!==e||n.push("text-decoration: "+e)}),'<span style="'+n.join("; ")+'">'+r+"</span>"})}return t.extend({urlRoot:"/trw/programs",clientUrlRoot:"#trw/programs",topicPrefix:"trw.programs",privilegePrefix:"TRW",nlsDomain:"wmes-trw-programs",labelAttribute:"name",url:function(){var e=t.prototype.url.apply(this,arguments);return this.isNew()?e:e+"?populate(tester)"},serialize:function(){var e=this.toJSON();return e.tester&&e.tester.name&&(e.tester=e.tester.name),e},serializeDetails:function(){var t=this.serialize(),n=this.get("tester"),o={};return(n&&n.io||[]).forEach(function(e){o[e._id]=e.name}),t.steps=t.steps.map(function(t){return e.defaults({name:r(t.name),description:r(t.description),setIo:t.setIo.map(function(e){return"▪ "+(o[e]||e)}).join(" &nbsp; "),checkIo:t.checkIo.map(function(e){return"▪ "+(o[e]||e)}).join(" &nbsp; ")},t)}),t},serializeForm:function(){var e=this.toJSON();return e.tester&&e.tester._id&&(e.tester=e.tester._id),e.steps=(e.steps||[]).map(function(e){return{name:e.name,description:e.description,setIo:e.setIo.join(","),checkIo:e.checkIo.join(",")}}),e}},{colorize:r})});