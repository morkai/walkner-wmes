define(["require","underscore","../i18n","../user","../core/Model"],function(t,r,e,n,o){"use strict";return o.extend({urlRoot:"/trw/programs",clientUrlRoot:"#trw/programs",topicPrefix:"trw.programs",privilegePrefix:"TRW",nlsDomain:"wmes-trw-programs",labelAttribute:"name",defaults:function(){return{steps:[]}},url:function(){var t=o.prototype.url.apply(this,arguments);return this.isNew()?t:t+"?populate(base)"},serialize:function(){var r=this.toJSON();if(r.base&&r.base.name)r.base=r.base.name;else{var e=t("app/wmes-trw-tests/dictionaries").bases.get(r.base);e&&(r.base=e.get("name"))}return r},serializeDetails:function(){var t=this.constructor,r=this.serialize(),e=this.get("base");return r.steps=r.steps.map(function(r){return{source:t.formatEndpoint(r.source,e),target:t.formatEndpoint(r.target,e),color:t.formatColor(r.color,"?"),length:t.formatLength(r.length,"?")}}),r},serializeForm:function(){var t=this.toJSON();return t.base&&t.base._id&&(t.base=t.base._id),t},getStep:function(t){return r.find(this.attributes.steps,function(r){return r._id===t})},getStepIndex:function(t){return r.findIndex(this.attributes.steps,function(r){return r._id===t})},getCluster:function(t){var e=this.get("base");return e?r.find(e.clusters,function(r){return r._id===t}):null}},{can:{manage:function(){return n.isAllowedTo("TRW:PROGRAM","TRW:MANAGE")}},COLORS:["white","brown","black","red","purple","blue","orange","pink","grey","green","yellow"],ENDPOINT_TO_ANCHOR:{top:"Top",left:"Left",right:"Right",bottom:"Bottom"},formatColor:function(t,r){return t.length?1===t.length?e("wmes-trw-programs","colors:"+t[0]):t.map(function(r,n){return e("wmes-trw-programs","colors:"+r+(n+1===t.length?"":":multi"))}).join("-"):r||""},formatLength:function(t,r){return t>0?t+"mm":r||""},formatEndpoint:function(t,e){if(!t)return"?";if(!e)return this.formatUnknownEndpoint(t);var n=r.find(e.clusters,function(r){return r._id===t.cluster});if(!n||!n.rows[t.row]||!n.rows[t.row][t.col])return this.formatUnknownEndpoint(t);var o=n.rows[t.row][t.col];return n.label.text+(/[0-9]$/.test(n.label.text)?":":"")+o.label||this.formatUnknownEndpoint(t)},formatUnknownEndpoint:function(t){return t.cluster?[t.cluster,t.row,t.col].join(":"):"?"},formatEndpointUuid:function(t){return[t.cluster,t.row,t.col,t.endpoint].join(":")}})});