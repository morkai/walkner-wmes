define(["underscore","app/core/views/FormView","app/wmes-orders-productTags/templates/form","app/wmes-orders-productTags/templates/conditionRow"],function(t,i,n,o){"use strict";return i.extend({template:n,events:t.assign({"input #-conditions .form-control":function(){this.firstConditionEl.setCustomValidity("")},"click #-addCondition":function(){this.addCondition({mrp:[],nc12:[],bom:[]})},'click .btn[data-action="removeCondition"]':function(t){this.$id("conditions").children().length>1&&(this.$(t.target).closest("tr").remove(),this.firstConditionEl.setCustomValidity(""))}},i.prototype.events),initialize:function(){this.conditionI=-1},afterRender:function(){i.prototype.afterRender.apply(this,arguments);var t=this.model.get("conditions")||[];t.forEach(this.addCondition,this),0===t.length&&this.$id("addCondition").click(),this.firstConditionEl=this.$id("conditions").find(".form-control").first()[0]},addCondition:function(t){this.$id("conditions").append(this.renderPartialHtml(o,{i:++this.conditionI,condition:t}))},checkValidity:function(t){var i=this;return 0!==t.conditions.length||(i.firstConditionEl.setCustomValidity(i.t("conditions:invalid")),setTimeout(function(){i.$(".btn-primary").click()},1),!1)},serializeForm:function(i){return i.conditions=(i.conditions||[]).filter(function(i){return i.mrp=t.uniq((i.mrp||"").toUpperCase().split(/[\s,]+/g).filter(function(t){return/^[A-Z0-9]+$/.test(t)})),i.nc12=t.uniq((i.nc12||"").toUpperCase().split(/[\s,]+/g).filter(function(t){return/^([A-Z0-9]{7}|[0-9]{12})$/.test(t)})),i.bom=t.uniq((i.bom||"").split(/[\s,]+/g).filter(function(t){return/^[0-9]{12}$/.test(t)})),i.mrp.length>0||i.nc12.length>0||i.bom.length>0}),i}})});