define(["jquery","../broker","../router","../viewport","../user","../time"],function(e,a,r,t,n,s){"use strict";var i=["css!app/paintShop/assets/main","css!app/planning/assets/main","css!app/wh/assets/main"],p=["i18n!app/nls/wh","i18n!app/nls/wh-lines","i18n!app/nls/planning","i18n!app/nls/paintShop"],o=n.auth("LOCAL","WH:VIEW"),u=n.auth("WH:MANAGE","WH:MANAGE:USERS");r.map("/wh/pickup/:id",o,function(e){/^-?[0-9]+d$/.test(e.params.id)&&(e.params.id=s.getMoment().subtract(s.getMoment().hours()<6?1:0,"days").startOf("day").add(+e.params.id.replace("d",""),"days").format("YYYY-MM-DD"),a.publish("router.navigate",{url:"/wh/pickup/"+e.params.id,replace:!0,trigger:!1}));var r={date:e.params.id,focus:null,from:void 0===e.query.from?"06:00":e.query.from,to:void 0===e.query.to?"06:00":e.query.to};e.query.order?r.focus={type:"order",order:e.query.order}:e.query.set&&(r.focus={type:"set",order:e.query.set}),["whStatuses","psStatuses","distStatuses","orders","lines","mrps","sets"].forEach(function(a){r[a]=void 0===e.query[a]?null:e.query[a].split(",").filter(function(e){return e.length>0})}),t.loadPage(["app/wh/pages/WhPickupPage"].concat(i,p),function(e){return new e(r)})}),r.map("/wh/problems",o,function(){t.loadPage(["app/wh/pages/WhProblemsPage"].concat(i,p),function(e){return new e})}),r.map("/wh/delivery/:kind",o,function(e){t.loadPage(["app/wh/pages/WhDeliveryPage"].concat(i,p),function(a){return new a({kind:e.params.kind})})}),r.map("/wh/settings",u,function(e){t.loadPage(["app/wh/pages/WhSettingsPage"].concat(p),function(a){return new a({initialTab:e.query.tab})})}),r.map("/wh/pickup;jump-to-order",o,function(r){t.msg.loading();var n=r.query.order,i=e.ajax({url:"/orders/"+n+"?select(scheduledStartDate)"});i.fail(function(){t.msg.loaded(),a.publish("viewport.page.loadingFailed",{page:null,xhr:i})}),i.done(function(e){t.msg.loaded();var r=s.getMoment(e.scheduledStartDate).format("YYYY-MM-DD");a.publish("router.navigate",{url:"/wh/pickup/"+r+"?&orders="+n,trigger:!0,replace:!0})})})});