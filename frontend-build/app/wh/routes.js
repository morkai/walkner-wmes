define(["../broker","../router","../viewport","../user","../time"],function(e,a,t,n,r){"use strict";var s=["css!app/paintShop/assets/main","css!app/planning/assets/main","css!app/wh/assets/main"],p=["i18n!app/nls/wh","i18n!app/nls/wh-lines","i18n!app/nls/planning","i18n!app/nls/paintShop"],i=n.auth("LOCAL","WH:VIEW"),o=n.auth("WH:MANAGE","WH:MANAGE:USERS");a.map("/wh/pickup/:id",i,function(a){/^-?[0-9]+d$/.test(a.params.id)&&(a.params.id=r.getMoment().subtract(r.getMoment().hours()<6?1:0,"days").startOf("day").add(+a.params.id.replace("d",""),"days").format("YYYY-MM-DD"),e.publish("router.navigate",{url:"/wh/pickup/"+a.params.id,replace:!0,trigger:!1}));var n={date:a.params.id,focus:null,from:void 0===a.query.from?"06:00":a.query.from,to:void 0===a.query.to?"06:00":a.query.to};a.query.order?n.focus={type:"order",order:a.query.order}:a.query.set&&(n.focus={type:"set",order:a.query.set}),["whStatuses","psStatuses","distStatuses","orders","lines","mrps","sets"].forEach(function(e){n[e]=void 0===a.query[e]?null:a.query[e].split(",").filter(function(e){return e.length>0})}),t.loadPage(["app/wh/pages/WhPickupPage"].concat(s,p),function(e){return new e(n)})}),a.map("/wh/problems",i,function(){t.loadPage(["app/wh/pages/WhProblemsPage"].concat(s,p),function(e){return new e})}),a.map("/wh/delivery/:kind",i,function(e){t.loadPage(["app/wh/pages/WhDeliveryPage"].concat(s,p),function(a){return new a({kind:e.params.kind})})}),a.map("/wh/settings",o,function(e){t.loadPage(["app/wh/pages/WhSettingsPage"].concat(p),function(a){return new a({initialTab:e.query.tab})})})});