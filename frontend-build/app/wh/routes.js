define(["../broker","../router","../viewport","../user","../time"],function(a,n,e,t,i){"use strict";var p=["css!app/wh/assets/main","css!app/planning/assets/main","css!app/paintShop/assets/main"],r=["i18n!app/nls/wh","i18n!app/nls/wh-lines","i18n!app/nls/planning","i18n!app/nls/paintShop"],s=t.auth("LOCAL","WH:VIEW"),o=t.auth("WH:MANAGE","WH:MANAGE:USERS");n.map("/wh/pickup/:id",s,function(n){/^-?[0-9]+d$/.test(n.params.id)&&(n.params.id=i.getMoment().subtract(i.getMoment().hours()<6?1:0,"days").startOf("day").add(+n.params.id.replace("d",""),"days").format("YYYY-MM-DD"),a.publish("router.navigate",{url:"/wh/pickup/"+n.params.id,replace:!0,trigger:!1}));var t={date:n.params.id,focus:n.query.focus,from:void 0===n.query.from?"06:00":n.query.from,to:void 0===n.query.to?"06:00":n.query.to};["whStatuses","psStatuses"].forEach(function(a){t[a]=void 0===n.query[a]?null:n.query[a].split(",").filter(function(a){return a.length>0})}),e.loadPage(["app/wh/pages/WhPickupPage"].concat(p,r),function(a){return new a(t)})}),n.map("/wh/problems",s,function(){e.loadPage(["app/wh/pages/WhProblemsPage"].concat(p,r),function(a){return new a})}),n.map("/wh/delivery/:kind",s,function(a){e.loadPage(["app/wh/pages/WhDeliveryPage"].concat(p,r),function(n){return new n({kind:a.params.kind})})}),n.map("/wh/settings",o,function(a){e.loadPage(["app/wh/pages/WhSettingsPage"].concat(r),function(n){return new n({initialTab:a.query.tab})})})});