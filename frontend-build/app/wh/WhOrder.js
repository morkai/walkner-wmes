define(["app/i18n","app/time","app/user","app/core/Model","app/planning/util/shift","app/planning/templates/orderStatusIcons"],function(t,e,i,n,s,a){"use strict";var r={pending:"default",started:"info",finished:"success",problem:"danger",cancelled:"warning"},u={pending:"fa-question",picklist:"fa-file-text-o",pickup:"fa-shopping-cart",problem:"fa-thumbs-down",finished:"fa-thumbs-up"},c={fmx:0,kitter:1,packer:2};return n.extend({urlRoot:"/wh/orders",topicPrefix:"wh.orders",privilegePrefix:"WH",nlsDomain:"wh",serialize:function(t,i){var n=this.toJSON(),c=t.orders.get(n.order),o=t.sapOrders.get(n.order),p=Date.parse(n.startTime),l=Date.parse(n.finishTime);return n.no=i+1,n.shift=s.getShiftNo(p),c?(n.mrp=c.get("mrp"),n.nc12=c.get("nc12"),n.name=c.get("name"),n.qtyTodo=c.get("quantityTodo"),n.planStatus=c.getStatus(),n.planStatusIcons=a(t,c.id)):(n.mrp="?",n.nc12="?",n.name="?",n.qtyTodo=0,n.planStatus="unplanned",n.planStatusIcons="?"),n.startTime=e.utc.format(p,"HH:mm:ss"),n.finishTime=e.utc.format(l,"HH:mm:ss"),n.comment=o?o.getCommentWithIcon():"",n.comments=o?o.get("comments"):[],n.rowClassName=r[n.status],n.funcIcons={fmx:u[n.funcs[0].status],kitter:u[n.funcs[1].status],packer:u[n.funcs[2].status]},n},serializeSet:function(t,e,n){var s=this.serialize(t,e),a=i.isAllowedTo("WH:MANAGE"),r=this.getUserFunc(n),u=!!r;return s.clickable={picklistDone:a||u&&r._id===s.picklistFunc&&null===s.picklistDone},s.funcs.forEach(function(t){s.clickable[t._id]={picklist:a&&s.picklistDone||s.picklistDone&&u&&r._id===t._id&&"picklist"===t.status,pickup:a&&null!==s.picklistDone&&"require"===t.picklist||s.picklistDone&&u&&r._id===t._id&&"pickup"===t.status}}),s.clickable.printLabels=a||u,s},update:function(t){this.set(t)},getFunc:function(t){return this.attributes.funcs[c[t]]||null},getUserFunc:function(t){if(!t)return null;var e=this.attributes.funcs[c[t.func]];return e.user&&e.user.id===t._id?e:null}},{FUNC_TO_INDEX:c})});