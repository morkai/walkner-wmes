define(["app/i18n","app/time","app/user","app/core/Model","app/planning/util/shift","app/planning/templates/orderStatusIcons"],function(t,e,i,s,n,a){"use strict";var r={pending:"default",started:"info",finished:"success",problem:"danger",cancelled:"warning"},c={pending:"fa-question",picklist:"fa-file-text-o",pickup:"fa-shopping-cart",problem:"fa-thumbs-down",finished:"fa-thumbs-up"},u={fmx:0,kitter:1,packer:2};return s.extend({urlRoot:"/wh/orders",topicPrefix:"wh.orders",privilegePrefix:"WH",nlsDomain:"wh",serialize:function(t,i){var s=this.toJSON(),u=t.orders.get(s.order),p=t.sapOrders.get(s.order),o=Date.parse(s.startTime),l=Date.parse(s.finishTime);return s.no=i+1,s.shift=n.getShiftNo(o),u?(s.mrp=u.get("mrp"),s.nc12=u.get("nc12"),s.name=u.get("name"),s.qtyTodo=u.get("quantityTodo"),s.planStatus=u.getStatus(),s.planStatusIcons=a(t,u.id)):(s.mrp="?",s.nc12="?",s.name="?",s.qtyTodo=0,s.planStatus="unplanned",s.planStatusIcons="?"),s.startTime=e.utc.format(o,"HH:mm:ss"),s.finishTime=e.utc.format(l,"HH:mm:ss"),s.comment=p?p.getCommentWithIcon():"",s.comments=p?p.get("comments"):[],s.rowClassName=r[s.status],s.funcIcons={fmx:c[s.funcs[0].status],kitter:c[s.funcs[1].status],packer:c[s.funcs[2].status]},s},serializeSet:function(t,e,s){var n=this.serialize(t,e),a=i.isAllowedTo("WH:MANAGE"),r=this.getUserFunc(s),c=!!r;return n.clickable={picklistDone:a||c&&r._id===n.picklistFunc&&null===n.picklistDone},n.funcs.forEach(function(t){n.clickable[t._id]={picklist:a&&n.picklistDone||n.picklistDone&&c&&r._id===t._id&&"picklist"===t.status,pickup:a&&null!==n.picklistDone&&"require"===t.picklist||n.picklistDone&&c&&r._id===t._id&&"pickup"===t.status}}),n.clickable.printLabels=a||c,n},update:function(t){this.set(t)},getUserFunc:function(t){if(!t)return null;var e=this.attributes.funcs[u[t.func]];return e.user&&e.user.id===t._id?e:null}},{FUNC_TO_INDEX:u})});