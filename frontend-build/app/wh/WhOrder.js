// Part of <https://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

define(["app/i18n","app/time","app/user","app/core/Model","app/planning/util/shift","app/planning/templates/orderStatusIcons"],function(t,e,i,s,n,r){"use strict";var a={pending:"default",started:"info",finished:"success",problem:"danger",cancelled:"warning"},u={pending:"fa-question",picklist:"fa-file-text-o",pickup:"fa-shopping-cart",problem:"fa-thumbs-down",finished:"fa-thumbs-up"},c={fmx:0,kitter:1,packer:2};return s.extend({urlRoot:"/wh/orders",topicPrefix:"wh.orders",privilegePrefix:"WH",nlsDomain:"wh",serialize:function(t,i){var s=this.toJSON(),c=t.orders.get(s.order),o=t.sapOrders.get(s.order),p=Date.parse(s.startTime),f=Date.parse(s.finishTime);return s.no=i+1,s.shift=n.getShiftNo(p),s.mrp=c.get("mrp"),s.nc12=c.get("nc12"),s.name=c.get("name"),s.qtyTodo=c.get("quantityTodo"),s.startTime=e.utc.format(p,"HH:mm:ss"),s.finishTime=e.utc.format(f,"HH:mm:ss"),s.comment=o?o.getCommentWithIcon():"",s.comments=o?o.get("comments"):[],s.planStatus=c.getStatus(),s.planStatusIcons=r(t,c.id),s.rowClassName=a[s.status],s.funcIcons={fmx:u[s.funcs[0].status],kitter:u[s.funcs[1].status],packer:u[s.funcs[2].status]},s},serializeSet:function(t,e,i){var s=this.serialize(t,e),n=this.getUserFunc(i),r=!!n;return s.clickable={picklistDone:r&&n._id===s.picklistFunc},s.funcs.forEach(function(t){s.clickable[t._id]={picklist:s.picklistDone&&r&&n._id===t._id&&"picklist"===s.funcs[0].status,pickup:s.picklistDone&&r&&n._id===t._id&&"pickup"===s.funcs[0].status}}),s},update:function(t){this.set(t)},getUserFunc:function(t){if(!t)return null;var e=this.attributes.funcs[c[t.func]];return e.user&&e.user.id===t._id?e:null}})});