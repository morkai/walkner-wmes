// Part of <https://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

define(["underscore","jquery","../time","../core/Collection","./WhOrder"],function(t,e,n,r,a){"use strict";function i(){return n.utc.getMoment(Date.now()).startOf("day").subtract(n.getMoment().hours()<6?1:0,"days").format("YYYY-MM-DD")}return r.extend({model:a,paginate:!1,initialize:function(e,n){n=t.assign({date:i()},n),this.date=n.date},setCurrentDate:function(){this.date=i()},url:function(){return"/wh/orders?sort(group,line,startTime)&date="+n.utc.getMoment(this.date,"YYYY-MM-DD").valueOf()},serialize:function(t){var e=null;return this.map(function(n,r){var a=n.serialize(t,r);return e&&(a.newGroup=a.group!==e.group,a.newLine=a.line!==e.line),e=a,a})},update:function(t){for(var e=0;e<t.length;++e){var n=t[e],r=this.get(n._id);r&&r.update(n)}},act:function(t,n){return e.ajax({method:"POST",url:"/wh/plans/"+this.date+";act",data:JSON.stringify({action:t,data:n})})}})});