define(["underscore","jquery","../time","../core/Collection","./WhOrder"],function(t,e,n,r,i){"use strict";function a(){return n.utc.getMoment(Date.now()).startOf("day").subtract(n.getMoment().hours()<6?1:0,"days").format("YYYY-MM-DD")}return r.extend({model:i,paginate:!1,initialize:function(e,n){n=t.assign({date:a()},n),this.date=n.date},setCurrentDate:function(){this.date=a()},url:function(){return this.date?"/wh/orders?sort(group,line,startTime)&date="+n.utc.getMoment(this.date,"YYYY-MM-DD").valueOf():"/wh/orders"},getFilters:function(t){return{whStatuses:t.displayOptions.get("whStatuses")||[],startTime:t.displayOptions.getStartTimeRange(t.id)}},serialize:function(t){var e=null,n=this.getFilters(t);return this.map(function(r,i){var a=r.serialize(t,i,n);return e&&(a.newGroup=a.group!==e.group,a.newLine=a.line!==e.line),e=a,a})},update:function(t){for(var e=0;e<t.length;++e){var n=t[e],r=this.get(n._id);r&&r.update(n)}},act:function(t,e){return this.constructor.act(e.date||this.date,t,e)}},{act:function(t,r,i){return/^[0-9]{4}-[0-9]{2}-[0-9]{2}$/.test(t)||(t=n.utc.format(t,"YYYY-MM-DD")),e.ajax({method:"POST",url:"/wh/plans/"+t+";act",data:JSON.stringify({action:r,data:i})})}})});