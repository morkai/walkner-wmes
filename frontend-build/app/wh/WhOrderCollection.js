// Part of <https://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

define(["underscore","../time","../core/Collection","./WhOrder"],function(t,e,n,r){"use strict";function i(){return e.utc.getMoment(Date.now()).startOf("day").subtract(e.getMoment().hours()<6?1:0,"days").format("YYYY-MM-DD")}return n.extend({model:r,paginate:!1,initialize:function(e,n){n=t.assign({date:i()},n),this.date=n.date},setCurrentDate:function(){this.date=i()},url:function(){return"/wh/orders?sort(group,line,startTime)&date="+e.utc.getMoment(this.date,"YYYY-MM-DD").valueOf()},serialize:function(t){var e=null;return this.map(function(n,r){var i=n.serialize(t,r);return e&&(i.newGroup=i.group!==e.group,i.newLine=i.line!==e.line),e=i,i})},update:function(t){for(var e=0;e<t.length;++e){var n=t[e],r=this.get(n._id);r&&r.update(n)}}})});