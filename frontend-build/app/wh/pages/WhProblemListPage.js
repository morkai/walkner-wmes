define(["underscore","jquery","app/i18n","app/user","app/viewport","app/time","app/core/Model","app/core/View","app/core/util/bindLoadingMessage","app/planning/Plan","app/planning/PlanSettings","app/planning/PlanDisplayOptions","../settings","../WhOrderCollection","../views/WhProblemFilterView","../views/WhProblemListView","app/wh/templates/problemListPage"],function(e,t,i,s,n,r,o,a,h,d,l,c,p,u,f,w,g){"use strict";return a.extend({template:g,layoutName:"page",breadcrumbs:function(){return[{label:this.t("BREADCRUMBS:base")},{label:this.t("BREADCRUMBS:problems")}]},actions:function(){return window.IS_EMBEDDED?[]:[{label:this.t("PAGE_ACTION:settings"),icon:"cogs",privileges:"WH:MANAGE",href:"#wh/settings"}]},remoteTopics:{"wh.orders.changed.*":function(e){var t=this;e.changes.changed.forEach(function(e){var i=t.whOrders.get(e._id);i&&(e.status&&"problem"!==e.status?t.whOrders.remove(i):i.set(e))}),e.changes.removed.forEach(function(e){t.whOrders.remove(e)})},"wh.orders.updated":function(e){var t=this;e.orders.forEach(function(e){var i=t.whOrders.get(e._id);if(i)return"problem"!==e.status?void t.whOrders.remove(i):void i.set(e);"problem"===e.status&&t.whOrders.add(e)})}},localTopics:{"socket.connected":function(){this.$el.removeClass("wh-is-disconnected"),this.load()},"socket.disconnected":function(){this.$el.addClass("wh-is-disconnected")}},initialize:function(){this.defineModels(),this.defineViews(),this.defineBindings()},destroy:function(){t(document).off("."+this.idPrefix),t(window).off("."+this.idPrefix),p.release()},setUpLayout:function(e){this.layout=e},defineModels:function(){this.displayOptions=c.fromLocalStorage({},{storageKey:"PLANNING:DISPLAY_OPTIONS:WH"}),this.whSettings=h(p.acquire(),this),this.whOrders=h(new u(null,{date:null,rqlQuery:"sort(startTime)&limit(0)&status=problem"}),this),this.model=this.whOrders},defineViews:function(){this.filterView=new f({displayOptions:this.displayOptions}),this.listView=new w({whSettings:this.whSettings,whOrders:this.whOrders}),this.setView("#-list",this.listView)},defineBindings:function(){this.listenTo(this.displayOptions,"change:useDarkerTheme",this.onDarkerThemeChanged)},load:function(e){return e(this.whSettings.fetchIfEmpty(),this.whOrders.fetch({reset:!0}))},getTemplateData:function(){return{darker:this.displayOptions.isDarkerThemeUsed()}},afterRender:function(){p.acquire()},onDarkerThemeChanged:function(){this.$el.toggleClass("planning-darker",this.displayOptions.isDarkerThemeUsed())}})});