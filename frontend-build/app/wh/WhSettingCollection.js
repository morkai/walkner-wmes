define(["underscore","jquery","../user","../data/orgUnits","../settings/SettingCollection","./WhSetting"],function(e,t,i,n,r,o){"use strict";var u=new RegExp(["maxSetSize","minSetDuration","maxSetDuration","maxSetDifference","groupDuration","groupExtraItems","minPickupDowntime","maxPickupDowntime","maxSetsPerLine","minTimeForDelivery","lateDeliveryTime","minDeliveryDowntime","maxDeliveryDowntime","maxSetCartsPerDelivery"].join("|"));return r.extend({model:o,topicSuffix:"wh.**",getValue:function(e){var t=this.get("wh."+e);return t?t.getValue():null},prepareValue:function(e,t){return u.test(e)?(t=Math.round(parseInt(t,10)),isNaN(t)||t<0?0:t):/Mrps$/.test(e)?t.split(",").filter(function(e){return!!e.length}):/ignorePsStatus/.test(e)?!!t:/lineGroups$/.test(e)?this.prepareLineGroups(t):void 0},prepareFormValue:function(e,t){return/lineGroups$/.test(e)?this.formatLineGroups(t):r.prototype.prepareFormValue.apply(this,arguments)},prepareLineGroups:function(e){var t={};(e||"").split("\n").forEach(function(e){var i=e.trim().split(":");if(2===i.length){var r=i[0].trim();r.length&&(t[r]||(t[r]={}),i[1].split(/[,;]+/).forEach(function(e){var i=n.getByTypeAndId("prodLine",e.trim());i&&(t[r][i.id]=1)}))}});var i=[];return Object.keys(t).forEach(function(e){i.push({_id:e,lines:Object.keys(t[e])})}),i},formatLineGroups:function(t){return t.map(function(t){return e.escape(t._id)+": "+t.lines.join(", ")}).join("\n")},getMinTimeForDelivery:function(){return 60*(this.getValue("planning.minTimeForDelivery")||45)*1e3},getLateDeliveryTime:function(){return 60*(this.getValue("planning.lateDeliveryTime")||30)*1e3}})});