define(["underscore","jquery","../user","../data/orgUnits","../settings/SettingCollection","./WhSetting"],function(e,t,i,r,n,a){"use strict";var o=new RegExp(["maxSetSize","minSetDuration","maxSetDuration","maxSetDifference","groupDuration","groupExtraItems","minPickupDowntime","maxPickupDowntime","maxSetsPerLine","minTimeForDelivery","maxDeliveryStartTime","lateDeliveryTime","minDeliveryDowntime","maxDeliveryDowntime","maxSetCartsPerDelivery","availableTimeThreshold"].join("|"));return n.extend({model:a,topicSuffix:"wh.**",getValue:function(e){var t=this.get("wh."+e);return t?t.getValue():null},prepareValue:function(e,t){return o.test(e)?(t=Math.round(parseInt(t,10)),isNaN(t)||t<0?0:t):/Mrps$/.test(e)?t.split(",").filter(function(e){return!!e.length}):/ignorePsStatus/.test(e)?!!t:/lineGroups$/.test(e)?this.prepareLineGroups(t):void 0},prepareFormValue:function(e,t){return/lineGroups$/.test(e)?this.formatLineGroups(t):n.prototype.prepareFormValue.apply(this,arguments)},prepareLineGroups:function(e){var t={};(e||"").split("\n").forEach(function(e){var i=e.trim().split(":");if(2===i.length){var n=i[0].trim();n.length&&(t[n]||(t[n]={}),i[1].split(/[,;]+/).forEach(function(e){var i=r.getByTypeAndId("prodLine",e.trim());i&&(t[n][i.id]=1)}))}});var i=[];return Object.keys(t).forEach(function(e){i.push({_id:e,lines:Object.keys(t[e])})}),i},formatLineGroups:function(t){return t.map(function(t){return e.escape(t._id)+": "+t.lines.join(", ")}).join("\n")},getMaxDeliveryStartTime:function(){return 60*(this.getValue("planning.maxDeliveryStartTime")||60)*1e3},getMinTimeForDelivery:function(){return 60*(this.getValue("planning.minTimeForDelivery")||45)*1e3},getLateDeliveryTime:function(){return 60*(this.getValue("planning.lateDeliveryTime")||30)*1e3}})});