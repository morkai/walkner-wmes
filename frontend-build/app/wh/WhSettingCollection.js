define(["underscore","jquery","../user","../data/orgUnits","../settings/SettingCollection","./WhSetting"],function(e,t,r,n,i,o){"use strict";var u=new RegExp(["maxSetSize","minSetDuration","maxSetDuration","maxSetDifference","groupDuration","groupExtraItems","minPickupDowntime","maxSetsPerLine"].join("|"));return i.extend({model:o,topicSuffix:"wh.**",getValue:function(e){var t=this.get("wh."+e);return t?t.getValue():null},prepareValue:function(e,t){return u.test(e)?(t=Math.round(parseInt(t,10)),isNaN(t)||t<0?0:t):/Mrps$/.test(e)?t.split(",").filter(function(e){return!!e.length}):/ignorePsStatus/.test(e)?!!t:/lineGroups$/.test(e)?this.prepareLineGroups(t):void 0},prepareFormValue:function(e,t){return/lineGroups$/.test(e)?this.formatLineGroups(t):i.prototype.prepareFormValue.apply(this,arguments)},prepareLineGroups:function(e){var t={};(e||"").split("\n").forEach(function(e){var r=e.trim().split(":");if(2===r.length){var i=r[0].trim();i.length&&(t[i]||(t[i]={}),r[1].split(/[,;]+/).forEach(function(e){var r=n.getByTypeAndId("prodLine",e.trim());r&&(t[i][r.id]=1)}))}});var r=[];return Object.keys(t).forEach(function(e){r.push({_id:e,lines:Object.keys(t[e])})}),r},formatLineGroups:function(t){return t.map(function(t){return e.escape(t._id)+": "+t.lines.join(", ")}).join("\n")}})});