define(["underscore","jquery","../user","../data/orgUnits","../settings/SettingCollection","./WhSetting"],function(e,t,r,i,n,o){"use strict";var u=new RegExp(["maxSetSize","minSetDuration","maxSetDuration","maxSetDifference","groupDuration","groupExtraItems","minPickupDowntime","maxSetsPerLine","minTimeForDelivery","lateDeliveryTime","minDeliveryDowntime","maxSetCartsPerDelivery"].join("|"));return n.extend({model:o,topicSuffix:"wh.**",getValue:function(e){var t=this.get("wh."+e);return t?t.getValue():null},prepareValue:function(e,t){return u.test(e)?(t=Math.round(parseInt(t,10)),isNaN(t)||t<0?0:t):/Mrps$/.test(e)?t.split(",").filter(function(e){return!!e.length}):/ignorePsStatus/.test(e)?!!t:/lineGroups$/.test(e)?this.prepareLineGroups(t):void 0},prepareFormValue:function(e,t){return/lineGroups$/.test(e)?this.formatLineGroups(t):n.prototype.prepareFormValue.apply(this,arguments)},prepareLineGroups:function(e){var t={};(e||"").split("\n").forEach(function(e){var r=e.trim().split(":");if(2===r.length){var n=r[0].trim();n.length&&(t[n]||(t[n]={}),r[1].split(/[,;]+/).forEach(function(e){var r=i.getByTypeAndId("prodLine",e.trim());r&&(t[n][r.id]=1)}))}});var r=[];return Object.keys(t).forEach(function(e){r.push({_id:e,lines:Object.keys(t[e])})}),r},formatLineGroups:function(t){return t.map(function(t){return e.escape(t._id)+": "+t.lines.join(", ")}).join("\n")},getMinTimeForDelivery:function(){return 60*(this.getValue("planning.minTimeForDelivery")||45)*1e3},getLateDeliveryTime:function(){return 60*(this.getValue("planning.lateDeliveryTime")||30)*1e3}})});