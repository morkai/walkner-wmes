define(["underscore","jquery","app/i18n","app/time","app/core/View","app/mrpControllers/util/setUpMrpSelect2","app/orgUnits/util/setUpOrgUnitSelect2","app/wh/templates/pickup/filter","app/core/util/ExpandableSelect"],function(e,t,s,i,a,n,l,r){"use strict";return a.extend({template:r,events:{"change #-whStatuses":"changeFilter","change #-psStatuses":"changeFilter","change #-distStatuses":"changeFilter","change #-from":"changeFilter","change #-to":"changeFilter","change #-orders":"scheduleChangeFilter","input #-orders":"scheduleChangeFilter","change #-lines":"changeFilter","change #-mrps":"changeFilter",'change input[name="filter"]':function(){this.toggleFilterVisibility(),this.changeFilter()},"click #-useDarkerTheme":function(){this.plan.displayOptions.toggleDarkerThemeUse()}},nlsDomain:"wh",initialize:function(){var e=this.plan,t=e.displayOptions;this.listenTo(e,"change:loading",this.onLoadingChanged),this.listenTo(t,"change:useDarkerTheme",this.updateToggles)},destroy:function(){this.$(".is-expandable").expandableSelect("destroy")},getTemplateData:function(){var e=this.plan.displayOptions,t=e.get("orders").join(" "),s=e.get("lines").join(","),i=e.get("mrps").join(","),a="orders";return t.length||(s.length?a="lines":i.length&&(a="mrps")),{whStatuses:e.get("whStatuses"),psStatuses:e.get("psStatuses"),distStatuses:e.get("distStatuses"),from:e.get("from"),to:e.get("to"),useDarkerTheme:e.isDarkerThemeUsed(),filter:a,orders:t,lines:s,mrps:i}},afterRender:function(){this.$(".is-expandable").expandableSelect(),this.setUpLinesFilter(),this.setUpMrpsFilter(),this.toggleFilterVisibility()},toggleFilterVisibility:function(){var e=this.$('input[name="filter"]:checked').val(),t=this.$id("orders"),s=this.$id("lines"),i=this.$id("mrps");"orders"===e?(s.prev().css("display","none"),i.prev().css("display","none"),t.removeClass("hidden").focus()):"lines"===e?(t.addClass("hidden"),i.prev().css("display","none"),s.prev().css("display",""),s.select2("focus")):"mrps"===e&&(t.addClass("hidden"),s.prev().css("display","none"),i.prev().css("display",""),i.select2("focus"))},setUpLinesFilter:function(){l(this.$id("lines"),{width:"698px",allowClear:!0,multiple:!0})},setUpMrpsFilter:function(){n(this.$id("mrps"),{view:this,width:"698px"})},updateToggles:function(){this.$id("useDarkerTheme").toggleClass("active",this.plan.displayOptions.isDarkerThemeUsed())},scheduleChangeFilter:function(){clearTimeout(this.timers.changeFilter),this.timers.changeFilter=setTimeout(this.changeFilter.bind(this),333)},changeFilter:function(){var t=this;clearTimeout(t.timers.changeFilter);var s=t.$id("whStatuses"),i=t.$id("psStatuses"),a=t.$id("distStatuses"),n={whStatuses:s.val(),psStatuses:i.val(),distStatuses:a.val(),from:t.$id("from").val()||"06:00",to:t.$id("to").val()||"06:00",orders:[],lines:[],mrps:[]};n.whStatuses&&n.whStatuses.length!==s[0].options.length||(n.whStatuses=[]),n.psStatuses&&n.psStatuses.length!==i[0].options.length||(n.psStatuses=[]),n.distStatuses&&n.distStatuses.length!==a[0].options.length||(n.distStatuses=[]);var l=t.$('input[name="filter"]:checked').val(),r="orders"===l;n[l]=t.$id(l).val().split(r?/[^0-9]+/:",").filter(function(e){return!!e&&(!r||/^[0-9]{9}$/.test(e))});var p={};["whStatuses","psStatuses","distStatuses","from","to","orders","lines","mrps"].forEach(function(s){e.isEqual(n[s],t.plan.displayOptions.get(s))||(p[s]=n[s])}),e.isEmpty(p)||t.plan.displayOptions.set(p)},onLoadingChanged:function(){var e=this,t=e.plan.get("loading");["whStatuses","psStatuses","distStatuses","from","to","orders"].forEach(function(s){e.$id(s).prop("disabled",t)}),e.$('input[name="filter"]').prop("disabled",t),e.$id("lines").select2("enable",!t),e.$id("mrps").select2("enable",!t)}})});