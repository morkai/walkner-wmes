define(["app/core/View","app/wh/templates/delivery/forceLine"],function(t,e){"use strict";return t.extend({template:e,nlsDomain:"wh",events:{submit:function(){var t=this.$(".active[data-line]");return!(!t.length||t.hasClass("hidden"))&&(this.trigger("picked",{line:t[0].dataset.line,card:this.$id("card").val().trim()}),!1)},"click .btn[data-line]":function(t){this.$(".active[data-line]").removeClass("active"),t.currentTarget.classList.add("active")},"input #-filter":function(){var t=this.transliterate(this.$id("filter").val().trim());this.$(".btn[data-line]").each(function(){this.classList.toggle("hidden",-1===this.dataset.filter.indexOf(t))})}},getTemplateData:function(){return{card:this.model.get("personnelId"),lines:this.serializeLines()}},serializeLines:function(){var t=this,e={};return t.setCarts.forEach(function(t){t.get("deliveringAt")||t.get("lines").forEach(function(t){e[t]=1})}),Object.keys(e).map(function(e){return{_id:e,filter:t.transliterate(e)}})},afterRender:function(){this.$(".btn[data-filter]").first().click()},onDialogShown:function(){var t=this.$(".active[data-filter]");t.length&&t[0].scrollIntoView()},transliterate:function(t){return t.toUpperCase().replace(/[^A-Z0-9]+/g,"")},getCard:function(){return this.$id("card").val().trim()},setCard:function(t){this.getCard()===t?this.$id("submit").click():this.$id("card").val(t)}})});