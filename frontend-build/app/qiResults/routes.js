// Part of <http://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

define(["underscore","../broker","../router","../viewport","../user","../time","../core/util/showDeleteFormPage","./QiResult"],function(e,t,i,a,r,s,n,u){"use strict";var o="i18n!app/nls/qiResults",l=r.auth("QI:RESULTS:VIEW"),p=r.auth("QI:INSPECTOR","QI:RESULTS:MANAGE"),d=r.auth("QI:INSPECTOR","QI:SPECIALIST","QI:RESULTS:MANAGE");i.map("/qi/reports/count",l,function(e){a.loadPage(["app/qiResults/QiCountReport","app/qiResults/pages/QiCountReportPage","i18n!app/nls/reports",o],function(t,i){return new i({model:t.fromQuery(e.query)})})}),i.map("/qi/reports/okRatio",l,function(e){a.loadPage(["app/qiResults/QiOkRatioReport","app/qiResults/pages/QiOkRatioReportPage","i18n!app/nls/reports",o],function(t,i){return new i({model:t.fromQuery(e.query)})})}),i.map("/qi/results",l,function(e){a.loadPage(["app/qiResults/QiResultCollection","app/qiResults/pages/QiResultListPage",o],function(t,i){return new i({collection:new t(null,{rqlQuery:e.rql})})})}),i.map("/qi/results;ok",l,function(){t.publish("router.navigate",{url:"/qi/results?sort(-inspectedAt,-rid)&limit(20)&ok=true",trigger:!0,replace:!0})}),i.map("/qi/results;nok",l,function(){t.publish("router.navigate",{url:"/qi/results?sort(-inspectedAt,-rid)&limit(20)&ok=false",trigger:!0,replace:!0})}),i.map("/qi/results/:id",l,function(e){a.loadPage(["app/qiResults/pages/QiResultDetailsPage",o],function(t){return new t({model:new u({_id:e.params.id})})})}),i.map("/qi/results;add",p,function(e){a.loadPage(["app/qiResults/pages/QiResultAddFormPage",o],function(t){return new t({model:new u({ok:"ok"===e.queryString,inspector:{id:r.data._id,label:r.getLabel()},inspectedAt:s.format(new Date,"YYYY-MM-DD"),qtyInspected:1,qtyToFix:0,qtyNok:0})})})}),i.map("/qi/results/:id;edit",d,function(e){a.loadPage(["app/qiResults/pages/QiResultEditFormPage",o],function(t){return new t({model:new u({_id:e.params.id})})})}),i.map("/qi/results/:id;delete",p,e.partial(n,u,e,e,{baseBreadcrumb:!0})),i.map("/qi/settings",r.auth("QI:DICTIONARIES:MANAGE"),function(e){a.loadPage(["app/qiResults/pages/QiSettingsPage",o],function(t){return new t({initialTab:e.query.tab})})})});