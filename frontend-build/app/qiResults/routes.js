define(["underscore","../broker","../router","../viewport","../user","../time","../core/util/showDeleteFormPage","../data/localStorage"],function(e,t,i,a,s,r,o,u){"use strict";var n="css!app/qiResults/assets/main",p="i18n!app/nls/qiResults",l=s.auth("QI:RESULTS:VIEW","FN:master","FN:leader","FN:manager","FN:wh"),R=s.auth("QI:INSPECTOR","QI:RESULTS:MANAGE","FN:leader","FN:wh"),d=s.auth("USER");i.map("/qi/reports/count",l,function(e){a.loadPage(["app/qiResults/QiCountReport","app/qiResults/pages/QiCountReportPage","i18n!app/nls/reports",n,p],function(t,i){return new i({model:t.fromQuery(e.query)})})}),i.map("/qi/reports/okRatio",l,function(e){a.loadPage(["app/qiResults/QiOkRatioReport","app/qiResults/pages/QiOkRatioReportPage","i18n!app/nls/reports",n,p],function(t,i){return new i({model:t.fromQuery(e.query)})})}),i.map("/qi/reports/nokRatio",l,function(e){a.loadPage(["app/qiResults/QiNokRatioReport","app/qiResults/pages/QiNokRatioReportPage","i18n!app/nls/reports",n,p],function(t,i){return new i({model:t.fromQuery(e.query)})})}),i.map("/qi/reports/outgoingQuality",l,function(e){a.loadPage(["app/qiResults/dictionaries","app/qiResults/QiOutgoingQualityReport","app/qiResults/pages/QiOutgoingQualityReportPage","i18n!app/nls/reports",n,p],function(t,i,a){return t.bind(new a({model:i.fromQuery(e.query)}))})}),i.map("/qi/results",l,function(e){a.loadPage(["app/qiResults/QiResultCollection","app/qiResults/pages/QiResultListPage",n,p],function(t,i){return new i({collection:new t(null,{rqlQuery:e.rql})})})}),i.map("/qi/results;ok",l,function(){t.publish("router.navigate",{url:"/qi/results?sort(-inspectedAt,-rid)&limit(-1337)&ok=true",trigger:!0,replace:!0})}),i.map("/qi/results;nok",l,function(){t.publish("router.navigate",{url:"/qi/results?sort(-inspectedAt,-rid)&limit(-1337)&ok=false",trigger:!0,replace:!0})}),i.map("/qi/results/:id",l,function(e){a.loadPage(["app/qiResults/QiResult","app/qiResults/pages/QiResultDetailsPage",n,p],function(t,i){return new i({model:new t({_id:e.params.id})})})}),i.map("/qi/results;add",R,function(e){a.loadPage(["app/qiResults/QiResult","app/qiResults/pages/QiResultAddFormPage",n,p],function(t,i){var a=null,o=null;return s.isAllowedTo("QI:INSPECTOR")?a=s.getInfo():s.isAllowedTo("FN:leader","FN:wh")&&(o=s.getInfo()),new i({model:new t({source:u.getItem("WMES_QI_SOURCE")||"prod",ok:"ok"===e.queryString,inspector:a,leader:o,inspectedAt:r.format(new Date,"YYYY-MM-DD"),qtyInspected:1,qtyToFix:0,qtyNok:0,qtyNokInspected:0})})})}),i.map("/qi/results/:id;edit",d,function(e){a.loadPage(["app/qiResults/QiResult","app/qiResults/pages/QiResultEditFormPage",n,p],function(t,i){return new i({model:new t({_id:e.params.id})})})}),i.map("/qi/results/:id;delete",R,e.partial(o,"app/qiResults/QiResult",e,e,{baseBreadcrumb:!0})),i.map("/qi/settings",s.auth("QI:DICTIONARIES:MANAGE"),function(e){a.loadPage(["app/qiResults/pages/QiSettingsPage",p],function(t){return new t({initialTab:e.query.tab})})})});