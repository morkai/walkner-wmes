// Part of <http://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

define(["underscore","../i18n","../time","../core/Model"],function(t,e,o,i){"use strict";return i.extend({urlRoot:"/qi/reports/nokRatio",defaults:function(){return{from:0,to:0}},fetch:function(e){return t.isObject(e)||(e={}),e.data=t.extend(e.data||{},t.pick(this.attributes,["from","to"])),i.prototype.fetch.call(this,e)},genClientUrl:function(){return"/qi/reports/nokRatio?from="+this.get("from")+"&to="+this.get("to")},parse:function(t){return{divisions:t.options.divisions,total:t.total,division:t.division}}},{fromQuery:function(t){var e=o.getMoment(+t.from).startOf("month"),i=o.getMoment(+t.to).startOf("month");return e.isValid()&&i.isValid()||(e.isValid()?i=e.clone().add(1,"years"):i.isValid()?e=i.clone().subtract(1,"years"):(e=o.getMoment().startOf("year"),i=e.clone().add(1,"years"))),(e.valueOf()===i.valueOf()||i.valueOf()<e.valueOf())&&(i=e.clone().add(1,"years")),new this({from:e.valueOf(),to:i.valueOf()})}})});