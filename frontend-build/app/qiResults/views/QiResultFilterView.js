define(["underscore","jquery","app/time","app/core/views/FilterView","app/core/util/idAndLabel","app/core/util/forms/dateTimeRange","app/data/orgUnits","app/users/util/setUpUserSelect2","app/qiResults/dictionaries","app/qiResults/templates/filter"],function(e,t,a,i,r,l,o,n,s,d){"use strict";return i.extend({filterList:["order","serialNumbers","productFamily","division","line","kind","errorCategory","faultCode","status","inspector","nokOwner","leader","coach","operator","limit"],filterMap:{orderNo:"order",nc12:"order",correctiveAction:"status",inspectorLeader:"inspector"},template:d,events:e.assign({"click a[data-date-time-range]":l.handleRangeEvent,"mouseup #-result > .btn":function(e){var t=e.currentTarget,a=t.firstElementChild;a.checked&&setTimeout(function(){t.classList.remove("active"),a.checked=!1},1)}},i.prototype.events),termToForm:{inspectedAt:l.rqlToForm,ok:function(e,t,a){a.result=t.args[1]?"ok":"nok"},nc12:function(e,t,a){a.order=t.args[1].replace(/[^A-Z0-9]+/g,"")},division:function(e,t,a){a[e]=t.args[1]},productFamily:function(e,t,a){a[e]="in"===t.name?t.args[1].join(","):t.args[1]},"inspector.id":function(e,t,a){a[e.split(".")[0]]="in"===t.name?t.args[1].join(","):t.args[1]},orderNo:"nc12",serialNumbers:"division","nokOwner.id":"inspector.id","leader.id":"inspector.id","coach.id":"inspector.id","operator.id":"inspector.id",line:"inspector.id",kind:"division",errorCategory:"division",faultCode:"productFamily","correctiveActions.status":"division"},serializeFormToQuery:function(e){var t=this,a=t.getButtonGroupValue("result"),i=t.$id("order").val().replace(/[^0-9A-Za-z]+/g,"").toUpperCase(),r=t.$id("serialNumbers").val().toUpperCase(),o=t.$id("productFamily").val(),n=t.$id("line").val(),s=t.$id("faultCode").val(),d=t.$id("status").val();l.formToRql(t,e),"ok"===a?e.push({name:"eq",args:["ok",!0]}):"nok"===a&&e.push({name:"eq",args:["ok",!1]}),9===i.length?e.push({name:"eq",args:["orderNo",i]}):/^([0-9]{12}|[A-Z][A-Z0-9]{6})$/.test(i)?e.push({name:"eq",args:["nc12",i]}):i.length&&e.push({name:"regex",args:["nc12","^"+i]}),19===r.length&&e.push({name:"eq",args:["serialNumbers",r]}),["inspector","nokOwner","leader","coach","operator"].forEach(function(a){var i=t.$id(a).val();i.length&&(-1===i.indexOf(",")?e.push({name:"eq",args:[a+".id",i]}):e.push({name:"in",args:[a+".id",i.split(",")]}))}),n.length&&(-1===n.indexOf(",")?e.push({name:"eq",args:["line",n]}):e.push({name:"in",args:["line",n.split(",")]})),o.length&&(-1===o.indexOf(",")?e.push({name:"eq",args:["productFamily",o]}):e.push({name:"in",args:["productFamily",o.split(",")]})),s.length&&(-1===s.indexOf(",")?e.push({name:"eq",args:["faultCode",s]}):e.push({name:"in",args:["faultCode",s.split(",")]})),d.length&&e.push({name:"eq",args:["correctiveActions.status",d]}),["division","kind","errorCategory"].forEach(function(a){var i=t.$id(a).val();i&&e.push({name:"eq",args:[a,i]})})},afterRender:function(){var e=this;i.prototype.afterRender.call(e),e.toggleButtonGroup("result"),e.$id("filters").select2({width:"175px"}),e.$id("productFamily").select2({width:"200px",allowClear:!0,multiple:!0,placeholder:" ",data:s.productFamilies.map(function(e){return{id:e,text:e}})}),e.$id("division").select2({width:"80px",allowClear:!0,placeholder:" ",data:o.getAllByType("division").filter(function(e){return"prod"===e.get("type")||"dist"===e.get("type")}).map(r)}),e.$id("line").select2({width:"175px",multiple:!0,allowClear:!0,placeholder:" ",data:o.getAllByType("prodLine").filter(function(e){return!e.get("deactivatedAt")}).map(r)}),e.$id("kind").select2({width:"200px",allowClear:!0,placeholder:" ",data:s.kinds.map(r)}),e.$id("errorCategory").select2({width:"140px",allowClear:!0,placeholder:" ",data:s.errorCategories.map(r)}),e.$id("faultCode").select2({width:"195px",allowClear:!0,multiple:!0,placeholder:" ",data:s.faults.map(r)}),e.$id("status").select2({width:"125px",allowClear:!0,placeholder:" ",data:s.actionStatuses.map(function(t){return{id:t,text:e.t("actionStatus:"+t)}})}),e.$id("inspector").select2({width:"230px",multiple:!0,allowClear:!0,placeholder:" ",data:s.inspectors.map(r)}),e.$id("nokOwner").select2({width:"230px",multiple:!0,allowClear:!0,placeholder:" ",data:s.masters.map(r)}),e.$id("leader").select2({width:"230px",multiple:!0,allowClear:!0,placeholder:" ",data:s.leaders.map(r)}),n(e.$id("coach"),{view:e,width:"230px",multiple:!0,allowClear:!0,placeholder:" ",noPersonnelId:!0}),n(e.$id("operator"),{view:e,width:"230px",multiple:!0,allowClear:!0,placeholder:" ",noPersonnelId:!0})},showFilter:function(e){"inspectedAt"!==e?i.prototype.showFilter.apply(this,arguments):this.$id("from-date").focus()}})});