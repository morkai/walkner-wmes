define(["underscore","jquery","app/i18n","app/time","app/core/views/ListView","app/core/util/html2pdf","app/printers/views/PrinterPickerView","../dictionaries","app/qiResults/templates/correctiveActionsTable"],function(e,t,i,s,a,r,n,o,l){"use strict";return a.extend({className:"qiResults-list is-clickable is-colored",events:e.assign({"click .action-print":function(e){var t=this,i=t.collection.get(this.$(e.target).closest("tr").attr("data-id"));return e.listAction={view:t,tag:"qi"},n.listAction(e,function(e){t.ajax({url:i.url()+".html",dataType:"html"}).done(function(t){r(t,{orientation:"landscape"},e)})}),!1},"click .is-filter":function(e){this.trigger("showFilter",e.currentTarget.dataset.columnId)}},a.prototype.events),destroy:function(){this.$el.popover("destroy")},serializeColumns:function(){var e=this.collection.hasAnyNokResult(),t=[{id:"rid",tdClassName:"is-min is-number",thClassName:"is-filter"},{id:"orderNo",tdClassName:"is-min is-number",thClassName:"is-filter"},{id:"nc12",tdClassName:"is-min text-mono",thClassName:"is-filter"},{id:"productFamily",tdClassName:"is-overflow w75",thClassName:"is-filter"},{id:"productName",tdClassName:"is-overflow w300"},{id:"division",tdClassName:"is-min",thClassName:"is-filter"},{id:"line",tdClassName:"is-min",thClassName:"is-filter"},{id:"kind",tdClassName:"is-overflow w200",thClassName:"is-filter"},{id:"inspectedAt",tdClassName:"is-min",thClassName:"is-filter"},{id:"inspectorLeader",tdClassName:"is-overflow w175",thClassName:"is-filter"}];return e&&t.push({id:"nokOwner",tdClassName:"is-overflow w175",thClassName:"is-filter"}),t.push({id:"qtyOrder",tdClassName:"is-min is-number"},{id:"qtyInspected",tdClassName:"is-min is-number"}),e&&t.push({id:"qtyNokInspected",tdClassName:"is-min is-number"},{id:"qtyToFix",tdClassName:"is-min is-number"},{id:"qtyNok",tdClassName:"is-min is-number"},{id:"errorCategory",tdClassName:"is-min",thClassName:"is-filter"},{id:"faultCode",tdClassName:"is-min has-popover",thClassName:"is-filter"},{id:"correctiveAction",label:this.t("PROPERTY:correctiveActions"),noData:"",thClassName:"is-filter",tdClassName:"is-overflow w250 has-popover"}),t.push("-"),t},serializeRows:function(){var e={dateFormat:"L",today:s.getMoment().startOf("day").hours(6).valueOf()};return this.collection.map(function(t){return t.serializeRow(o,e)})},serializeActions:function(){var e=this;return function(t){var i=e.collection.get(t._id),s=[a.actions.viewDetails(i)],r=i.url()+".pdf";return s.push({id:"print",icon:"print",label:e.t("PAGE_ACTION:print"),href:r,className:i.get("ok")?"disabled":""}),i.canEdit()&&s.push(a.actions.edit(i)),i.canDelete()&&s.push(a.actions.delete(i)),s}},afterRender:function(){var e=this;a.prototype.afterRender.apply(e,arguments),e.$el.popover({selector:".has-popover",container:this.el,trigger:"hover",placement:"auto left",html:!0,className:function(e){var t=["qiResults-list-popover"];return"correctiveAction"===e.$element[0].dataset.id&&t.push("is-correctiveAction"),t.join(" ")},title:function(){return""},content:function(){var t=e.collection.get(this.parentNode.dataset.id);if("faultCode"===this.dataset.id)return t.get("faultDescription");if("correctiveAction"===this.dataset.id){var i=t.get("correctiveActions");if(i&&i.length)return e.renderPartialHtml(l,{bordered:!1,correctiveActions:t.serializeCorrectiveActions(o)})}}})}})});