define(["underscore","app/time","app/core/View","app/reports/util/formatXAxis","app/qiResults/templates/outgoingQuality/paretoTable"],function(t,e,o,a,i){"use strict";return o.extend({template:i,initialize:function(){this.listenTo(this.model,"change:groups",this.render)},getTemplateData:function(){var o=this,a=o.options.property,i=[],r=o.model.getTopCount(),l=o.model.get("top")||{qtyNok:0},n=l[a]||[],s=o.model.get("groups")||[];return n.forEach(function(e){if(i.length!==r){var n={_id:e[0],label:e[0],title:o.options.resolveTitle?o.options.resolveTitle(e[0]):"",data:[],total:{absolute:e[1],relative:e[2],total:l.qtyNok}};s.forEach(function(e){var o=t.find(e[a],function(t){return t[0]===n._id});o?n.data.push({absolute:o[1],relative:o[2],total:e.qtyNok}):n.data.push({absolute:0,relative:0,total:e.qtyNok})}),n.data[n.data.length-1].absolute&&(n.data=n.data.slice(-3),i.push(n))}}),{property:a,weeks:s.slice(-1*r).map(function(t){return e.format(t.key,"[W]W")}),rows:i}}})});