define(["underscore","app/core/View","app/reports/util/formatXAxis","app/qiResults/templates/outgoingQuality/paretoTable"],function(t,e,o,a){"use strict";return e.extend({template:a,initialize:function(){this.listenTo(this.model,"change:groups",this.render)},getTemplateData:function(){for(var e=this,a=e.options.property,n=[],r=e.model.getTopCount(),i=e.model.get("top")||{nokCount:0},l=i[a]||[],s=e.model.get("groups")||[],u=0;u<r;++u){var p=l[u];if(!p)break;for(var d={_id:p[0],label:p[0],title:e.options.resolveTitle?e.options.resolveTitle(p[0]):"",data:[],total:{absolute:p[1],relative:p[2],total:i.nokCount}},f=s.length-r;f<s.length;++f){var g=s[f],c=t.find(g[a],function(t){return t[0]===d._id});c?d.data.push({absolute:c[1],relative:c[2],total:g.nokCount}):d.data.push({absolute:0,relative:0,total:g.nokCount})}n.push(d)}return{property:a,weeks:s.slice(-1*r).map(function(t){return o(e,{value:t.key})}),rows:n}}})});