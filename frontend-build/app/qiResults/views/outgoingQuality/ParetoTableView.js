define(["underscore","app/core/View","app/reports/util/formatXAxis","app/qiResults/templates/outgoingQuality/paretoTable"],function(t,e,o,a){"use strict";return e.extend({template:a,initialize:function(){this.listenTo(this.model,"change:groups",this.render)},getTemplateData:function(){for(var e=this,a=e.options.property,r=[],i=e.model.getTopCount(),l=e.model.get("top")||{qtyNok:0},n=l[a]||[],s=e.model.get("groups")||[],p=0;p<i;++p){var u=n[p];if(!u)break;for(var d={_id:u[0],label:u[0],title:e.options.resolveTitle?e.options.resolveTitle(u[0]):"",data:[],total:{absolute:u[1],relative:u[2],total:l.qtyNok}},f=s.length-i;f<s.length;++f){var g=s[f],c=t.find(g[a],function(t){return t[0]===d._id});c?d.data.push({absolute:c[1],relative:c[2],total:g.qtyNok}):d.data.push({absolute:0,relative:0,total:g.qtyNok})}r.push(d)}return{property:a,weeks:s.slice(-1*i).map(function(t){return o(e,{value:t.key})}),rows:r}}})});