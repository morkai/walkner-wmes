define(["underscore","jquery","app/time","app/viewport","app/core/View","app/reports/util/formatXAxis","app/qiResults/templates/outgoingQuality/ppmTable"],function(e,t,n,i,a,r,o){"use strict";return a.extend({template:o,events:{"click td[data-key]":function(e){var n=this,a=e.currentTarget,r=a.dataset.key,o=parseInt(a.textContent.trim(),10)||0;if(!a.querySelector(".fa-spinner")){var s=a.querySelector("input");if(s)s.focus();else{n.$("form").remove();var u=t("<form></form>"),p=t('<input type="number" class="form-control" min="0">').val(o),f=t('<button class="btn btn-primary"><i class="fa fa-save"></i></button>');u.append(p).append(f).on("submit",function(){var e=parseInt(p.val(),10)||0;if(u.remove(),e!==o){i.msg.saving(),a.style.textAlign="center",a.innerHTML='<i class="fa fa-spinner fa-spin"></i>';var t=n.ajax({method:"POST",url:"/qi/reports/outgoingQuality/weeks/"+r,data:JSON.stringify({target:e})});return t.fail(function(){i.msg.savingFailed(),a.innerHTML=o}),t.done(function(){i.msg.saved()}),t.always(function(){a.style.textAlign=""}),!1}}),u.appendTo(a),p.focus()}}}},initialize:function(){this.listenTo(this.model,"change:groups",this.render),t(window).on("keydown."+this.idPrefix,this.onKeyDown.bind(this))},destroy:function(){t(window).off("."+this.idPrefix)},getTemplateData:function(){return{canManage:this.model.canManage(),data:e.map(this.model.get("groups"),function(e){return{key:e.key,week:n.format(e.key,"[W]W"),oql:e.oql,target:e.oqlTarget}})}},onKeyDown:function(e){"Escape"===e.key&&this.$("form").remove()}})});