define(["underscore","app/i18n","app/core/View","app/core/util/bindLoadingMessage","app/data/orgUnits","app/reports/util/formatTooltipHeader","../dictionaries","../QiOutgoingQualityReport","../views/outgoingQuality/FilterView","../views/outgoingQuality/PpmChartView","../views/outgoingQuality/PpmTableView","../views/outgoingQuality/ParetoChartView","../views/outgoingQuality/ParetoTableView","../views/outgoingQuality/ResultListView","app/qiResults/templates/outgoingQuality/page"],function(e,t,i,r,o,n,l,a,s,u,p,h,g,c,d){"use strict";return i.extend({layoutName:"page",template:d,remoteTopics:{"qi.oqlWeeks.updated":function(e){this.model.updateOqlWeek(e)}},breadcrumbs:function(){return[this.t("BREADCRUMBS:base"),this.t("BREADCRUMBS:reports:outgoingQuality")]},actions:function(){var e=this;return[{icon:"print",label:this.t("report:oql:printable"),className:e.model.get("printable")?"active":"",callback:function(){var t=!e.model.get("printable");e.model.set("printable",t),this.querySelector(".btn").classList.toggle("active",t),t&&setTimeout(function(){window.print()},1)}}]},initialize:function(){var e=r(this.model,this);function t(e){var t=o.getByTypeAndId("mrpController",e);return t?t.get("description"):""}function i(e,t){var i=l.faults.get(e);if(!i)return"";var r=i.get("name"),o=i.get("description");return t||r===o?r:r+":\n"+o}r(e.results,this),this.setView("#-filter",new s({model:e})),this.setView("#-ppm-chart",new u({model:e})),this.setView("#-ppm-table",new p({model:e})),this.setView("#-where-chart",new h({model:e,property:"where",resolveTitle:t})),this.setView("#-where-table",new g({model:e,property:"where",resolveTitle:t})),this.setView("#-what-chart",new h({model:e,property:"what",resolveTitle:i})),this.setView("#-what-table",new g({model:e,property:"what",resolveTitle:i})),this.setView("#-results",new c({collection:e.results})),this.listenTo(e,"filtered",this.onFiltered),this.listenTo(e,"change:printable",this.onPrintableChange)},load:function(e){return e(this.model.fetch())},getTemplateData:function(){return{printable:this.model.get("printable")}},onFiltered:function(){this.promised(this.model.fetch()),this.broker.publish("router.navigate",{url:this.model.genClientUrl(),trigger:!1,replace:!0})},onPrintableChange:function(){this.render()}})});