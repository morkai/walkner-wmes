// Part of <http://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

define(["app/i18n","app/core/View","app/reports/util/formatTooltipHeader","../dictionaries","../QiCountReport","../views/QiCountReportFilterView","../views/QiTotalNokCountChartView","../views/QiNokCountPerDivisionChartView","../views/QiNokQtyPerFamilyChartView","app/qiResults/templates/countReportPage"],function(e,t,i,o,s,l,r,n,d,u){"use strict";return t.extend({layoutName:"page",template:u,breadcrumbs:[e.bound("qiResults","BREADCRUMBS:base"),e.bound("qiResults","BREADCRUMBS:reports:count")],actions:function(){return[{label:e.bound("qiResults","PAGE_ACTION:settings"),icon:"cogs",privileges:"QI:RESULTS:MANAGE",href:"#qi/settings?tab=reports"}]},initialize:function(){this.setView(".filter-container",new l({model:this.model})),this.setView("#"+this.idPrefix+"-totalNokCount",new r({model:this.model})),this.setView("#"+this.idPrefix+"-nokCountPerDivision",new n({model:this.model})),this.setView("#"+this.idPrefix+"-nokQtyPerFamily",new d({model:this.model})),this.listenTo(this.model,"filtered",this.onFiltered),this.listenTo(this.model,"change:selectedGroupKey",this.updateSelectedGroup)},destroy:function(){o.unload()},load:function(e){return o.loaded?e(this.model.fetch()):o.load().then(this.model.fetch.bind(this.model))},afterRender:function(){o.load(),this.updateSelectedGroup()},onFiltered:function(){this.promised(this.model.fetch()),this.broker.publish("router.navigate",{url:this.model.genClientUrl(),trigger:!1,replace:!0})},updateSelectedGroup:function(){var e=this.model.get("selectedGroupKey");if(!e){var t=this.model.getSelectedGroup();t&&(e=t.key)}this.$id("selectedGroup").text(e?i.call({model:this.model},e):"?")}})});