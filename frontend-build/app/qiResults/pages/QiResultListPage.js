// Part of <http://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

define(["jquery","app/i18n","app/user","app/core/pages/FilteredListPage","app/core/util/pageActions","../dictionaries","../views/QiResultFilterView","../views/QiResultListView","app/qiResults/templates/addPageActions"],function(e,t,i,s,n,o,l,r,a){"use strict";return s.extend({baseBreadcrumb:!0,FilterView:l,ListView:r,actions:function(e){var s=this.collection;return[n.jump(this,s),n["export"](e,this,this.collection,!1),{template:a,privileges:function(){return i.isAllowedTo("QI:INSPECTOR","QI:RESULTS:MANAGE")}},{label:t.bound("qiResults","PAGE_ACTION:settings"),icon:"cogs",privileges:"QI:DICTIONARIES:MANAGE",href:"#qi/settings?tab=results"}]},load:function(e){return e(this.collection.fetch({reset:!0}),o.load())},defineViews:function(){s.prototype.defineViews.apply(this,arguments),this.listenTo(this.listView,"showFilter",function(t){"rid"===t?e(".page-actions-jump").find('input[name="rid"]').focus():this.filterView.showFilter(t)})},destroy:function(){s.prototype.destroy.call(this),o.unload()},afterRender:function(){s.prototype.afterRender.call(this),o.load(),localStorage.QI_FILTER_HELP||this.showFilterHelp()},showFilterHelp:function(){t.has("qiResults","filter:help")&&e('<div class="message message-inline message-info"></div>').css("margin-bottom","15px").html(t("qiResults","filter:help")).insertAfter(this.$(".filter-container")).on("click",function(){localStorage.QI_FILTER_HELP="1",e(this).fadeOut("fast",function(){e(this).remove()})})}})});