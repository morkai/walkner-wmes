// Part of <http://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

define(["underscore","../i18n","../time","../core/Model","../data/colorFactory","./dictionaries"],function(e,t,r,i,o,s){"use strict";return i.extend({urlRoot:"/qi/reports/count",defaults:function(){return{from:0,to:0,interval:"month",productFamilies:[],kinds:[],errorCategories:[],faultCodes:[],divisions:{},selectedGroupKey:null,groups:{}}},fetch:function(t){e.isObject(t)||(t={});var r=t.data=e.extend(t.data||{},e.pick(this.attributes,["from","to","interval","productFamilies","kinds","errorCategories","faultCodes"]));return r.kinds=r.kinds.join(","),r.errorCategories=r.errorCategories.join(","),r.faultCodes=r.faultCodes.join(","),i.prototype.fetch.call(this,t)},genClientUrl:function(){return"/qi/reports/count?from="+this.get("from")+"&to="+this.get("to")+"&interval="+this.get("interval")+"&productFamilies="+this.get("productFamilies")+"&kinds="+this.get("kinds")+"&errorCategories="+this.get("errorCategories")+"&faultCodes="+this.get("faultCodes")},parse:function(e){return{divisions:e.divisions,selectedGroupKey:null,groups:e.groups}},getSelectedGroup:function(){var t=this.get("selectedGroupKey"),r=this.get("groups");return t?e.find(r,function(e){return e.key===t}):r[0]},selectNearestGroup:function(e){for(var t=this.get("groups"),r=null,i=0;i<t.length;++i){var o=t[i].key,s=t[i+1];if(!s||o>e){r=o;break}var n=s.key;if(e>=o&&n>e){r=o;break}}this.set("selectedGroupKey",r)}},{fromQuery:function(t){return new this({from:+t.from||void 0,to:+t.to||void 0,interval:t.interval||void 0,productFamilies:e.isEmpty(t.productFamilies)?"":t.productFamilies,kinds:e.isEmpty(t.kinds)?[]:t.kinds.split(","),errorCategories:e.isEmpty(t.errorCategories)?[]:t.errorCategories.split(","),faultCodes:e.isEmpty(t.faultCodes)?[]:t.faultCodes.split(",")})}})});