define(["app/viewport","app/time","app/core/View","app/core/util/html2pdf","app/wmes-osh-common/dictionaries","app/wmes-osh-payouts/templates/printDialog","app/wmes-osh-payouts/templates/printPage"],function(t,e,i,a,o,r,p){"use strict";return i.extend({template:r,events:{'change input[name="period"]':function(t){this.$id("period").attr("max","month"===t.target.value?12:4)},submit:function(){const i=this.$('.btn[type="submit"]').prop("disabled",!0),r={types:this.model.get("types").map(t=>this.t(`type:${t}`)).join(", "),companies:this.model.get("companies").map(t=>t.label).join(", "),period:"",pages:[]},n=this.$id("period").val(),s=this.$id("year").val();"quarter"===this.$('input[name="periodType"]:checked').val()?r.period=this.t("printDialog:period:quarter",{quarter:this.t("core",`QUARTER:${n}`),year:s}):r.period=this.t("printDialog:period:month",{month:e.getMoment(`${s}-${n.padStart(2,"0")}-01`,"YYYY-MM-DD").format("MMMM"),year:s});const l=this.model.get("recipients").map((t,e)=>({no:e+1,personnelId:t.personnelId,label:t.label,department:t.department,amount:o.currencyFormatter.format(t.amount.total)}));for(;l.length;)r.pages.push({no:r.pages.length+1,recipients:l.splice(0,0===r.pages.length?51:54)});const d=this.renderPartialHtml(p,{dateCreated:e.getMoment().format("L"),payout:r});return a(d,{done:()=>{i.prop("disabled",!1),t.closeDialog()}}),!1}},getTemplateData:function(){return{year:e.format(this.model.get("createdAt"),"YYYY")}},serializeDescription:function(){const t=this.model.get("types");return 1===t.length?this.t(`printDialog:description:${t[0]}`):this.t("printDialog:description:default")},afterRender:function(){this.selectDefaultPeriod()},selectDefaultPeriod:function(){const t=this.model.get("types"),i=e.getMoment(this.model.get("createdAt"));1===t.length&&"kaizen"===t[0]?(this.$('input[value="quarter"]').prop("checked",!0),this.$id("period").val(i.format("Q")).attr("max","4")):(this.$('input[value="month"]').prop("checked",!0),this.$id("period").val(i.format("M")).attr("max","12"))}})});