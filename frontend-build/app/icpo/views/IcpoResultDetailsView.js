// Copyright (c) 2014, ≈Åukasz Walukiewicz <lukasz@walukiewicz.eu>. Some Rights Reserved.
// Licensed under CC BY-NC-SA 4.0 <http://creativecommons.org/licenses/by-nc-sa/4.0/>.
// Part of the walkner-wmes project <http://lukasz.walukiewicz.eu/p/walkner-wmes>

define(["underscore","highlight","app/core/View","app/icpo/templates/details"],function(t,i,e,a){"use strict";return e.extend({template:a,events:{"click .history-tabs a":function(t){t.preventDefault();var i=this.$(t.target).tab("show").parent().attr("data-tab");this.broker.publish("router.navigate",{url:this.model.genClientUrl()+"?tab="+i,trigger:!1,replace:!0})},"shown.bs.tab":function(t){var i=t.target.parentNode;void 0!==i.dataset.highlight&&this.highlight(i.dataset.tab)}},initialize:function(){this.idPrefix=t.uniqueId("v"),this.highlighted={driverData:!1,gprsData:!1,inputData:!1,outputData:!1},this.listenTo(this.model,"change",t.after(2,this.render.bind(this)))},serialize:function(){var t=this.model.toJSON();return t.startedAt=Date.parse(t.startedAt),t.finishedAt=Date.parse(t.finishedAt),{idPrefix:this.idPrefix,model:t,log:this.model.getDecoratedLog()}},beforeRender:function(){this.highlighted={driverData:!1,gprsData:!1,inputData:!1,outputData:!1}},afterRender:function(){this.$('.nav-tabs > li[data-tab="'+(this.options.tab||"log")+'"] > a').tab("show")},highlight:function(t){this.highlighted[t]||(this.model.get(t)&&i.highlightBlock(this.$id(t).find("code")[0]),this.highlighted[t]=!0)}})});