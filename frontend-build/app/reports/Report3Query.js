define(["underscore","h5.rql/index","../time","../core/Model"],function(i,t,n,e){"use strict";var r=["totalAvailabilityH","operationalAvailabilityH","operationalAvailabilityP","exploitationH","exploitationP","oee","adjustingDuration","maintenanceDuration","renovationDuration","malfunctionDuration","malfunctionCount","majorMalfunctionCount","mttr","mtbf"];return e.extend({defaults:function(){var i=n.getMoment().startOf("day");return{to:i.valueOf(),from:i.subtract(1,"days").valueOf(),interval:"day",majorMalfunction:1.5,divisions:[],subdivisionType:null,prodLines:{},sort:{division:1,_id:1},columns:{}}},serializeToObject:function(){return{from:this.get("from"),to:this.get("to"),interval:this.get("interval"),majorMalfunction:this.get("majorMalfunction")}},serializeToString:function(){var n=this.attributes,e=new t.Query;e.sort=this.get("sort"),e.selector={name:"and",args:[{name:"eq",args:["from",n.from]},{name:"eq",args:["to",n.to]},{name:"eq",args:["interval",n.interval]},{name:"eq",args:["majorMalfunction",n.majorMalfunction]}]},n.divisions.length&&e.selector.args.push({name:"in",args:["divisions",n.divisions]}),n.subdivisionType&&e.selector.args.push({name:"eq",args:["subdivisionType",n.subdivisionType]}),i.isEmpty(n.prodLines)||e.selector.args.push({name:"in",args:["prodLines",Object.keys(n.prodLines)]});var s="";return r.forEach(function(i){s+=!1===n.columns[i]?"0":"1"}),e.selector.args.push({name:"eq",args:["columns",s]}),e.toString()},diffProdLines:function(i){var t=this.get("prodLines"),n={};Object.keys(t).forEach(function(t){i[t]&&(n[t]=!0)}),this.set("prodLines",n)},isProdLineSelected:function(t,n){return!!this.attributes.prodLines[t]||!!n&&i.isEmpty(this.attributes.prodLines)},getSelectedProdLines:function(){return Object.keys(this.attributes.prodLines)},toggleProdLineSelection:function(i,t){t?this.attributes.prodLines[i]=!0:delete this.attributes.prodLines[i],this.trigger("change"),this.trigger("change:prodLines")},matchProdLine:function(i){var t=this.get("divisions"),n=this.get("subdivisionType");return!(t.length&&-1===t.indexOf(i.division)||null!=n&&-1===n.indexOf(i.subdivisionType))},changeColumnVisibility:function(i,t){var n=this.get("columns");n[i]!==t&&(n[i]=t,this.trigger("change"),this.trigger("change:columns",i,t))},isColumnVisible:function(i){return!1!==this.get("columns")[i]}},{fromRqlQuery:function(t){var n={sort:i.isEmpty(t.sort)?void 0:t.sort};return(t.selector?t.selector.args:[]).forEach(function(i){"eq"!==i.name&&"in"!==i.name||("in"===i.name&&"prodLines"===i.args[0]?(n.prodLines={},i.args[1].forEach(function(i){n.prodLines[i]=!0})):"eq"===i.name&&"columns"===i.args[0]?(n.columns={},r.forEach(function(t,e){"0"===i.args[1][e]&&(n.columns[t]=!1)})):n[i.args[0]]=i.args[1])}),new this(n)}})});