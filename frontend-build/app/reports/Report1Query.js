define(["underscore","../time","../core/Model","../data/orgUnits","./Report1"],function(e,t,n,r,i){return n.extend({defaults:{orgUnitType:null,orgUnitId:null,from:null,to:null,interval:"hour",subdivisionType:null},reset:function(t){this.set(e.defaults(t,this.defaults),{reset:!0})},createReports:function(e,t){var n=[],o={query:this},a=this.get("orgUnitType"),s=r.getByTypeAndId(a,this.get("orgUnitId"));e||(e=new i({orgUnitType:this.get("orgUnitType"),orgUnit:s},o)),n.push(e);var l,d=r.getChildType(a);return l=s?r.getChildren(s):r.getAllDivisions().filter(function(e){return"prod"===e.get("type")}),l.sort(function(e,t){return e.getLabel().localeCompare(t.getLabel())}),l.forEach(function(e){t&&e===t.get("orgUnit")?n.push(t):n.push(new i({orgUnitType:d,orgUnit:e},o))}),n},serializeToObject:function(e,t){var n={subdivisionType:this.get("subdivisionType")||void 0,interval:this.get("interval"),from:this.get("from"),to:this.get("to")};if(!n.from||!n.to){var r=this.getFirstShiftMoment();n.from=r.toISOString(),n.to=r.add("days",1).toISOString()}return e&&t&&(n.orgUnitType=e,n.orgUnitId=t.id),n},serializeToString:function(e,t){var n="",r=this.attributes;return r.interval&&(n+="&interval="+r.interval),r.subdivisionType&&(n+="&subdivisionType="+r.subdivisionType),r.from&&r.to&&(n+="&from="+encodeURIComponent(r.from),n+="&to="+encodeURIComponent(r.to)),2===arguments.length?e&&(n+="&orgUnitType="+e,n+="&orgUnitId="+encodeURIComponent(t)):r.orgUnitType&&(n+="&orgUnitType="+r.orgUnitType,n+="&orgUnitId="+encodeURIComponent(r.orgUnitId)),n.substr(1)},getFirstShiftMoment:function(){var e=t.getMoment();return e.hours()>=0&&e.hours()<6&&e.subtract("days",1),e.hours(6).minutes(0).seconds(0).milliseconds(0)}})});