define(["underscore","../time","../core/Model","../data/orgUnits","./Report1"],function(t,e,n,i,o){return n.extend({defaults:{orgUnitType:null,orgUnitId:null,from:null,to:null,interval:"hour",subdivisionType:null},reset:function(e){this.set(t.defaults(e,this.defaults),{reset:!0})},createReports:function(t,e){var n=[],r={query:this},s=this.get("orgUnitType"),u=i.getByTypeAndId(s,this.get("orgUnitId"));t||(t=new o({orgUnitType:this.get("orgUnitType"),orgUnit:u},r)),n.push(t);var g,d=i.getChildType(s);return g=u?i.getChildren(u):i.getAllDivisions().filter(function(t){return"prod"===t.get("type")}),g.sort(function(t,e){return t.getLabel().localeCompare(e.getLabel())}),g.forEach(function(t){e&&t===e.get("orgUnit")?n.push(e):n.push(new o({orgUnitType:d,orgUnit:t},r))}),n},serializeToObject:function(t,e){var n={subdivisionType:this.get("subdivisionType")||void 0,interval:this.get("interval"),from:this.get("from"),to:this.get("to")};if(!n.from||!n.to){var i=this.getFirstShiftMoment();n.from=i.toISOString(),n.to=i.add("days",1).toISOString()}return t&&e&&(n.orgUnitType=t,n.orgUnitId=e.id),n},serializeToString:function(t,e){var n="",i=this.attributes;return i.interval&&(n+="&interval="+i.interval),i.subdivisionType&&(n+="&subdivisionType="+i.subdivisionType),i.from&&i.to&&(n+="&from="+encodeURIComponent(i.from),n+="&to="+encodeURIComponent(i.to)),2===arguments.length?t&&(n+="&orgUnitType="+t,n+="&orgUnitId="+encodeURIComponent(e)):i.orgUnitType&&(n+="&orgUnitType="+i.orgUnitType,n+="&orgUnitId="+encodeURIComponent(i.orgUnitId)),n.substr(1)},getFirstShiftMoment:function(){var t=e.getMoment();return t.hours()>=0&&t.hours()<6&&t.subtract("days",1),t.hours(6).minutes(0).seconds(0).milliseconds(0)}})});