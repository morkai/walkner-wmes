define(["underscore","../time","../data/companies","../data/prodFunctions","../data/aors","../data/colorFactory","../core/Model"],function(r,e,t,n,o,i,a){"use strict";return a.extend({urlRoot:"/reports/8",initialize:function(r,e){if(!e.query)throw new Error("query option is required!");this.query=e.query},fetch:function(e){return r.isObject(e)||(e={}),e.data=r.assign(e.data||{},this.query.serializeToObject()),a.prototype.fetch.call(this,e)},parse:function(r){return r.groups=this.parseGroups(r.groups,Object.keys(r.summary.downtimeByAor)),r},parseGroups:function(e,t){var n={totalVolumeProduced:[],prodBasedPlanners:[],prodQualityInspection:[],prodOperators:[],prodSetters:[],masters:[],leaders:[],prodMaterialHandling:[],kitters:[],prodTransport:[],cycleCounting:[],otherWarehousing:[],materialQualityInspection:[],maintenance:[],timeAvailablePerShift:[],routingTimeForLine:[],routingTimeForLabour:[],heijunkaTimeForLine:[],breaks:[],fap0:[],startup:[],shutdown:[],meetings:[],sixS:[],tpm:[],trainings:[],coTime:[],downtime:[],plan:[],efficiency:[]},o={totalVolumeProduced:[],averageRoutingTime:[],prodBasedPlanners:[],prodQualityInspection:[],prodOperators:[],prodSetters:[],masters:[],leaders:[],prodMaterialHandling:[],kitters:[],prodTransport:[],cycleCounting:[],otherWarehousing:[],materialQualityInspection:[],maintenance:[],timeAvailablePerShift:[],routingTimeForLine:[],routingTimeForLabour:[],breaks:[],fap0:[],startup:[],shutdown:[],meetings:[],sixS:[],tpm:[],trainings:[],coTime:[],downtime:[],plan:[],efficiency:[]},i=Object.keys(n),a=Object.keys(o);return r.forEach(t,function(r){o[r]=[]}),r.forEach(e,function(e){var u=e.key;r.forEach(i,function(r){var t=e[r];n[r].push({x:u,y:"number"==typeof t?t:t[0]})}),r.forEach(a,function(r){var t=e[r];o[r].push({x:u,y:"number"==typeof t?t:t[1]})}),r.forEach(t,function(r){var t=e.downtimeByAor[r];o[r].push({x:u,y:t||0})})}),{plan:n,real:o}},getColor:function(r,e){return i.getColor("lean:"+r,e)},serializeToCsv:function(){var t=[],n=["date"].concat(this.query.constructor.SERIES),i=this.get("summary"),a=this.get("groups");if(t.push(n),!i)return d();var u=[];r.forEach(i.downtimeByAor,function(r,e){u.push(e),t[0].push('"'+o.get(e).getLabel()+'"')});var s=r.map(this.query.constructor.SERIES,function(r){var e=r.split(":");return{id:e[0],kind:e[1]}}),c=[""];return r.forEach(s,function(r){var e=i[r.id];"number"!=typeof e&&(e=e["plan"===r.kind?0:1]),c.push(p(e))}),r.forEach(u,function(r){c.push(p(i.downtimeByAor[r]))}),t.push([],c,[]),r.forEach(a.plan.totalVolumeProduced,function(n,o){var i=[e.format(n.x,"YYYY-MM-DD HH:mm:ss")];r.forEach(s,function(r){i.push(p(a[r.kind][r.id][o].y))}),r.forEach(u,function(r){i.push(p(a.real[r][o].y))}),t.push(i)}),d();function p(r){return r?(Math.round(1e3*r)/1e3).toLocaleString().replace(/\s+/g,""):"0"}function d(){return t.map(function(r){return r.join(";")}).join("\r\n")}}})});