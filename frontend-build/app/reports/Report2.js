define(["underscore","../data/aors","../data/downtimeReasons","../core/Model"],function(n,o,t,r){"use strict";return r.extend({urlRoot:"/reports/2",defaults:function(){return{orgUnitType:null,orgUnit:null,clip:{orderCount:[],production:[],productionCount:[],endToEnd:[],endToEndCount:[]},maxClip:{orderCount:0,production:0,endToEnd:0}}},initialize:function(n,o){if(!o.query)throw new Error("query option is required!");this.query=o.query},fetch:function(o){return n.isObject(o)||(o={}),o.data=n.assign(o.data||{},this.query.serializeToObject(this.get("orgUnitType"),this.get("orgUnit"))),r.prototype.fetch.call(this,o)},parse:function(n){var o={clip:null,maxClip:null,dirIndir:null,effIneff:null};return this.parseClip(n.clip,o),o},parseClip:function(o,t){var r={orderCount:[],productionCount:[],endToEndCount:[],production:[],endToEnd:[]},e={orderCount:0,productionCount:0,endToEndCount:0,production:0,endToEnd:0};n.forEach(o,function(n){var o=n.orderCount||0,t=o*n.production||0,u=o*n.endToEnd||0,d=Math.round(100*(n.production||0)),i=Math.round(100*(n.endToEnd||0));r.orderCount.push({x:n.key,y:o}),r.production.push({x:n.key,y:d}),r.productionCount.push({x:n.key,y:t}),r.endToEnd.push({x:n.key,y:i}),r.endToEndCount.push({x:n.key,y:u}),e.orderCount=Math.max(e.orderCount,o),e.productionCount=Math.max(e.productionCount,t),e.endToEndCount=Math.max(e.endToEndCount,u),e.production=Math.max(e.production,d),e.endToEnd=Math.max(e.endToEnd,i)}),t.clip=r,t.maxClip=e}})});