// Copyright (c) 2014, ≈Åukasz Walukiewicz <lukasz@walukiewicz.eu>. Some Rights Reserved.
// Licensed under CC BY-NC-SA 4.0 <http://creativecommons.org/licenses/by-nc-sa/4.0/>.
// Part of the walkner-wmes project <http://lukasz.walukiewicz.eu/p/walkner-wmes>

define(["underscore","../data/aors","../data/downtimeReasons","../core/Model"],function(n,o,r,t){"use strict";return t.extend({urlRoot:"/reports/2",defaults:function(){return{orgUnitType:null,orgUnit:null,clip:{orderCount:[],production:[],endToEnd:[]},maxClip:{orderCount:0,production:0,endToEnd:0}}},initialize:function(n,o){if(!o.query)throw new Error("query option is required!");this.query=o.query},fetch:function(o){return n.isObject(o)||(o={}),o.data=n.extend(o.data||{},this.query.serializeToObject(this.get("orgUnitType"),this.get("orgUnit"))),t.prototype.fetch.call(this,o)},parse:function(n){var o={clip:null,maxClip:null,dirIndir:null,effIneff:null};return this.parseClip(n.clip,o),o},parseClip:function(n,o){var r={orderCount:[],production:[],endToEnd:[]},t={orderCount:0,production:0,endToEnd:0};n.forEach(function(n){var o=n.orderCount||0,e=Math.round(100*(n.production||0)),i=Math.round(100*(n.endToEnd||0));r.orderCount.push({x:n.key,y:o}),r.production.push({x:n.key,y:e}),r.endToEnd.push({x:n.key,y:i}),t.orderCount=Math.max(t.orderCount,o),t.production=Math.max(t.production,e),t.endToEnd=Math.max(t.endToEnd,i)}),o.clip=r,o.maxClip=t}})});