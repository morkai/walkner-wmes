define(["underscore","js2form","app/i18n","app/time","app/core/View","app/core/util/fixTimeRange","app/reports/templates/report2Filter"],function(e,t,r,a,i,n,o){return i.extend({template:o,events:{"submit .filter-form":function(e){e.preventDefault(),this.changeFilter()},"click .btn[data-range]":function(e){var t,r,i=a.getMoment();switch(e.target.getAttribute("data-range")){case"month":i.date(1),t=i.clone().add("months",1),r="week";break;case"week":i.weekday(0),t=i.clone().add("days",7),r="day";break;case"today":t=i.clone().add("days",1),r="day";break;case"yesterday":t=i.clone(),i.subtract("days",1),r="day"}this.$id("from").val(i.format("YYYY-MM-DD")),this.$id("to").val(t.format("YYYY-MM-DD")),this.$(".btn[data-interval="+r+"]").click(),this.$(".filter-form").submit()}},initialize:function(){this.idPrefix=e.uniqueId("report2Filter")},serialize:function(){return{idPrefix:this.idPrefix}},afterRender:function(){var e=this.serializeFormData();t(this.el.querySelector(".filter-form"),e),this.$("[name=interval]:checked").closest(".btn").addClass("active")},serializeFormData:function(){return{interval:this.model.get("interval"),from:a.format(Number(this.model.get("from")),"YYYY-MM-DD"),to:a.format(Number(this.model.get("to")),"YYYY-MM-DD")}},changeFilter:function(){var e={rnd:Math.random(),from:null,to:null,interval:this.$(".reports-2-filter-intervals > .active > input").val()},t=n.fromView(this);e.from=t.from||this.getFromMomentForSelectedInterval().valueOf(),e.to=t.to||Date.now(),this.$id("from").val(a.format(e.from,"YYYY-MM-DD")),this.$id("to").val(a.format(e.to,"YYYY-MM-DD")),this.model.set(e)},getSelectedInterval:function(){return this.$(".reports-2-filter-intervals > .active").attr("data-interval")},getFromMomentForSelectedInterval:function(){var e=a.getMoment().minutes(0).seconds(0).milliseconds(0);switch(this.getSelectedInterval()){case"month":return e.date(1).hours(6);case"week":return e.day(1).hours(6);default:return e.hour(6)}}})});