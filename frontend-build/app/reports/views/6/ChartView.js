// Part of <https://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

define(["app/time","app/i18n","app/highcharts","app/core/View","app/reports/util/formatTooltipHeader"],function(t,e,i,r,s){"use strict";return r.extend({className:null,kind:null,initialize:function(){this.chart=null,this.loading=!1,this.listenTo(this.model,"request",this.onModelLoading),this.listenTo(this.model,"sync",this.onModelLoaded),this.listenTo(this.model,"error",this.onModelError),this.listenTo(this.model,"change:"+this.kind,this.render),this.listenTo(this.model.query,"change:interval",this.onIntervalChange),this.settings&&this.listenTo(this.settings,"add change",this.onSettingsUpdate)},destroy:function(){null!==this.chart&&(this.chart.destroy(),this.chart=null)},afterRender:function(){this.timers.createOrUpdateChart&&clearTimeout(this.timers.createOrUpdateChart),this.timers.createOrUpdateChart=setTimeout(this.createOrUpdateChart.bind(this),1)},createOrUpdateChart:function(){this.timers.createOrUpdateChart=null,this.chart?this.updateChart():(this.createChart(),this.loading&&this.chart.showLoading())},createChart:function(){},updateChart:function(){},serializeChartData:function(){},formatTooltipHeader:s,getMarkerStyles:function(t){return{radius:t>1?0:3,states:{hover:{radius:t>1?3:6}}}},onModelLoading:function(){this.loading=!0,this.chart&&this.chart.showLoading()},onModelLoaded:function(){this.loading=!1,this.chart&&this.chart.hideLoading()},onModelError:function(){this.loading=!1,this.chart&&this.chart.hideLoading()},onIntervalChange:function(){},onSettingsUpdate:function(t){if(this.chart)switch(t.getType()){case"color":return this.updateColor(t.getMetricName(),t.getValue())}},updateColor:function(t,e){"efficiency"===t?t="eff":"quantityDone"===t?t="qty":"warehouse"===t&&(t="fte");var i=this.chart.get(t);i&&i.update({color:e},!0)},getChartTitle:function(t){var i=this.options.type,r=this.kind+":"+i;if(e.has("reports","wh:"+r))return e("reports","wh:"+r);var s=this.prodTasks.get(i.replace(/^[a-zA-Z]+\-/,""));if(!s)return r;var a=s.getLabel();return t===!1||a.length<37?a:a.substr(0,34)+"..."},getExportFilename:function(){return e.has("reports","filenames:6:"+this.kind+":"+this.options.type)?e("reports","filenames:6:"+this.kind+":"+this.options.type):e("reports","filenames:6:suffix",{suffix:this.getChartTitle(!1)})}})});