// Part of <https://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

define(["app/i18n","app/highcharts","./ChartView"],function(e,t,i){"use strict";return i.extend({className:"reports-6-totalAndAbsence",kind:"totalAndAbsence",createChart:function(){var i=this.serializeChartData();this.chart=new t.Chart({chart:{renderTo:this.el},exporting:{filename:this.getExportFilename()},title:{text:this.getChartTitle()},noData:{},xAxis:{type:"datetime"},yAxis:[{id:"fteAxis",title:!1,min:0},{id:"absenceAxis",title:!1,opposite:!0,labels:{format:"{value}%"},showEmpty:!0,min:0,gridLineWidth:0}],tooltip:{shared:!0,headerFormatter:this.formatTooltipHeader.bind(this),valueDecimals:1},legend:{enabled:!1},plotOptions:{line:{lineWidth:2,states:{hover:{lineWidth:2}},marker:this.getMarkerStyles(i.fte.length)}},series:[{id:"fte",name:this.getFteSeriesName(),color:this.settings&&this.settings.getColor("warehouse")||"#eeee00",borderWidth:0,type:"column",data:i.fte,yAxis:0},{id:"absence",name:e("reports","wh:absence"),color:this.settings&&this.settings.getColor("absence")||"#ee0000",type:"line",data:i.absence,yAxis:1,tooltip:{valueSuffix:"%"}}]})},updateChart:function(){var e=this.serializeChartData(),t=this.getMarkerStyles(e.fte.length),i=this.chart,a=i.series;a.forEach(function(i){i.update({marker:t},!1),i.setData(e[i.options.id],!1)}),this.chart.redraw(!1)},serializeChartData:function(){return this.model.getTotalAndAbsenceData(this.options.type)},getFteSeriesName:function(){var t="",i=this.model.query.get("interval");return"day"!==i&&"shift"!==i&&(t=":avg"),e("reports","wh:fte"+t)},onIntervalChange:function(){this.chart&&this.chart.series[0].update({name:this.getFteSeriesName()},!1)}})});