define(["underscore","jquery","app/time","app/i18n","app/viewport","app/core/View","app/data/views/renderOrgUnitPath","app/highcharts"],function(e,t,n,r,i,o,a,s){return o.extend({className:function(){return"reports-chart reports-1-coeffs"},initialize:function(){this.shouldRenderChart=!this.options.skipRenderChart,this.chart=null,this.loading=!1,this.listenTo(this.model,"request",this.onModelLoading),this.listenTo(this.model,"sync",this.onModelLoaded),this.listenTo(this.model,"error",this.onModelError),this.listenTo(this.model,"change:coeffs",this.render)},destroy:function(){null!==this.chart&&(this.chart.destroy(),this.chart=null)},afterRender:function(){this.chart?this.updateChart():this.shouldRenderChart&&(this.createChart(),this.loading&&this.chart.showLoading()),this.shouldRenderChart=!0},createChart:function(){var e=this.serializeChartData(),n=this.formatTooltipHeader.bind(this),i=this.getMarkerStyles(e.quantityDone.length),o=this;this.chart=new s.Chart({chart:{renderTo:this.el,zoomType:"x",resetZoomButton:{relativeTo:"chart",position:{y:5}},events:{selection:function(e){e.resetSelection&&(o.timers.resetExtremes=setTimeout(this.yAxis[1].setExtremes.bind(this.yAxis[1],0,null,!0,!1),1))}}},title:{useHTML:!0,text:this.getTitle()},noData:{},xAxis:{type:"datetime"},yAxis:[{title:!1},{title:!1,opposite:!0,gridLineWidth:0}],tooltip:{borderColor:"#999999",shared:!0,useHTML:!0,formatter:function(){var e="<b>"+n(this.x)+"</b><table>";return t.each(this.points,function(t,n){e+='<tr><td style="color: '+n.series.color+'">'+n.series.name+":</td><td>"+n.y+n.series.tooltipOptions.valueSuffix+"</td></tr>"}),e+="</table>"}},legend:{layout:"horizontal",align:"center",verticalAlign:"bottom",backgroundColor:"#FFFFFF",itemStyle:{fontSize:"10px"}},plotOptions:{area:{lineWidth:0,marker:i},line:{lineWidth:2,states:{hover:{lineWidth:2}},marker:i}},series:[{name:r("reports","coeffs:quantityDone"),color:"#00aaff",type:"area",yAxis:0,data:e.quantityDone,tooltip:{valueSuffix:r("reports","quantityDoneSuffix")}},{name:r("reports","coeffs:efficiency"),color:"#00ee00",type:"line",yAxis:1,data:e.efficiency,tooltip:{valueSuffix:"%"}},{name:r("reports","coeffs:productivity"),color:"#ffaa00",type:"line",yAxis:1,data:e.productivity,tooltip:{valueSuffix:"%"},visible:"hour"!==this.model.query.get("interval")},{name:r("reports","coeffs:downtime"),color:"rgba(255, 0, 0, .75)",borderColor:"#AC2925",borderWidth:0,type:"column",yAxis:1,data:e.downtime,tooltip:{valueSuffix:"%"}}]})},updateChart:function(){var e=this.serializeChartData(),t=0;e.quantityDone.length||(t=null),this.chart.yAxis[1].setExtremes(t,null,!1);var n="hour"!==this.model.query.get("interval"),r=this.getMarkerStyles(e.quantityDone.length);this.chart.series[0].update({marker:r},!1),this.chart.series[1].update({marker:r},!1),this.chart.series[2].update({marker:r,visible:n},!1),this.chart.series[3].update({marker:r},!1),this.chart.series[0].setData(e.quantityDone,!1),this.chart.series[1].setData(e.efficiency,!1),this.chart.series[2].setData(e.productivity,!1),this.chart.series[3].setData(e.downtime,!0)},serializeChartData:function(){return this.model.get("coeffs")},formatTooltipHeader:function(e){var t,i=n.getMoment(e),o=this.model.query.interval||"hour";return"shift"===o&&(t={shift:r("core","SHIFT:"+(6===i.hours()?1:14===i.hours()?2:3))}),i.format(r("reports","tooltipHeaderFormat:"+o,t))},getMarkerStyles:function(e){return{radius:e>1?0:3,states:{hover:{radius:e>1?3:6}}}},getTitle:function(){var e=this.model.get("orgUnitType");if(!e)return r("reports","report1:overallTitle");var t=this.model.get("orgUnit");return"subdivision"===e?a(t,!1,!1):t.getLabel()},onModelLoading:function(){this.loading=!0,this.chart&&this.chart.showLoading()},onModelLoaded:function(){this.loading=!1,this.chart&&this.chart.hideLoading()},onModelError:function(){this.loading=!1,this.chart&&this.chart.hideLoading()}})});