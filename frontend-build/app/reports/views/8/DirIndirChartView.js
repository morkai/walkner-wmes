define(["underscore","app/i18n","app/time","app/highcharts","app/core/View","app/data/colorFactory","app/reports/util/formatTooltipHeader","app/reports/util/formatXAxis"],function(t,e,i,r,n,o,s,a){"use strict";return n.extend({initialize:function(){this.chart=null,this.isLoading=!1,this.listenTo(this.model,"request",this.onModelLoading),this.listenTo(this.model,"sync",this.onModelLoaded),this.listenTo(this.model,"error",this.onModelError),this.listenTo(this.model,"change:groups",this.render),this.listenTo(this.model.query,"change:visibleSeries",this.render)},destroy:function(){null!==this.chart&&(this.chart.destroy(),this.chart=null)},afterRender:function(){this.timers.createOrUpdate&&clearTimeout(this.timers.createOrUpdate),this.timers.createOrUpdate=setTimeout(this.createOrUpdate.bind(this),1)},createOrUpdate:function(){this.timers.createOrUpdate=null,this.chart?this.updateChart():(this.createChart(),this.isLoading&&this.chart.showLoading())},createChart:function(){var t=this.serializeSeries(),i=this.serializeYAxis(t);this.chart=new r.Chart({chart:{renderTo:this.el,plotBorderWidth:1,height:450},exporting:{filename:e.bound("reports","8:filename:dirIndir"),chartOptions:{title:!1}},title:!1,noData:{},xAxis:{type:"datetime",labels:a.labels(this)},yAxis:i,tooltip:{shared:!0,valueDecimals:2,headerFormatter:s.bind(this)},legend:{enabled:!0,itemStyle:{fontSize:"12px",lineHeight:"14px"}},series:t})},updateChart:function(){this.chart.destroy(),this.createChart()},serializeYAxis:function(e){var i=[],r={},n={fte:{id:"fte",title:!1,min:0,decimals:2,opposite:!1},pce:{id:"pce",title:!1,min:0,decimals:0,opposite:!1},time:{id:"time",title:!1,min:0,decimals:2,opposite:!1}},o=-1;return t.forEach(e,function(t){void 0===r[t.yAxis]&&(r[t.yAxis]=++o)}),t.forEach(r,function(t,e){i.push(n[e])}),i.length>1&&t.forEach(i,function(t){t.opposite="fte"!==t.id}),i},serializeSeries:function(){var i=this.model,r=i.get("groups"),n=[],o={totalVolumeProduced:{type:"line",yAxis:"pce",zIndex:3,tooltip:{valueSuffix:e("reports","quantitySuffix")}},averageRoutingTime:{type:"line",yAxis:"time",zIndex:4,tooltip:{valueSuffix:e("reports","8:times:unit:"+i.query.get("unit"))}},prodBasedPlanners:null,prodQualityInspection:null,prodOperators:null,prodSetters:null,masters:null,leaders:null,prodMaterialHandling:null,kitters:null,prodTransport:null,cycleCounting:null,otherWarehousing:null,materialQualityInspection:null,maintenance:null};return t.forEach(o,function(e,i){null===e&&(e={type:"column",yAxis:"fte",tooltip:{valueSuffix:"FTE"}}),s("plan",t.clone(e),i),s("real",t.clone(e),i)}),n;function s(t,o,s){r&&(o.data=r[t][s],o.data&&(o.id=s+":"+t,i.query.isVisibleSeries(o.id)&&(o.metricLabel=e("reports","8:dirIndir:"+s),o.name=o.metricLabel+" "+e("reports","8:suffix:"+t),o.color=i.getColor("dirIndir",o.id),n.push(o))))}},onModelLoading:function(){this.isLoading=!0,this.chart&&this.chart.showLoading()},onModelLoaded:function(){this.isLoading=!1,this.chart&&this.chart.hideLoading()},onModelError:function(){this.isLoading=!1,this.chart&&this.chart.hideLoading()}})});