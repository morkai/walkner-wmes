// Part of <https://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

define(["underscore","app/i18n","app/highcharts","app/core/View","app/data/aors","app/reports/templates/8/timesTable"],function(e,r,i,t,a,o){"use strict";return t.extend({template:o,events:{"click .js-value":function(e){this.toggleSeries(e.currentTarget.parentNode.dataset.prop,e.currentTarget.dataset.kind)}},initialize:function(){this.listenTo(this.model,"change:summary",this.render)},serialize:function(){return{idPrefix:this.idPrefix,props:this.serializeProps()}},serializeProp:function(e,r,i,t,a){var o={plan:"",real:"",unit:a,className:"",planColor:this.serializeColor(i,"plan"),realColor:this.serializeColor(i,"real")};if(r){var s=r[i];Array.isArray(s)?(o.plan=this.formatValue(s[0],t),o.real=this.formatValue(s[1],t)):o["heijunkaTimeForLine"===i?"plan":"real"]=this.formatValue(s,t)}return e[i]=o,o},serializeColor:function(e,r){var i=e+":"+r;return this.model.query.isVisibleSeries(i)?this.model.getColor("times",i):"transparent"},formatValue:function(e,r){return i.numberFormat(e,r)},serializeProps:function(){var i=this.model.query.get("unit"),t=r("reports","8:times:unit:"+i),o=2,s=this.model.get("summary"),n={},l=this;return["timeAvailablePerShift","routingTimeForLine","routingTimeForLabour","heijunkaTimeForLine","breaks","fap0","startup","shutdown","meetings","sixS","tpm","trainings","coTime","downtime"].forEach(function(e){l.serializeProp(n,s,e,o,t)}),e.forEach(s?s.downtimeByAor:null,function(e,r){var i=a.get(r);n[r]={name:i?i.getLabel():r,plan:"",real:l.formatValue(e,o),unit:t,className:"",planColor:"transparent",realColor:l.serializeColor(r,"real")}}),this.serializeProp(n,s,"plan",0,r("reports","8:times:unit:pcs")),this.serializeProp(n,s,"efficiency",0,r("reports","8:times:unit:%")),n},toggleSeries:function(e,r){var i=this.$('tr[data-prop="'+e+'"]'),t=i.find('td[data-kind="'+r+'"] > span');this.model.query.toggleSeriesVisibility(e+":"+r),t.css({borderBottomColor:this.serializeColor(e,r)})}})});