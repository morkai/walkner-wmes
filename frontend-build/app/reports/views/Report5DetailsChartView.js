// Copyright (c) 2014, ≈Åukasz Walukiewicz <lukasz@walukiewicz.eu>. Some Rights Reserved.
// Licensed under CC BY-NC-SA 4.0 <http://creativecommons.org/licenses/by-nc-sa/4.0/>.
// Part of the walkner-wmes project <http://lukasz.walukiewicz.eu/p/walkner-wmes>

define(["underscore","app/i18n","app/highcharts","app/data/companies","app/data/prodFunctions","./Report5FteChartView"],function(t,e,i,o,a,r){return r.extend({fteType:"details",extremesChangeProperties:["maxDetailsFte"],localTopics:{"companies.synced":"updateChart","prodFunctions.synced":"updateChart"},serializeChartData:function(){var t=this.displayOptions,e=this.model.get("byCompanyAndProdFunction"),i=[];return a.forEach(function(a){if(t.isProdFunctionVisible(a.id)){var r=a.get("color");(a.get("companies")||[]).forEach(function(n){var s=o.get(n);if(s&&void 0!==e[n]&&t.isCompanyVisible(n)){var l=e[n][a.id];null!=l&&0!==l&&i.push({prodFunctionId:a.id,companyId:n,color:r,borderColor:s.get("color"),y:l,states:{hover:{borderColor:s.get("color")}}})}})}}),{details:i.sort(function(t,e){return e.y-t.y})}},toggleSeriesVisibility:function(t){return void 0===t.companies&&void 0===t.prodFunctions?!1:(this.chart.series[0].setData(this.serializeChartData().details,!1,!1,!1),!0)},getYAxisMaxValues:function(){return[this.displayOptions.get("maxDetailsFte")||null]},formatTooltip:function(){var t=this.points[0].point,e=t.prodFunctionId,r=a.get(e).getLabel(),n=t.series.data.filter(function(t){return t.prodFunctionId===e}).map(function(t){var e=o.get(t.companyId),i=t.series.tooltipOptions;return{name:e.getLabel(),value:t.y,color:e.get("color"),decimals:i.valueDecimals,suffix:i.valueSuffix}});return i.formatTableTooltip(r,n)},createChartOptions:function(){var t=r.prototype.createChartOptions.call(this);return t.tooltip.formatter=this.formatTooltip,t},createXAxis:function(){return{labels:{enabled:!1},tickWidth:0,tickLength:0}},createSeries:function(t){return[{id:"details",type:"column",yAxis:0,data:t.details,tooltip:{valueSuffix:" FTE",valueDecimals:2},borderWidth:2,minPointLength:2}]}})});