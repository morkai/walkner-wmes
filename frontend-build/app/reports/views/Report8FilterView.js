// Copyright (c) 2014, ≈Åukasz Walukiewicz <lukasz@walukiewicz.eu>. Some Rights Reserved.
// Licensed under CC BY-NC-SA 4.0 <http://creativecommons.org/licenses/by-nc-sa/4.0/>.
// Part of the walkner-wmes project <http://lukasz.walukiewicz.eu/p/walkner-wmes>

define(["underscore","form2js","app/i18n","app/time","app/viewport","app/data/orgUnits","app/core/views/FilterView","app/core/util/idAndLabel","../Report8Query","app/reports/templates/report8Filter"],function(e,t,i,r,o,s,n,p,a,l){"use strict";return n.extend({template:l,events:e.extend({},n.prototype.events),serialize:function(){return e.extend(n.prototype.serialize.call(this),{numericProps:a.NUMERIC_PROPS,divisions:s.getAllByType("division").filter(function(e){return"prod"===e.get("type")}).map(p)})},afterRender:function(){n.prototype.afterRender.call(this),this.$id("prodLines").select2({width:322,multiple:!0,data:s.getAllByType("prodLine").map(p)})},serializeQueryToForm:function(){var t=this.model.toJSON();return t.from=r.format(t.from,"YYYY-MM-DD"),t.to=r.format(t.to,"YYYY-MM-DD"),["days","shifts","divisions","subdivisionTypes"].forEach(this.applyAllOptionsIfEmpty.bind(this,t)),t.prodLines=e.isArray(t.prodLines)?t.prodLines.join(","):"",t},applyAllOptionsIfEmpty:function(t,i){e.isEmpty(t[i])&&(t[i]=this.$('input[name="'+i+'[]"]').map(function(){return this.value}).get())},changeFilter:function(){this.model.set(this.serializeFormToQuery(),{reset:!0})},serializeFormToQuery:function(){var i=e.extend(e.result(this.model,"defaults"),t(this.el));return i.from=r.getMoment(i.from,"YYYY-MM-DD").valueOf(),i.to=r.getMoment(i.to,"YYYY-MM-DD").valueOf(),["days","shifts","divisions","subdivisionTypes"].forEach(this.applyAllOptionsIfEmpty.bind(this,i)),i}})});