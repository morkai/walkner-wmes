// Copyright (c) 2014, ≈Åukasz Walukiewicz <lukasz@walukiewicz.eu>. Some Rights Reserved.
// Licensed under CC BY-NC-SA 4.0 <http://creativecommons.org/licenses/by-nc-sa/4.0/>.
// Part of the walkner-wmes project <http://lukasz.walukiewicz.eu/p/walkner-wmes>

define(["app/i18n","app/time","app/core/View","app/pressWorksheets/templates/ordersList","app/reports/templates/notesList"],function(e,s,t,r,o){return t.extend({template:o,className:"reports-4-notesList",events:{"click #-load":function(){var e=this,t=this.$id("load").prop("disabled",!0),r=t.find(".fa");r.addClass("fa-spin");var o=this.ajax({type:"GET",url:"/reports/4;notes?"+this.model.query.serializeToString()});o.fail(function(){r.removeClass("fa-spin"),t.prop("disabled",!1)}),o.done(function(t){e.orders=t.collection.map(function(e){return 5!==e.startedAt.length&&(e.startedAt=s.format(e.startedAt,"HH:mm:ss"),e.finishedAt=s.format(e.finishedAt,"HH:mm:ss")),e}),e.render()})},"click .panel-heading":"togglePanel","mouseover tbody > tr":function(e){this.toggleHovered(e.currentTarget,!0)},"mouseout tbody > tr":function(e){this.toggleHovered(e.currentTarget,!1)}},initialize:function(){this.orders=[],this.listenTo(this.model,"request",function(){this.orders=[]})},serialize:function(){var e=this.model.get("notes");return{idPrefix:this.idPrefix,orders:this.orders,notes:e.count,worksheets:e.worksheets.length,renderOrderList:r}},beforeRender:function(){this.stopListening(this.model,"request error change:notes",this.render)},afterRender:function(){this.listenToOnce(this.model,"request error change:notes",this.render)},toggleHovered:function(e,s){var t=this.$(e),r=t.hasClass("pressWorksheets-orders-notes")?t.prev():t.next(".pressWorksheets-orders-notes");t.toggleClass("is-hovered",s),r.toggleClass("is-hovered",s)},togglePanel:function(){var e=this.$id("toggle"),s=e.find(".fa"),t=this.$id("table");t.stop(!0),s.hasClass("fa-chevron-up")?(s.removeClass("fa-chevron-up").addClass("fa-chevron-down"),t.slideUp("fast")):(s.removeClass("fa-chevron-down").addClass("fa-chevron-up"),t.slideDown("fast"))}})});