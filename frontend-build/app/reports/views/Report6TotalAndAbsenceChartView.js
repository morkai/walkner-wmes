// Copyright (c) 2014, ≈Åukasz Walukiewicz <lukasz@walukiewicz.eu>. Some Rights Reserved.
// Licensed under CC BY-NC-SA 4.0 <http://creativecommons.org/licenses/by-nc-sa/4.0/>.
// Part of the walkner-wmes project <http://lukasz.walukiewicz.eu/p/walkner-wmes>

define(["app/time","app/i18n","app/highcharts","./Report6ChartView","../util/formatTooltipHeader"],function(e,t,i,a){return a.extend({className:"reports-6-totalAndAbsence",kind:"totalAndAbsence",createChart:function(){var e=this.serializeChartData();this.chart=new i.Chart({chart:{renderTo:this.el},exporting:{filename:this.getExportFilename()},title:{text:this.getChartTitle()},noData:{},xAxis:{type:"datetime"},yAxis:[{id:"fteAxis",title:!1,min:0},{id:"absenceAxis",title:!1,opposite:!0,labels:{format:"{value}%"},showEmpty:!0,min:0,gridLineWidth:0}],tooltip:{shared:!0,headerFormatter:this.formatTooltipHeader.bind(this),valueDecimals:1},legend:!1,plotOptions:{line:{lineWidth:2,states:{hover:{lineWidth:2}},marker:this.getMarkerStyles(e.fte.length)}},series:[{id:"fte",name:this.getFteSeriesName(),color:this.settings&&this.settings.getColor("warehouse")||"#eeee00",borderWidth:0,type:"column",data:e.fte,yAxis:0},{id:"absence",name:t("reports","wh:absence"),color:this.settings&&this.settings.getColor("absence")||"#ee0000",type:"line",data:e.absence,yAxis:1,tooltip:{valueSuffix:"%"}}]})},updateChart:function(){var e=this.serializeChartData(),t=this.getMarkerStyles(e.fte.length),i=this.chart,a=i.series;a.forEach(function(i){i.update({marker:t},!1),i.setData(e[i.options.id],!1)}),this.chart.redraw(!1)},serializeChartData:function(){return this.model.getTotalAndAbsenceData(this.options.type)},getFteSeriesName:function(){return t("reports","wh:fte"+("week"===this.model.query.get("interval")?":avg":""))},onIntervalChange:function(){this.chart&&this.chart.series[0].update({name:this.getFteSeriesName()},!1)}})});