define(["screenfull","app/highcharts","app/i18n","app/data/prodFunctions","app/core/View","./wordwrapTooltip"],function(t,e,i,r,o,n){var a="#00ee00",s="#eeee00",h="#ffaa00",c="#00aaff";return o.extend({className:function(){return"reports-chart reports-2-dirIndir"},events:{dblclick:function(){t.enabled&&t.request(this.el)}},initialize:function(){this.shouldRenderChart=!this.options.skipRenderChart,this.chart=null,this.loading=!1,this.listenTo(this.model,"request",this.onModelLoading),this.listenTo(this.model,"sync",this.onModelLoaded),this.listenTo(this.model,"error",this.onModelError),this.listenTo(this.model,"change:dirIndir",this.render),this.onFullscreenChange=this.onFullscreenChange.bind(this),this.el.ownerDocument.addEventListener(t.raw.fullscreenchange,this.onFullscreenChange)},destroy:function(){this.el.ownerDocument.removeEventListener(t.raw.fullscreenchange,this.onFullscreenChange),null!==this.chart&&(this.chart.destroy(),this.chart=null)},afterRender:function(){this.chart?this.updateChart():this.shouldRenderChart&&(this.createChart(),this.loading&&this.chart.showLoading()),this.shouldRenderChart=!0},onFullscreenChange:function(t){t.target===this.el&&this.updateChart()},createChart:function(){this.chart=new e.Chart({chart:{renderTo:this.el},title:{text:i("reports","dirIndir:title"),style:{fontSize:"12px",color:"#4D759E"}},noData:{},tooltip:{borderColor:"#999999",shared:!0},xAxis:{categories:[]},yAxis:[{title:!1},{title:!1,opposite:!0,gridLineWidth:0,min:0,labels:{format:"{value}%"},showEmpty:!1},{title:!1,opposite:!0,gridLineWidth:0,min:0,showEmpty:!1}],legend:!1,series:[{name:i("reports","dirIndir:seriesName"),type:"column",data:[],dataLabels:{enabled:!0},yAxis:0},{name:i("reports","coeffs:productivity"),color:h,type:"line",yAxis:1,data:[],tooltip:{valueSuffix:"%"}},{name:i("reports","coeffs:quantityDone"),color:c,type:"line",yAxis:2,data:[],tooltip:{valueSuffix:i("reports","quantityDoneSuffix")}}]})},updateChart:function(){var t=this.serializeChartData();this.chart.xAxis[0].setCategories(t.categories,!1),this.chart.series[0].setData(t.data,!1),this.chart.series[1].setData(t.productivity,!1),this.chart.series[2].setData(t.quantityDone,!0)},serializeChartData:function(){var e=this.model.get("dirIndir"),i={quantityDone:[],productivity:[],categories:[],data:[]};return 0===e.productivity&&0===e.direct&&0===e.indirect?i:t.isFullscreen?this.serializeChartDataByProdFunction(i):(i.productivity.push(e.productivity,e.productivity),i.categories.push("DIRECT","INDIRECT"),i.data.push({y:e.direct,color:a},{y:e.indirect,color:s}),i)},serializeChartDataByProdFunction:function(t){var e=this.model.get("tasks"),i=this.model.get("dirIndir");this.pushByProdFunction(t,i.quantityDone,i.directByProdFunction," (DIR)",a),this.pushByProdFunction(t,i.quantityDone,i.indirectByProdFunction," (INDIR)",s);var r=[];return Object.keys(i.storageByProdTasks).forEach(function(t){var o=e[t]||t;r.push({categoryName:o,name:n(o),y:i.storageByProdTasks[t],color:s})}),r.sort(function(t,e){return e.y-t.y}).forEach(function(e){t.categories.push(e.categoryName),t.data.push(e),t.quantityDone.push(i.quantityDone)}),t},pushByProdFunction:function(t,e,i,o,n){var a=[];Object.keys(i).forEach(function(t){var e=r.get(t),s=e?e.getLabel():t;a.push({category:s,name:s+o,y:i[t],color:n})}),a.sort(function(t,e){return e.y-t.y}).forEach(function(i){t.categories.push(i.category),t.data.push(i),t.quantityDone.push(e)})},onModelLoading:function(){this.loading=!0,this.chart&&this.chart.showLoading()},onModelLoaded:function(){this.loading=!1,this.chart&&this.chart.hideLoading()},onModelError:function(){this.loading=!1,this.chart&&this.chart.hideLoading()}})});