define(["underscore","screenfull","app/highcharts","app/i18n","app/core/View","app/data/categoryFactory","./wordwrapTooltip"],function(e,t,r,a,n,o,s){var i="#0e0",h="#e00",l="#ee0",c="#ee0",d="#000";return n.extend({className:function(){return"reports-chart reports-2-effIneff"},events:{dblclick:function(){t.enabled&&t.request(this.el)}},initialize:function(){this.shouldRenderChart=!this.options.skipRenderChart,this.chart=null,this.loading=!1,this.listenTo(this.model,"request",this.onModelLoading),this.listenTo(this.model,"sync",this.onModelLoaded),this.listenTo(this.model,"error",this.onModelError),this.listenTo(this.model,"change:effIneff change:prodTasks",e.debounce(this.render,1)),this.onFullscreenChange=this.onFullscreenChange.bind(this),this.el.ownerDocument.addEventListener(t.raw.fullscreenchange,this.onFullscreenChange)},destroy:function(){this.el.ownerDocument.removeEventListener(t.raw.fullscreenchange,this.onFullscreenChange),null!==this.chart&&(this.chart.destroy(),this.chart=null)},afterRender:function(){this.chart?this.updateChart():this.shouldRenderChart&&(this.createChart(),this.loading&&this.chart.showLoading()),this.shouldRenderChart=!0},onFullscreenChange:function(e){e.target===this.el&&this.updateChart()},createChart:function(){this.chart=new r.Chart({chart:{renderTo:this.el},title:{text:a("reports","effIneff:title"),style:{fontSize:"12px",color:"#4D759E"}},noData:{},tooltip:{borderColor:"#999999"},xAxis:{categories:[]},yAxis:{title:!1},legend:!1,series:[{name:a("reports","effIneff:seriesName"),type:"column",data:[],dataLabels:{enabled:!0}}]})},updateChart:function(){var e=this.serializeChartData();this.chart.xAxis[0].setCategories(e.categories,!1),this.chart.series[0].setData(e.data,!0)},serializeChartData:function(){var e=t.isFullscreen,r=this.model.get("prodTasks"),n=this.model.get("effIneff"),f=[],u=[];if(0===n.value&&0===n.dirIndir)return{categories:f,data:u};u.push({category:a("reports","effIneff:category:value"),name:a("reports","effIneff:name:value"),y:Math.abs(n.value),color:n>0?i:h},{category:a("reports","effIneff:category:dirIndir"),name:a("reports","effIneff:name:dirIndir"),y:n.dirIndir,color:l}),Object.keys(n.prodTasks).forEach(function(e){var t=r[e];u.push({category:o.getCategory("tasks",e),name:s(t?t.label:e),y:n.prodTasks[e],color:t?t.color:c})}),u.sort(function(e,t){return t.y-e.y}).forEach(function(e){f.push(e.category)});var g=f.length,p=7;if(!e&&g>p+1){for(var y=f.slice(0,p-1),m=u.slice(0,p-1),C=0,v=p;g>v;++v)C+=u[v].y;y.push(a("reports","effIneff:category:other")),m.push({name:a("reports","effIneff:name:other"),y:Math.round(10*C)/10,color:d}),f=y,u=m}if(e)for(var I=0;g>I;++I)f[I]=u[I].name;return{categories:f,data:u}},onModelLoading:function(){this.loading=!0,this.chart&&this.chart.showLoading()},onModelLoaded:function(){this.loading=!1,this.chart&&this.chart.hideLoading()},onModelError:function(){this.loading=!1,this.chart&&this.chart.hideLoading()}})});