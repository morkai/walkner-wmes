define(["underscore","screenfull","app/highcharts","app/i18n","app/core/View","app/data/categoryFactory","./wordwrapTooltip"],function(e,t,r,n,a,s,i){var o="#0e0",h="#e00",l="#ee0",c="#ee0",f="#000";return a.extend({className:function(){return"reports-chart reports-2-effIneff"},events:{dblclick:function(){t.enabled&&t.request(this.el)}},initialize:function(){this.shouldRenderChart=!this.options.skipRenderChart,this.chart=null,this.loading=!1,this.listenTo(this.model,"request",this.onModelLoading),this.listenTo(this.model,"sync",this.onModelLoaded),this.listenTo(this.model,"error",this.onModelError),this.listenTo(this.model,"change:effIneff change:prodTasks",e.debounce(this.render,1)),this.onFullscreenChange=this.onFullscreenChange.bind(this),this.el.ownerDocument.addEventListener(t.raw.fullscreenchange,this.onFullscreenChange)},destroy:function(){this.el.ownerDocument.removeEventListener(t.raw.fullscreenchange,this.onFullscreenChange),null!==this.chart&&(this.chart.destroy(),this.chart=null)},afterRender:function(){this.chart?this.updateChart():this.shouldRenderChart&&(this.createChart(),this.loading&&this.chart.showLoading()),this.shouldRenderChart=!0},onFullscreenChange:function(e){e.target===this.el&&this.updateChart()},createChart:function(){this.chart=new r.Chart({chart:{renderTo:this.el},exporting:{filename:n("reports","filenames:2:effIneff")},title:{text:n("reports","effIneff:title"),style:{fontSize:"12px",color:"#4D759E"}},noData:{},xAxis:{categories:[]},yAxis:{title:!1},legend:!1,series:[{name:n("reports","effIneff:seriesName"),type:"column",data:[],dataLabels:{enabled:!0}}]})},updateChart:function(){var e=this.serializeChartData();this.chart.xAxis[0].setCategories(e.categories,!1),this.chart.series[0].setData(e.data,!0)},serializeChartData:function(){var e=t.isFullscreen,r=this.model.get("prodTasks"),a=this.model.get("effIneff"),d=[],u=[];if(0===a.value&&0===a.dirIndir)return{categories:d,data:u};u.push({category:n("reports","effIneff:category:value"),name:n("reports","effIneff:name:value"),y:Math.abs(a.value),color:a>0?o:h},{category:n("reports","effIneff:category:dirIndir"),name:n("reports","effIneff:name:dirIndir"),y:a.dirIndir,color:l}),Object.keys(a.prodTasks).forEach(function(e){var t=r[e];u.push({category:s.getCategory("tasks",e),name:i(t?t.label:e),y:a.prodTasks[e],color:t?t.color:c})}),u.sort(function(e,t){return t.y-e.y}).forEach(function(e){d.push(e.category)});var g=d.length,p=7;if(!e&&g>p+1){for(var y=d.slice(0,p-1),m=u.slice(0,p-1),C=0,I=p;g>I;++I)C+=u[I].y;y.push(n("reports","effIneff:category:other")),m.push({name:n("reports","effIneff:name:other"),y:Math.round(10*C)/10,color:f}),d=y,u=m}if(e)for(var v=0;g>v;++v)d[v]=u[v].name;return{categories:d,data:u}},onModelLoading:function(){this.loading=!0,this.chart&&this.chart.showLoading()},onModelLoaded:function(){this.loading=!1,this.chart&&this.chart.hideLoading()},onModelError:function(){this.loading=!1,this.chart&&this.chart.hideLoading()}})});