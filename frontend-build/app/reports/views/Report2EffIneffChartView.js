define(["screenfull","app/highcharts","app/i18n","app/core/View","app/data/categoryFactory","./wordwrapTooltip"],function(e,t,r,n,s,a){return n.extend({className:function(){return"reports-chart reports-2-effIneff"},events:{dblclick:function(){e.enabled&&e.request(this.el)}},initialize:function(){this.shouldRenderChart=!this.options.skipRenderChart,this.chart=null,this.loading=!1,this.listenTo(this.model,"request",this.onModelLoading),this.listenTo(this.model,"sync",this.onModelLoaded),this.listenTo(this.model,"error",this.onModelError),this.listenTo(this.model,"change:effIneff",this.render),this.onFullscreenChange=this.onFullscreenChange.bind(this),this.el.ownerDocument.addEventListener(e.raw.fullscreenchange,this.onFullscreenChange)},destroy:function(){this.el.ownerDocument.removeEventListener(e.raw.fullscreenchange,this.onFullscreenChange),null!==this.chart&&(this.chart.destroy(),this.chart=null)},afterRender:function(){this.chart?this.updateChart():this.shouldRenderChart&&(this.createChart(),this.loading&&this.chart.showLoading()),this.shouldRenderChart=!0},onFullscreenChange:function(e){e.target===this.el&&this.updateChart()},createChart:function(){this.chart=new t.Chart({chart:{renderTo:this.el},title:{text:r("reports","effIneff:title"),style:{fontSize:"12px",color:"#4D759E"}},noData:{},tooltip:{borderColor:"#999999"},xAxis:{categories:[]},yAxis:{title:!1},legend:!1,series:[{name:r("reports","effIneff:seriesName"),type:"column",data:[],dataLabels:{enabled:!0}}]})},updateChart:function(){var e=this.serializeChartData();this.chart.xAxis[0].setCategories(e.categories,!1),this.chart.series[0].setData(e.data,!0)},serializeChartData:function(){var t=this.model.get("tasks"),n=this.model.get("effIneff"),i=[],o=[];if(0===n.value&&0===n.dirIndir)return{categories:i,data:o};i.push(r("reports","effIneff:category:value"),r("reports","effIneff:category:dirIndir")),o.push({name:r("reports","effIneff:name:value"),y:Math.abs(n.value),color:n>0?"#00ee00":"#ee0000"},{name:r("reports","effIneff:name:dirIndir"),y:n.dirIndir,color:"#eeee00"});var h=[];Object.keys(n.prodTasks).forEach(function(e){h.push({taskId:e,name:a(t[e]||e),y:n.prodTasks[e],color:"#eeee00"})}),h.sort(function(e,t){return t.y-e.y}).forEach(function(e){i.push(s.getCategory("tasks",e.taskId)),o.push(e)});var l=i.length;if(!e.isFullscreen&&l>10){for(var c=i.slice(0,9),d=o.slice(0,9),f=0,u=9;l>u;++u)f+=o[u].y;c.push(r("reports","effIneff:category:other")),d.push({name:r("reports","effIneff:name:other"),y:Math.round(10*f)/10,color:"#000"}),i=c,o=d}return e.isFullscreen||o.forEach(function(e){e.y=Math.round(e.y)}),{categories:i,data:o}},onModelLoading:function(){this.loading=!0,this.chart&&this.chart.showLoading()},onModelLoaded:function(){this.loading=!1,this.chart&&this.chart.hideLoading()},onModelError:function(){this.loading=!1,this.chart&&this.chart.hideLoading()}})});