define(["jquery","underscore","js2form","select2","app/i18n","app/data/orgUnits","app/core/View","app/reports/templates/orgUnitPicker"],function(t,e,i,n,r,s,a,o){"use strict";return a.extend({template:o,events:{submit:function(t){t.preventDefault();var e={};this.$('input[type="text"]').each(function(){this.value&&(e[this.name]=this.value.split(","))}),this.trigger("picked",e)},"click #-reset":function(){this.trigger("picked",{})},"click [data-subdivision-type]":function(t){var i="1"===t.target.dataset.nextToggle,n=t.target.dataset.subdivisionType,r=s.getAllByType("subdivision").filter(function(t){return t.get("type")===n}).map(function(t){return t.id}),a=this.$id("subdivision").val().split(",").filter(function(t){return!!t.length});return i?r.forEach(function(t){e.includes(a,t)||a.push(t)}):a=a.filter(function(t){return!e.includes(r,t)}),this.$id("subdivision").select2("val",a),t.target.dataset.nextToggle=i?"0":"1",!1}},afterRender:function(){this.setUpOrgUnitSelect2("division"),this.setUpOrgUnitSelect2("subdivision"),this.setUpOrgUnitSelect2("mrpController"),this.setUpOrgUnitSelect2("prodFlow"),this.setUpOrgUnitSelect2("workCenter"),this.setUpOrgUnitSelect2("prodLine")},setUpOrgUnitSelect2:function(t){var e=this.$id(t).val(this.model&&this.model[t]||[].join(",")),i=[];s.getAllByType(t).forEach(function(e){if("division"!==t||"prod"===e.get("type")){var n;if("subdivision"===t){if("storage"===e.get("type"))return;n=e.get("division")+" > "+e.getLabel()}else n=e.getLabel();i.push({id:e.id,text:n,deactivated:!!e.get("deactivatedAt")})}}),e.select2({multiple:!0,data:i,formatResult:function(t,e,i,r){if(!t.id)return r(t.text);var s=[];return s.push('<span style="text-decoration: '+(t.deactivated?"line-through":"initial")+'">'),n.util.markMatch(t.text,i.term,s,r),s.push("</span>"),s.join("")},formatSelection:function(t){return t.deactivated?'<span style="text-decoration: line-through">'+t.text+"</span>":t.text}})}})});