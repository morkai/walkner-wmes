// Copyright (c) 2014, ≈Åukasz Walukiewicz <lukasz@walukiewicz.eu>. Some Rights Reserved.
// Licensed under CC BY-NC-SA 4.0 <http://creativecommons.org/licenses/by-nc-sa/4.0/>.
// Part of the walkner-wmes project <http://lukasz.walukiewicz.eu/p/walkner-wmes>

define(["app/i18n","app/data/orgUnits","app/core/View","app/reports/templates/report1Header"],function(e,t,r,i){"use strict";return r.extend({template:i,initialize:function(){this.listenTo(this.model,"change",this.render),this.listenTo(this.displayOptions,"change",this.render)},serialize:function(){var r=this.model,i=[],l=t.getByTypeAndId(r.get("orgUnitType"),r.get("orgUnitId"));if(l)do{var n=t.getType(l);i.unshift({label:e("core","ORG_UNIT:"+n),value:[l.getLabel()],query:[i.length?r.serializeToString(n,l.id):null],lastI:0}),"prodFlow"===n&&(l=this.serializeMrpControllers(l,i)),l=t.getParent(l)}while(l);return{overallQuery:i.length?r.serializeToString(null,null):null,orgUnitPath:i,fragment:this.displayOptions.serializeToString()}},serializeMrpControllers:function(r,i){var l=this.model,n={label:e("core","ORG_UNIT:mrpController"),value:[],query:[],lastI:-1};return r.get("mrpController").forEach(function(e){n.lastI+=1,n.value.push(e),n.query.push(l.serializeToString("mrpController",e))}),i.unshift(n),t.getParent(r)}})});