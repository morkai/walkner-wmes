// Copyright (c) 2014, ≈Åukasz Walukiewicz <lukasz@walukiewicz.eu>. Some Rights Reserved.
// Licensed under CC BY-NC-SA 4.0 <http://creativecommons.org/licenses/by-nc-sa/4.0/>.
// Part of the walkner-wmes project <http://lukasz.walukiewicz.eu/p/walkner-wmes>

define(["underscore","app/data/orgUnits","app/settings/views/SettingsView","app/reports/templates/settings"],function(e,t,i,n){"use strict";return i.extend({clientUrl:"#reports;settings",defaultTab:"efficiency",template:n,localTopics:{"divisions.synced":"render","subdivisions.synced":"render"},events:e.extend({'change [name$="prodTask"]':function(e){this.updateSetting(e.target.name,e.target.value)},'change [name$="id"]':function(e){this.updateSetting(e.target.name,e.target.value)}},i.prototype.events),serialize:function(){return e.extend(i.prototype.serialize.call(this),{divisions:this.serializeProdDivisions(),colors:this.serializeColors()})},serializeProdDivisions:function(){return t.getAllDivisions().filter(function(e){return"prod"===e.get("type")}).map(function(e){return{_id:e.id,label:e.getLabel(),subdivisions:t.getChildren(e).map(function(e){return{_id:e.id,label:e.getLabel()}}).sort(function(e,t){return e.label.localeCompare(t.label)})}}).sort(function(e,t){return e.label.localeCompare(t.label)})},serializeStorageSubdivisions:function(){return t.getAllByType("subdivision").filter(function(e){return"storage"===e.get("type")}).map(function(e){return{id:e.id,text:e.get("division")+" \\ "+e.get("name")}}).sort(function(e,t){return e.text.localeCompare(t.text)})},serializeColors:function(){var e={};return["quantityDone","efficiency","productivity","productivityNoWh","scheduledDowntime","unscheduledDowntime","clipOrderCount","clipProduction","clipEndToEnd","direct","directRef","indirect","indirectRef","warehouse","warehouseRef","absence","absenceRef","dirIndir","dirIndirRef","eff","ineff","hrTotal"].forEach(function(t){e[t]=this.settings.getColor(t)},this),e},afterRender:function(){i.prototype.afterRender.call(this);var e=this.serializeStorageSubdivisions();this.$id("wh-comp-id").select2({width:"374px",allowClear:!0,placeholder:" ",data:e}),this.$id("wh-finGoods-id").select2({width:"374px",allowClear:!0,placeholder:" ",data:e}),this.$('input[name$="prodTask"]').select2({width:"374px",allowClear:!0,placeholder:" ",data:this.prodTasks.serializeToSelect2()})},updateSettingField:function(e){var t=this.$('input[name="'+e.id+'"]');return t.hasClass("select2-offscreen")?t.select2("val",e.getValue()):void 0}})});