// Part of <https://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

define(["underscore","app/time","app/i18n","app/highcharts","app/core/View"],function(t,e,i,s,a){"use strict";return a.extend({className:"reports-chart reports-2-delayReasons",initialize:function(){this.shouldRenderChart=!this.options.skipRenderChart,this.chart=null,this.isLoading=!1,this.listenTo(this.model,"request",this.onModelLoading),this.listenTo(this.model,"sync",this.onModelLoaded),this.listenTo(this.model,"error",this.onModelError),this.listenTo(this.model,"change:delayReasons",this.render),this.displayOptions&&this.listenTo(this.displayOptions,"change",t.debounce(this.onDisplayOptionsChange,1))},destroy:function(){null!==this.chart&&(this.chart.destroy(),this.chart=null)},afterRender:function(){this.chart?this.updateChart():this.shouldRenderChart&&(this.createChart(),this.isLoading?this.chart.showLoading():this.displayOptions||this.updateExtremes()),this.shouldRenderChart=!0},updateChart:function(){var t=this.serializeChartData();this.updateExtremes(!1),this.chart.series[0].setData(t,!0)},serializeChartData:function(){return this.model.get("delayReasons")},updateExtremes:function(t){var e=this.displayOptions;if(!e)return void this.chart.yAxis[0].setExtremes(0,null,t,!1);var i=!(this.isFullscreen||this.model.get("isParent")&&"parent"!==this.model.get("extremes")),s=i?e.get("maxDelayReasonsCount"):null;this.chart.yAxis[0].setExtremes(0,s,t,!1)},onDisplayOptionsChange:function(){var t=this.displayOptions.changedAttributes(),e=!1;void 0!==t.maxDelayReasonsCount&&(this.updateExtremes(!1),e=!0),e&&this.chart.redraw(!1)},onModelLoading:function(){this.isLoading=!0,this.chart&&this.chart.showLoading()},onModelLoaded:function(){this.isLoading=!1,this.chart&&this.chart.hideLoading()},onModelError:function(){this.isLoading=!1,this.chart&&this.chart.hideLoading()},createChart:function(){var t=this.serializeChartData();this.chart=new s.Chart({chart:{renderTo:this.el,zoomType:null,type:"column"},exporting:{filename:this.t("delayReasons:filename")},title:{text:this.t("delayReasons:title")},noData:{},legend:{enabled:!1},tooltip:{valueDecimals:0},xAxis:{type:"category"},yAxis:[{title:!1}],series:[{id:"delayReasons",name:this.t("delayReasons:metric"),data:t}]})}})});