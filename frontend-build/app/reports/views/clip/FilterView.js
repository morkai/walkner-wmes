define(["js2form","app/time","app/core/View","app/core/util/forms/dateTimeRange","app/reports/templates/clip/filter"],function(t,e,a,i,n){"use strict";return a.extend({template:n,events:{"click a[data-date-time-range]":i.handleRangeEvent,submit:function(t){t.preventDefault(),this.changeFilter()},"click #-showDisplayOptions":function(){this.trigger("showDisplayOptions")}},initialize:function(){this.listenTo(this.settings,"change",this.onSettingChange)},afterRender:function(){var e=this.serializeFormData();t(this.el,e),this.$('input[name="interval"]:checked').closest(".btn").addClass("active"),this.updateDefaultOffsets()},serializeFormData:function(){return{interval:this.model.get("interval"),"from-date":e.format(Number(this.model.get("from")),"YYYY-MM-DD"),"to-date":e.format(Number(this.model.get("to")),"YYYY-MM-DD"),offset1:this.model.get("offset1"),offset2:this.model.get("offset2"),offset3:this.model.get("offset3")}},changeFilter:function(){var t=this,a={rnd:Math.random(),from:null,to:null,interval:t.$id("intervals").find(".active > input").val(),skip:0,offset1:"",offset2:"",offset3:""},n=i.serialize(this),o=n.from||this.getFromMomentForSelectedInterval(),r=n.to||e.getMoment();a.from=o.valueOf(),a.to=r.valueOf(),t.$id("from-date").val(o.format("YYYY-MM-DD")),t.$id("to-date").val(r.format("YYYY-MM-DD")),[1,2,3].forEach(function(e){var i=t.$('input[name="offset'+e+'"]').val().trim();i.length&&(a["offset"+e]=i)}),t.model.set(a)},getSelectedInterval:function(){return this.$id("intervals").find(".active").attr("data-interval")},getFromMomentForSelectedInterval:function(){var t=e.getMoment().startOf("hour");switch(this.getSelectedInterval()){case"month":return t.date(1).hours(6);case"week":return t.day(1).hours(6);default:return t.hour(6)}},updateDefaultOffsets:function(){var t=this;["date","findDate","dataDate"].forEach(function(e,a){t.$('input[name="offset'+(a+1)+'"]').prop("placeholder",t.settings.getValue("clip."+e+"PropertyOffset")||0)})},onSettingChange:function(t){/datePropertyOffset$/i.test(t.id)&&this.updateDefaultOffsets()}})});