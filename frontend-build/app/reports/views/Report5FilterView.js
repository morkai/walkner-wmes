// Copyright (c) 2014, ≈Åukasz Walukiewicz <lukasz@walukiewicz.eu>. Some Rights Reserved.
// Licensed under CC BY-NC-SA 4.0 <http://creativecommons.org/licenses/by-nc-sa/4.0/>.
// Part of the walkner-wmes project <http://lukasz.walukiewicz.eu/p/walkner-wmes>

define(["underscore","app/time","app/core/views/FilterView","app/core/util/fixTimeRange","../util/prepareDateRange","app/reports/templates/report5Filter"],function(e,t,r,o,n,i){return r.extend({template:i,events:e.extend({},r.prototype.events,{"click a[data-range]":function(e){var t=n(e.target);this.$id("from").val(t.fromMoment.format("YYYY-MM-DD")),this.$id("to").val(t.toMoment.format("YYYY-MM-DD")),this.$('.btn[data-interval="'+t.interval+'"]:not(.active)').click(),this.$el.submit()},"click #-showDisplayOptions":function(){this.trigger("showDisplayOptions")}}),afterRender:function(){r.prototype.afterRender.call(this),this.toggleButtonGroup("interval"),this.toggleButtonGroup("weekends")},serializeQueryToForm:function(){var e=this.model;return{interval:e.get("interval"),weekends:e.get("weekends")?"1":"0",from:t.format(Number(e.get("from")),"YYYY-MM-DD"),to:t.format(Number(e.get("to")),"YYYY-MM-DD")}},changeFilter:function(){var e={rnd:Math.random(),from:null,to:null,interval:this.getButtonGroupValue("interval"),weekends:this.getButtonGroupValue("weekends")},r=o.fromView(this);e.from=r.from||this.getFromTimeByInterval(e.interval).valueOf(),e.to=r.to||Date.now(),this.$id("from").val(t.format(e.from,"YYYY-MM-DD")),this.$id("to").val(t.format(e.to,"YYYY-MM-DD")),this.model.set(e)},getFromTimeByInterval:function(e){var r=t.getMoment().minutes(0).seconds(0).milliseconds(0);switch(e){case"month":return r.date(1).hours(6).valueOf();case"week":return r.day(1).hours(6).valueOf();default:return r.hour(6).valueOf()}}})});