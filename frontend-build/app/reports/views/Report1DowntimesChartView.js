define(["jquery","app/i18n","app/core/View","app/data/colors","app/highcharts"],function(t,e,i,a,r){function o(t){if(45>t)return t;var e=t.split(" "),i=[];return e.forEach(function(t){var e=0===i.length?"":i[i.length-1];0===i.length||e.length+t.length>40?i.push(t):i[i.length-1]+=" "+t}),i.join('</span><br><span style="font-size: 10px">')}return i.extend({className:function(){return"reports-chart reports-1-"+this.options.attrName},initialize:function(){this.shouldRenderChart=!this.options.skipRenderChart,this.chart=null,this.loading=!1,this.listenTo(this.model,"request",this.onModelLoading),this.listenTo(this.model,"sync",this.onModelLoaded),this.listenTo(this.model,"error",this.onModelError),this.listenTo(this.model,"change:"+this.options.attrName,this.render)},destroy:function(){null!==this.chart&&(this.chart.destroy(),this.chart=null)},afterRender:function(){this.chart?this.updateChart():this.shouldRenderChart&&(this.createChart(),this.loading&&this.chart.showLoading()),this.shouldRenderChart=!0},createChart:function(){var t=this.serializeChartData();this.chart=new r.Chart({chart:{renderTo:this.el},title:{text:e("reports",this.options.attrName+":title"),style:{fontSize:"12px",color:"#4D759E"}},noData:{},tooltip:{borderColor:"#999999"},xAxis:{categories:t.categories},yAxis:{title:!1},legend:!1,series:[{name:e("reports",this.options.attrName+":seriesName"),color:"#ff0000",type:"column",data:t.data,tooltip:{valueSuffix:" FTE"}}]})},updateChart:function(){var t=this.serializeChartData();this.chart.xAxis[0].setCategories(t.categories,!1),this.chart.series[0].setData(t.data,!0)},serializeChartData:function(){var t={categories:[],data:[]},e=this.options.attrName,i=this.model.get(e);if(!i||!i.length)return t;var r=0;return i.forEach(function(t){t.value>r&&(r=t.value)}),i.forEach(function(i){100*i.value/r>.5&&(t.categories.push(i.shortText),t.data.push({name:o(i.longText),y:i.value,color:a.getColor(e,i.key)}))}),t},onModelLoading:function(){this.loading=!0,this.chart&&this.chart.showLoading()},onModelLoaded:function(){this.loading=!1,this.chart&&this.chart.hideLoading()},onModelError:function(){this.loading=!1,this.chart&&this.chart.hideLoading()}})});