define(["jquery","app/i18n","app/core/View","app/data/colors","app/highcharts"],function(e,t,n,r,i){function o(e){if(45>e)return e;var t=e.split(" "),n=[];return t.forEach(function(e){var t=0===n.length?"":n[n.length-1];0===n.length||t.length+e.length>40?n.push(e):n[n.length-1]+=" "+e}),n.join('</span><br><span style="font-size: 10px">')}return n.extend({className:function(){return"reports-chart reports-1-"+this.options.attrName},initialize:function(){this.shouldRenderChart=!this.options.skipRenderChart,this.chart=null,this.loading=!1,this.listenTo(this.model,"request",this.onModelLoading),this.listenTo(this.model,"sync",this.onModelLoaded),this.listenTo(this.model,"error",this.onModelError),this.listenTo(this.model,"change:"+this.options.attrName,this.render)},destroy:function(){null!==this.chart&&(this.chart.destroy(),this.chart=null)},afterRender:function(){this.chart?this.updateChart():this.shouldRenderChart&&(this.createChart(),this.loading&&this.chart.showLoading()),this.shouldRenderChart=!0},createChart:function(){var e=this.serializeChartData();this.chart=new i.Chart({chart:{renderTo:this.el},title:{text:t("reports",this.options.attrName+":title"),style:{fontSize:"12px",color:"#4D759E"}},noData:{},tooltip:{borderColor:"#999999"},xAxis:{categories:e.categories},yAxis:{title:!1},legend:!1,series:[{name:t("reports",this.options.attrName+":seriesName"),color:"#ff0000",type:"column",data:e.data,tooltip:{valueSuffix:" FTE"}}]})},updateChart:function(){var e=this.serializeChartData();this.chart.xAxis[0].setCategories(e.categories,!1),this.chart.series[0].setData(e.data,!0)},serializeChartData:function(){var e={categories:[],data:[]},t=this.options.attrName,n=this.model.get(t);if(!n||!n.length)return e;var i=0;return n.forEach(function(e){e.value>i&&(i=e.value)}),n.forEach(function(n){100*n.value/i>.5&&(e.categories.push(n.shortText),e.data.push({name:o(n.longText),y:n.value,color:r.getColor(t,n.key)}))}),e},onModelLoading:function(){this.loading=!0,this.chart&&this.chart.showLoading()},onModelLoaded:function(){this.loading=!1,this.chart&&this.chart.hideLoading()},onModelError:function(){this.loading=!1,this.chart&&this.chart.hideLoading()}})});