// Copyright (c) 2014, ≈Åukasz Walukiewicz <lukasz@walukiewicz.eu>. Some Rights Reserved.
// Licensed under CC BY-NC-SA 4.0 <http://creativecommons.org/licenses/by-nc-sa/4.0/>.
// Part of the walkner-wmes project <http://lukasz.walukiewicz.eu/p/walkner-wmes>

define(["app/highcharts","app/core/View","app/reports/templates/report8DirIndirTable"],function(i,r,t){"use strict";return r.extend({template:t,events:{"click .js-dirIndir":function(i){this.toggleDirIndir(this.$(i.currentTarget).closest("tr").attr("data-prop")),this.recountTotalDirIndir()}},initialize:function(){this.listenTo(this.model,"change",this.render)},destroy:function(){},serialize:function(){return{idPrefix:this.idPrefix,props:this.serializeProps()}},serializeProp:function(i,r,t,e){var a={plan:"",rawPlan:0,real:"",rawReal:0,className:"",dirIndir:e!==!1},s=r[t];return Array.isArray(s)?(a.plan=this.formatValue(s[0]),a.rawPlan=s[0],a.real=this.formatValue(s[1]),a.rawReal=s[1]):(a.real=this.formatValue(s),a.rawReal=s),i[t]=a,a},formatValue:function(r){return i.numberFormat(r,2)},serializeProps:function(){var i=this.model.get("summary"),r={};return this.serializeProp(r,i,"totalVolumeProduced",!1),this.serializeProp(r,i,"averageRoutingTime",!1),this.serializeProp(r,i,"prodBasedPlanners",!0),this.serializeProp(r,i,"prodQualityInspection",!0),this.serializeProp(r,i,"prodOperators",!0),this.serializeProp(r,i,"prodSetters",!0),this.serializeProp(r,i,"masters",!0),this.serializeProp(r,i,"leaders",!0),this.serializeProp(r,i,"prodMaterialHandling",!0),this.serializeProp(r,i,"kitters",!0),this.serializeProp(r,i,"prodTransport",!0),this.serializeProp(r,i,"cycleCounting",!0),this.serializeProp(r,i,"otherWarehousing",!0),this.serializeProp(r,i,"materialQualityInspection",!0),this.serializeProp(r,i,"maintenance",!0),r},adjustHeight:function(i){var r=this.$id("footer").css("height","0px"),t=this.$el.outerHeight();t>=i?r.css("display","none"):r.css({display:"",height:1+i-t+"px"})},toggleDirIndir:function(i){var r=this.$('tr[data-prop="'+i+'"]');r.hasClass("is-dir")?r.removeClass("is-dir").addClass("is-indir"):r.hasClass("is-indir")?r.removeClass("is-indir"):r.addClass("is-dir")},recountTotalDirIndir:function(){var i=0,r=0,t=0,e=0,a=!1;this.$(".is-dir").each(function(){a=!0,i+=parseFloat(this.dataset.plan),r+=parseFloat(this.dataset.real)}),this.$(".is-indir").each(function(){a=!0,t+=parseFloat(this.dataset.plan),e+=parseFloat(this.dataset.real)}),this.$id("planDirTotal").text(a?this.format00(i):""),this.$id("realDirTotal").text(a?this.format00(r):""),this.$id("planIndirTotal").text(a?this.format00(t):""),this.$id("realIndirTotal").text(a?this.format00(e):"")},format00:function(i){return(Math.round(100*i)/100).toLocaleString()}})});