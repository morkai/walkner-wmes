// Copyright (c) 2014, ≈Åukasz Walukiewicz <lukasz@walukiewicz.eu>. Some Rights Reserved.
// Licensed under CC BY-NC-SA 4.0 <http://creativecommons.org/licenses/by-nc-sa/4.0/>.
// Part of the walkner-wmes project <http://lukasz.walukiewicz.eu/p/walkner-wmes>

define(["jquery","app/time","app/i18n","app/user","app/viewport","app/core/View","app/core/util/bindLoadingMessage","../settings","../Report9","../views/Report9TableView","../views/Report9PlanUploadView","app/reports/templates/report9Page","app/reports/templates/report9Actions"],function(e,t,i,n,s,o,r,a,p,c,d,l,u){"use strict";return o.extend({layoutName:"page",pageId:"report9",template:l,breadcrumbs:[i.bound("reports","9:breadcrumbs:base")],remoteTopics:{"cags.plan.synced":function(){s.msg.show({type:"info",time:2500,text:i("reports","9:planUpload:synced")})},"cags.plan.syncFailed":function(){s.msg.show({type:"error",time:5e3,text:i("reports","9:planUpload:syncFailed")})}},actions:function(){return n.isAllowedTo("REPORTS:MANAGE")?[{template:u,afterRender:function(e){e.find("a").last().on("click",function(){return document.body.focus(),s.showDialog(new d,i("reports","9:planUpload:title")),!1})}}]:[]},initialize:function(){this.defineModels(),this.defineViews(),this.defineBindings(),this.setView("#"+this.idPrefix+"-table",this.tableView)},destroy:function(){a.release()},defineModels:function(){this.settings=r(a.acquire(),this),this.report=r(new p,this)},defineViews:function(){this.tableView=new c({model:this.report})},defineBindings:function(){},load:function(e){return e(this.settings.fetchIfEmpty(function(){return[this.report.fetch()]},this))},afterRender:function(){a.acquire()}})});