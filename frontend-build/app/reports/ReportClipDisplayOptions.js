// Part of <https://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

define(["underscore","../core/Model"],function(n,e){"use strict";function t(n,e){for(;n.length<e;)n="0"+n;return n}var r=["clipOrderCount","clipProductionCount","clipEndToEndCount","clipProduction","clipEndToEnd"];return e.extend({defaults:function(){var n={series:{},extremes:"none",zeroes:"include",maxClipOrderCount:null,maxClipPercent:null,maxDelayReasonsCount:null,maxM4sCount:null,maxDrmsCount:null};return r.forEach(function(e){n.series[e]=!0}),n},initialize:function(n,e){if(!e.settings)throw new Error("settings option is required!");this.settings=e.settings},isSeriesVisible:function(n){return!!this.get("series")[n]},updateExtremes:function(n){var e={maxClipOrderCount:null,maxClipPercent:null,maxDelayReasonsCount:null,maxM4sCount:null,maxDrmsCount:null},t=this.get("extremes");if("none"===t)return this.set(e);for(var r=this.get("series"),i="siblings"===t?1:0,o=n.length;i<o;++i){var s=n[i],u=s.get("maxClip"),a=s.get("maxDelayReasons"),l=s.get("maxM4s"),c=s.get("maxDrms");e.maxClipOrderCount=Math.max(e.maxClipOrderCount,r.clipOrderCount?u.orderCount:0,r.clipProductionCount?u.productionCount:0,r.clipEndToEndCount?u.endToEndCount:0),e.maxClipPercent=Math.max(e.maxClipPercent,r.clipProduction?u.production:0,r.clipEndToEnd?u.endToEnd:0),e.maxDelayReasonsCount=Math.max(e.maxDelayReasonsCount,a),e.maxM4sCount=Math.max(e.maxM4sCount,l),e.maxDrmsCount=Math.max(e.maxDrmsCount,c)}this.set(e)},serializeToString:function(){var n=this.get("extremes"),e=this.get("zeroes"),t=this.get("series"),i=["none"===n?0:"siblings"===n?1:2,"","include"===e?0:"gap"===e?1:2];return r.forEach(function(n){i[1]+=t[n]?1:0}),i.join("&")}},{fromString:function(n,e){var i=this,o=n.split("&");if(o.length<2)return new i(null,e);var s={extremes:"2"===o[0]?"parent":"1"===o[0]?"siblings":"none",zeroes:"2"===o[2]?"ignore":"1"===o[2]?"gap":"include",series:{}},u=t(o[1],r.length);return r.forEach(function(n,e){"1"===u[e]&&(s.series[n]=!0)}),new i(s,e)}})});