// Part of <http://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

define(["underscore","../i18n","../time","../data/aors","../core/Model"],function(o,t,n,r,i){"use strict";function e(o){return Math.round(o/60*100)/100}return i.extend({urlRoot:"/reports/7",defaults:function(){return{clip:{orderCount:[],production:[],productionCount:[],endToEnd:[],endToEndCount:[]},downtimeTimes:{indoor:[],outdoor:[],specificIndoor:[],specificOutdoor:[]},downtimeCounts:{indoor:[],outdoor:[],specificIndoor:[],specificOutdoor:[]}}},initialize:function(o,t){if(!t.query)throw new Error("query option is required!");this.query=t.query},getSingleAor:function(){var t=o.without(this.query.get("aors"),this.query.get("specificAor"));return 1===t.length?r.get(t[0]):null},getSpecificAor:function(){return r.get(this.query.get("specificAor"))},fetch:function(t){return o.isObject(t)||(t={}),t.data=o.extend(t.data||{},this.query.serializeToObject()),i.prototype.fetch.call(this,t)},parse:function(o){var t={clip:null,downtimeCounts:null,downtimeTimes:null};return this.parseClip(o.clip,t),this.parseDowntimes(o.downtimes,t),this.attributes.clip=null,this.attributes.downtimeTimes=null,this.attributes.downtimeCounts=null,t},parseClip:function(t,n){var r={orderCount:[],productionCount:[],endToEndCount:[],production:[],endToEnd:[]};o.forEach(t,function(o){var t=o.key;r.orderCount.push({x:t,y:o.orderCount||0}),r.productionCount.push({x:t,y:o.productionCount||0}),r.endToEndCount.push({x:t,y:o.endToEndCount||0}),r.production.push({x:t,y:Math.round(100*(o.production||0))}),r.endToEnd.push({x:t,y:Math.round(100*(o.endToEnd||0))})}),n.clip=r},parseDowntimes:function(o,t){for(var n={indoor:[],outdoor:[],specificIndoor:[],specificOutdoor:[]},r={indoor:[],outdoor:[],specificIndoor:[],specificOutdoor:[]},i=0;i<o.length;++i){var u=o[i],d=u.key;n.indoor.push({x:d,y:e(u.indoorDuration),workerCount:u.indoorWorkerCount}),n.outdoor.push({x:d,y:e(u.outdoorDuration),workerCount:u.outdoorWorkerCount}),n.specificIndoor.push({x:d,y:e(u.specificIndoorDuration),workerCount:u.specificIndoorWorkerCount}),n.specificOutdoor.push({x:d,y:e(u.specificOutdoorDuration),workerCount:u.specificOutdoorWorkerCount}),r.indoor.push({x:d,y:u.indoorCount}),r.outdoor.push({x:d,y:u.outdoorCount}),r.specificIndoor.push({x:d,y:u.specificIndoorCount}),r.specificOutdoor.push({x:d,y:u.specificOutdoorCount})}t.downtimeTimes=n,t.downtimeCounts=r}})});