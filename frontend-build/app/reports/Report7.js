define(["underscore","../i18n","../time","../data/aors","../core/Model"],function(o,t,n,r,i){"use strict";function u(o){return Math.round(o/60*100)/100}return i.extend({urlRoot:"/reports/7",defaults:function(){return{clip:{orderCount:[],production:[],productionCount:[],endToEnd:[],endToEndCount:[]},downtimeTimes:{indoor:[],outdoor:[],specificIndoor:[],specificOutdoor:[]},downtimeCounts:{indoor:[],outdoor:[],specificIndoor:[],specificOutdoor:[]}}},initialize:function(o,t){if(!t.query)throw new Error("query option is required!");this.query=t.query},getSingleAor:function(){var t=o.without(this.query.get("aors"),this.query.get("specificAor"));return 1===t.length?r.get(t[0]):null},getSpecificAor:function(){return r.get(this.query.get("specificAor"))},fetch:function(t){return o.isObject(t)||(t={}),t.data=o.assign(t.data||{},this.query.serializeToObject()),i.prototype.fetch.call(this,t)},parse:function(o){var t={clip:null,downtimeCounts:null,downtimeTimes:null};return this.parseClip(o.clip,t),this.parseDowntimes(o.downtimes,t),this.attributes.clip=null,this.attributes.downtimeTimes=null,this.attributes.downtimeCounts=null,t},parseClip:function(t,n){var r={orderCount:[],productionCount:[],endToEndCount:[],production:[],endToEnd:[]};o.forEach(t,function(o){var t=o.key,n=Math.round(o.productionCount/o.orderCount*1e3)/10||0,i=Math.round(o.endToEndCount/o.orderCount*1e3)/10||0;r.orderCount.push({x:t,y:o.orderCount||0}),r.productionCount.push({x:t,y:o.productionCount||0}),r.endToEndCount.push({x:t,y:o.endToEndCount||0}),r.production.push({x:t,y:n}),r.endToEnd.push({x:t,y:i})}),n.clip=r},parseDowntimes:function(o,t){for(var n={indoor:[],outdoor:[],specificIndoor:[],specificOutdoor:[]},r={indoor:[],outdoor:[],specificIndoor:[],specificOutdoor:[]},i=0;i<o.length;++i){var e=o[i],d=e.key;n.indoor.push({x:d,y:u(e.indoorDuration),workerCount:e.indoorWorkerCount}),n.outdoor.push({x:d,y:u(e.outdoorDuration),workerCount:e.outdoorWorkerCount}),n.specificIndoor.push({x:d,y:u(e.specificIndoorDuration),workerCount:e.specificIndoorWorkerCount}),n.specificOutdoor.push({x:d,y:u(e.specificOutdoorDuration),workerCount:e.specificOutdoorWorkerCount}),r.indoor.push({x:d,y:e.indoorCount}),r.outdoor.push({x:d,y:e.outdoorCount}),r.specificIndoor.push({x:d,y:e.specificIndoorCount}),r.specificOutdoor.push({x:d,y:e.specificOutdoorCount})}t.downtimeTimes=n,t.downtimeCounts=r}})});