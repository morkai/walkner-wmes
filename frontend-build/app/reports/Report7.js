// Copyright (c) 2014, ≈Åukasz Walukiewicz <lukasz@walukiewicz.eu>. Some Rights Reserved.
// Licensed under CC BY-NC-SA 4.0 <http://creativecommons.org/licenses/by-nc-sa/4.0/>.
// Part of the walkner-wmes project <http://lukasz.walukiewicz.eu/p/walkner-wmes>

define(["underscore","../time","../core/Model"],function(o,n,t){"use strict";return t.extend({urlRoot:"/reports/7",defaults:function(){return{clip:{orderCount:[],production:[],productionCount:[],endToEnd:[],endToEndCount:[]},downtimeTimes:{categories:[],indoor:[],outdoor:[]},downtimeCounts:{categories:[],indoor:[],outdoor:[]}}},initialize:function(o,n){if(!n.query)throw new Error("query option is required!");this.query=n.query},fetch:function(n){return o.isObject(n)||(n={}),n.data=o.extend(n.data||{},this.query.serializeToObject()),t.prototype.fetch.call(this,n)},parse:function(o){var n={clip:null,downtimeCount:null,downtimeDuration:null};return this.parseClip(o.clip,n),this.parseDowntimes(o.downtimes,n),n},parseClip:function(n,t){var r={orderCount:[],productionCount:[],endToEndCount:[],production:[],endToEnd:[]};o.forEach(n,function(o){r.orderCount.push({x:o.key,y:o.orderCount||0}),r.productionCount.push({x:o.key,y:o.productionCount||0}),r.endToEndCount.push({x:o.key,y:o.endToEndCount||0}),r.production.push({x:o.key,y:Math.round(100*(o.production||0))}),r.endToEnd.push({x:o.key,y:Math.round(100*(o.endToEnd||0))})}),t.clip=r},parseDowntimes:function(o,t){for(var r={categories:[],indoor:[],outdoor:[]},e={categories:[],indoor:[],outdoor:[]},u=0;u<o.length;++u){var i=o[u],d=n.getMoment(i.key),s=d.format("MMMM");r.categories.push(s),r.indoor.push(Math.round(i.indoorDuration/3600*100)/100),r.outdoor.push(Math.round(i.outdoorDuration/3600*100)/100),e.categories.push(s),e.indoor.push(i.indoorCount),e.outdoor.push(i.outdoorCount)}t.downtimeTimes=r,t.downtimeCounts=e}})});