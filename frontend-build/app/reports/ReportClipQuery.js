define(["underscore","../time","../core/Model","../data/orgUnits","../mrpControllers/MrpController","./ReportClip"],function(t,e,r,o,i,n){"use strict";return r.extend({defaults:function(){var t=e.getMoment();return t.hours()<6&&t.subtract(1,"days"),t.startOf("day"),{orgUnitType:null,orgUnitId:null,to:t.valueOf(),from:t.subtract(7,"days").valueOf(),interval:"day",limit:25,skip:0,orderHash:null,orderCount:0,offset1:"",offset2:"",offset3:""}},reset:function(e){this.set(t.defaults(e,this.defaults()),{reset:!0})},createReports:function(t,e,r){var s=[],f=this.get("orgUnitType"),l=o.getByTypeAndId(f,this.get("orgUnitId"));l||"mrpController"!==f||(l=new i({_id:this.get("orgUnitId"),subdivision:null})),t||(t=new n({orgUnitType:this.get("orgUnitType"),orgUnit:l},r)),s.push(t);var g,d=o.getChildType(f);return l?"mrpController"===d?g=t.get("children").map(function(t){var e=o.getByTypeAndId("mrpController",t);return new i({_id:t,subdivision:l.id,description:e?e.get("description"):""})}):"prodFlow"===d?g=t.get("children").map(function(t){return o.getByTypeAndId(d,t)}):(g=o.getChildren(l),"subdivision"===d&&(g=g.filter(function(t){return"assembly"===t.get("type")}))):g=o.getAllDivisions().filter(function(t){return"prod"===t.get("type")}),g.sort(function(t,e){return t.getLabel().localeCompare(e.getLabel())}),g.forEach(function(t){e&&t.id===e.get("orgUnit").id?s.push(e):s.push(new n({orgUnitType:d,orgUnit:t},r))}),s},serializeToObject:function(t,e){var r={interval:this.get("interval"),from:this.get("from"),to:this.get("to"),offset1:this.get("offset1"),offset2:this.get("offset2"),offset3:this.get("offset3")};return t&&e&&(r.orgUnitType=t,r.orgUnitId=e.id),r},serializeToString:function(t,e){var r="",o=this.attributes;return o.interval&&(r+="&interval="+o.interval),o.from&&o.to&&(r+="&from="+o.from,r+="&to="+o.to),2===arguments.length&&void 0!==t?t&&(r+="&orgUnitType="+t,r+="&orgUnitId="+encodeURIComponent(e)):o.orgUnitType&&(r+="&orgUnitType="+o.orgUnitType,r+="&orgUnitId="+encodeURIComponent(o.orgUnitId)),r+="&limit="+o.limit,r+="&skip="+o.skip,r+="&offset1="+o.offset1,r+="&offset2="+o.offset2,(r+="&offset3="+o.offset3).substr(1)}})});