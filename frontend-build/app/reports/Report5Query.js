// Part of <http://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

define(["underscore","../time","../core/Model","../data/orgUnits","./Report5"],function(e,t,n,r,o){"use strict";return n.extend({defaults:function(){var e=t.getMoment().hours(0).minutes(0).seconds(0).milliseconds(0);return{orgUnitType:null,orgUnitId:null,to:e.valueOf(),from:e.subtract(1,"days").valueOf(),interval:"shift",weekends:!0}},reset:function(t){this.set(e.defaults(t,this.defaults()),{reset:!0})},createReports:function(e,t,n){var i=[],s=this.get("orgUnitType"),g=r.getByTypeAndId(s,this.get("orgUnitId"));e||(e=new o({orgUnitType:this.get("orgUnitType"),orgUnit:g},n)),i.push(e);var u,a=r.getChildType(s);return u=g?r.getChildren(g).sort(function(e,t){return e.getLabel().localeCompare(t.getLabel())}):r.getAllDivisions().filter(function(e){return"other"!==e.get("type")}).sort(function(e,t){var n=e.get("type");return n===t.get("type")?e.id.localeCompare(t.id):"prod"===n?-1:1}),u.forEach(function(e){t&&e===t.get("orgUnit")?i.push(t):i.push(new o({orgUnitType:a,orgUnit:e},n))}),i},serializeToObject:function(e,t){var n={interval:this.get("interval"),from:this.get("from"),to:this.get("to"),weekends:this.get("weekends")};return e&&t&&(n.orgUnitType=e,n.orgUnitId=t.id),n},serializeToString:function(e,t){var n="",r=this.attributes;return r.interval&&(n+="&interval="+r.interval),r.weekends&&(n+="&weekends=1"),r.from&&r.to&&(n+="&from="+r.from,n+="&to="+r.to),2===arguments.length&&void 0!==e?e&&(n+="&orgUnitType="+e,n+="&orgUnitId="+encodeURIComponent(t)):r.orgUnitType&&(n+="&orgUnitType="+r.orgUnitType,n+="&orgUnitId="+encodeURIComponent(r.orgUnitId)),n.substr(1)}})});