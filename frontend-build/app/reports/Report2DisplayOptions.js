// Copyright (c) 2014, ≈Åukasz Walukiewicz <lukasz@walukiewicz.eu>. Some Rights Reserved.
// Licensed under CC BY-NC-SA 4.0 <http://creativecommons.org/licenses/by-nc-sa/4.0/>.
// Part of the walkner-wmes project <http://lukasz.walukiewicz.eu/p/walkner-wmes>

define(["underscore","../core/Model"],function(n,e){"use strict";function t(n,e){for(;n.length<e;)n="0"+n;return n}var i=["clipOrderCount","clipProductionCount","clipEndToEndCount","clipProduction","clipEndToEnd"];return e.extend({defaults:function(){var n={series:{},extremes:"none",maxClipOrderCount:null,maxClipPercent:null};return i.forEach(function(e){n.series[e]=!0}),n},initialize:function(n,e){if(!e.settings)throw new Error("settings option is required!");this.settings=e.settings},isSeriesVisible:function(n){return!!this.get("series")[n]},updateExtremes:function(n){var e={maxClipOrderCount:null,maxClipPercent:null},t=this.get("extremes");if("none"===t)return this.set(e);for(var i=this.get("series"),r="siblings"===t?1:0,o=n.length;o>r;++r){var s=n[r],u=s.get("maxClip");e.maxClipOrderCount=Math.max(e.maxClipOrderCount,i.clipOrderCount?u.orderCount:0,i.clipProductionCount?u.productionCount:0,i.clipEndToEndCount?u.endToEndCount:0),e.maxClipPercent=Math.max(e.maxClipPercent,i.clipProduction?u.production:0,i.clipEndToEnd?u.endToEnd:0)}this.set(e)},serializeToString:function(){var n=this.get("extremes"),e=this.get("series"),t=["none"===n?0:"siblings"===n?1:2,""];return i.forEach(function(n){t[1]+=e[n]?1:0}),t.join("&")}},{fromString:function(n,e){var r=this,o=n.split("&");if(2!==o.length)return new r(null,e);var s={extremes:"2"===o[0]?"parent":"1"===o[0]?"siblings":"none",series:{}},u=t(o[1],i.length);return i.forEach(function(n,e){"1"===u[e]&&(s.series[n]=!0)}),new r(s,e)}})});