// Copyright (c) 2014, ≈Åukasz Walukiewicz <lukasz@walukiewicz.eu>. Some Rights Reserved.
// Licensed under CC BY-NC-SA 4.0 <http://creativecommons.org/licenses/by-nc-sa/4.0/>.
// Part of the walkner-wmes project <http://lukasz.walukiewicz.eu/p/walkner-wmes>

define(["underscore","../core/Model"],function(e,n){"use strict";function t(e,n){for(;e.length<n;)e="0"+e;return e}var r=["clipOrderCount","clipProduction","clipEndToEnd"];return n.extend({defaults:function(){var e={series:{},extremes:"none",maxClipOrderCount:null,maxClipPercent:null};return r.forEach(function(n){e.series[n]=!0}),e},initialize:function(e,n){if(!n.settings)throw new Error("settings option is required!");this.settings=n.settings},isSeriesVisible:function(e){return!!this.get("series")[e]},updateExtremes:function(e){var n={maxClipOrderCount:null,maxClipPercent:null},t=this.get("extremes");if("none"===t)return this.set(n);for(var r=this.get("series"),i="siblings"===t?1:0,s=e.length;s>i;++i){var o=e[i],u=o.get("maxClip");n.maxClipOrderCount=Math.max(n.maxClipOrderCount,r.clipOrderCount?u.orderCount:0),n.maxClipPercent=Math.max(n.maxClipPercent,r.clipProduction?u.production:0,r.clipEndToEnd?u.endToEnd:0)}this.set(n)},serializeToString:function(){var e=this.get("extremes"),n=this.get("series"),t=["none"===e?0:"siblings"===e?1:2,""];return r.forEach(function(e){t[1]+=n[e]?1:0}),t.join("&")}},{fromString:function(e,n){var i=this,s=e.split("&");if(2!==s.length)return new i(null,n);var o={extremes:"2"===s[0]?"parent":"1"===s[0]?"siblings":"none",series:{}},u=t(s[1],r.length);return r.forEach(function(e,n){"1"===u[n]&&(o.series[e]=!0)}),new i(o,n)}})});