define(["underscore","app/i18n","app/time","app/core/Model","app/core/Collection","app/core/util/getShiftStartInfo"],function(t,e,r,o,n,i){"use strict";return o.extend({urlRoot:"/reports/rearm",nlsDomain:"reports",defaults:function(){return{from:0,to:0,lines:[],report:null}},initialize:function(){this.lines=new n,this.on("change:report",this.onReportChange),this.set("report",{options:{},settings:{},lines:[]})},onReportChange:function(){this.lines.reset(this.get("report").lines)},fetch:function(e){return t.isObject(e)||(e={}),e.data=t.assign(e.data||{},t.pick(this.attributes,["from","to","mrps"])),Object.keys(e.data).forEach(t=>{Array.isArray(e.data[t])&&(e.data[t]=e.data[t].join(","))}),o.prototype.fetch.call(this,e)},genClientUrl:function(){return"/reports/rearm?from="+(this.get("from")||"")+"&to="+(this.get("to")||"")+"&mrps="+(this.get("mrps")||"")},parse:function(t){const e={};return t.lines.forEach(function(t){t.orders=t.orders.map(function(r){const o=r[6];let n=e[o];n||(n=e[o]=i(o).no);let s=0;return{line:t._id,prodShift:r[s++],prodShiftOrder:r[s++],orderNo:r[s++],mrp:r[s++],firstAt:r[s++],lastAt:r[s++],shiftAt:r[s++],shiftNo:n,startedAt:r[s++],finishedAt:r[s++],sapTaktTime:r[s++],avgTaktTime:r[s++],medTaktTime:r[s++],quantityDone:r[s++],workerCount:r[s++],efficiency:r[s++],idle:r[s++],downtimes:r[s++],metrics:r[s++]}})}),{report:t}}},{fromQuery:function(e){const o={from:+e.from||0,to:+e.to||0};return o.from&&o.to||(o.from=r.getMoment().startOf("day").subtract(7,"days").valueOf(),o.to=r.getMoment().startOf("day").add(1,"days").valueOf()),["mrps"].forEach(r=>{o[r]=t.isEmpty(e[r])?[]:e[r].split(",")}),new this(o)}})});