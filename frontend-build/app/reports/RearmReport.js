define(["underscore","app/i18n","app/time","app/core/Model","app/core/Collection","app/core/util/getShiftStartInfo"],function(t,r,e,o,i,n){"use strict";return o.extend({urlRoot:"/reports/rearm",nlsDomain:"reports",defaults:function(){return{from:0,to:0,lines:[],report:null}},initialize:function(){this.lines=new i,this.on("change:report",this.onReportChange),this.set("report",{lines:[]})},onReportChange:function(){var t=this.get("report");this.lines.reset(t.lines)},fetch:function(r){return t.isObject(r)||(r={}),r.data=t.assign(r.data||{},t.pick(this.attributes,["from","to","mrps"])),Object.keys(r.data).forEach(function(t){Array.isArray(r.data[t])&&(r.data[t]=r.data[t].join(","))}),o.prototype.fetch.call(this,r)},genClientUrl:function(){return"/reports/rearm?from="+(this.get("from")||"")+"&to="+(this.get("to")||"")+"&mrps="+(this.get("mrps")||"")},parse:function(t){var r={};return t.lines.forEach(function(t){t.orders=t.orders.map(function(e){var o=e[4],i=r[o];i||(i=r[o]=n(o).no);var a=5;return{line:t._id,orderNo:e[0],mrp:e[1],firstAt:e[2],lastAt:e[3],shiftAt:o,shiftNo:i,startedAt:e[a++],finishedAt:e[a++],avgTaktTime:e[a++],quantityDone:e[a++],efficiency:e[a++],idle:e[a++],downtime:e[a++],breaks:e[a++],metric0:e[a++],metric1:e[a++],metric2:e[a++],metric3:e[a++]}})}),{report:t}}},{fromQuery:function(r){var o={from:+r.from||0,to:+r.to||0};return o.from&&o.to||(o.from=e.getMoment().startOf("day").subtract(7,"days").valueOf(),o.to=e.getMoment().startOf("day").add(1,"days").valueOf()),["mrps"].forEach(function(e){o[e]=t.isEmpty(r[e])?[]:r[e].split(",")}),new this(o)}})});