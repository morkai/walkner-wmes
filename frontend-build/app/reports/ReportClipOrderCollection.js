// Part of <https://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

define(["underscore","app/orders/OrderCollection"],function(i,r){"use strict";return r.extend({nlsDomain:"reports",url:"/reports/clip/orders",rqlQuery:function(i){return i.Query.fromObject({limit:25})},initialize:function(i,r){if(!r.query)throw new Error("query option is required!");this.hash=null,this.query=r.query,this.displayOptions=r.displayOptions,this.rqlQuery.limit=+this.query.get("limit"),this.rqlQuery.skip=+this.query.get("skip")},sync:function(){return this.hash=null,this.rqlQuery.selector.args=[{name:"eq",args:["hash",this.query.get("orderHash")]},{name:"eq",args:["count",this.query.get("orderCount")]}],r.prototype.sync.apply(this,arguments)},parse:function(i){var r=this;return r.paginationData&&r.paginationData.set(r.getPaginationData(i)),Array.isArray(i.collection)?i.collection.map(function(i){return r.hash=i._id.hash,i._id=i._id.no,i}):[]},genPaginationUrlTemplate:function(){return"#reports/clip?"+this.query.serializeToString().replace(/limit=[0-9]+/,"limit=${limit}").replace(/skip=[0-9]+/,"skip=${skip}")+"#"+(this.displayOptions?this.displayOptions.serializeToString():"")}})});