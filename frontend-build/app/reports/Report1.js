define(["underscore","../i18n","../data/aors","../data/downtimeReasons","../core/Model"],function(e,t,n,r,i){return i.extend({urlRoot:"/reports/1",defaults:function(){return{orgUnitType:null,orgUnit:null,coeffs:{quantityDone:[],downtime:[],efficiency:[],productivity:[]},downtimesByAor:[],downtimesByReason:[]}},initialize:function(e,t){if(!t.query)throw new Error("query option is required!");this.query=t.query},fetch:function(t){return e.isObject(t)||(t={}),t.data=e.extend(t.data||{},this.query.serializeToObject(this.get("orgUnitType"),this.get("orgUnit"))),i.prototype.fetch.call(this,t)},parse:function(e){return{coeffs:this.parseCoeffs(e.coeffs),downtimesByAor:this.parseDowntimesByAor(e.downtimes.byAor).sort(this.sortByValueDesc),downtimesByReason:this.parseDowntimesByReason(e.downtimes.byReason).sort(this.sortByValueDesc)}},parseCoeffs:function(e){var t={quantityDone:[],downtime:[],efficiency:[],productivity:[]};return e.forEach(function(e){var n=Date.parse(e.key);t.quantityDone.push({x:n,y:e.quantityDone||0}),t.downtime.push({x:n,y:Math.round(100*(e.downtime||0))}),t.efficiency.push({x:n,y:Math.round(100*(e.efficiency||0))}),t.productivity.push({x:n,y:Math.round(100*(e.productivity||0))})}),t},parseDowntimesByAor:function(e){var r=[];return e&&Object.keys(e).forEach(function(i){var o,a;if("null"===i)o=t("reports","downtimesByAor:press:longText"),a=t("reports","downtimesByAor:press:shortText");else{var s=n.get(i);o=s?s.getLabel():i;var l=o.indexOf("-");a=-1===l?o>13?o.substr(0,10).trim()+"...":o:o.substr(0,l).trim()}r.push({key:i,longText:o,shortText:a,value:Math.round(100*e[i])/100})}),r},parseDowntimesByReason:function(e){var t=[];return e&&Object.keys(e).forEach(function(n){var i=r.get(n);t.push({key:n,longText:i?i.getLabel():n,shortText:n,value:Math.round(100*e[n])/100})}),t},sortByValueDesc:function(e,t){return t.value-e.value}})});