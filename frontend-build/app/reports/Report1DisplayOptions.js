define(["underscore","../core/Model","../data/aors","../data/downtimeReasons"],function(e,t,n,i){"use strict";var s=["quantityDone","scheduledDowntime","unscheduledDowntime","efficiency","productivity","productivityNoWh"];function r(e,t){for(;e.length<t;)e="0"+e;return e}return t.extend({defaults:function(){var e={series:{},aors:{},reasons:{},extremes:"none",skipEmpty:!1,maxQuantityDone:null,maxPercentCoeff:null,maxDowntimesByAor:null,maxDowntimesByReason:null,references:{}};return s.forEach(function(t){e.series[t]=!0,e.references[t]=!0}),n.forEach(function(t){e.aors[t.id]=!0,e.references[t.id]=!0}),i.forEach(function(t){e.reasons[t.id]=!0,e.references[t.id]=!0}),e},initialize:function(e,t){if(!t.settings)throw new Error("settings option is required!");this.settings=t.settings},isSeriesVisible:function(e){return!!this.get("series")[e]},isReferenceVisible:function(e){return!!this.get("references")[e]},updateExtremes:function(e){var t={maxQuantityDone:null,maxPercentCoeff:null,maxDowntimesByAor:null,maxDowntimesByReason:null},n=this.get("extremes");if("none"===n)return this.set(t);for(var i=this.get("series"),s=this.get("aors"),r=this.get("reasons"),o=this.get("references"),c="siblings"===n?1:0,a=e.length;c<a;++c){var u=e[c],f=u.get("maxCoeffs"),h=u.getReferenceOrgUnitId();t.maxQuantityDone=Math.max(t.maxQuantityDone,i.quantityDone?f.quantityDone:0),t.maxPercentCoeff=Math.max(t.maxPercentCoeff,i.scheduledDowntime?f.scheduledDowntime:0,i.scheduledDowntime&&o.scheduledDowntime?this.settings.getReference("scheduledDowntime",h):0,i.unscheduledDowntime?f.unscheduledDowntime:0,i.unscheduledDowntime&&o.unscheduledDowntime?this.settings.getReference("unscheduledDowntime",h):0,i.efficiency?f.efficiency:0,i.efficiency&&o.efficiency?this.settings.getReference("efficiency",h):0,i.productivity?f.productivity:0,i.productivity&&o.productivity?this.settings.getReference("productivity",h):0,i.productivityNoWh?f.productivityNoWh:0,i.productivityNoWh&&o.productivityNoWh?this.settings.getReference("productivityNoWh",h):0),t.maxDowntimesByAor=Math.max(t.maxDowntimesByAor,u.getMaxDowntimesByAor(s,o)),t.maxDowntimesByReason=Math.max(t.maxDowntimesByReason,u.getMaxDowntimesByReason(r,o))}this.set(t)},serializeToString:function(){var e=this.get("extremes"),t=this.get("series"),r=this.get("references"),o=this.get("aors"),c=this.get("reasons"),a=["none"===e?0:"siblings"===e?1:2,"","","",this.get("skipEmpty")?"1":"0"];return s.forEach(function(e){a[1]+=t[e]?1:0,a[1]+=r[e]?1:0}),n.forEach(function(e){a[2]+=o[e.id]?1:0,a[2]+=r[e.id]?1:0}),i.forEach(function(e){a[3]+=c[e.id]?1:0,a[3]+=r[e.id]?1:0}),a.join("&")}},{fromString:function(e,t){var o=e.split("&");if(o.length<4)return new this(null,t);var c,a,u={extremes:"2"===o[0]?"parent":"1"===o[0]?"siblings":"none",series:{},aors:{},reasons:{},references:{},skipEmpty:!1},f=r(o[1],2*s.length);for(c=2*s.length-1,a=s.length-1;c>0;--c,--a)"1"===f[c]&&(u.references[s[a]]=!0),"1"===f[--c]&&(u.series[s[a]]=!0);var h=r(o[2],2*n.length);for(c=2*n.length-1,a=n.length-1;c>0;--c,--a){var d=n.at(a);"1"===h[c]&&(u.references[d.id]=!0),"1"===h[--c]&&(u.aors[d.id]=!0)}var l=r(o[3],2*i.length);for(c=2*i.length-1,a=i.length-1;c>0;--c,--a){var m=i.at(a);"1"===l[c]&&(u.references[m.id]=!0),"1"===l[--c]&&(u.reasons[m.id]=!0)}return u.skipEmpty="1"===o[4],console.log(o,u),new this(u,t)}})});