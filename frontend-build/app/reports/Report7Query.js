// Copyright (c) 2014, ≈Åukasz Walukiewicz <lukasz@walukiewicz.eu>. Some Rights Reserved.
// Licensed under CC BY-NC-SA 4.0 <http://creativecommons.org/licenses/by-nc-sa/4.0/>.
// Part of the walkner-wmes project <http://lukasz.walukiewicz.eu/p/walkner-wmes>

define(["underscore","../time","../user","../core/Model"],function(t,s,e,r){"use strict";return r.extend({defaults:function(){return{aors:e.data.aors||[],statuses:["confirmed"],limit:8,skip:0}},reset:function(s){this.set(t.defaults(this.constructor.prepareAttrsFromQuery(s),this.defaults),{reset:!0})},serializeToObject:function(){return{aors:this.get("aors").join(","),statuses:this.get("statuses").join(",")}},serializeToString:function(){var t="",s=this.attributes;return s.aors&&(t+="&aors="+s.aors),t+="&statuses=confirmed",t+="&limit="+s.limit,t+="&skip="+s.skip,t.substr(1)},createProdDowntimesSelector:function(){var t=s.getMoment().startOf("month").hours(6),e=this.get("statuses"),r=this.get("aors"),a={name:"and",args:[]};return a.args.push({name:"ge",args:["startedAt",t.valueOf()]},{name:"lt",args:["startedAt",t.add(1,"months").valueOf()]}),2===e.length?a.args.push({name:"in",args:["status",e]}):1===e.length&&a.args.push({name:"eq",args:["status",e[0]]}),1===r.length?a.args.push({name:"eq",args:["aor",r[0]]}):r.length>0&&a.args.push({name:"in",args:["aor",r]}),a}},{prepareAttrsFromQuery:function(t){return{aors:t.aors?t.aors.split(","):e.data.aors||[],statuses:t.statuses?t.statuses.split(","):["confirmed"],limit:parseInt(t.limit,10)||8,skip:parseInt(t.skip,10)||0}},fromQuery:function(t){return new this(this.prepareAttrsFromQuery(t))}})});