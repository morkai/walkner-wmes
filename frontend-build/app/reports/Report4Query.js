define(["h5.rql/index","../time","../core/Model"],function(e,t,i){"use strict";return i.extend({defaults:function(){var e=t.getMoment().weekday(0).hours(0).minutes(0).seconds(0).milliseconds(0);return{from:e.valueOf(),to:e.add(7,"days").valueOf(),interval:"day",mode:"shift",masters:void 0,operators:void 0,divisions:[],shifts:[1,2,3]}},serializeToObject:function(){var e={from:this.get("from"),to:this.get("to"),interval:this.get("interval"),mode:this.get("mode"),divisions:this.get("divisions").join(","),shifts:this.get("shifts").join(",")};return"shift"!==e.mode&&(e[e.mode]=this.get(e.mode),Array.isArray(e[e.mode])&&(e[e.mode]=this.serializeUsers())),e},serializeToString:function(){var e=this.attributes,t="from="+e.from+"&to="+e.to+"&interval="+e.interval;return e.mode&&(t+="&mode="+e.mode,"shift"!==e.mode&&(t+="&"+e.mode+"=",Array.isArray(e[e.mode])&&(t+=this.serializeUsers()))),t+="&divisions="+e.divisions.join(",")+"&shifts="+e.shifts.join(",")},serializeUsers:function(){var e=this.get(this.get("mode"));return Array.isArray(e)?e.map(function(e){return e._id?e._id:e}).join(","):""},getUsersForSelect2:function(){if("shift"===this.get("mode"))return[];var e=this.get(this.get("mode"));return Array.isArray(e)?e.map(function(e){return"string"==typeof e?{id:e,text:e}:e&&e._id?{id:e._id,text:e.lastName+" "+e.firstName+" ("+e.personnelId+")"}:null}).filter(function(e){return null!==e}):[]},updateUsers:function(e){"shift"!==this.get("mode")&&this.set(this.get("mode"),e)}},{fromQuery:function(e){var t={};return e.from&&e.to&&(t.from=parseInt(e.from,10),t.to=parseInt(e.to,10)),e.interval&&(t.interval=e.interval),e.mode&&(t.mode=e.mode,"masters"===e.mode||"operators"===e.mode?(t[t.mode]=String(e[t.mode]).split(","),0===t[t.mode].length&&(delete t.mode,delete t[t.mode])):"shift"!==e.mode&&delete t.mode),e.divisions&&(t.divisions=e.divisions.split(",")),e.shifts&&(t.shifts=e.shifts.split(",")),new this(t)}})});