define(["underscore","h5.rql/index","../time","../core/Model","../core/util/getShiftStartInfo"],function(e,t,r,o,i){return o.extend({defaults:function(){var e=r.getMoment().weekday(0).hours(0).minutes(0).seconds(0).milliseconds(0),t=i(new Date);return{from:e.valueOf(),to:e.add("days",7).valueOf(),interval:"day",mode:"shift",shift:t.shift,masters:void 0,operators:void 0}},serializeToObject:function(){var e={from:this.get("from"),to:this.get("to"),interval:this.get("interval"),mode:this.get("mode")};return e.mode&&(e[e.mode]=this.get(e.mode),Array.isArray(e[e.mode])&&(e[e.mode]=this.serializeUsers())),e},serializeToString:function(){var e=this.attributes,t="from="+e.from+"&to="+e.to+"&interval="+e.interval;return e.mode&&(t+="&mode="+e.mode,t+="&"+e.mode+"=",t+=Array.isArray(e[e.mode])?this.serializeUsers():e[e.mode]),t},serializeUsers:function(){var e=this.get(this.get("mode"));return Array.isArray(e)?e.map(function(e){return e.personellId?e.personellId:e}).join(","):""},getUsersForSelect2:function(){if("shift"===this.get("mode"))return[];var e=this.get(this.get("mode"));return Array.isArray(e)?e.map(function(e){return"string"==typeof e?{id:e,text:e}:e&&e.personellId?{id:e.personellId,text:e.lastName&&e.firstName?e.lastName+" "+e.firstName:e.personellId}:null}).filter(function(e){return null!==e}):[]},updateUsers:function(e){"shift"!==this.get("mode")&&this.set(this.get("mode"),e)}},{fromQuery:function(e){var t=this,r={};return e.from&&e.to&&(r.from=parseInt(e.from,10),r.to=parseInt(e.to,10)),e.interval&&(r.interval=e.interval),e.mode&&(r.mode=e.mode,"shift"===e.mode?(r.shift=parseInt(e.shift,10),(r.shift<1||r.shift>3)&&(delete r.mode,delete r.shift)):"masters"===e.mode||"operators"===e.mode?(r[r.mode]=String(e[r.mode]).split(",").filter(function(e){return/^[0-9]+$/.test(e)}),0===r[r.mode].length&&(delete r.mode,delete r[r.mode])):delete r.mode),new t(r)}})});