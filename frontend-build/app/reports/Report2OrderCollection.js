// Part of <https://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

define(["underscore","app/orders/OrderCollection"],function(r,e){"use strict";return e.extend({nlsDomain:"reports",url:"/reports/2/orders",rqlQuery:function(r){return r.Query.fromObject({fields:{name:1,mrp:1,qty:1,statusesSetAt:1,scheduledStartDate:1,delayReason:1,changes:1}})},initialize:function(r,e){if(!e.query)throw new Error("query option is required!");this.query=e.query,this.displayOptions=e.displayOptions,this.rqlQuery.limit=+this.query.get("limit"),this.rqlQuery.skip=+this.query.get("skip")},sync:function(){function r(r,e){return{name:"eq",args:[r,e]}}var t=this.rqlQuery.selector,i=this.query,s=i.get("orderNo");if(s.length>=6)return t.args=[r("orderNo",s)],e.prototype.sync.apply(this,arguments);t.args=[r("from",+i.get("from")),r("to",+i.get("to"))];var o=i.get("orgUnitType"),n=i.get("orgUnitId");o&&n&&t.args.push(r("orgUnitType",o),r("orgUnitId",n));var u=i.get("statuses");t.args.push(r("filter",i.get("filter"))),u.length&&t.args.push(r("statuses",u));var a=i.get("hour");return a&&(t.args.push(r("hourMode",i.get("hourMode"))),t.args.push(r("hour",+a))),e.prototype.sync.apply(this,arguments)},genPaginationUrlTemplate:function(){return"#reports/2?"+this.query.serializeToString().replace(/limit=[0-9]+/,"limit=${limit}").replace(/skip=[0-9]+/,"skip=${skip}")+"#"+(this.displayOptions?this.displayOptions.serializeToString():"")}})});