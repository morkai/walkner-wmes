define(["underscore","../time","../core/Model","../data/orgUnits","./Report2"],function(t,e,r,n,i){return r.extend({defaults:function(){var t=e.getMoment();return{orgUnitType:null,orgUnitId:null,to:t.valueOf(),from:t.subtract("days",1).valueOf(),interval:"shift"}},reset:function(e){this.set(t.defaults(e,this.defaults()),{reset:!0})},createReports:function(t,e){var r=[],o={query:this},g=this.get("orgUnitType"),s=n.getByTypeAndId(g,this.get("orgUnitId"));t||(t=new i({orgUnitType:this.get("orgUnitType"),orgUnit:s},o)),r.push(t);var u,a=n.getChildType(g);return s?(u=n.getChildren(s),"subdivision"===a&&(u=u.filter(function(t){return"assembly"===t.get("type")}))):u=n.getAllDivisions().filter(function(t){return"prod"===t.get("type")}),u.sort(function(t,e){return t.getLabel().localeCompare(e.getLabel())}),u.forEach(function(t){r.push(e&&t===e.get("orgUnit")?e:new i({orgUnitType:a,orgUnit:t},o))}),r},serializeToObject:function(t,e){var r={interval:this.get("interval"),from:this.get("from"),to:this.get("to")};return t&&e&&(r.orgUnitType=t,r.orgUnitId=e.id),r},serializeToString:function(t,e){var r="",n=this.attributes;return n.interval&&(r+="&interval="+n.interval),n.from&&n.to&&(r+="&from="+n.from,r+="&to="+n.to),2===arguments.length?t&&(r+="&orgUnitType="+t,r+="&orgUnitId="+encodeURIComponent(e)):n.orgUnitType&&(r+="&orgUnitType="+n.orgUnitType,r+="&orgUnitId="+encodeURIComponent(n.orgUnitId)),r.substr(1)}})});