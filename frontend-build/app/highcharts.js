// Copyright (c) 2014, Łukasz Walukiewicz <lukasz@walukiewicz.eu>. Some Rights Reserved.
// Licensed under CC BY-NC-SA 4.0 <http://creativecommons.org/licenses/by-nc-sa/4.0/>.
// Part of the walkner-wmes project <http://lukasz.walukiewicz.eu/p/walkner-wmes>

define(["underscore","highcharts","./i18n","./time","./broker","i18n!app/nls/core"],function(t,e,o,i,r){"use strict";function s(){e.setOptions({lang:{contextButtonTitle:o("core","highcharts:contextButtonTitle"),downloadJPEG:o("core","highcharts:downloadJPEG"),downloadPDF:o("core","highcharts:downloadPDF"),downloadPNG:o("core","highcharts:downloadPNG"),downloadSVG:o("core","highcharts:downloadSVG"),printChart:o("core","highcharts:printChart"),noData:o("core","highcharts:noData"),resetZoom:o("core","highcharts:resetZoom"),resetZoomTitle:o("core","highcharts:resetZoomTitle"),loading:o("core","highcharts:loading"),decimalPoint:o("core","highcharts:decimalPoint"),thousandsSep:o("core","highcharts:thousandsSep"),shortMonths:o("core","highcharts:shortMonths").split("_"),weekdays:o("core","highcharts:weekdays").split("_"),months:o("core","highcharts:months").split("_")},exporting:{buttons:{contextButton:{menuItems:a()}}}})}function a(){return[{text:o("core","highcharts:downloadPDF"),onclick:t.partial(n,"application/pdf")},{text:o("core","highcharts:downloadPNG"),onclick:t.partial(n,"image/png")}]}function n(e){var o={dataLabels:{enabled:!0,formatter:h}},i=this.options.chart.events;this.exportChart({type:e},{chart:{events:{load:function(){i&&i.load&&i.load.apply(this,arguments),t.forEach(this.series,function(t){t.update(o)})}}}})}function h(){var t=this.series.chart.options.chart.type;if(null===this.y||0===this.y&&"pie"!==t)return"";if("column"!==this.series.type&&"pie"!==this.series.type&&this.series.points.length>10){if(this.series.index%2===0&&this.point.index%2!==0)return"";if(this.series.index%2!==0&&this.point.index%2===0)return""}var o=e.numberFormat(this.y,1);return/.0$/.test(o)&&(o=e.numberFormat(this.y,0)),o}function l(t){return t.series.name}function c(t){return t.y}var p=e.Tooltip.prototype.getPosition;return e.Tooltip.prototype.getPosition=function(t,e,o){var i=p.call(this,t,e,o);return i.y<this.chart.plotTop+5&&(i.y=this.chart.plotTop+5),i},t.extend(e.Axis.prototype.defaultYAxisOptions,{maxPadding:.01,minPadding:.01}),e.getDefaultMenuItems=a,e.formatTableTooltip=function(t,i){var r=o("core","highcharts:decimalPoint"),s=t?'<b class="highcharts-tooltip-header">'+t+"</b>":"";return s+='<table class="highcharts-tooltip">',i.forEach(function(t){var o=e.numberFormat(t.value,t.decimals).split(r),i=o[0],a=2===o.length?r+o[1]:"",n=t.prefix||"",h=t.suffix||"",l=' style="'+(t.valueStyle||"")+'"';s+='<tr><td class="highcharts-tooltip-label"><span style="color: '+t.color+'">●</span> '+t.name+':</td><td class="highcharts-tooltip-integer"'+l+">"+n+i+'</td><td class="highcharts-tooltip-fraction"'+l+">"+a+'</td><td class="highcharts-tooltip-suffix"'+l+">"+h+"</td>"+(t.extraColumns||"")+"</tr>"}),s+="</table>"},e.setOptions({global:{timezoneOffset:i.getMoment().zone(),useUTC:!1},chart:{zoomType:"x",animation:!1,resetZoomButton:{theme:{style:{top:"display: none"}}}},plotOptions:{series:{animation:!1}},credits:{enabled:!1},legend:{borderRadius:0,borderWidth:1,borderColor:"#E3E3E3",backgroundColor:"#F5F5F5",itemStyle:{fontSize:"10px",fontWeight:"normal",fontFamily:"Arial, sans-serif"}},tooltip:{borderColor:"#000",borderWidth:1,borderRadius:0,backgroundColor:"rgba(255,255,255,.85)",shadow:!1,shape:"square",hideDelay:250,useHTML:!0,displayHeader:!0,formatter:function(){var t,o=[],i=(this.point||this.points[0]).series.chart.tooltip.options,r=i.headerFormatter,s=i.rowNameFormatter||l,a=i.valueFormatter||c;t="function"==typeof r?r(this):this.key?this.key:this.points?this.points[0].key:this.series?this.series.name:this.x;var n=this.points||[{point:this.point,series:this.point.series}];return n.forEach(function(t){t=t.point;var e=t.series.tooltipOptions;o.push({point:t,color:t.color||t.series.color,name:s(t),prefix:e.valuePrefix,suffix:e.valueSuffix,decimals:e.valueDecimals,value:a(t)})}),i.extraRowsProvider&&i.extraRowsProvider(n,o),e.formatTableTooltip(t,o)}},exporting:{chartOptions:{chart:{spacing:[10,10,10,10]}},scale:1,sourceWidth:848,sourceHeight:600,url:"/reports;export"},loading:{labelStyle:{top:"20%"}}}),s(),r.subscribe("i18n.reloaded",s),e});