define(["underscore","jquery","highcharts","highcharts/modules/exporting","highcharts/modules/no-data-to-display","highcharts/modules/grouped-categories","./i18n","./time","./broker","./viewport","i18n!app/nls/core"],function(t,e,o,r,i,a,s,n,h,l){"use strict";a(o);var c=o.Tooltip.prototype.getPosition;function p(){o.setOptions({lang:{contextButtonTitle:s("core","highcharts:contextButtonTitle"),downloadJPEG:s("core","highcharts:downloadJPEG"),downloadPDF:s("core","highcharts:downloadPDF"),downloadPNG:s("core","highcharts:downloadPNG"),downloadSVG:s("core","highcharts:downloadSVG"),printChart:s("core","highcharts:printChart"),noData:s("core","highcharts:noData"),resetZoom:s("core","highcharts:resetZoom"),resetZoomTitle:s("core","highcharts:resetZoomTitle"),loading:s("core","highcharts:loading"),decimalPoint:s("core","highcharts:decimalPoint"),thousandsSep:s("core","highcharts:thousandsSep"),shortMonths:s("core","highcharts:shortMonths").split("_"),weekdays:s("core","highcharts:weekdays").split("_"),months:s("core","highcharts:months").split("_")},exporting:{buttons:{contextButton:{menuItems:d()}}}})}function d(){return[{text:s("core","highcharts:downloadPDF"),onclick:t.partial(u,"application/pdf")},{text:s("core","highcharts:downloadPNG"),onclick:t.partial(u,"image/png")}]}function u(e){var o={dataLabels:{enabled:!this.userOptions.exporting||!1!==this.userOptions.exporting.dataLabels,padding:0,allowOverlap:!1,formatter:g}},r=this.options.chart.events;this.exportChart({type:e},{chart:{events:{load:function(){r&&r.load&&r.load.apply(this,arguments),t.forEach(this.series,function(t){t.update(o)})}}}})}function g(){var t=this.series.chart.options,e=t.chart.type;if(t.exporting.noDataLabels||null===this.y||0===this.y&&"pie"!==e)return"";var r=o.numberFormat(this.y,1);return/[^0-9]0$/.test(r)&&(r=o.numberFormat(this.y,0)),r}function f(t){return t.series.name}function m(t){return t.y}return o.Tooltip.prototype.getPosition=function(t,e,o){var r=c.call(this,t,e,o);return r.y<this.chart.plotTop+5&&(r.y=this.chart.plotTop+5),r},o.Chart.prototype.exportChart=function(r,i){var a=this.getSVGForExport(r,i);r=o.merge(this.options.exporting,r);var n=t.assign({filename:r.filename||this.getFilename(),type:r.type,width:r.width,scale:r.scale,svg:a},r.formAttributes),h=e.ajax({method:"POST",url:r.url,dataType:null,dataFilter:function(t){return t},data:JSON.stringify(n)});return!1!==r.handleResponse&&(h.fail(function(){l.msg.show({type:"error",time:2500,text:s("core","MSG:EXPORTING_FAILURE")})}),h.done(function(t){window.open("/reports;download?key="+t)})),h},t.assign(o.Axis.prototype.defaultYAxisOptions,{maxPadding:.01,minPadding:.01}),o.getDefaultMenuItems=d,o.formatTableTooltip=function(t,e){var r=s("core","highcharts:decimalPoint"),i=t?'<b class="highcharts-tooltip-header">'+t+"</b>":"";return i+='<table class="highcharts-tooltip">',e.forEach(function(t){var e=o.numberFormat(t.value,t.decimals).split(r),a=e[0],s=2===e.length?r+e[1]:"",n=t.prefix||"",h=t.suffix||"",l=' style="'+(t.valueStyle||"")+'"';i+='<tr><td class="highcharts-tooltip-label"><span style="color: '+t.color+'">‚óè</span> '+t.name+':</td><td class="highcharts-tooltip-integer"'+l+">"+n+a+'</td><td class="highcharts-tooltip-fraction"'+l+">"+s+'</td><td class="highcharts-tooltip-suffix"'+l+">"+h+"</td>"+(t.extraColumns||"")+"</tr>"}),i+="</table>"},o.setOptions({global:{timezoneOffset:n.getMoment().utcOffset(),useUTC:!1},chart:{zoomType:"x",animation:!1,resetZoomButton:{theme:{style:{top:"display: none"}}}},plotOptions:{series:{animation:!1}},credits:{enabled:!1},legend:{borderRadius:0,borderWidth:1,borderColor:"#E3E3E3",backgroundColor:"#F5F5F5",itemStyle:{fontSize:"10px",fontWeight:"normal",fontFamily:"Arial, sans-serif"}},tooltip:{borderColor:"#000",borderWidth:1,borderRadius:0,backgroundColor:"rgba(255,255,255,.85)",shadow:!1,shape:"square",hideDelay:250,useHTML:!0,displayHeader:!0,style:{pointerEvents:"auto"},formatter:function(){var t,e=[],r=(this.point||this.points[0]).series.chart.tooltip.options,i=r.headerFormatter,a=r.rowNameFormatter||f,s=r.valueFormatter||m;t="function"==typeof i?i(this):this.key?this.key:this.points?this.points[0].key:this.series?this.series.name:this.x;var n=this.points||[{point:this.point,series:this.point.series}];return n.forEach(function(t){var o=(t=t.point).series.tooltipOptions;e.push({point:t,color:t.series.userOptions.tooltipColor||t.color||t.series.color,name:a(t),prefix:"function"==typeof o.valuePrefix?o.valuePrefix(t):o.valuePrefix,suffix:"function"==typeof o.valueSuffix?o.valueSuffix(t):o.valueSuffix,decimals:o.valueDecimals,value:(o.valueFormatter||s)(t)})}),r.extraRowsProvider&&r.extraRowsProvider(n,e),o.formatTableTooltip(t,e)}},exporting:{chartOptions:{chart:{spacing:[10,10,10,10]}},scale:1,sourceWidth:842,sourceHeight:595,url:"/reports;export?delay=1&inline=0"},loading:{labelStyle:{top:"20%"}}}),p(),h.subscribe("i18n.reloaded",p),o});