// Part of <http://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

define(["app/data/orgUnits","app/core/views/FilterView","app/core/util/idAndLabel","app/core/util/fixTimeRange","app/isa/templates/eventListFilter"],function(e,t,i,a,r){"use strict";return t.extend({template:r,defaultFormData:{time:"",line:null,type:null},termToForm:{time:function(e,t,i){a.toFormData(i,t,"date+time")},prodLine:function(e,t,i){i.line=t.args[1]},type:function(e,t,i){i.type=t.args[1]}},afterRender:function(){t.prototype.afterRender.call(this),this.$id("line").select2({width:"275px",allowClear:!0,placeholder:" ",data:this.getApplicableProdLines()}),this.$id("type").select2({width:"275px",allowClear:!0,placeholder:" "})},getApplicableProdLines:function(){return e.getAllByType("prodLine").filter(function(t){var i=e.getSubdivisionFor(t);return!i||"assembly"===i.get("type")}).map(i)},serializeFormToQuery:function(e){var t=a.fromView(this,{defaultTime:"00:00"}),i=this.$id("line").val(),r=this.$id("type").val();i&&i.length&&e.push({name:"orgUnit",args:["prodLine",i]}),r&&r.length&&e.push({name:"eq",args:["type",r]}),t.from&&e.push({name:"ge",args:["time",t.from]}),t.to&&e.push({name:"lt",args:["time",t.to]})}})});