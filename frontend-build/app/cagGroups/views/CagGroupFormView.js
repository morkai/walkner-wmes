// Part of <https://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

define(["underscore","app/core/views/FormView","app/core/templates/colorPicker","app/cagGroups/templates/form","bootstrap-colorpicker"],function(e,t,r,o){"use strict";function i(e){return"string"==typeof e?{id:e,text:e}:{id:e._id,text:e._id+" - "+e.name}}return t.extend({template:o,events:e.extend({},t.prototype.events,{"change [name=color]":"updateColorPicker"}),destroy:function(){this.$(".colorpicker-component").colorpicker("destroy")},afterRender:function(){t.prototype.afterRender.call(this),this.options.editMode&&this.$id("name").focus(),this.$id("color").parent().colorpicker(),this.$id("cags").select2({multiple:!0,ajax:{cache:!0,quietMillis:300,url:function(e){var t="/cags?sort(name)";return e&&(t+=/^[0-9]+$/.test(e)?6===e.length?"&_id=string:"+e:"&regex(_id,string:"+e+")":"&regex(name,"+encodeURIComponent(e)+",i)"),t},results:function(e){return{results:(e.collection||[]).map(i)}}}}).select2("data",(this.model.get("cags")||[]).map(i))},serialize:function(){return e.extend(t.prototype.serialize.call(this),{renderColorPicker:r})},serializeForm:function(e){return e.cags=(e.cags||"").split(",").filter(function(e){return!!e}),e},serializeToForm:function(){var e=this.model.toJSON();return e.cags=(e.cags||[]).join(","),e},updateColorPicker:function(e){e.originalEvent&&this.$(e.target).closest(".colorpicker-component").colorpicker("setValue",e.target.value)}})});