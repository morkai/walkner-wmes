define(["underscore","app/time","app/core/View","app/core/util/bindLoadingMessage","../views/LineStateView","app/wmes-ct-state/templates/diagPage","app/wmes-ct-state/templates/diagRow"],function(t,e,o,i,a,r,n){"use strict";return o.extend({nlsDomain:"wmes-ct-state",template:r,breadcrumbs:function(){return[{href:"#ct",label:this.t("BREADCRUMBS:base")},this.t("BREADCRUMBS:diag")]},remoteTopics:{"ct.todos.saved":function(t){this.addTodo(t,!1)},"ct.todos.ignored":function(t){this.addTodo(t,!0)}},addTodo:function(t,o){var i=this.isScrolledToBottom();this.$("tbody").append(this.renderPartialHtml(n,{row:{ignored:o,time:e.format(t.time,"YYYY-MM-DD, HH:mm:ss.SSS"),line:t.line,station:t.station?t.station.toString():"",action:this.t("todo:action:"+t.action),data:this.serializeData(t)}})),i&&this.scrollToBottom()},scrollToBottom:function(){window.scrollTo({top:document.body.scrollHeight,left:0,behavior:"smooth"})},isScrolledToBottom:function(){return document.body.scrollHeight-window.scrollY-window.innerHeight<5},serializeData:function(e){if(t.isEmpty(e.data))return"";var o=this.dataSerializers[e.action];return o?o(e):"<pre>"+JSON.stringify(e.data,null,2)+"</pre>"},dataSerializers:{cart:function(t){return t.data.cart||"?"},input:function(t){return!0===t.data.state?"1":!1===t.data.state?"0":"?"},sn:function(t){return'<a href="#prodShiftOrders/'+t.data.prodShiftOrder+'">'+t.data.serialNo+"</a>"}}})});