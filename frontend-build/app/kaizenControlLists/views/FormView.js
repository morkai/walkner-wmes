define(["app/core/views/FormView","app/kaizenOrders/dictionaries","app/kaizenControlLists/templates/form","app/kaizenControlLists/templates/_formRow"],function(e,t,i,a){"use strict";return e.extend({template:i,events:Object.assign({"change #-category":function(e){if(e.added){this.$id("category").select2("data",null);var i=t.controlCategories.get(e.added.id);this.addCategory({_id:i.id,label:i.getLabel(),shortName:i.get("shortName"),fullName:i.get("fullName")}),this.setUpCategorySelect2(),this.$id("category").select2("focus")}},'click .btn[data-action="remove"]':function(e){var t=this,i=this.$(e.currentTarget).closest("tr");i.fadeOut("fast",function(){i.remove(),t.setUpCategorySelect2()})},'click .btn[data-action="down"]':function(e){var t=this.$id("categories").children(),i=this.$(e.target).closest("tr"),a=i.next();1!==t.length&&(a.length?i.insertAfter(a):i.insertBefore(t.first()))},'click .btn[data-action="up"]':function(e){var t=this.$id("categories").children(),i=this.$(e.target).closest("tr"),a=i.prev();1!==t.length&&(a.length?i.insertBefore(a):i.insertAfter(t.last()))}},e.prototype.events),initialize:function(){e.prototype.initialize.apply(this,arguments),this.categoryI=0},serializeToForm:function(){var e=this.model.toJSON();return delete e.categories,e},serializeForm:function(e){return e.categories=e.categories||[],e},checkValidity:function(e){var t=this;return!!e.categories.length||(setTimeout(function(){t.$id("category").select2("focus")},1),!1)},afterRender:function(){e.prototype.afterRender.call(this),(this.model.get("categories")||[]).forEach(this.addCategory,this),this.setUpCategorySelect2()},setUpCategorySelect2:function(){var e={};t.controlCategories.forEach(t=>{e[t.id]={id:t.id,text:t.getLabel()}}),this.$('input[name$="._id"]').each(function(){delete e[this.value]}),this.$id("category").select2({width:"350px",placeholder:this.t("FORM:category:placeholder"),data:Object.values(e)})},addCategory:function(e){e.label||(e.label=t.controlCategories.getLabel(e._id)),this.$id("categories").append(this.renderPartialHtml(a,{i:++this.categoryI,category:e}))}})});