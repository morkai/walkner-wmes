// Copyright (c) 2014, ≈Åukasz Walukiewicz <lukasz@walukiewicz.eu>. Some Rights Reserved.
// Licensed under CC BY-NC-SA 4.0 <http://creativecommons.org/licenses/by-nc-sa/4.0/>.
// Part of the walkner-wmes project <http://lukasz.walukiewicz.eu/p/walkner-wmes>

define(["../time","../core/Model","../opinionSurveys/dictionaries","../opinionSurveys/OpinionSurvey","app/core/templates/userInfo"],function(e,r,s,i,o){"use strict";return r.extend({urlRoot:"/opinionSurveys/responses",clientUrlRoot:"#opinionSurveyResponses",topicPrefix:"opinionSurveys.responses",privilegePrefix:"OPINION_SURVEYS",nlsDomain:"opinionSurveyResponses",getLabel:function(){return null},url:function(){var e=r.prototype.url.apply(this,arguments);return this.isNew()?e:e+"?populate(survey)"},serialize:function(r){var n=this.toJSON();r||(r=new i(n.survey._id?n.survey:{_id:n.survey})),r.cacheMaps||r.buildCacheMaps();var t=s.employers.get(n.employer),u=r.cacheMaps.superiors[n.superior],p=s.divisions.get(n.division);return n.survey=r.get("label")||r.id,n.createdAt=e.format(n.createdAt,"LLLL"),n.creator=o({userInfo:n.creator}),n.employer=t?t.get("short"):n.employer||"?",n.superior=u?u["short"]:n.superior||"?",n.division=p?p.get("short"):n.division||"?",n.answers=n.answers.map(function(e){return{question:r.cacheMaps.questions[e.question],answer:e.answer}}),n}})});