define(["underscore","app/time","app/core/views/FilterView","app/core/util/idAndLabel","app/core/util/forms/dateTimeRange","app/users/util/setUpUserSelect2","app/pfepEntries/templates/filter"],function(e,t,i,r,a,n,s){"use strict";var o=["nc12","packType","vendor","creator","limit"],l={};return i.extend({template:s,events:e.assign({"click a[data-date-time-range]":a.handleRangeEvent,"mouseup #-result > .btn":function(e){var t=e.currentTarget,i=t.firstElementChild;i.checked&&setTimeout(function(){t.classList.remove("active"),i.checked=!1},1)},"click a[data-filter]":function(e){e.preventDefault(),this.showFilter(e.currentTarget.dataset.filter)}},i.prototype.events),defaultFormData:function(){return{nc12:"",packType:"",vendor:"",creator:""}},termToForm:{createdAt:a.rqlToForm,nc12:function(e,t,i){i.nc12=t.args[1].replace(/[^A-Z0-9]+/g,"")},packType:function(e,t,i){i[e]=t.args[1]},"creator.id":function(e,t,i){i[e.split(".")[0]]="in"===t.name?t.args[1].join(","):t.args[1]}},serializeFormToQuery:function(e){var t=this.$id("nc12").val().replace(/[^0-9A-Za-z]+/g,"").toUpperCase(),i=this.$id("creator").val();a.formToRql(this,e),/^([0-9]{12}|[A-Z][A-Z0-9]{6})$/.test(t)?e.push({name:"eq",args:["nc12",t]}):t.length&&e.push({name:"regex",args:["nc12","^"+t]}),i.length&&(-1===i.indexOf(",")?e.push({name:"eq",args:["creator.id",i]}):e.push({name:"in",args:["creator.id",i.split(",")]})),["packType","vendor"].forEach(function(t){var i=this.$id(t).val().trim();i&&e.push({name:"eq",args:[t,i]})},this)},changeFilter:function(){i.prototype.changeFilter.apply(this,arguments),this.toggleFilters()},serialize:function(){return e.assign(i.prototype.serialize.apply(this,arguments),{filters:o})},afterRender:function(){i.prototype.afterRender.call(this),this.$id("limit").parent().attr("data-filter","limit"),this.$id("filters").select2({width:"175px"}),n(this.$id("creator"),{view:this,width:"275px"}),this.toggleFilters()},toggleFilters:function(){var e=this;o.forEach(function(t){e.$('.form-group[data-filter="'+t+'"]').toggleClass("hidden",!e.filterHasValue(t))})},filterHasValue:function(e){var t=this.$id(e).val();return"limit"===e?15!=+t:t.length>0},showFilter:function(e){"date"!==e?this.$('.form-group[data-filter="'+(l[e]||e)+'"]').removeClass("hidden").find("input, select").first().focus():this.$id("from-date").focus()}})});