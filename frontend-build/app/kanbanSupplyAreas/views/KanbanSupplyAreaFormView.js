// Part of <https://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

define(["underscore","app/data/orgUnits","app/core/util/idAndLabel","app/core/views/FormView","app/kanbanSupplyAreas/templates/form"],function(t,i,e,n,a){"use strict";return n.extend({template:a,events:t.assign({"input #-_id":"validateId"},n.prototype.events),initialize:function(){n.prototype.initialize.apply(this,arguments),this.validateId=t.debounce(this.validateId.bind(this),500)},afterRender:function(){n.prototype.afterRender.apply(this,arguments),this.$id("lines").select2({multiple:!0,data:i.getAllByType("prodLine").filter(function(t){return!t.get("deactivatedAt")}).map(e)}),this.options.editMode?(this.$id("_id").prop("readonly",!0),this.$id("name").focus()):this.$id("_id").focus()},serializeToForm:function(){var t=this.model.toJSON();return t.lines=(t.lines||[]).join(","),t},serializeForm:function(t){return t.lines=(t.lines||"").split(",").filter(function(t){return!!t.length}),t},validateId:function(){var t=this,i=t.$id("_id"),e=t.ajax({method:"HEAD",url:"/kanban/supplyAreas/"+i.val()});e.fail(function(){i[0].setCustomValidity("")}),e.done(function(){i[0].setCustomValidity(200===e.status?t.t("FORM:ERROR:alreadyExists"):"")})}})});