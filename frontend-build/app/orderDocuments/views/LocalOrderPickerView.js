// Copyright (c) 2014, ≈Åukasz Walukiewicz <lukasz@walukiewicz.eu>. Some Rights Reserved.
// Licensed under CC BY-NC-SA 4.0 <http://creativecommons.org/licenses/by-nc-sa/4.0/>.
// Part of the walkner-wmes project <http://lukasz.walukiewicz.eu/p/walkner-wmes>

define(["underscore","jquery","js2form","form2js","app/i18n","app/viewport","app/core/View","app/orderDocuments/templates/localOrderPicker"],function(e,r,s,a,o,i,n,d){"use strict";return n.extend({template:d,events:{submit:function(){return this.submitForm(),!1}},afterRender:function(){s(this.el,{orderNo:""})},submitForm:function(){var e=this,r=this.$id("submit").prop("disabled",!0);r.find(".fa").removeClass("fa-search").addClass("fa-spin fa-spinner");var s=this.$id("orderNo").val(),a=this.ajax({type:"GET",url:window.location.origin+"/orders/"+s+"/documents"});a.fail(function(e){var r=((e.responseJSON||{}).error||{}).message,s=o.has("orderDocuments","localOrderPicker:error:"+r)?o("orderDocuments","localOrderPicker:error:"+r):o("orderDocuments","localOrderPicker:error:failure");i.msg.show({type:"error",time:3e3,text:s})}),a.done(function(r){e.trigger("localOrder",r)}),a.always(function(){r.prop("disabled",!1).find(".fa").removeClass("fa-spin fa-spinner").addClass("fa-search")})},checkLocalServer:function(){var e=this,r=this.ajax({type:"GET",url:"http://127.0.0.1:1335/hello"}),s=e.$(".message-warning").removeClass("hidden"),a=e.$(".message-success").addClass("hidden"),o=e.$(".message-error").addClass("hidden");r.always(function(){s.addClass("hidden")}),r.done(function(){a.removeClass("hidden")}),r.fail(function(){o.removeClass("hidden")})}})});