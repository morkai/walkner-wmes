define(["jquery","underscore","js2form","select2","app/i18n","app/data/orgUnits","app/core/View","app/orgUnits/templates/pickerDialog"],function(t,e,i,r,n,o,a,s){"use strict";return a.extend({template:s,events:{submit:function(t){t.preventDefault();var e=this.$('input[name="orgUnitType"]:checked').val(),i=this.$id(e).select2("val");this.trigger("picked",e,i)},'change input[type="radio"]':function(t){this.$id(t.currentTarget.value).select2("focus")},"click #-deactivated":function(){var t="1"===(localStorage.getItem("WMES:OrgUnitPicker:deactivated")||"0")?"0":"1";localStorage.setItem("WMES:OrgUnitPicker:deactivated",t),this.$id("deactivated").toggleClass("active","1"===t),this.setUpOrgUnitsSelect2()},"change .orgUnits-picker-orgUnits":function(t){this.$(t.target).closest(".form-group").find('input[type="radio"]').click()}},initialize:function(){this.model.orgUnitTypes||(this.model.orgUnitTypes=["division","subdivision","mrpControllers","prodFlow","workCenter","prodLine"])},serialize:function(){var t=this;return{idPrefix:t.idPrefix,orgUnits:t.model.orgUnitTypes.map(function(e){return{type:e,label:t.model.resolveLabel(e)}}),deactivated:"1"===localStorage.getItem("WMES:OrgUnitPicker:deactivated")}},afterRender:function(){var t=this.serializeFormData();i(this.el,t),this.setUpOrgUnitsSelect2(),this.$id(t.orgUnitType).attr("autofocus",!0)},serializeFormData:function(){var t={orgUnitType:this.model.orgUnitType};return t[t.orgUnitType]=this.model.orgUnitIds.join(","),t},setUpOrgUnitsSelect2:function(){this.model.orgUnitTypes.forEach(this.setUpOrgUnitSelect2,this)},setUpOrgUnitSelect2:function(t){var i="1"===localStorage.getItem("WMES:OrgUnitPicker:deactivated"),n=this.createSubdivisionFilter(),a=o.getAllByType(t).filter(function(t){return i||!t.get("deactivatedAt")}).map(function(e){if("division"===t&&"prod"!==e.get("type"))return null;var i,r;if("subdivision"===t){if("storage"===e.get("type"))return null;i=e.get("division")+" > "+e.getLabel()}else"mrpControllers"===t?(i=e.id+": "+e.get("description"),r=e.id):i=e.getLabel();return"division"===t||n(e)?{id:e.id,selection:r,text:i,deactivated:!!e.get("deactivatedAt")}:null}).filter(function(t){return null!==t}).sort(function(t,e){return t.text.localeCompare(e.text)});return this.$id(t).select2({multiple:!0,data:a,formatSelection:function(t){var i=e.escape(t.selection||t.text);return t.deactivated?'<span style="text-decoration: line-through">'+i+"</span>":i},formatResult:function(t,e,i,n){var o=[];return o.push('<span style="text-decoration: '+(t.deactivated?"line-through":"initial")+'">'),r.util.markMatch(t.selection||t.text,i.term,o,n),o.push("</span>"),o.join("")}})},createSubdivisionFilter:function(){var t=this.model.subdivisionFilter;return Array.isArray(t)?function(e){var i=e.getSubdivision(),r=i&&i.get("type");return-1!==t.indexOf(r)}:"function"==typeof t?t:function(){return!0}}})});