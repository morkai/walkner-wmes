define(["underscore","app/user","app/core/Collection","app/core/util/getShiftStartInfo","app/data/localStorage","./WhLine"],function(e,t,i,r,n,s){"use strict";var l=["pickup","available","redirLine"];return i.extend({model:s,rqlQuery:"sort(_id)&limit(0)",initialize:function(e,t){this.filters={working:null,mrps:[]},this.on("filtered",function(){n.setItem("WMES_WH_LINES_FILTERS",JSON.stringify(this.filters))}),t&&t.filters&&this.setFilters(t.filters)},getFilters:function(){return this.filters},setFilters:function(e){Object.assign(this.filters,e),this.trigger("filtered")},isVisible:function(e){var t=this.filters;return(null===t.working||e.get("working")===t.working)&&!(t.mrps.length&&!e.get("mrps").some(function(e){return t.mrps.includes(e)}))},comparator:function(e,t){return e.id.localeCompare(t.id,void 0,{numeric:!0,ignorePunctuation:!0})},handleUpdate:function(t){var i=this,r=!1;return t.added&&i.add(t.added,{merge:!0}),t.deleted&&t.deleted.forEach(function(e){i.remove(e._id)}),t.updated&&t.updated.forEach(function(t){var n=i.get(t._id);n?n.set(t):!r&&e.intersection(Object.keys(t),l).length&&(r=!0)}),r?i.fetch():null}},{can:{manage:function(){return t.isAllowedTo("WH:MANAGE","PLANNING:MANAGE","PLANNING:PLANNER")},redir:function(){return this.manage()}},fromQuery:function(e){var t=JSON.parse(n.getItem("WMES_WH_LINES_FILTERS")||"{}");return Object.keys(e).length&&(t.working="1"===e.working||"0"!==e.working&&null,t.mrps=(e.mrps||"").split(",").filter(function(e){return!!e.length})),new this(null,{filters:t})}})});