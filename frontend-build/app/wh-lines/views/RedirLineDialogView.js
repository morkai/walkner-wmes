define(["app/viewport","app/core/View","app/orgUnits/util/setUpOrgUnitSelect2","app/wh-lines/templates/redirLine","i18n!app/nls/wh-lines"],function(e,i,t,r){"use strict";return i.extend({template:r,events:{submit:function(){var i=this;e.msg.saving();var t=i.$id("submit").prop("disabled",!0),r=i.ajax({method:"POST",url:"/old/wh;act",data:JSON.stringify({action:i.model.get("redirLine")?"stopRedirLine":"startRedirLine",data:{sourceLine:i.model.id,targetLine:i.$id("targetLine").val(),redirDelivered:i.$id("redirDelivered").prop("checked")}})});return r.fail(function(){var n=r.responseJSON&&r.responseJSON.error||null;n&&i.t.has("redirLine:error:"+n.code)?(e.msg.saved(),e.msg.show({type:"error",time:5e3,text:i.t("redirLine:error:"+n.code,n)})):e.msg.savingFailed(),t.prop("disabled",!1)}),r.done(function(){e.msg.saved(),e.closeDialog()}),!1}},initialize:function(){this.listenTo(this.model,"change:redirLine",function(){e.closeDialog()})},getTemplateData:function(){return{mode:this.model.get("redirLine")?"stop":"start",sourceLine:this.model.id,targetLine:this.model.get("redirLine")||""}},afterRender:function(){this.model.get("redirLine")||t(this.$id("targetLine"),{orgUnitType:"prodLine"})}})});