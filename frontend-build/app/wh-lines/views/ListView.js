define(["app/user","app/viewport","app/core/views/ListView","../WhLineCollection","./RedirLineDialogView","app/wh-lines/templates/list","app/wh-lines/templates/row"],function(e,t,i,n,r,o,a){"use strict";return i.extend({template:o,localTopics:{"socket.connected":function(){this.refreshCollectionNow()}},remoteTopics:function(){var e={};return e[this.collection.getTopicPrefix()+".updated"]="onUpdated",e},events:Object.assign({'click a[data-action="redirLine"]':function(e){this.redirLine(this.$(e.currentTarget).closest(".list-item")[0].dataset.id)}},i.prototype.events),initialize:function(){i.prototype.initialize.apply(this,arguments),this.once("afterRender",function(){this.listenTo(this.collection,"add change",this.renderRow)})},onUpdated:function(e){this.promised(this.collection.handleUpdate(e))},getTemplateData:function(){return{renderRow:this.renderPartialHtml.bind(this,a),canRedir:n.can.redir()}},renderRow:function(e){var t=this.$row(e.id),i=this.renderPartialHtml(a,{row:e.serializeRow(),canRedir:n.can.redir()});t.length?t.replaceWith(i):this.$("tbody").append(i)},redirLine:function(e){var i=this.collection.get(e);if(i&&!(t.currentDialog instanceof r&&t.currentDialog.model.sourceLine.id===e)){var n=new r({model:i});t.showDialog(n,this.t("redirLine:title:"+(i.get("redirLine")?"stop":"start")))}}})});