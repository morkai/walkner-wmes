define(["app/user","app/viewport","app/core/views/ListView","../WhLineCollection","./RedirLineDialogView","./EditStartedPlanDialogView","app/wh-lines/templates/list","app/wh-lines/templates/row"],function(t,e,i,n,a,o,r,l){"use strict";return i.extend({template:r,localTopics:{"socket.connected":function(){this.refreshCollectionNow()}},remoteTopics:function(){var t={};return t[this.collection.getTopicPrefix()+".updated"]="onUpdated",t},events:Object.assign({'click a[data-action="redirLine"]':function(t){this.redirLine(this.$(t.currentTarget).closest(".list-item")[0].dataset.id)},'click a[data-action="editStartedPlan"]':function(t){this.editStartedPlan(this.$(t.currentTarget).closest(".list-item")[0].dataset.id)}},i.prototype.events),initialize:function(){i.prototype.initialize.apply(this,arguments),this.once("afterRender",function(){this.listenTo(this.collection,"add change",this.renderRow)})},onUpdated:function(t){this.promised(this.collection.handleUpdate(t))},getTemplateData:function(){return{renderRow:this.renderPartialHtml.bind(this,l),canManage:n.can.manage()}},renderRow:function(t){var e=this.$row(t.id),i=this.renderPartialHtml(l,{row:t.serializeRow(),canManage:n.can.manage()});e.length?e.replaceWith(i):this.$("tbody").append(i)},redirLine:function(t){var i=this.collection.get(t);if(i&&!(e.currentDialog instanceof a&&e.currentDialog.model.sourceLine.id===t)){var n=new a({model:i});e.showDialog(n,this.t("redirLine:title:"+(i.get("redirLine")?"stop":"start")))}},editStartedPlan:function(t){var i=new o({model:this.collection.get(t)});e.showDialog(i,this.t("editStartedPlan:title"))}})});