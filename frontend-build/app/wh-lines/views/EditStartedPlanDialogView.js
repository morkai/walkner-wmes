define(["app/time","app/viewport","app/core/View","app/planning/util/shift","app/wh-lines/templates/editStartedPlan","i18n!app/nls/wh-lines"],function(e,t,a,i,n){"use strict";return a.extend({template:n,events:{"click #-setNextShift":function(){this.$id("newValue").val(i.getPlanDate(this.model.get("nextShiftAt"),!1).format("YYYY-MM-DD"))},"change #-newValue":function(){this.newValue=this.$id("newValue").val()},submit:function(){var e=this;t.msg.saving();var a=e.$id("submit").prop("disabled",!0),i=e.ajax({method:"POST",url:"/old/wh;act",data:JSON.stringify({action:"editStartedPlan",data:{line:e.model.id,newValue:e.$id("newValue").val()}})});return i.fail(function(){var n=i.responseJSON&&i.responseJSON.error||null;n&&e.t.has("editStartedPlan:error:"+n.code)?(t.msg.saved(),t.msg.show({type:"error",time:5e3,text:e.t("editStartedPlan:error:"+n.code,n)})):t.msg.savingFailed(),a.prop("disabled",!1)}),i.done(function(){t.msg.saved(),t.closeDialog()}),!1}},initialize:function(){this.listenTo(this.model,"change:startedPlan change:nextShiftAt",this.render)},getTemplateData:function(){var t=i.getPlanDate(Date.now(),!0),a=e.utc.getMoment(this.model.get("startedPlan"));return a.isBefore(t)&&(a=t),{line:this.model.toJSON(),nextShiftAt:this.model.serializeNextShiftAt(),minValue:t.format("YYYY-MM-DD"),curValue:this.newValue||a.format("YYYY-MM-DD"),maxValue:t.endOf("week").add(7,"days").format("YYYY-MM-DD")}}})});