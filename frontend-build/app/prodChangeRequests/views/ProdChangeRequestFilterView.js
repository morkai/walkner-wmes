// Copyright (c) 2014, ≈Åukasz Walukiewicz <lukasz@walukiewicz.eu>. Some Rights Reserved.
// Licensed under CC BY-NC-SA 4.0 <http://creativecommons.org/licenses/by-nc-sa/4.0/>.
// Part of the walkner-wmes project <http://lukasz.walukiewicz.eu/p/walkner-wmes>

define(["underscore","app/time","app/core/views/FilterView","app/core/util/idAndLabel","app/data/orgUnits","app/prodChangeRequests/templates/filter"],function(e,t,i,n,r,o){"use strict";return i.extend({template:o,events:e.extend({"change #-division":function(){this.$id("prodLine").select2("val","")},"change #-prodLine":function(){this.$id("division").select2("val","")}},i.prototype.events),defaultFormData:function(){return{division:"",prodLine:"",status:"new"}},termToForm:{division:function(e,t,i){i[e]=t.args[1]},status:function(e,t,i){i.status="eq"===t.name?"new":"old"},prodLine:"division"},afterRender:function(){i.prototype.afterRender.call(this),this.toggleButtonGroup("status"),this.$id("division").select2({width:175,allowClear:!0,placeholder:" ",data:r.getAllByType("division").filter(function(e){return"prod"===e.get("type")}).map(n)}),this.$id("prodLine").select2({width:175,allowClear:!0,placeholder:" ",data:r.getAllByType("prodLine").filter(function(e){if(e.get("deactivatedAt"))return!1;var t=r.getAllForProdLine(e).division,i=r.getByTypeAndId("division",t);return"prod"===i.get("type")}).map(n)})},serializeFormToQuery:function(e,t){var i=this.$id("division").val(),n=this.$id("prodLine").val(),r=this.getButtonGroupValue("status");i&&e.push({name:"eq",args:["division",i]}),n&&e.push({name:"eq",args:["prodLine",n]}),"old"===r?(e.push({name:"in",args:["status",["accepted","rejected"]]}),t.sort={_id:-1}):(e.push({name:"eq",args:["status","new"]}),t.sort={prodLine:1,_id:1})}})});