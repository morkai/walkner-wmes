// Part of <https://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

define(["underscore","jquery","app/viewport","app/core/pages/FilteredListPage","../views/XDataFilterView","../views/XDataListView"],function(e,t,i,a,n,r){"use strict";return a.extend({layoutName:"page",FilterView:n,ListView:r,actions:[],initialize:function(){var e=this;a.prototype.initialize.apply(e,arguments);var i=e.onDrag.bind(e);t(document).on("dragenter."+e.idPrefix,i),t(document).on("dragleave."+e.idPrefix,i),t(document).on("dragover."+e.idPrefix,i),t(document).on("drop."+e.idPrefix,e.onDrop.bind(e))},destroy:function(){a.prototype.destroy.apply(this,arguments),t(document).off("."+this.idPrefix)},onDrag:function(e){e.preventDefault(),e.stopPropagation()},onDrop:function(t){var a=this;if(t=t.originalEvent,t.preventDefault(),t.stopPropagation(),!t.dataTransfer.files.length)return i.msg.show({type:"warning",time:3e3,text:a.t("MSG:drop:invalidFile")});var n=e.find(t.dataTransfer.files,function(e){return/xlsx?$/i.test(e.name)&&("application/vnd.ms-excel"===e.type||"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"===e.type)});if(!n)return i.msg.show({type:"warning",time:3e3,text:a.t("MSG:drop:invalidFile")});i.msg.saving();var r=new FormData;r.append("xData",n);var o=a.ajax({type:"POST",url:"/sapLaborTimeFixer/xData",data:r,processData:!1,contentType:!1});o.fail(function(){i.msg.savingFailed()}),o.done(function(e){i.msg.saved(),e&&e._id&&a.broker.publish("router.navigate",{url:"/sapLaborTimeFixer/xData/"+e._id,trigger:!0,replace:!1})})}})});