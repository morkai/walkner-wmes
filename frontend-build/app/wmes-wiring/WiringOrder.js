define(["underscore","../time","../i18n","../core/Model"],function(e,r,i,t){"use strict";function s(e){return["date","startedAt","finishedAt"].forEach(function(r){"string"==typeof e[r]&&(e[r]=new Date(e[r]))}),e}return t.extend({urlRoot:"/wiring/orders",clientUrlRoot:"#wiring/orders",topicPrefix:"wiring.orders",privilegePrefix:"WIRING",nlsDomain:"wmes-wiring",parse:s,serialize:function(e,i){if(i||(i=this.collection),!e&&i&&i.serializedMap&&i.serializedMap[this.id])return i.serializedMap[this.id];var t=this.toJSON();if(t.startedAt){var s=r.getMoment(t.startedAt);t.startedAtTime=s.format("HH:mm:ss"),t.startedAtDate=s.format("DD.MM, HH:mm:ss")}if(t.finishedAt){var n=r.getMoment(t.finishedAt);t.finishedAtTime=n.format("HH:mm:ss"),t.finishedAtDate=n.format("DD.MM, HH:mm:ss")}return t.mrps=[t.mrp],t.childOrders={},t.leadingOrders={},t.orders.forEach(function(e){t.childOrders[e.leadingOrder]=e,t.leadingOrders[e.leadingOrder]=1}),t.leadingOrders=Object.keys(t.leadingOrders).sort(),t.qtyRemaining=Math.max(t.qty-t.qtyDone,0),t}},{parse:s})});