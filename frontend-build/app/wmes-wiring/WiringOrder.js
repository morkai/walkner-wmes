define(["underscore","../time","../i18n","../core/Model"],function(e,r,t,i){"use strict";function s(e){return["date","startedAt","finishedAt"].forEach(function(r){"string"==typeof e[r]&&(e[r]=new Date(e[r]))}),e}return i.extend({urlRoot:"/wiring/orders",clientUrlRoot:"#wiring/orders",topicPrefix:"wiring.orders",privilegePrefix:"WIRING",nlsDomain:"wmes-wiring",parse:s,serialize:function(e,t){if(t||(t=this.collection),!e&&t&&t.serializedMap&&t.serializedMap[this.id])return t.serializedMap[this.id];var i=this.toJSON();if(i.startedAt){var s=r.getMoment(i.startedAt);i.startedAtTime=s.format("HH:mm:ss"),i.startedAtDate=s.format("DD.MM, HH:mm:ss")}if(i.finishedAt){var n=r.getMoment(i.finishedAt);i.finishedAtTime=n.format("HH:mm:ss"),i.finishedAtDate=n.format("DD.MM, HH:mm:ss")}return i.mrps=[i.mrp],i.leadingOrders={},i.orders.forEach(function(e){i.leadingOrders[e.leadingOrder]=1}),i.leadingOrders=Object.keys(i.leadingOrders).sort(),i.qtyRemaining=Math.max(i.qty-i.qtyDone,0),i}},{parse:s})});