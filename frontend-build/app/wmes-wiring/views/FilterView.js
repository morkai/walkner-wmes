define(["underscore","jquery","app/core/View","app/core/util/buttonGroup","../WiringOrderCollection","app/wmes-wiring/templates/filter"],function(t,e,r,i,s,n){"use strict";return r.extend({template:n,events:{"click #-status .btn":function(t){if(t.ctrlKey)return this.orders.setStatusFilter([t.currentTarget.firstElementChild.value]),!1},"mousedown #-status .btn":function(t){if(2===t.button)return this.orders.setStatusFilter([t.currentTarget.firstElementChild.value]),!1},"contextmenu #-status .btn":function(){return!1},'change input[name="status[]"]':function(){var t=i.getValue(this.$id("status"));return this.orders.setStatusFilter(t),!1},"click #-mrp .active":function(){return this.orders.setMrpFilter("all"),!1},'change input[name="mrp[]"]':function(){return this.orders.setMrpFilter(this.$('input[name="mrp[]"]:checked').val()),!1}},modelProperty:"orders",initialize:function(){this.keyBuffer="";var r=t.debounce(this.toggleFilter.bind(this,"mrp"),1);this.listenTo(this.orders,"filter:status",t.debounce(this.toggleFilter.bind(this,"status"),1)),this.listenTo(this.orders,"filter:mrp",function(){r(),this.recountStats()}),this.listenTo(this.orders,"reset",this.render),this.listenTo(this.orders,"totalsRecounted",this.recountStats),e("body").on("keyup."+this.idPrefix,this.onKeyUp.bind(this))},destroy:function(){e("body").off("."+this.idPrefix)},getTemplateData:function(){return{statuses:s.STATUSES,mrps:this.orders.getMrps(),filters:this.orders.filters,stats:this.orders.getStats()}},afterRender:function(){this.toggleFilter("status"),this.toggleFilter("mrp")},toggleFilter:function(e){var r=this.$id(e);e=this.orders.filters[e],r.find(".btn").each(function(){var r=this.firstElementChild.value,i=Array.isArray(e)?t.includes(e,r):r===e;this.classList.toggle("active",i),this.firstElementChild.checked=i})},onKeyUp:function(e){var r=this,i=e.key.toUpperCase();if(clearTimeout(r.timers.handleKeyBuffer),/^[A-Z0-9]$/.test(i)){r.keyBuffer+=i;var s=r.orders.getMrps();if(t.includes(s,r.keyBuffer))return r.keyBuffer!==r.orders.filters.mrp&&r.orders.setMrpFilter(r.keyBuffer),void(r.keyBuffer="");r.timers.handleKeyBuffer=setTimeout(function(){r.keyBuffer=""},1e3)}else r.keyBuffer=""},recountStats:function(){var t=this;t.$(".wiring-filter-status-stats").each(function(){var e=this.parentNode.dataset.status,r=t.orders.filters.mrp,i=t.orders.totalQuantities[r];this.textContent=i&&i[e]||0}),t.$(".wiring-filter-mrp-stats").each(function(){var e=this.dataset.mrp,r=t.orders.totalQuantities[e];this.textContent=r?r.remaining:0})}})});