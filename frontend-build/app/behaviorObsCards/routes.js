define(["underscore","../broker","../router","../viewport","../user","../core/util/showDeleteFormPage","../data/localStorage"],function(e,a,r,s,o,i,n){"use strict";var t="css!app/behaviorObsCards/assets/main",d="i18n!app/nls/behaviorObsCards",b=o.auth("LOCAL","USER");r.map("/behaviorObsCardCountReport",b,function(e){s.loadPage(["app/behaviorObsCards/BehaviorObsCardCountReport","app/behaviorObsCards/pages/BehaviorObsCardCountReportPage",t,"i18n!app/nls/reports",d],function(a,r){return new r({model:a.fromQuery(e.query)})})}),r.map("/behaviorObsCards",b,function(e){s.loadPage(["app/behaviorObsCards/BehaviorObsCardCollection","app/behaviorObsCards/pages/BehaviorObsCardListPage",t,d],function(a,r){return new r({collection:new a(null,{rqlQuery:e.rql})})})}),r.map("/behaviorObsCards/:id",b,function(e){s.loadPage(["app/behaviorObsCards/BehaviorObsCard","app/behaviorObsCards/pages/BehaviorObsCardDetailsPage",t,d],function(a,r){return new r({model:new a({_id:e.params.id}),standalone:!!e.query.standalone})})}),r.map("/behaviorObsCards;add",b,function(r){s.loadPage(["app/behaviorObsCards/BehaviorObsCard","app/behaviorObsCards/pages/BehaviorObsCardAddFormPage",t,d],function(s,i){var t={observer:o.getInfo()};try{e.assign(t,JSON.parse(n.getItem("BOC_LAST")))}catch(e){}finally{n.removeItem("BOC_LAST")}r.query.nearMiss?(t.nearMiss=+r.query.nearMiss,a.publish("router.navigate",{url:"/behaviorObsCards;add",trigger:!1,replace:!0})):r.query.suggestion&&(t.suggestion=+r.query.suggestion,a.publish("router.navigate",{url:"/behaviorObsCards;add",trigger:!1,replace:!0}));var d=null;try{d=JSON.parse(decodeURIComponent(atob(r.query.operator)))}catch(e){}d&&(t.observer.id=d.id,t.observer.label=d.text);var b=!!r.query.standalone,u="WMES_STANDALONE_CLOSE_TIMER";return b&&void 0===window[u]&&(clearTimeout(window[u]),window.onblur=function(){clearTimeout(window[u]),window[u]=setTimeout(function(){window.close()},6e4)},window.onfocus=function(){clearTimeout(window[u])}),new i({model:new s(t),standalone:b})})}),r.map("/behaviorObsCards/:id;edit",b,function(r){s.loadPage(["app/behaviorObsCards/BehaviorObsCard","app/behaviorObsCards/pages/BehaviorObsCardEditFormPage",t,d],function(s,o){var i=new s({_id:r.params.id}),t={};try{e.assign(t,JSON.parse(n.getItem("BOC_LAST")))}catch(e){}finally{n.removeItem("BOC_LAST")}r.query.nearMiss?(t.nearMiss=+r.query.nearMiss,a.publish("router.navigate",{url:"/behaviorObsCards/"+r.params.id+";edit",trigger:!1,replace:!0})):r.query.suggestion&&(t.suggestion=+r.query.suggestion,a.publish("router.navigate",{url:"/behaviorObsCards/"+r.params.id+";edit",trigger:!1,replace:!0}));var d=new o({model:i});return t._id===r.params.id&&d.listenToOnce(i,"sync",function(){e.assign(i.attributes,t)}),d})}),r.map("/behaviorObsCards/:id;delete",b,e.partial(i,"app/behaviorObsCards/BehaviorObsCard",e,e,{baseBreadcrumb:!0}))});