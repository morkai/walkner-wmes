// Part of <http://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

define(["underscore","../time","../user","../core/Model","app/kaizenOrders/dictionaries","app/core/templates/userInfo"],function(e,t,r,i,a,n){"use strict";var s=["date"],o=["createdAt","updatedAt"],u=["creator","updater","observer"];return i.extend({urlRoot:"/behaviorObsCards",clientUrlRoot:"#behaviorObsCards",topicPrefix:"behaviorObsCards",privilegePrefix:"KAIZEN",nlsDomain:"behaviorObsCards",labelAttribute:"rid",defaults:function(){return{date:new Date}},serialize:function(e){var r=e&&e.longDateTime,i=r?"LL":"L",c=r?"LLLL":"L, LTS",l=this.toJSON();return l.section=a.sections.getLabel(l.section),s.forEach(function(e){l[e]=l[e]?t.format(l[e],i):null}),o.forEach(function(e){l[e]=l[e]?t.format(l[e],c):null}),u.forEach(function(e){l[e]=n({userInfo:l[e]})}),l},serializeRow:function(e){return this.serialize(e)},serializeDetails:function(){return this.serialize({longDateTime:!0})},isCreator:function(){return this.attributes.creator&&this.attributes.creator.id===r.data._id},canEdit:function(){return r.isAllowedTo(this.privilegePrefix+":MANAGE")?!0:this.isCreator()?Date.now()-Date.parse(this.get("date"))<864e5:!1},canDelete:function(){return r.isAllowedTo(this.privilegePrefix+":MANAGE")?!0:this.isCreator()?Date.now()-Date.parse(this.get("date"))<288e5:!1},hasAnyEasy:function(){return e.any(this.get("observations"),function(e){return!e.safe&&e.easy})||e.any(this.get("risks"),function(e){return e.easy})}})});