define(["underscore","app/time","app/user","app/core/views/FilterView","app/core/util/idAndLabel","app/core/util/forms/dateTimeRange","app/data/orgUnits","app/users/util/setUpUserSelect2","app/kaizenOrders/dictionaries","app/behaviorObsCards/templates/filter","app/core/util/ExpandableSelect"],function(e,s,r,t,n,a,i,o,u,p){"use strict";return t.extend({template:p,events:e.assign({"click a[data-date-time-range]":a.handleRangeEvent,'change input[name="userType"]':"toggleUserSelect2","keyup select":function(e){if(27===e.keyCode)return e.target.selectedIndex=-1,!1},"dblclick select":function(e){e.target.selectedIndex=-1}},t.prototype.events),defaultFormData:function(){return{section:[],observerSection:[],line:[],userType:"others",user:null,anyHard:[]}},termToForm:{date:a.rqlToForm,"observer.id":function(e,s,r){r.userType="observer",r.user=s.args[1]},"superior.id":function(e,s,r){r.userType="superior",r.user=s.args[1]},users:function(e,s,r){"mine"===s.args[1]?(r.userType="mine",r.user=null):(r.userType="others",r.user=s.args[1])},section:function(e,s,r){r[e]="in"===s.name?s.args[1]:[s.args[1]]},observerSection:"section",line:function(e,s,r){r[e]="in"===s.name?s.args[1].join(","):s.args[1]},anyHardObservations:function(e,s,r){s.args[1]&&r.anyHard.push("observations")},anyHardRisks:function(e,s,r){s.args[1]&&r.anyHard.push("risks")}},serialize:function(){return e.assign(t.prototype.serialize.call(this),{sections:u.sections.toJSON()})},serializeFormToQuery:function(s){var t=this.$('input[name="userType"]:checked').val(),n=this.$id("user").val(),i=this.getButtonGroupValue("anyHard");a.formToRql(this,s),"observer"===t&&n?s.push({name:"eq",args:["observer.id",n]}):"superior"===t&&n?s.push({name:"eq",args:["superior.id",n]}):"mine"===t?s.push({name:"eq",args:["users","mine"]}):n&&s.push({name:"eq",args:["users",n]}),e.contains(i,"observations")&&s.push({name:"eq",args:["anyHardObservations",!0]}),e.contains(i,"risks")&&s.push({name:"eq",args:["anyHardRisks",!0]}),["observerSection","section","line"].forEach(function(r){var t=this.$id(r).val()||[];"string"==typeof t&&(t=t.split(",")),1===(t=t.filter(function(s){return!e.isEmpty(s)})).length?s.push({name:"eq",args:[r,t[0]]}):t.length&&s.push({name:"in",args:[r,t]})},this),s.push({name:"lang",args:[r.lang]})},afterRender:function(){t.prototype.afterRender.call(this),this.$(".is-expandable").expandableSelect(),o(this.$id("user"),{width:"335px",view:this}),this.$id("line").select2({width:"250px",allowClear:!0,multiple:!0,placeholder:" ",data:i.getActiveByType("prodLine").map(n)}),this.toggleButtonGroup("anyHard"),this.toggleUserSelect2()},destroy:function(){t.prototype.destroy.call(this),this.$(".is-expandable").expandableSelect("destroy")},toggleUserSelect2:function(){var e=this.$('input[name="userType"]:checked').val();this.$id("user").select2("enable","mine"!==e)}})});