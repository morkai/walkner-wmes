define(["underscore","app/time","app/core/views/FilterView","app/core/util/idAndLabel","app/core/util/forms/dateTimeRange","app/data/orgUnits","app/users/util/setUpUserSelect2","app/kaizenOrders/dictionaries","app/behaviorObsCards/templates/filter","app/core/util/ExpandableSelect"],function(e,s,r,t,n,i,a,o,u){"use strict";return r.extend({template:u,events:e.assign({"click a[data-date-time-range]":n.handleRangeEvent,'change input[name="userType"]':"toggleUserSelect2","keyup select":function(e){if(27===e.keyCode)return e.target.selectedIndex=-1,!1},"dblclick select":function(e){e.target.selectedIndex=-1}},r.prototype.events),defaultFormData:function(){return{section:[],observerSection:[],line:[],userType:"others",user:null,anyHard:[]}},termToForm:{date:n.rqlToForm,"observer.id":function(e,s,r){r.userType="observer",r.user=s.args[1]},"superior.id":function(e,s,r){r.userType="superior",r.user=s.args[1]},users:function(e,s,r){"mine"===s.args[1]?(r.userType="mine",r.user=null):(r.userType="others",r.user=s.args[1])},section:function(e,s,r){r[e]="in"===s.name?s.args[1]:[s.args[1]]},observerSection:"section",line:function(e,s,r){r[e]="in"===s.name?s.args[1].join(","):s.args[1]},anyHardObservations:function(e,s,r){s.args[1]&&r.anyHard.push("observations")},anyHardRisks:function(e,s,r){s.args[1]&&r.anyHard.push("risks")}},serialize:function(){return e.assign(r.prototype.serialize.call(this),{sections:o.sections.toJSON()})},serializeFormToQuery:function(s){var r=this.$('input[name="userType"]:checked').val(),t=this.$id("user").val(),i=this.getButtonGroupValue("anyHard");n.formToRql(this,s),"observer"===r&&t?s.push({name:"eq",args:["observer.id",t]}):"superior"===r&&t?s.push({name:"eq",args:["superior.id",t]}):"mine"===r?s.push({name:"eq",args:["users","mine"]}):t&&s.push({name:"eq",args:["users",t]}),e.contains(i,"observations")&&s.push({name:"eq",args:["anyHardObservations",!0]}),e.contains(i,"risks")&&s.push({name:"eq",args:["anyHardRisks",!0]}),["observerSection","section","line"].forEach(function(r){var t=this.$id(r).val()||[];"string"==typeof t&&(t=t.split(",")),1===(t=t.filter(function(s){return!e.isEmpty(s)})).length?s.push({name:"eq",args:[r,t[0]]}):t.length&&s.push({name:"in",args:[r,t]})},this)},afterRender:function(){r.prototype.afterRender.call(this),this.$(".is-expandable").expandableSelect(),a(this.$id("user"),{width:"335px",view:this}),this.$id("line").select2({width:"250px",allowClear:!0,multiple:!0,placeholder:" ",data:i.getActiveByType("prodLine").map(t)}),this.toggleButtonGroup("anyHard"),this.toggleUserSelect2()},destroy:function(){r.prototype.destroy.call(this),this.$(".is-expandable").expandableSelect("destroy")},toggleUserSelect2:function(){var e=this.$('input[name="userType"]:checked').val();this.$id("user").select2("enable","mine"!==e)}})});