define(["underscore","app/time","app/user","app/core/views/FilterView","app/core/util/idAndLabel","app/core/util/forms/dateTimeRange","app/data/orgUnits","app/users/util/setUpUserSelect2","app/kaizenOrders/dictionaries","app/behaviorObsCards/templates/filter","app/core/util/ExpandableSelect"],function(e,r,s,i,t,a,n,o,u,l){"use strict";return i.extend({template:l,filterList:["observerSection","section","line","anyHard","riskyBehaviors","limit"],filterMap:{hardBehavior:"anyHard",hardCondition:"anyHard",observer:"user"},events:e.assign({"click a[data-date-time-range]":a.handleRangeEvent,'change input[name="userType"]':"toggleUserSelect2","keyup select":function(e){if(27===e.keyCode)return e.target.selectedIndex=-1,!1},"dblclick select":function(e){e.target.selectedIndex=-1}},i.prototype.events),defaultFormData:function(){return{section:[],observerSection:[],line:[],userType:"others",user:null,anyHard:[],riskyBehaviors:[]}},termToForm:{date:a.rqlToForm,"observer.id":function(e,r,s){s.userType="observer",s.user=r.args[1]},"superior.id":function(e,r,s){s.userType="superior",s.user=r.args[1]},users:function(e,r,s){"mine"===r.args[1]?(s.userType="mine",s.user=null):(s.userType="others",s.user=r.args[1])},section:function(e,r,s){s[e]="in"===r.name?r.args[1]:[r.args[1]]},observerSection:"section",riskyBehaviors:"section",line:function(e,r,s){s[e]="in"===r.name?r.args[1].join(","):r.args[1]},anyHardObservations:function(e,r,s){r.args[1]&&s.anyHard.push("observations")},anyHardRisks:function(e,r,s){r.args[1]&&s.anyHard.push("risks")}},serialize:function(){return e.assign(i.prototype.serialize.call(this),{sections:u.sections.toJSON(),behaviors:u.behaviours.invoke("serialize")})},serializeFormToQuery:function(r){var i=this.$('input[name="userType"]:checked').val(),t=this.$id("user").val(),n=this.getButtonGroupValue("anyHard");a.formToRql(this,r),"observer"===i&&t?r.push({name:"eq",args:["observer.id",t]}):"superior"===i&&t?r.push({name:"eq",args:["superior.id",t]}):"mine"===i?r.push({name:"eq",args:["users","mine"]}):t&&r.push({name:"eq",args:["users",t]}),e.contains(n,"observations")&&r.push({name:"eq",args:["anyHardObservations",!0]}),e.contains(n,"risks")&&r.push({name:"eq",args:["anyHardRisks",!0]}),["observerSection","section","line","riskyBehaviors"].forEach(function(s){var i=this.$id(s).val()||[];"string"==typeof i&&(i=i.split(",")),1===(i=i.filter(function(r){return!e.isEmpty(r)})).length?r.push({name:"eq",args:[s,i[0]]}):i.length&&r.push({name:"in",args:[s,i]})},this),r.push({name:"lang",args:[s.lang]})},afterRender:function(){i.prototype.afterRender.call(this),this.$(".is-expandable").expandableSelect(),o(this.$id("user"),{width:"375px",view:this}),this.$id("line").select2({width:"250px",allowClear:!0,multiple:!0,placeholder:" ",data:n.getActiveByType("prodLine").map(t)}),this.toggleButtonGroup("anyHard"),this.toggleUserSelect2()},destroy:function(){i.prototype.destroy.call(this),this.$(".is-expandable").expandableSelect("destroy")},toggleUserSelect2:function(){var e=this.$('input[name="userType"]:checked').val();this.$id("user").select2("enable","mine"!==e)}})});