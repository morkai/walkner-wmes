// Part of <https://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

define(["underscore","jquery","app/i18n","app/core/views/ListView","app/behaviorObsCards/templates/detailsRow"],function(i,e,s,t,a){"use strict";return t.extend({className:"is-clickable",events:i.assign({"click .behaviorObsCards-list-expander":function(i){var e=i.currentTarget;return e.classList.contains("is-enabled")&&this.toggleDetails(e.parentNode.dataset.id,e.dataset.id),!1}},t.prototype.events),serializeColumns:function(){if(this.options.simple)return[{id:"rid",className:"is-min is-number"},{id:"date",className:"is-min"},{id:"section",className:"is-min"},{id:"line"}];var i=function(i,e){return'<span class="behaviorObsCards-list-text">'+e+"</span>"},e=function(i){return'class="behaviorObsCards-list-expander is-'+(i[this.id]?"enabled":"disabled")+'"'};return[{id:"rid",className:"is-min is-number"},{id:"date",className:"is-min"},{id:"observer",className:"is-min"},{id:"section",className:"is-min"},{id:"line",className:"is-min"},{id:"position",className:"is-min",tdDecorator:i},{id:"observation",tdAttrs:e,tdDecorator:i},{id:"risk",tdAttrs:e,tdDecorator:i},{id:"hardBehavior",tdAttrs:e,tdDecorator:i},{id:"hardCondition",tdAttrs:e,tdDecorator:i}]},serializeActions:function(){var i=this.collection;return this.options.simple?null:function(e){var s=i.get(e._id),a=[t.actions.viewDetails(s)];return s.canEdit()&&a.push(t.actions.edit(s)),s.canDelete()&&a.push(t.actions.delete(s)),a}},toggleDetails:function(i,e){var s=this.$('.list-item[data-id="'+i+'"]'),t=this.$(".is-expanded");this.collapseDetails(t),s[0]===t[0]&&t.attr("data-expanded-column-id")===e||this.expandDetails(s,e)},collapseDetails:function(i){i.removeClass("is-expanded").next().remove()},expandDetails:function(i,s){var t=this.collection.get(i.attr("data-id")),n="observation"===s?"observations":"risk"===s?"risks":"difficulties",d={idPrefix:this.idPrefix,columnId:s,model:{}};d.model[n]=t.get(n),e(a(d)).insertAfter(i),i.addClass("is-expanded").attr("data-expanded-column-id",s)}})});