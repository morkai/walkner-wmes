// Part of <https://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

define(["underscore","jquery","app/i18n","app/core/views/ListView","app/behaviorObsCards/templates/detailsRow"],function(i,s,e,t,a){"use strict";return t.extend({className:"is-clickable",events:i.assign({"click .behaviorObsCards-list-expander":function(i){var s=i.currentTarget;return s.classList.contains("is-enabled")&&this.toggleDetails(s.parentNode.dataset.id,s.dataset.id),!1}},t.prototype.events),serializeColumns:function(){if(this.options.simple)return[{id:"rid",className:"is-min is-number"},{id:"date",className:"is-min"},{id:"section",className:"is-min"},{id:"line"}];var i=function(i,s){return'<span class="behaviorObsCards-list-text">'+s+"</span>"},s=function(i){return'class="behaviorObsCards-list-expander is-'+(i[this.id]?"enabled":"disabled")+'"'};return[{id:"rid",className:"is-min is-number"},{id:"date",className:"is-min"},{id:"observer",className:"is-min"},{id:"section",className:"is-min"},{id:"line",className:"is-min"},{id:"position",className:"is-min"},{id:"observation",tdAttrs:s,tdDecorator:i},{id:"risk",tdAttrs:s,tdDecorator:i},{id:"hardBehavior",tdAttrs:s,tdDecorator:i},{id:"hardCondition",tdAttrs:s,tdDecorator:i}]},serializeActions:function(){var i=this.collection;return this.options.simple?null:function(s){var e=i.get(s._id),a=[t.actions.viewDetails(e)];return e.canEdit()&&a.push(t.actions.edit(e)),e.canDelete()&&a.push(t.actions.delete(e)),a}},toggleDetails:function(i,s){var e=this.$('.list-item[data-id="'+i+'"]'),t=this.$(".is-expanded");this.collapseDetails(t),e[0]!==t[0]&&this.expandDetails(e,s)},collapseDetails:function(i){i.removeClass("is-expanded").next().remove()},expandDetails:function(i,e){var t=this.collection.get(i.attr("data-id")),n="observation"===e?"observations":"risk"===e?"risks":"difficulties",r={idPrefix:this.idPrefix,columnId:e,model:{}};r.model[n]=t.get(n);var d=s(a(r));d.insertAfter(i),i.addClass("is-expanded")}})});