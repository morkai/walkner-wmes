define(["underscore","jquery","backbone","backbone.layout","app/broker","app/socket","app/pubsub","app/i18n","./util"],function(t,e,i,o,r,n,s,p,a){"use strict";function c(e){var i=this;i.idPrefix=t.uniqueId("v"),i.options=e||{},i.timers={},i.promises=[],t.forEach(i.sections,function(t,e){i.sections[e]="string"!=typeof t||"#"===t?"#"+i.idPrefix+"-"+e:t.replace("#-","#"+i.idPrefix+"-")}),a.defineSandboxedProperty(i,"broker",r),a.defineSandboxedProperty(i,"pubsub",s),a.defineSandboxedProperty(i,"socket",n),Object.defineProperty(i,"t",{enumerable:!0,configurable:!0,get:function(){return delete i.t,i.t=p.forDomain(i.getDefaultNlsDomain()),i.t}}),o.call(i,e),a.subscribeTopics(i,"broker",i.localTopics,!0),i.remoteTopicsAfterSync?(!0===i.remoteTopicsAfterSync&&(i.remoteTopicsAfterSync="model"),"string"==typeof i.remoteTopicsAfterSync&&i[i.remoteTopicsAfterSync]&&i.listenToOnce(i[i.remoteTopicsAfterSync],"sync",a.subscribeTopics.bind(a,i,"pubsub",i.remoteTopics,!0))):a.subscribeTopics(i,"pubsub",i.remoteTopics,!0)}return a.inherits(c,o),c.prototype.delegateEvents=function(e){if(e||(e=t.result(this,"events")),!e)return this;this.undelegateEvents(),Object.keys(e).forEach(function(i){var o=e[i];if(t.isFunction(o)||(o=this[o]),t.isFunction(o)){var r=i.match(/^(\S+)\s*(.*)$/),n=r[1]+".delegateEvents"+this.cid,s=r[2];""===s?this.$el.on(n,o.bind(this)):(t.isString(this.idPrefix)&&(s=s.replace(/#-/g,"#"+this.idPrefix+"-")),this.$el.on(n,s,o.bind(this)))}},this)},c.prototype.listenTo=function(t){if(t)return o.prototype.listenTo.apply(this,arguments)},c.prototype.listenToOnce=function(t){if(t)return o.prototype.listenToOnce.apply(this,arguments)},c.prototype.getViews=function(t){return"string"==typeof t&&/^#-/.test(t)&&(t=t.replace("#-","#"+this.idPrefix+"-")),o.prototype.getViews.call(this,t)},c.prototype.setView=function(t,e,r,n){return"string"==typeof t&&/^#-/.test(t)&&(t=t.replace("#-","#"+this.idPrefix+"-")),t instanceof i.View||e instanceof i.View?o.prototype.setView.call(this,t,e,r,n):null},c.prototype.cleanup=function(){this.destroy(),this.cleanupSelect2(),a.cleanupSandboxedProperties(this),t.isObject(this.timers)&&(t.forEach(this.timers,clearTimeout),this.timers={}),this.cancelRequests()},c.prototype.destroy=function(){},c.prototype.cleanupSelect2=function(){var t=this;this.$(".select2-container").each(function(){t.$("#"+this.id.replace("s2id_","")).select2("destroy")})},c.prototype.beforeRender=function(){},c.prototype.serialize=function(){return t.assign(this.getCommonTemplateData(),this.getTemplateData())},c.prototype.getCommonTemplateData=function(){var t=this.getTemplateHelpers();return{idPrefix:this.idPrefix,helpers:t,t:t.t}},c.prototype.getTemplateData=function(){return{}},c.prototype.getTemplateHelpers=function(){return{t:this.t,props:this.props.bind(this)}},c.prototype.renderPartial=function(t,i){return e(this.renderPartialHtml(t,i))},c.prototype.renderPartialHtml=function(e,i){return e(t.assign(this.getCommonTemplateData(),i))},c.prototype.afterRender=function(){},c.prototype.isRendered=function(){return!0===this.hasRendered},c.prototype.isDetached=function(){return!e.contains(document.documentElement,this.el)},c.prototype.ajax=function(t){return this.promised(e.ajax(t))},c.prototype.promised=function(e){if(!e||!t.isFunction(e.abort))return e;this.promises.push(e);var i=this;return e.always(function(){Array.isArray(i.promises)&&i.promises.splice(i.promises.indexOf(e),1)}),e},c.prototype.cancelRequests=function(){this.promises.forEach(function(t){t.abort()}),this.promises=[]},c.prototype.cancelAnimations=function(t,e){this.$el.stop(!1!==t,!1!==e),this.$(":animated").stop(!1!==t,!1!==e)},c.prototype.$id=function(i){var o="#";t.isString(this.idPrefix)&&(o+=this.idPrefix+"-"),o+=i;var r=this.$el.find(o);return r.length?r:e(o)},c.prototype.getDefaultModel=function(){return this[this.modelProperty]||this.model||this.collection},c.prototype.getDefaultNlsDomain=function(){if(this.nlsDomain)return this.nlsDomain;var t=this.getDefaultModel();if(t){if(t.getNlsDomain)return t.getNlsDomain();if(t.nlsDomain)return t.nlsDomain}return"core"},c.prototype.props=function(e,i){var o=this;i||(e=(i=e).data);var r='<div class="props '+(i.first?"first":"")+'">',n=o.getDefaultNlsDomain();return[].concat(t.isArray(i)?i:i.props).forEach(function(s){"string"==typeof s&&(s={id:s});var a=!1!==s.escape&&"!"!==s.id.charAt(0),c=a?s.id:s.id.substring(1),l=s.className||"",u=s.valueClassName||"",f=s.nlsDomain||i.nlsDomain||n,d=s.label||p(f,"PROPERTY:"+c),h=t.isFunction(s.value)?s.value(e[c],s,o):t.isUndefined(s.value)?e[c]:s.value;t.isFunction(s.visible)&&!s.visible(h,s,o)||(null==s.visible||s.visible)&&(a&&(h=t.escape(h)),r+='<div class="prop '+l+'" data-prop="'+c+'"><div class="prop-name">'+d+'</div><div class="prop-value '+u+'">'+h+"</div></div>")}),r+"</div>"},c});