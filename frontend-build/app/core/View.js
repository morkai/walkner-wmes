define(["underscore","jquery","backbone.layout","app/broker","app/socket","app/pubsub","./util"],function(e,t,n,i,r,a,o){function s(e){this.options=e||{},this.timers={},this.promises=[],o.defineSandboxedProperty(this,"broker",i),o.defineSandboxedProperty(this,"pubsub",a),o.defineSandboxedProperty(this,"socket",r),n.call(this,e),o.subscribeTopics(this,"broker",this.localTopics,!0),o.subscribeTopics(this,"pubsub",this.remoteTopics,!0)}return o.inherits(s,n),s.prototype.cleanup=function(){e.isFunction(this.destroy)&&this.destroy(),o.cleanupSandboxedProperties(this),e.isObject(this.timers)&&(e.each(this.timers,clearTimeout),this.timers=null),this.cancelRequests()},s.prototype.isRendered=function(){return this.hasRendered===!0},s.prototype.isDetached=function(){return!t.contains(document.documentElement,this.el)},s.prototype.ajax=function(e){return this.promised(t.ajax(e))},s.prototype.promised=function(t){if(e.isFunction(t.abort)){this.promises.push(t);var n=this;t.always(function(){Array.isArray(n.promises)&&n.promises.splice(n.promises.indexOf(t),1)})}return t},s.prototype.cancelRequests=function(){this.promises.forEach(function(e){e.abort()}),this.promises=[]},s.prototype.cancelAnimations=function(e,t){this.$(":animated").stop(e!==!1,t!==!1)},s.prototype.$id=function(e){var t="#";return"string"==typeof this.idPrefix&&(t+=this.idPrefix+"-"),this.$(t+e)},s});