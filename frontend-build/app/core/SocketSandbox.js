define(["underscore"],function(e){function t(e){if(this.socket=e,this.listeners={destroy:[]},e instanceof t){var i=this;this.socket.on("destroy",function(){i.destroy()})}}return t.prototype.destroy=function(){var t=this.listeners;if(null!=t){var i=t.destroy;if(e.isArray(i))for(var n=0,r=i.length;r>n;++n)i[n].call(this);delete this.listeners.destroy;for(var o=Object.keys(t),s=0,a=o.length;a>s;++s)for(var l=o[s],p=t[l],c=0,d=p.length;d>c;++c)this.socket.off(l,p[c]);this.listeners=null,this.socket=null}},t.prototype.sandbox=function(){return new t(this)},t.prototype.getId=function(){return this.socket.getId()},t.prototype.isConnected=function(){return this.socket.isConnected()},t.prototype.on=function(t,i){var n=this.listeners[t];return e.isUndefined(n)&&(n=this.listeners[t]=[]),n.push(i),"destroy"!==t&&this.socket.on(t,i),this},t.prototype.off=function(t,i){var n=this.listeners[t];if(e.isUndefined(n))return this;if(e.isUndefined(i))delete this.listeners[t];else{var r=e.indexOf(n,i);if(-1===r)return this;n.splice(r,1),0===n.length&&delete this.listeners[t]}return"destroy"!==t&&this.socket.off(t,i),this},t.prototype.emit=function(){var e=Array.prototype.slice.call(arguments),t=e.length-1;return e[t]=this.wrapCallback(e[t]),this.socket.emit.apply(this.socket,e),this},t.prototype.send=function(e,t){return this.socket.send(e,this.wrapCallback(t)),this},t.prototype.wrapCallback=function(t){if(!e.isFunction(t))return t;var i=this;return function(){null!==i.socket&&t.apply(this,arguments)}},t});