define(["underscore","backbone","h5.rql/index","./util","./PaginationData"],function(t,i,e,r,o){function n(e,r){t.isObject(r)||(r={}),this.rqlQuery=this.createRqlQuery(r.rqlQuery||this.rqlQuery),this.paginationData=r.paginate!==!1?new o:null,this.url||(this.url=this.model.prototype.urlRoot),i.Collection.call(this,e,r),this.paginationData&&this.listenTo(this.paginationData,"change:page",this.onPageChanged)}return r.inherits(n,i.Collection),n.prototype.parse=function(t){return this.paginationData&&this.paginationData.set({totalCount:t.totalCount,urlTemplate:this.genPaginationUrlTemplate(),skip:this.rqlQuery.skip,limit:this.rqlQuery.limit}),t.collection},n.prototype.sync=function(t,e,r){return"read"!==t||r.data||(r.data=this.rqlQuery.toString()),i.Collection.prototype.sync.call(this,t,e,r)},n.prototype.genClientUrl=function(t){if(null===this.model.prototype.clientUrlRoot)throw new Error("Model's `clientUrlRoot` was not specified");var i=this.model.prototype.clientUrlRoot;return"string"==typeof t&&(i+=";"+t),i},n.prototype.getTopicPrefix=function(){return this.topicPrefix||this.model.prototype.topicPrefix},n.prototype.getPrivilegePrefix=function(){return this.privilegePrefix||this.model.prototype.privilegePrefix},n.prototype.getNlsDomain=function(){return this.nlsDomain||this.model.prototype.nlsDomain},n.prototype.createRqlQuery=function(i){return t.isString(i)?i=e.parse(i):t.isFunction(i)?i=i.call(this,e):t.isObject(i)&&(i=e.Query.fromObject(i)),i&&!i.isEmpty()?i:t.isString(this.rqlQuery)?e.parse(this.rqlQuery):t.isFunction(this.rqlQuery)?this.rqlQuery.call(this,e):t.isObject(this.rqlQuery)?e.Query.fromObject(this.rqlQuery):new e.Query},n.prototype.genPaginationUrlTemplate=function(){var t=this.rqlQuery,i=t.skip,e=t.limit;t.skip="${skip}",t.limit="${limit}";var r=this.genClientUrl()+"?"+t.toString();return t.skip=i,t.limit=e,r},n.prototype.onPageChanged=function(t,i){this.rqlQuery.skip=(i-1)*this.rqlQuery.limit,this.fetch({reset:!0})},n});