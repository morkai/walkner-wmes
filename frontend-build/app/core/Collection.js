define(["underscore","backbone","h5.rql/index","./util","./PaginationData"],function(e,n,t,i,a){function o(t,i){e.isObject(i)||(i={}),this.rqlQuery=this.createRqlQuery(i.rqlQuery||this.rqlQuery),this.paginationData=i.paginate!==!1?new a:null,this.url||(this.url=this.model.prototype.urlRoot),n.Collection.call(this,t,i),this.paginationData&&this.listenTo(this.paginationData,"change:page",this.onPageChanged)}return i.inherits(o,n.Collection),o.prototype.parse=function(e){return this.paginationData&&this.paginationData.set({totalCount:e.totalCount,urlTemplate:this.genPaginationUrlTemplate(),skip:this.rqlQuery.skip,limit:this.rqlQuery.limit}),e.collection},o.prototype.sync=function(e,t,i){return"read"!==e||i.data||(i.data=this.rqlQuery.toString()),n.sync(e,t,i)},o.prototype.genClientUrl=function(e){if(null===this.model.prototype.clientUrlRoot)throw new Error("Model's `clientUrlRoot` was not specified");var n=this.model.prototype.clientUrlRoot;return"string"==typeof e&&(n+=";"+e),n},o.prototype.getTopicPrefix=function(){return this.topicPrefix||this.model.prototype.topicPrefix},o.prototype.getPrivilegePrefix=function(){return this.privilegePrefix||this.model.prototype.privilegePrefix},o.prototype.getNlsDomain=function(){return this.nlsDomain||this.model.prototype.nlsDomain},o.prototype.createRqlQuery=function(n){return e.isString(n)?n=t.parse(n):e.isFunction(n)?n=n.call(this,t):e.isObject(n)&&(n=t.Query.fromObject(n)),n&&!n.isEmpty()?n:e.isString(this.rqlQuery)?t.parse(this.rqlQuery):e.isFunction(this.rqlQuery)?this.rqlQuery.call(this,t):e.isObject(this.rqlQuery)?t.Query.fromObject(this.rqlQuery):new t.Query},o.prototype.genPaginationUrlTemplate=function(){var e=this.rqlQuery,n=e.skip,t=e.limit;e.skip="${skip}",e.limit="${limit}";var i=this.genClientUrl()+"?"+e.toString();return e.skip=n,e.limit=t,i},o.prototype.onPageChanged=function(e,n){this.rqlQuery.skip=(n-1)*this.rqlQuery.limit,this.fetch({reset:!0})},o});