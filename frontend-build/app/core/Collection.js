define(["underscore","backbone","h5.rql/index","./util","./PaginationData"],function(e,n,i,t,o){function a(i,t){e.isObject(t)||(t={}),this.rqlQuery=this.createRqlQuery(t.rqlQuery||this.rqlQuery),this.paginationData=t.paginate!==!1?new o:null,this.url||(this.url=this.model.prototype.urlRoot),n.Collection.call(this,i,t),this.paginationData&&this.listenTo(this.paginationData,"change:page",this.onPageChanged)}return t.inherits(a,n.Collection),a.prototype.parse=function(e){return this.paginationData&&this.paginationData.set({totalCount:e.totalCount,urlTemplate:this.genPaginationUrlTemplate(),skip:this.rqlQuery.skip,limit:this.rqlQuery.limit}),e.collection},a.prototype.sync=function(e,i,t){return"read"!==e||t.data||(t.data=this.rqlQuery.toString()),n.Collection.prototype.sync.call(this,e,i,t)},a.prototype.genClientUrl=function(e){if(null===this.model.prototype.clientUrlRoot)throw new Error("Model's `clientUrlRoot` was not specified");var n=this.model.prototype.clientUrlRoot;return"string"==typeof e&&(n+=";"+e),n},a.prototype.getTopicPrefix=function(){return this.topicPrefix||this.model.prototype.topicPrefix},a.prototype.getPrivilegePrefix=function(){return this.privilegePrefix||this.model.prototype.privilegePrefix},a.prototype.getNlsDomain=function(){return this.nlsDomain||this.model.prototype.nlsDomain},a.prototype.createRqlQuery=function(n){return e.isString(n)?n=i.parse(n):e.isFunction(n)?n=n.call(this,i):e.isObject(n)&&(n=i.Query.fromObject(n)),n&&!n.isEmpty()?n:e.isString(this.rqlQuery)?i.parse(this.rqlQuery):e.isFunction(this.rqlQuery)?this.rqlQuery.call(this,i):e.isObject(this.rqlQuery)?i.Query.fromObject(this.rqlQuery):new i.Query},a.prototype.genPaginationUrlTemplate=function(){var e=this.rqlQuery,n=e.skip,i=e.limit;e.skip="${skip}",e.limit="${limit}";var t=this.genClientUrl()+"?"+e.toString();return e.skip=n,e.limit=i,t},a.prototype.onPageChanged=function(e,n){this.rqlQuery.skip=(n-1)*this.rqlQuery.limit,this.fetch({reset:!0})},a});