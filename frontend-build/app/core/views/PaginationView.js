define(["underscore","../View","app/core/templates/pagination"],function(e,t,i){var n={pageNumbers:3,firstLastLinksVisible:!0,prevNextLinksVisible:!0,dotsVisible:!0},o=t.extend({template:i,events:{"click a":function(e){if(0===e.button){e.preventDefault();var t=e.currentTarget;this.changePage(+t.getAttribute("data-page"),t.getAttribute("href"))}}}});return o.prototype.initialize=function(){e.defaults(this.options,n),this.listenTo(this.model,"change:urlTemplate",this.render)},o.prototype.afterRender=function(){var e=this.model.get("limit");(-1===e||this.model.get("totalCount")<=e)&&this.$el.hide()},o.prototype.changePage=function(e,t){this.model.set({page:e}),t&&this.broker.publish("router.navigate",{url:t})},o.prototype.serialize=function(){var e=this.options,t=this.model,i=t.get("page"),n=Math.ceil(t.get("totalCount")/t.get("limit")),o=(e.pageNumbers-1)/2;e.dotsVisible&&(o+=1);var r=i,s=r+o,a=!0,l=!1;1>r-o?r=1:(r-=o,l=e.dotsVisible&&1!==r),l&&(r+=1),s>n&&(s=n,a=!1),o+1>i?(s+=o+1-i,s>n&&(s=n)):i>n-o&&(r-=o-(n-i),1>r&&(r=1));var c=e.dotsVisible&&a&&s!==n;return c&&(s-=1),1===r&&(l=!1),{pageCount:n,page:i,skip:t.get("skip"),limit:t.get("limit"),visible:n>1,firstLastLinksVisible:e.firstLastLinksVisible,prevNextLinksVisible:e.prevNextLinksVisible,leftDotsVisible:l,rightDotsVisible:c,firstPageLinkAvailable:i>1,lastPageLinkAvailable:n>i,prevPageLinkAvailable:i>1,nextPageLinkAvailable:n>i,firstPageHref:this.genPageHref(1),lastPageHref:this.genPageHref(n),prevPageHref:this.genPageHref(i-1),nextPageHref:this.genPageHref(i+1),pages:this.genPages(r,s)}},o.prototype.genPageHref=function(e){var t=this.model.get("urlTemplate"),i=this.model.get("limit");return t.replace("${page}",e).replace("${skip}",(e-1)*i).replace("${limit}",i)},o.prototype.genPages=function(e,t){for(var i=[],n=this.model.get("page"),o=e;t>=o;++o)i.push({no:o,active:o===n,href:this.genPageHref(o)});return i},o});