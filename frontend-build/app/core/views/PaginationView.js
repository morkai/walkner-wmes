define(["underscore","../View","app/core/templates/pagination"],function(e,t,i){var n={pageNumbers:3,firstLastLinksVisible:!0,prevNextLinksVisible:!0,dotsVisible:!0},r=t.extend({template:i,events:{"click a":function(e){if(0===e.button){e.preventDefault();var t=e.currentTarget;this.changePage(+t.getAttribute("data-page"),t.getAttribute("href"))}}}});return r.prototype.initialize=function(){e.defaults(this.options,n),this.listenTo(this.model,"change:urlTemplate",this.render)},r.prototype.afterRender=function(){var e=this.model.get("limit");(-1===e||this.model.get("totalCount")<=e)&&this.$el.hide()},r.prototype.changePage=function(e,t){this.model.set({page:e}),t&&this.broker.publish("router.navigate",{url:t})},r.prototype.serialize=function(){var e=this.options,t=this.model,i=t.get("page"),n=Math.ceil(t.get("totalCount")/t.get("limit")),r=(e.pageNumbers-1)/2;e.dotsVisible&&(r+=1);var o=i,s=o+r,a=!0,l=!1;1>o-r?o=1:(o-=r,l=e.dotsVisible&&1!==o),l&&(o+=1),s>n&&(s=n,a=!1),r+1>i?(s+=r+1-i,s>n&&(s=n)):i>n-r&&(o-=r-(n-i),1>o&&(o=1));var c=e.dotsVisible&&a&&s!==n;return c&&(s-=1),1===o&&(l=!1),{pageCount:n,page:i,skip:t.get("skip"),limit:t.get("limit"),visible:n>1,firstLastLinksVisible:e.firstLastLinksVisible,prevNextLinksVisible:e.prevNextLinksVisible,leftDotsVisible:l,rightDotsVisible:c,firstPageLinkAvailable:i>1,lastPageLinkAvailable:n>i,prevPageLinkAvailable:i>1,nextPageLinkAvailable:n>i,firstPageHref:this.genPageHref(1),lastPageHref:this.genPageHref(n),prevPageHref:this.genPageHref(i-1),nextPageHref:this.genPageHref(i+1),pages:this.genPages(o,s)}},r.prototype.genPageHref=function(e){var t=this.model.get("urlTemplate"),i=this.model.get("limit");return t.replace("${page}",e).replace("${skip}",(e-1)*i).replace("${limit}",i)},r.prototype.genPages=function(e,t){for(var i=[],n=this.model.get("page"),r=e;t>=r;++r)i.push({no:r,active:r===n,href:this.genPageHref(r)});return i},r});