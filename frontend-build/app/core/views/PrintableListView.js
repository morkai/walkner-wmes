// Copyright (c) 2014, ≈Åukasz Walukiewicz <lukasz@walukiewicz.eu>. Some Rights Reserved.
// Licensed under CC BY-NC-SA 4.0 <http://creativecommons.org/licenses/by-nc-sa/4.0/>.
// Part of the walkner-wmes project <http://lukasz.walukiewicz.eu/p/walkner-wmes>

define(["jquery","app/i18n","app/user","../View","./ActionFormView","./PaginationView","app/core/templates/printableList"],function(t,e,i,n,r,o,s){return n.extend({template:s,serialize:function(){return{className:this.className||"",columns:this.serializeColumns(),rows:this.serializeRows()}},serializeColumns:function(){var t,i=this.collection.getNlsDomain();return t=Array.isArray(this.options.columns)?this.options.columns:Array.isArray(this.columns)?this.columns:[],t.map(function(t){return{id:t,label:e(i,"PROPERTY:"+t)}})},serializeRows:function(){return this.collection.toJSON()},afterRender:function(){this.listenToOnce(this.collection,"reset",this.render)},fitToPrintablePage:function(e){var i=this.$("table"),n=i.find("thead").outerHeight(),r=[[]],o=n;this.$("tbody > tr").each(function(){var i=t(this),s=i.height();o+s>e&&(o=n,r[r.length-1].forEach(function(t){t.detach()}),r.push([])),o+=s,r[r.length-1].push(i)}),i.find("tbody").empty();var s=r.map(function(t){var e=i.clone(),n=e.find("tbody");return t.forEach(function(t){n.append(t.detach())}),e});return i.remove(),s}})});