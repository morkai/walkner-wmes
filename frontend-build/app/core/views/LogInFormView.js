// Copyright (c) 2014, ≈Åukasz Walukiewicz <lukasz@walukiewicz.eu>. Some Rights Reserved.
// Licensed under CC BY-NC-SA 4.0 <http://creativecommons.org/licenses/by-nc-sa/4.0/>.
// Part of the walkner-wmes project <http://lukasz.walukiewicz.eu/p/walkner-wmes>

define(["app/user","../View","app/core/templates/logInForm"],function(s,t,i){"use strict";return t.extend({template:i,events:{submit:"submitForm","keypress input":function(){this.$submitEl.removeClass("btn-danger").addClass("btn-primary")}},destroy:function(){this.$submitEl=null},afterRender:function(){this.$('input[name="login"]').focus(),this.$submitEl=this.$(".logInForm-submit")},submitForm:function(){if(!this.$submitEl.hasClass("btn-primary"))return!1;var t={login:this.$("[name=login]").val(),password:this.$("[name=password]").val(),socketId:this.socket.getId()};if(0===t.login.length||0===t.password.length)return!1;this.$el.addClass("logInForm-loading"),this.$submitEl.attr("disabled",!0);var i=this.ajax({type:"POST",url:this.el.action,data:JSON.stringify(t)}),n=this;return i.done(function(t){n.$submitEl.removeClass("btn-primary").addClass("btn-success"),s.reload(t)}),i.fail(function(){n.$submitEl.removeClass("btn-primary").addClass("btn-danger"),n.$submitEl.attr("disabled",!1),n.$el.removeClass("logInForm-loading"),n.$("[autofocus]").focus()}),!1}})});