define(["jquery","app/i18n","app/user","../View","./ActionFormView","./PaginationView","app/core/templates/list"],function(e,t,n,i,r,o,s){function a(e,n,i){return n||(n=e.getNlsDomain()),t.has(n,i)?t(n,i):t("core",i)}var l=i.extend({template:s,remoteTopics:function(){var e={},t=this.collection.getTopicPrefix();return e[t+".added"]="refreshCollection",e[t+".edited"]="refreshCollection",e[t+".deleted"]="refreshCollection",e},events:{"click .action-delete":function(e){e.preventDefault(),r.showDeleteDialog({model:this.getModelFromEvent(e)})}},initialize:function(){this.lastRefreshAt=0,this.collection.paginationData&&(this.setView(".pagination-container",new o({model:this.collection.paginationData})),this.listenTo(this.collection.paginationData,"change:page",this.scrollTop))},serialize:function(){return{columns:this.serializeColumns(),actions:this.serializeActions(),rows:this.serializeRows()}},serializeColumns:function(){var e,n=this.collection.getNlsDomain();return e=Array.isArray(this.options.columns)?this.options.columns:Array.isArray(this.columns)?this.columns:[],e.map(function(e){return{id:e,label:t(n,"PROPERTY:"+e)}})},serializeActions:function(){return l.actions.viewEditDelete(this.collection)},serializeRows:function(){return this.collection.map(this.options.serializeRow||this.serializeRow,this)},serializeRow:function(e){return e.toJSON()},beforeRender:function(){this.stopListening(this.collection,"reset",this.render)},afterRender:function(){this.listenToOnce(this.collection,"reset",this.render)},refreshCollection:function(){var e=Date.now(),t=e-this.lastRefreshAt;1e3>t?this.timers.refreshCollection||(this.timers.refreshCollection=setTimeout(this.refreshCollection.bind(this),1e3-t)):(this.lastRefreshAt=Date.now(),delete this.timers.refreshCollection,this.promised(this.collection.fetch({reset:!0})))},scrollTop:function(){var t=this.$el.offset().top-14,n=e(".navbar-fixed-top");n.length&&(t-=n.outerHeight()),e("html, body").stop(!0,!1).animate({scrollTop:t})},getModelFromEvent:function(e){return this.collection.get(this.$(e.target).closest(".list-item").attr("data-id"))}});return l.actions={viewDetails:function(e,t){return{id:"viewDetails",icon:"file-text-o",label:a(e,t,"LIST:ACTION:viewDetails"),href:e.genClientUrl()}},edit:function(e,t){return{id:"edit",icon:"edit",label:a(e,t,"LIST:ACTION:edit"),href:e.genClientUrl("edit")}},"delete":function(e,t){return{id:"delete",icon:"times",label:a(e,t,"LIST:ACTION:delete"),href:e.genClientUrl("delete")}},viewEditDelete:function(e,t,i){return function(r){var o=e.get(r._id),s=[l.actions.viewDetails(o,i)];return n.isAllowedTo((t||o.getPrivilegePrefix())+":MANAGE")&&s.push(l.actions.edit(o,i),l.actions.delete(o,i)),s}}},l});