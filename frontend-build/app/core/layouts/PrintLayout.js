define(["underscore","jquery","moment","app/user","../View","app/core/templates/printLayout"],function(t,e,i,n,r,a){var o=r.extend({pageContainerSelector:".print-page-bd",template:a});return o.prototype.initialize=function(){this.model={id:null,actions:[],breadcrumbs:[]}},o.prototype.destroy=function(){this.el.ownerDocument&&this.el.ownerDocument.body.classList.remove("print")},o.prototype.afterRender=function(){this.changeTitle(),null!==this.model.id&&this.setId(this.model.id),this.el.ownerDocument&&this.el.ownerDocument.body.classList.add("print")},o.prototype.reset=function(){this.setId(null),this.model.breadcrumbs=[],this.removeView(this.pageContainerSelector)},o.prototype.setUpPage=function(t){t.pageId&&this.setId(t.pageId),t.breadcrumbs?this.setBreadcrumbs(t.breadcrumbs,t):this.changeTitle(),this.listenTo(t,"afterRender",this.fitToPrintablePage)},o.prototype.setId=function(t){return this.isRendered()&&this.$el.attr("data-id",t),this.model.id=t,this},o.prototype.setBreadcrumbs=function(t,e){return null==t?this:("function"==typeof t&&(t=t.call(e)),Array.isArray(t)||(t=[t]),this.model.breadcrumbs=t.map(function(t){var e=typeof t;return("string"===e||"function"===e)&&(t={label:t}),t}),this.changeTitle(),this)},o.prototype.changeTitle=function(){this.isRendered()&&this.broker.publish("page.titleChanged",t.pluck(this.model.breadcrumbs,"label"))},o.prototype.fitToPrintablePage=function(r){var a=this.$(".print-pages"),o=a.find(".print-page"),s=o.find(".print-page-hd"),p=o.find(".print-page-ft"),d=o.find(".print-page-bd"),l=e('<div class="print-page-bd-container"></div>');t.isFunction(r.hdLeft)&&s.find(".print-page-hd-left").text(r.hdLeft.call(r)),t.isFunction(r.hdRight)&&s.find(".print-page-hd-right").text(r.hdRight.call(r));var c,h=1122,u={top:parseFloat(o.css("padding-top"))||0,left:parseFloat(o.css("padding-left"))||0,right:parseFloat(o.css("padding-right"))||0,bottom:parseFloat(o.css("padding-bottom"))||0},g=s.outerHeight(!0),f=p.outerHeight(!0),b=h-u.top-u.bottom-g-f;c=t.isFunction(r.fitToPrintablePage)?r.fitToPrintablePage.call(r,b):t.isObject(r.view)&&t.isFunction(r.view.fitToPrintablePage)?r.view.fitToPrintablePage.call(r,b):[r.$el.detach()],l.height(b),d.wrap(l),o.detach(),c.forEach(function(t,e){var i=o.clone();i.find(".print-page-bd").append(t),i.find(".print-page-no").text(e+1),i.addClass("print-page-fit"),a.append(i)}),o.remove(),this.$(".print-page-count").text(c.length),this.$(".print-page-date").text(i().format("LLL")),this.$(".print-page-user").text(n.data.name||n.data.login)},o});