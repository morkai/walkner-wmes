define(["underscore","jquery","moment","app/user","../View","app/core/templates/printLayout"],function(e,t,i,n,r,a){var o=r.extend({pageContainerSelector:".print-page-bd",template:a});return o.prototype.initialize=function(){this.model={id:null,actions:[],breadcrumbs:[]}},o.prototype.destroy=function(){this.el.ownerDocument&&this.el.ownerDocument.body.classList.remove("print")},o.prototype.afterRender=function(){this.changeTitle(),null!==this.model.id&&this.setId(this.model.id),this.el.ownerDocument&&this.el.ownerDocument.body.classList.add("print")},o.prototype.reset=function(){this.setId(null),this.model.breadcrumbs=[],this.removeView(this.pageContainerSelector)},o.prototype.setUpPage=function(e){e.pageId&&this.setId(e.pageId),e.breadcrumbs?this.setBreadcrumbs(e.breadcrumbs,e):this.changeTitle(),this.listenTo(e,"afterRender",this.fitToPrintablePage)},o.prototype.setId=function(e){return this.isRendered()&&this.$el.attr("data-id",e),this.model.id=e,this},o.prototype.setBreadcrumbs=function(e,t){return null==e?this:("function"==typeof e&&(e=e.call(t)),Array.isArray(e)||(e=[e]),this.model.breadcrumbs=e.map(function(e){var t=typeof e;return("string"===t||"function"===t)&&(e={label:e}),e}),this.changeTitle(),this)},o.prototype.changeTitle=function(){this.isRendered()&&this.broker.publish("page.titleChanged",e.pluck(this.model.breadcrumbs,"label"))},o.prototype.fitToPrintablePage=function(r){var a=this.$(".print-pages"),o=a.find(".print-page"),s=o.find(".print-page-hd"),l=o.find(".print-page-ft"),p=o.find(".print-page-bd"),c=t('<div class="print-page-bd-container"></div>');e.isFunction(r.hdLeft)&&s.find(".print-page-hd-left").text(r.hdLeft.call(r)),e.isFunction(r.hdRight)&&s.find(".print-page-hd-right").text(r.hdRight.call(r));var d,u=1122,m={top:parseFloat(o.css("padding-top"))||0,left:parseFloat(o.css("padding-left"))||0,right:parseFloat(o.css("padding-right"))||0,bottom:parseFloat(o.css("padding-bottom"))||0},f=s.outerHeight(!0),h=l.outerHeight(!0),g=u-m.top-m.bottom-f-h;d=e.isFunction(r.fitToPrintablePage)?r.fitToPrintablePage.call(r,g):e.isObject(r.view)&&e.isFunction(r.view.fitToPrintablePage)?r.view.fitToPrintablePage.call(r,g):[r.$el.detach()],c.height(g),p.wrap(c),o.detach(),d.forEach(function(e,t){var i=o.clone();i.find(".print-page-bd").append(e),i.find(".print-page-no").text(t+1),i.addClass("print-page-fit"),a.append(i)}),o.remove(),this.$(".print-page-count").text(d.length),this.$(".print-page-date").text(i().format("LLL")),this.$(".print-page-user").text(n.data.name||n.data.login)},o});