// Part of <https://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

define(["app/i18n","app/viewport"],function(e,o){"use strict";return function(r,s,n,a){function i(e){!1!==e.showLoadingMessage&&o.msg.loaded()}function d(r,s){var i=s.statusText;if("abort"===i)return void(!1!==r.showLoadingMessage&&o.msg.loaded());var d=s.responseJSON;d&&d.error&&(d.error.code?i=d.error.code:d.error.message&&(i=d.error.message)),!1!==r.showLoadingMessage&&o.msg.loadingFailed(e(a||"core",n||"MSG:LOADING_FAILURE",{code:i}))}return s.listenTo(r,"request",function(e,r,s){"read"===s.syncMethod&&(!1!==s.showLoadingMessage&&o.msg.loading(),r.done(i.bind(s)),r.fail(d.bind(s)))}),r}});