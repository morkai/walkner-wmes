// Part of <https://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

define(["jquery","underscore"],function(e,t){"use strict";function i(t,i){this.id=++n,this.$el=t,this.$helper=null,this.options=i,e(window).on("resize."+s+this.id,this.onWindowResize.bind(this)),this.$el.on("mousedown."+s,this.onMouseDown.bind(this)).on("keydown."+s,this.onKeyDown.bind(this)).on("focus."+s,this.onFocus.bind(this)).on("blur."+s,this.onBlur.bind(this))}var s="expandableSelect",n=0;return i.prototype={destroy:function(){this.collapse(),e(window).off("."+s+this.id),this.$el.off("."+s),this.$el=null},isExpanded:function(){return this.$el.hasClass(this.options.isExpandedClassName)},expand:function(){if(!this.isExpanded()){var e=this.$el.css("width"),t=this.$el.position();this.$helper=this.options.createHelperElement(this.$el),this.$helper.css({width:e,opacity:0}),this.$helper.insertAfter(this.$el);var i=this.$el.prop("length")+this.$el.find("optgroup").length,s=this.options.expandedLength||parseInt(this.$el.attr("data-expanded-length"),10)||i;this.$el.prop("size",s>i?i:s),this.$el.css({top:t.top+"px",left:t.left+"px",width:e}),this.$el.addClass(this.options.isExpandedClassName)}},collapse:function(){this.isExpanded()&&(this.$helper.remove(),this.$helper=null,this.$el.prop("size",1),this.$el.removeClass(this.options.isExpandedClassName))},onWindowResize:function(){this.collapse()},onMouseDown:function(e){this.isExpanded()||(this.expand(),t.defer(this.$el.focus.bind(this.$el)),e.preventDefault())},onKeyDown:function(e){if(27===e.keyCode)return this.$el.blur(),!1},onFocus:function(){this.expand()},onBlur:function(){this.collapse()}},e.fn[s]=function(){var n,o=null,l=null,h=null;return 0!==arguments.length&&t.isString(arguments[0])?(h=Array.prototype.slice.call(arguments),l=h.shift()):o=t.defaults({},arguments[0],e.fn[s].defaults),this.each(function(){var t=e(this),d=t.data(s);if(d){if(null!==l)return n=d[l].apply(d,h),void(void 0===n&&(n=null));d.destroy()}t.data(s,new i(t,o))}),void 0===n?this:n},e.fn[s].defaults={isExpandedClassName:"is-expanded",createHelperElement:function(t){return e("<div></div>").attr("class",t.attr("class"))},expandedLength:0},i});