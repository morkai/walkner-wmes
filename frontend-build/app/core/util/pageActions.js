define(["underscore","app/i18n","app/viewport","../views/ActionFormView","app/core/templates/jumpAction","app/core/templates/exportAction"],function(e,t,n,r,l,a){"use strict";function i(e,t,n){return!1===t?null:t||e.getPrivilegePrefix()+":"+(n||"MANAGE")}return{add:function(e,n){return{label:t.bound(e.getNlsDomain(),"PAGE_ACTION:add"),icon:"plus",href:e.genClientUrl("add"),privileges:i(e,n)}},edit:function(e,n){return{label:t.bound(e.getNlsDomain(),"PAGE_ACTION:edit"),icon:"edit",href:e.genClientUrl("edit"),privileges:i(e,n)}},delete:function(n,l,a){return a||(a={}),{label:t.bound(n.getNlsDomain(),"PAGE_ACTION:delete"),icon:"times",href:n.genClientUrl("delete"),privileges:i(n,l),callback:function(t){t&&0!==t.button||(t&&t.preventDefault(),r.showDeleteDialog(e.defaults({model:n},a)))}}},export:function(n,r,l,o){var u={layout:n,page:r,collection:l,privilege:o,maxCount:6e4};1===arguments.length&&e.assign(u,n);var c=function(){var n,r=(n=u.collection).paginationData?n.paginationData.get("totalCount"):n.length,l=e.result(u.collection,"url")+";export.${format}?"+u.collection.rqlQuery,i=[{type:"csv",href:l.replace("${format}","csv")}];return window.XLSX_EXPORT&&r<u.maxCount/2&&i.push({type:"xlsx",href:l.replace("${format}","xlsx")}),a({type:r>=u.maxCount/2?"danger":r>=u.maxCount/4?"warning":"default",formats:i,disabled:r>=u.maxCount||0===r,label:u.label||t(u.collection.getNlsDomain(),"PAGE_ACTION:export")})};return u.page.listenTo(u.collection,"sync",function(){u.layout.$(".page-actions-export").replaceWith(c())}),{template:c,privileges:i(u.collection,u.privilege,"VIEW"),callback:u.callback}},jump:function(r,a,i){return i=e.assign({mode:"rid",pattern:"^ *[0-9]+ *$",autoFocus:!0},i),{template:function(){var e=a.getNlsDomain();return l({title:i.title||t(e,"PAGE_ACTION:jump:title"),placeholder:i.placeholder||t(e,"PAGE_ACTION:jump:placeholder"),autoFocus:i.autoFocus,pattern:i.pattern})},afterRender:function(l){var o=l.find("form");o.submit(function(r,l,a,i){var o=a[0].phrase;if(o.readOnly)return!1;var u=o.value;o.readOnly=!0;var c=a.find(".fa").removeClass("fa-search").addClass("fa-spinner fa-spin"),s=r.ajax("rid"===i.mode?{url:e.result(l,"url")+";rid",data:{rid:u}}:{method:"HEAD",url:e.result(l,"url")+"/"+u});return s.done(function(e){r.broker.publish("router.navigate",{url:l.genClientUrl()+"/"+(e||u),trigger:!0})}),s.fail(function(){n.msg.show({type:"error",time:2e3,text:t(l.getNlsDomain(),"MSG:jump:404",{rid:u})}),c.removeClass("fa-spinner fa-spin").addClass("fa-search"),o.readOnly=!1,o.select()}),!1}.bind(null,r,a,o,i))}}}}});