define(["underscore","app/i18n","app/viewport","../views/ActionFormView","app/core/templates/jumpAction","app/core/templates/exportAction"],function(e,t,r,l,n,a){"use strict";function i(e,t,r){return!1===t?null:t||e.getPrivilegePrefix()+":"+(r||"MANAGE")}return{add:function(e,r){return{label:t.bound(e.getNlsDomain(),"PAGE_ACTION:add"),icon:"plus",href:e.genClientUrl("add"),privileges:i(e,r)}},edit:function(e,r){return{label:t.bound(e.getNlsDomain(),"PAGE_ACTION:edit"),icon:"edit",href:e.genClientUrl("edit"),privileges:i(e,r)}},delete:function(r,n,a){return a||(a={}),{label:t.bound(r.getNlsDomain(),"PAGE_ACTION:delete"),icon:"times",href:r.genClientUrl("delete"),privileges:i(r,n),callback:function(t){t&&0!==t.button||(t&&t.preventDefault(),l.showDeleteDialog(e.defaults({model:r},a)))}}},export:function(r,l,n,o){var u={layout:r,page:l,collection:n,privilege:o};1===arguments.length&&(u=r);var c=function(){var r,l=(r=u.collection).paginationData?r.paginationData.get("totalCount"):r.length,n=e.result(u.collection,"url")+";export.${format}?"+u.collection.rqlQuery,i=[{type:"csv",href:n.replace("${format}","csv")}];return window.XLSX_EXPORT&&l<3e4&&i.push({type:"xlsx",href:n.replace("${format}","xlsx")}),a({type:l>=3e4?"danger":l>=15e3?"warning":"default",formats:i,disabled:l>=6e4||0===l,label:u.label||t(u.collection.getNlsDomain(),"PAGE_ACTION:export")})};return u.page.listenTo(u.collection,"sync",function(){u.layout.$(".page-actions-export").replaceWith(c())}),{template:c,privileges:i(u.collection,u.privilege,"VIEW"),callback:u.callback}},jump:function(l,a,i){return i=e.assign({mode:"rid",pattern:"^ *[0-9]+ *$",autoFocus:!0},i),{template:function(){var e=a.getNlsDomain();return n({title:i.title||t(e,"PAGE_ACTION:jump:title"),placeholder:i.placeholder||t(e,"PAGE_ACTION:jump:placeholder"),autoFocus:i.autoFocus,pattern:i.pattern})},afterRender:function(n){var o=n.find("form");o.submit(function(l,n,a,i){var o=a[0].phrase;if(o.readOnly)return!1;var u=o.value;o.readOnly=!0;var c=a.find(".fa").removeClass("fa-search").addClass("fa-spinner fa-spin"),s=l.ajax("rid"===i.mode?{url:e.result(n,"url")+";rid",data:{rid:u}}:{method:"HEAD",url:e.result(n,"url")+"/"+u});return s.done(function(e){l.broker.publish("router.navigate",{url:n.genClientUrl()+"/"+(e||u),trigger:!0})}),s.fail(function(){r.msg.show({type:"error",time:2e3,text:t(n.getNlsDomain(),"MSG:jump:404",{rid:u})}),c.removeClass("fa-spinner fa-spin").addClass("fa-search"),o.readOnly=!1,o.select()}),!1}.bind(null,l,a,o,i))}}}}});