define(["underscore","autolinker","app/i18n"],function(e,n,t){"use strict";var r=/(.)??(#[0-9]+|[0-9]{15}|0*[0-9]{12}|[0-9]{9}|[A-Z]{3}[0-9]{3}[A-Z]{1})(.)??/g,i=null;function l(e){return i||(i=new n({urls:{schemeMatches:!0,wwwMatches:!0,tldMatches:!0},email:!0,phone:!1,mention:!1,hashtag:!1,stripPrefix:!0,stripTrailingSlash:!0,newWindow:!0,truncate:{length:0,location:"end"},className:"",replaceFn:function(e){var n=e.buildTag();if("url"===e.getType()&&-1!==e.getUrl().indexOf(window.location.host)){var t=n.innerHTML.split("?");t.length>1&&t[1].length&&(n.innerHTML=t[0]+"?&hellip;"),delete n.attrs.rel}else n.innerHTML.length>=60&&(n.innerHTML=n.innerHTML.substring(0,50)+"&hellip;");return n}})),i.link(e)}return{autolinkText:l,autolinkMessage:function(n,i){return n=(n||"").trim().replace(/\n{3,}/,"\n\n"),n=(n=l(e.escape(n)).replace(/ðŸ‘¤/g,'<i class="fa fa-user"></i>')).replace(r,function(e,n,r,l){var a;if("/"===n)return e;if(void 0===n&&(n=""),void 0===l&&(l=""),r=r.replace(/^0+/,""),/^#[0-9]+$/.test(r)&&r.length<9?(a="entry",r=r.substring(1),n+="#"):a=15===r.length?"document":9===r.length?"order":"product",!a)return e;var s=i&&i.nlsDomain,o="autolink:"+a,u=s&&t.has(s,o)?t(s,o):t("core",o);return console.log({type:a,nlsDomain:s,nlsProp:o,title:u}),n+'<a class="autolink" title="'+u+'" data-type="'+a+'" data-id="'+r.toUpperCase()+'">'+r+"</a>"+l})}}});