define(["underscore","autolinker","app/i18n"],function(e,n,t){"use strict";var r=/(.)??(#[0-9]+|[0-9]{15}|0*[0-9]{12}|[0-9]{9}|[A-Z]{3}[0-9]{3}[A-Z]{1})(.)??/g,i=null;function a(e){return i||(i=new n({urls:{schemeMatches:!0,wwwMatches:!0,tldMatches:!0},email:!0,phone:!1,mention:!1,hashtag:!1,stripPrefix:!0,stripTrailingSlash:!0,newWindow:!0,truncate:{length:0,location:"end"},className:"",replaceFn:function(e){var n=e.buildTag();if("url"===e.getType()&&-1!==e.getUrl().indexOf(window.location.host)){var t=n.innerHTML.split("?");t.length>1&&t[1].length&&(n.innerHTML=t[0]+"?&hellip;"),delete n.attrs.rel}else n.innerHTML.length>=60&&(n.innerHTML=n.innerHTML.substring(0,50)+"&hellip;");return n}})),i.link(e)}return{autolinkText:a,autolinkMessage:function(n,i){return n=(n||"").trim().replace(/\n{3,}/,"\n\n"),n=(n=a(e.escape(n)).replace(/ðŸ‘¤/g,'<i class="fa fa-user"></i>')).replace(r,function(e,n,r,a){var l;if("/"===n)return e;if(void 0===n&&(n=""),void 0===a&&(a=""),r=r.replace(/^0+/,""),/^#[0-9]+$/.test(r)&&r.length<9?(l="entry",r=r.substring(1),n+="#"):l=15===r.length?"document":9===r.length?"order":"product",!l)return e;var s=i&&i.nlsDomain,u="autolink:"+l;return n+'<a class="autolink" title="'+(s&&t.has(s,u)?t(s,u):t("core",u))+'" data-type="'+l+'" data-id="'+r.toUpperCase()+'">'+r+"</a>"+a})}}});