define(["underscore","app/time"],function(e,t){function n(e,n){var i;if(e.hasClass("form-group-datetime")){var a=e.find("input[type=date]"),r=e.find("input[type=time]"),o=a.val().trim(),s=r.val().trim();0===s.length&&(s=n),i=t.getMoment(o+" "+s)}else i=t.getMoment(e.val());var l=i.isValid();if(e.hasClass("form-group-datetime"))e.find("input[type=date]").val(l?i.format("YYYY-MM-DD"):""),e.find("input[type=time]").val(l?i.format("HH:mm"):n);else if(l){var c="";switch(e.attr("type")){case"datetime-local":case"datetime":c=i.toISOString();break;case"date":c=i.format("YYYY-MM-DD");break;case"time":c=i.format("HH:mm");break;default:c=i.format("YYYY-MM-DD HH:mm")}e.val(c)}else e.val("");return i}var i=document.createElement("input");i.setAttribute("type","datetime-local"),i="text"!==i.type;var a={};return a.fromView=function(t,i){i=e.defaults(i||{},{fromId:"from",toId:"to",defaultTime:"00:00"});var a={from:null,to:null},r=n(t.$id(i.fromId),i.defaultTime),o=n(t.$id(i.toId),i.defaultTime);return r.isValid()&&(a.from=r.valueOf()),o.isValid()&&(a.to=o.valueOf()),a},a.toFormData=function(e,n,a){if("select"!==n.name&&"sort"!==n.name){var r="ge"===n.name?"from":"to",o=t.getMoment(n.args[1]);"date+time"===a?(e[r+"-date"]=o.format("YYYY-MM-DD"),e[r+"-time"]=o.format("HH:mm")):e[r]="datetime"===a?i?o.toISOString():o.format("YYYY-MM-DD HH:mm:ss"):"time"===a?o.format("HH:mm:ss"):o.format("YYYY-MM-DD")}},a});