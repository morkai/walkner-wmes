define(["underscore","app/time"],function(t,e){function a(t,a){var m;if(t.hasClass("form-group-datetime")){var i=t.find("input[type=date]"),r=t.find("input[type=time]"),o=i.val().trim(),f=r.val().trim();0===f.length&&(f=a),m=e.getMoment(o+" "+f)}else m=e.getMoment(t.val());var n=m.isValid();if(t.hasClass("form-group-datetime"))t.find("input[type=date]").val(n?m.format("YYYY-MM-DD"):""),t.find("input[type=time]").val(n?m.format("HH:mm"):a);else if(n){var l="";switch(t.attr("type")){case"datetime-local":case"datetime":l=m.toISOString();break;case"date":l=m.format("YYYY-MM-DD");break;case"time":l=m.format("HH:mm");break;default:l=m.format("YYYY-MM-DD HH:mm")}t.val(l)}else t.val("");return m}var m=document.createElement("input");m.setAttribute("type","datetime-local"),m="text"!==m.type;var i={};return i.fromView=function(e,m){m=t.defaults(m||{},{fromId:"from",toId:"to",defaultTime:"00:00"});var i={from:null,to:null},r=a(e.$id(m.fromId),m.defaultTime),o=a(e.$id(m.toId),m.defaultTime);return r.isValid()&&(i.from=r.valueOf()),o.isValid()&&(i.to=o.valueOf()),i},i.toFormData=function(t,a,i){if("select"!==a.name&&"sort"!==a.name){var r="ge"===a.name?"from":"to",o=e.getMoment(a.args[1]);"date+time"===i?(t[r+"-date"]=o.format("YYYY-MM-DD"),t[r+"-time"]=o.format("HH:mm")):t[r]="datetime"===i?m?o.toISOString():o.format("YYYY-MM-DD HH:mm:ss"):o.format("time"===i?"HH:mm:ss":"YYYY-MM-DD")}},i});