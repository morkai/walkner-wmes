define(["underscore","moment","app/time"],function(t,e,a){"use strict";var m=document.createElement("input");function i(t,m,i){var r;if(t.hasClass("form-group-datetime")){var o=t.find("input[type=date]"),f=t.find("input[type=time]"),s=o.val().trim(),n=f.val().trim();0===n.length&&(n=m),2===n.split(":").length&&(n+=":00"),r=(i?e.utc:a.getMoment)(s+" "+n,"YYYY-MM-DD HH:mm:ss")}else{var l=t.val().trim();if(/^[0-9]{4}.[0-9]{1,2}/.test(l)&&!/^[0-9]{4}.[0-9]{1,2}.[0-9]{1,2}/.test(l)){var u=l.split(" ");u[0]+="-01",l=u.join(" ")}/ [0-9]+:[0-9]+(:[0-9]+)?/.test(l)||(l+=" "+(m||"00:00:00")),2===l.split(":").length&&(l+=":00"),r=(i?e.utc:a.getMoment)(l,"YYYY-MM-DD HH:mm:ss")}var Y=r.isValid();if(t.hasClass("form-group-datetime"))t.find("input[type=date]").val(Y?r.format("YYYY-MM-DD"):""),t.find("input[type=time]").val(Y?r.format("HH:mm"):"");else if(Y){var d="";switch(t.attr("type")){case"datetime-local":case"datetime":d=r.toISOString();break;case"date":d=r.format("YYYY-MM-DD");break;case"time":d=r.format("HH:mm");break;case"month":d=r.format("YYYY-MM");break;default:d=r.format("YYYY-MM-DD HH:mm")}t.val(d)}else t.val("");return r}m.setAttribute("type","datetime-local"),m="text"!==m.type;var r={fromView:function(e,a){a=t.defaults(a||{},{fromId:"from",toId:"to",defaultTime:"00:00",utc:!1});var m={from:null,to:null},r=e.$id(a.fromId),o=e.$id(a.toId),f=i(r,a.defaultTime,a.utc),s=i(o,a.defaultTime,a.utc);return f.isValid()&&(m.from=f.valueOf()),s.isValid()&&(m.to=s.valueOf()),m},toFormData:function(i,r,o,f){if("select"!==r.name&&"sort"!==r.name){f=t.defaults(f||{},{utc:!1});var s="ge"===r.name?"from":"to",n=(f.utc?e.utc:a.getMoment)(r.args[1]);"date+time"===o?(i[s+"-date"]=n.format("YYYY-MM-DD"),i[s+"-time"]=n.format("HH:mm")):i[s]="datetime"===o?m?n.toISOString():n.format("YYYY-MM-DD HH:mm:ss"):"time"===o?n.format("HH:mm:ss"):n.format("YYYY-MM-DD")}}};return r});