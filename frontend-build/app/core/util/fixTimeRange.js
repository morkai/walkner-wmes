define(["underscore","app/time"],function(t,e){function a(t,a){var m;if(t.hasClass("form-group-datetime")){var r=t.find("input[type=date]"),i=t.find("input[type=time]"),o=r.val().trim(),f=i.val().trim();0===f.length&&(f=a),m=e.getMoment(o+" "+f)}else m=e.getMoment(t.val());var n=m.isValid();if(t.hasClass("form-group-datetime"))t.find("input[type=date]").val(n?m.format("YYYY-MM-DD"):""),t.find("input[type=time]").val(n?m.format("HH:mm"):a);else if(n){var l="";switch(t.attr("type")){case"datetime-local":case"datetime":l=m.toISOString();break;case"date":l=m.format("YYYY-MM-DD");break;case"time":l=m.format("HH:mm");break;default:l=m.format("YYYY-MM-DD HH:mm")}t.val(l)}else t.val("");return m}var m=document.createElement("input");m.setAttribute("type","datetime-local"),m="text"!==m.type;var r={};return r.fromView=function(e,m){m=t.defaults(m||{},{fromId:"from",toId:"to",defaultTime:"00:00"});var r={from:null,to:null},i=a(e.$id(m.fromId),m.defaultTime),o=a(e.$id(m.toId),m.defaultTime);return i.isValid()&&(r.from=i.valueOf()),o.isValid()&&(r.to=o.valueOf()),r},r.toFormData=function(t,a,r){if("select"!==a.name&&"sort"!==a.name){var i="ge"===a.name?"from":"to",o=e.getMoment(a.args[1]);"date+time"===r?(t[i+"-date"]=o.format("YYYY-MM-DD"),t[i+"-time"]=o.format("HH:mm")):t[i]="datetime"===r?m?o.toISOString():o.format("YYYY-MM-DD HH:mm:ss"):"time"===r?o.format("HH:mm:ss"):o.format("YYYY-MM-DD")}},r});