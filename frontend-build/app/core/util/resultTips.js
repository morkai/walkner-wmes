define(["jquery","app/i18n","app/broker","app/viewport","./scrollbarSize","./html"],function(e,t,i,n,s,o){"use strict";var r={},d=0,a=0;function c(e){0!==d&&Object.keys(r).forEach(function(t){l(t,e)})}function l(t,i){var s=r[t];if(s){var o=e("#"+t);o.stop(!0,!1),i?o.remove():o.fadeOut("fast",function(){o.remove()}),clearTimeout(s.hideTimer),delete r[t],0===(d-=1)&&(window.removeEventListener("scroll",h),window.removeEventListener("resize",w),n.$dialog[0].removeEventListener("scroll",h))}}function p(t){if(t.text){a+=1,d+=1;var i=t.top||t.y||t.pageY||0,c=t.left||t.x||t.pageX||0,p=t.event||t.e,u=t.el||t.currenTarget||t.target,v={id:"resultTip"+a,className:["resultTip",t.type||"success"].concat(t.className||[]),style:t.style},f=o.tag("div",v,t.text||"???"),g=e(f);g.appendTo(document.body),p&&(i||(i=p.pageY),c||(c=p.pageX));var m=g[0].getBoundingClientRect();if(u&&(!i||!c)){var y=u.getBoundingClientRect();i||(i=y.top+y.height+5),c||(c=y.left,m.width>y.width?c-=(m.width-y.width)/2:c+=(y.width-m.width)/2)}i+m.height+s.height>=window.innerHeight&&(i=window.innerHeight-m.height-s.height-5),c+m.width+s.width>=window.innerWidth&&(c=window.innerWidth-m.width-s.width-5),g[0].style.display="none",g[0].style.top=i+"px",g[0].style.left=c+"px",!1===t.animate?g[0].style.display="":g.fadeIn("fast"),r[v.id]={id:v.id,hideTimer:setTimeout(l,t.time||1500,v.id,!1)},1===d&&(window.addEventListener("scroll",h,{passive:!0}),window.addEventListener("resize",w,{passive:!0}),n.$dialog[0].addEventListener("scroll",h,{passive:!0}))}}function h(){c(!0)}function w(){c(!0)}return i.subscribe("router.executing",function(){c(!0)}),{show:p,showCopied:function(e){p(Object.assign({type:"success",text:t("core","resultTips:copied"),time:1e3},e))}}});