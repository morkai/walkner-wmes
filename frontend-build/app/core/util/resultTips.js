define(["jquery","app/i18n","app/broker","app/viewport","./scrollbarSize","./html"],function(e,t,i,n,o,s){"use strict";var r={},d=0,c=0;function a(e){0!==d&&Object.keys(r).forEach(function(t){l(t,e)})}function l(t,i){var o=r[t];if(o){var s=e("#"+t);s.stop(!0,!1),i?s.remove():s.fadeOut("fast",function(){s.remove()}),clearTimeout(o.hideTimer),delete r[t],0===(d-=1)&&(window.removeEventListener("scroll",h),window.removeEventListener("resize",p),n.$dialog[0].removeEventListener("scroll",h))}}function f(t){if(t.text){c+=1,d+=1;var i=t.top||t.y||t.clientY||0,a=t.left||t.x||t.clientX||0,f=t.event||t.e,w=t.el||t.currentTarget||t.target,u={id:"resultTip"+c,className:["resultTip",t.type||"success"].concat(t.className||[]),style:t.style},v=s.tag("div",u,t.text||"???"),g=e(v);g.appendTo(document.body),f&&(i||(i=f.clientY),a||(a=f.clientX));var m=g[0].getBoundingClientRect();if(w&&(!i||!a)){var y=w.getBoundingClientRect();i||(i=y.top+y.height+5),a||(a=y.left,m.width>y.width?a-=(m.width-y.width)/2:a+=(y.width-m.width)/2)}t.offsetTop&&(i+=t.offsetTop),t.offsetLeft&&(a+=t.offsetLeft),i+m.height+o.height>=window.innerHeight&&(i=window.innerHeight-m.height-o.height-5),a+m.width+o.width>=window.innerWidth&&(a=window.innerWidth-m.width-o.width-5),g[0].style.display="none",g[0].style.top=i+"px",g[0].style.left=a+"px",!1===t.animate?g[0].style.display="":g.fadeIn("fast"),r[u.id]={id:u.id,hideTimer:setTimeout(l,t.time||1500,u.id,!1)},1===d&&(window.addEventListener("scroll",h,{passive:!0}),window.addEventListener("resize",p,{passive:!0}),n.$dialog[0].addEventListener("scroll",h,{passive:!0}))}}function h(){a(!0)}function p(){a(!0)}return i.subscribe("router.executing",function(){a(!0)}),{show:f,showCopied:function(e){f(Object.assign({type:"success",text:t("core","resultTips:copied"),time:1e3},e))}}});