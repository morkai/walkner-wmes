define(["require","jquery","app/i18n","app/viewport","app/data/localStorage","app/core/View","app/core/views/DialogView","app/core/templates/embedded/appsDialog","app/core/templates/embedded/confirmDialog","app/core/templates/embedded/uiLock","app/core/templates/embedded/actions"],function(e,t,o,n,a,i,s,p,d,r,c){"use strict";var w=window.IS_EMBEDDED||window.parent!==window||-1!==window.location.href.indexOf("_embedded=1"),l=null;return window.addEventListener("message",function(t){var o=t.data||{data:{}};switch(o.type){case"apps":n=o.data,clearTimeout(l),n&&Array.isArray(n.apps)&&0!==n.apps.length&&(1===n.apps.length?window.parent.postMessage({type:"switch",app:window.WMES_APP_ID},"*"):(a=n.apps,(s=e("app/viewport")).showDialog(new i({events:{"click [data-app]":function(e){s.closeAllDialogs(),window.parent.postMessage({type:"switch",app:window.WMES_APP_ID,newApp:e.currentTarget.dataset.app},"*")}},dialogClassName:"embedded-appsDialog",template:p,getTemplateData:function(){return{apps:a}}}))))}var n,a,s}),{actions:{switch:function(){window.parent.postMessage({type:"apps"},"*"),l&&clearTimeout(l),l=setTimeout(function(){window.parent.postMessage({type:"switch",app:window.WMES_APP_ID},"*")},250)},config:function(){window.parent.postMessage({type:"config"},"*")},refresh:function(){window.parent.postMessage({type:"refresh"},"*")},resetBrowser:function(){window.parent.postMessage({type:"resetBrowser"},"*")},restartBrowser:function(){window.parent.postMessage({type:"restartBrowser"},"*")},noKiosk:function(){window.parent.postMessage({type:"noKiosk"},"*")},reboot:function(){var t=new s({dialogClassName:"embedded-confirmDialog",template:d,model:{action:"reboot"}});t.once("answered",function(e){"yes"===e&&window.parent.postMessage({type:"reboot"},"*")}),e("app/viewport").showDialog(t,o("core","embedded:reboot:title"))},shutdown:function(){var t=new s({dialogClassName:"embedded-confirmDialog",template:d,model:{action:"shutdown"}});t.once("answered",function(e){"yes"===e&&window.parent.postMessage({type:"shutdown"},"*")}),e("app/viewport").showDialog(t,o("core","embedded:shutdown:title"))},lockUi:function(){var e=t(".embedded-uiLock");e.length||((e=t(r()).appendTo(document.body)).find("div").on("click",function(){a.removeItem("WMES_EMBEDDED_UI_LOCKED"),e.remove()}),e.on("touchstart",function(e){if(!t(e.target).closest(".embedded-uiLock-inner").length)return!1}),e.appendTo("body"),a.setItem("WMES_EMBEDDED_UI_LOCKED","1"))}},isEnabled:function(){return w},ready:function(e){w&&window.parent.postMessage({type:"ready",app:e||window.WMES_APP_ID},"*")},render:function(e,n){if(w){var i=0,s=null,p=Object.assign({},n&&n.actions);p.lockUi&&("object"!=typeof p.lockUi&&(p.lockUi={}),p.lockUi=Object.assign({icon:"fa-lock",handler:this.actions.lockUi,title:o("core","embedded:actions:lockUi")},p.lockUi),"1"===a.getItem("WMES_EMBEDDED_UI_LOCKED")&&(e.timers.lockUi=setTimeout(p.lockUi.handler,1)));var d=t(c({app:window.WMES_APP_ID,left:n&&!0===n.left,actions:p})),r=Object.assign({},this.actions,p);d.on("click","[data-action]",function(t){var o=r[t.currentTarget.dataset.action];o&&("function"==typeof o.handler?o.handler(e,o):"function"==typeof o&&o(e,o)),t.preventDefault()}),d.on("show.bs.dropdown",function(){i+=1,clearTimeout(s),s=setTimeout(function(){i=0},2e3),l(i<3)}),d.on("hidden.bs.dropdown",function(){l(!0)}),t(".embedded-actions").remove(),t(".modal.fade").removeClass("fade"),(n&&n.container||e.$el).append(d)}function l(e){d.find(".dev").toggleClass("hidden",e)}}}});