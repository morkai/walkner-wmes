define(["jquery","app/i18n","app/viewport","app/core/View","app/core/views/DialogView","app/core/templates/embedded/appsDialog","app/core/templates/embedded/confirmDialog","app/core/templates/embedded/actions"],function(e,t,a,o,n,p,i,s){"use strict";var d=null;return window.addEventListener("message",function(e){var t=e.data;switch(t.type){case"apps":n=t.data,clearTimeout(d),0!==n.apps.length&&(1===n.apps.length?window.parent.postMessage({type:"switch",app:window.WMES_APP_ID},"*"):(i=n.apps,a.showDialog(new o({events:{"click [data-app]":function(e){a.closeAllDialogs(),window.parent.postMessage({type:"switch",app:window.WMES_APP_ID,newApp:e.currentTarget.dataset.app},"*")}},dialogClassName:"embedded-appsDialog",template:p,getTemplateData:function(){return{apps:i}}}))))}var n,i}),{actions:{switch:function(){window.parent.postMessage({type:"apps"},"*"),d&&clearTimeout(d),d=setTimeout(function(){window.parent.postMessage({type:"switch",app:window.WMES_APP_ID},"*")},250)},config:function(){window.parent.postMessage({type:"config"},"*")},refresh:function(){window.parent.postMessage({type:"refresh"},"*")},reboot:function(){var e=new n({dialogClassName:"embedded-confirmDialog",template:i,model:{action:"reboot"}});e.once("answered",function(e){"yes"===e&&window.parent.postMessage({type:"reboot"},"*")}),a.showDialog(e,t("core","embedded:reboot:title"))},shutdown:function(){var e=new n({dialogClassName:"embedded-confirmDialog",template:i,model:{action:"shutdown"}});e.once("answered",function(e){"yes"===e&&window.parent.postMessage({type:"shutdown"},"*")}),a.showDialog(e,t("core","embedded:shutdown:title"))}},render:function(t,a){if(window.parent!==window){var o=this.actions,n=e(s({app:window.WMES_APP_ID,left:a&&!0===a.left}));n.on("click","[data-action]",function(e){var t=o[e.currentTarget.dataset.action];t&&t(),e.preventDefault()}),(a&&a.container||t.$el).append(n)}}}});