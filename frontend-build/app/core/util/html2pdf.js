// Part of <https://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

define(["jquery","app/i18n","app/viewport"],function(e,t,i){"use strict";return function(n,a){var o=i.msg.show({type:"info",text:'<i class="fa fa-spinner fa-spin"></i><span>'+t("core","html2pdf:progress")+"</span>"}),r=e.ajax({method:"POST",url:"/html2pdf",contentType:"text/plain",data:n});r.done(function(e){if(!a){var n=Math.min(window.screen.availWidth-200,1400);a={top:80,width:n,height:Math.min(window.screen.availHeight-160,800),left:window.screen.availWidth-n-80}}var r=[];Object.keys(a).forEach(function(e){r.push(e+"="+a[e])});var s=window.open("/html2pdf/"+e.hash+".pdf","_blank",r.join(","));s?(i.msg.hide(o),s.focus()):(i.msg.hide(o,!0),i.msg.show({type:"error",time:3e3,text:t("core","MSG:POPUP_BLOCKED")}))}),r.fail(function(){i.msg.hide(o,!0),i.msg.show({type:"error",time:2500,text:t("core","html2pdf:failure")})})}});