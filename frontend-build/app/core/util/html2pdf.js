// Part of <https://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

define(["jquery","app/i18n","app/viewport"],function(t,e,i){"use strict";function n(t,n,s){if(!n){var a=Math.min(window.screen.availWidth-200,1400);n={top:80,width:a,height:Math.min(window.screen.availHeight-160,800),left:window.screen.availWidth-a-80}}var r=[];Object.keys(n).forEach(function(t){r.push(t+"="+n[t])});var o=window.open("/html2pdf/"+s+".pdf","_blank",r.join(","));o?(i.msg.hide(t),o.focus()):(i.msg.hide(t,!0),i.msg.show({type:"error",time:3e3,text:e("core","MSG:POPUP_BLOCKED")}))}function s(n,s,a){i.msg.hide(n),n=i.msg.show({type:"info",text:'<i class="fa fa-spinner fa-spin"></i><span>'+e("core","html2pdf:printing")+"</span>"});var r=t.ajax({method:"POST",url:"/html2pdf;print",data:JSON.stringify({hash:a,printer:s})});r.done(function(){i.msg.hide(n,!0),i.msg.show({type:"success",time:2e3,text:e("core","html2pdf:printing:success")})}),r.fail(function(){i.msg.hide(n,!0),i.msg.show({type:"error",time:2500,text:e("core","html2pdf:printing:failure")})})}return function(a,r,o){"string"==typeof r&&(o=r,r=null);var p=i.msg.show({type:"info",text:'<i class="fa fa-spinner fa-spin"></i><span>'+e("core","html2pdf:progress")+"</span>"}),h=t.ajax({method:"POST",url:"/html2pdf",contentType:"text/plain",data:a});h.done(function(t){o?s(p,o,t.hash):n(p,r,t.hash)}),h.fail(function(){i.msg.hide(p,!0),i.msg.show({type:"error",time:2500,text:e("core","html2pdf:failure")})})}});