define(["underscore","app/i18n","app/data/localStorage"],function(e,r,a){"use strict";function n(e,a){return r.bound(r.has(e,a)?e:"core",a)}return function(r,t){var i=r.modelProperty?r[r.modelProperty]:r.model||r.collection,l=i.getNlsDomain();if(t=Array.isArray(t)?t.map(function(e){return"string"==typeof e?{label:":"===e[0]?n(l,"BREADCRUMB"+e):e}:("string"==typeof e.label&&":"===e.label[0]&&(e.label=n(l,"BREADCRUMB"+e.label)),e)}):[],!1!==r.browseBreadcrumb){var o=t.length?i.genClientUrl("base"):null;if(o){var s=window.location.origin+window.location.pathname+o,f=e.find(JSON.parse(a.getItem("WMES_RECENT_LOCATIONS")||"[]"),function(e){if(0!==e.href.indexOf(s))return!1;var r=e.href.charAt(s.length);return""===r||"?"===r});if(f){var u=f.href.split("?")[1];u&&(-1===o.indexOf("?")?o+="?"+u:o+="&"+u)}}t.unshift({label:n(l,e.result(r,"browseBreadcrumb")||"BREADCRUMB:browse"),href:o})}if(!0===r.baseBreadcrumb)t.unshift(n(l,"BREADCRUMB:base"));else if(r.baseBreadcrumb){var b=e.result(r,"baseBreadcrumb");Array.isArray(b)?t.unshift.apply(t,b):t.unshift({label:n(l,"BREADCRUMB:base"),href:String(b)})}return t}});