define(["underscore","jquery","app/i18n","../util/bindLoadingMessage","../util/pageActions","../View","../views/ListView","./createPageBreadcrumbs","app/core/templates/listPage"],function(i,e,t,s,o,n,l,r,a){"use strict";return n.extend({template:a,layoutName:"page",baseBreadcrumb:!1,breadcrumbs:function(){return r(this)},actions:function(){return[o.add(this.getDefaultModel())]},initialize:function(){this.defineModels(),this.defineViews(),this.setView(".filter-container",this.filterView),this.setView(".list-container",this.listView)},defineModels:function(){this[this.collection?"collection":"model"]=s(this.getDefaultModel(),this)},defineViews:function(){this.listView=this.createListView(),this.filterView=this.createFilterView(),this.listenTo(this.filterView,"filterChanged",this.onFilterChanged),this.listenTo(this.listView,"showFilter",this.onShowFilter)},createListView:function(){return new(this.getListViewClass())(this.getListViewOptions())},getListViewClass:function(){return this.ListView||this.options.ListView||l},getListViewOptions:function(){var e=this.getListViewClass();return{collection:this.collection,model:this.collection?void 0:this.getDefaultModel(),columns:this.options.columns||this.columns||e.prototype.columns,serializeRow:this.options.serializeRow||this.serializeRow||e.prototype.serializeRow,serializeActions:this.options.serializeActions||this.serializeActions||e.prototype.serializeActions,className:i.find([this.options.listClassName,this.listClassName,e.prototype.className,"is-clickable"],function(i){return void 0!==i})}},createFilterView:function(){return new(this.getFilterViewClass())(this.getFilterViewOptions())},getFilterViewClass:function(){return this.FilterView||this.options.FilterView},getFilterViewOptions:function(){return{model:this.getDefaultModel()}},load:function(i){return i(this.getDefaultModel().fetch({reset:!0}))},onFilterChanged:function(i){this.getDefaultModel().rqlQuery=i,this.refreshCollection()},onShowFilter:function(i){if("rid"===i){var t=e(".page-actions-jump .form-control");if(t.length)return void t.focus()}this.filterView.showFilter(i)},refreshCollection:function(){this.listView.refreshCollectionNow(),this.updateClientUrl()},updateClientUrl:function(){var i=this.getDefaultModel();this.broker.publish("router.navigate",{url:i.genClientUrl()+"?"+i.rqlQuery,trigger:!1,replace:!0})}})});