// Part of <http://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

define(["app/i18n","../util/bindLoadingMessage","../util/pageActions","../View","../views/ListView","./createPageBreadcrumbs","app/core/templates/listPage"],function(e,i,t,l,n,s,o){"use strict";return l.extend({template:o,layoutName:"page",baseBreadcrumb:!1,breadcrumbs:function(){return s(this)},actions:function(){return[t.add(this.collection||this.model)]},initialize:function(){this.defineModels(),this.defineViews(),this.setView(".filter-container",this.filterView),this.setView(".list-container",this.listView)},defineModels:function(){this[this.collection?"collection":"model"]=i(this.collection||this.model,this)},defineViews:function(){this.listView=this.createListView(),this.filterView=this.createFilterView(),this.listenTo(this.filterView,"filterChanged",this.onFilterChanged)},createListView:function(){var e=this.ListView||this.options.ListView||n;return new e({collection:this.collection,model:this.model})},createFilterView:function(){var e=this.FilterView||this.options.FilterView;return new e({model:{rqlQuery:(this.collection||this.model).rqlQuery}})},load:function(e){return e((this.collection||this.model).fetch({reset:!0}))},onFilterChanged:function(e){(this.collection||this.model).rqlQuery=e,this.refreshCollection()},refreshCollection:function(){this.listView.refreshCollectionNow(),this.updateClientUrl()},updateClientUrl:function(){var e=this.collection||this.model;this.broker.publish("router.navigate",{url:e.genClientUrl()+"?"+e.rqlQuery,trigger:!1,replace:!0})}})});