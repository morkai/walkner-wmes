// Copyright (c) 2014, ≈Åukasz Walukiewicz <lukasz@walukiewicz.eu>. Some Rights Reserved.
// Licensed under CC BY-NC-SA 4.0 <http://creativecommons.org/licenses/by-nc-sa/4.0/>.
// Part of the walkner-wmes project <http://lukasz.walukiewicz.eu/p/walkner-wmes>

define(["app/i18n","../util/bindLoadingMessage","../util/pageActions","../View","../views/ListView","app/core/templates/listPage"],function(i,e,t,l,o,n){return l.extend({template:n,layoutName:"page",breadcrumbs:function(){return[i.bound((this.collection||this.model).getNlsDomain(),"BREADCRUMBS:browse")]},actions:function(){return[t.add(this.collection||this.model)]},initialize:function(){this.defineModels(),this.defineViews(),this.setView(".filter-container",this.filterView),this.setView(".list-container",this.listView)},defineModels:function(){this[this.collection?"collection":"model"]=e(this.collection||this.model,this)},defineViews:function(){this.listView=this.createListView(),this.filterView=this.createFilterView(),this.listenTo(this.filterView,"filterChanged",this.onFilterChanged)},createListView:function(){return new(this.ListView||this.options.ListView||o)({collection:this.collection,model:this.model})},createFilterView:function(){return new(this.FilterView||this.options.FilterView)({model:{rqlQuery:(this.collection||this.model).rqlQuery}})},load:function(i){return i((this.collection||this.model).fetch({reset:!0}))},onFilterChanged:function(i){(this.collection||this.model).rqlQuery=i,this.refreshCollection()},refreshCollection:function(){this.listView.refreshCollectionNow(),this.broker.publish("router.navigate",{url:(this.collection||this.model).genClientUrl()+"?"+(this.collection||this.model).rqlQuery,trigger:!1,replace:!0})}})});