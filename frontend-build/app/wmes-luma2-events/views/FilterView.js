define(["underscore","app/core/views/FilterView","app/core/util/forms/dateTimeRange","../dictionaries","app/wmes-luma2-events/templates/filter","app/core/util/ExpandableSelect"],function(e,t,i,n,a){"use strict";return t.extend({template:a,events:e.assign({"click a[data-date-time-range]":i.handleRangeEvent},t.prototype.events),termToForm:{time:i.rqlToForm,order:function(e,t,i){i[e]=t.args[1]},type:function(e,t,i){i[e]="in"===t.name?t.args[1]:[t.args[1]]},line:"type",station:"order",program:"order"},initialize:function(){t.prototype.initialize.apply(this,arguments),this.listenTo(n.lines,"add remove change",this.updateLines)},serialize:function(){return e.assign(t.prototype.serialize.call(this),{types:n.types,lines:n.lines.pluck("_id")})},serializeFormToQuery:function(t){var n=this;i.formToRql(n,t),["type","line"].forEach(function(i){var a=(n.$id(i).val()||[]).filter(function(t){return!e.isEmpty(t)});a.length&&t.push({name:"in",args:[i,a]})}),["order","station","program"].forEach(function(e){var i=n.$id(e).val().trim();i.length&&t.push({name:"eq",args:[e,i]})})},afterRender:function(){t.prototype.afterRender.call(this),this.$(".is-expandable").expandableSelect()},destroy:function(){t.prototype.destroy.call(this),this.$(".is-expandable").expandableSelect("destroy")},updateLines:function(){var t=this.$id("line"),i=t.val()||[],a="";n.lines.forEach(function(t){a+="<option "+(e.includes(i,t.id)?"selected":"")+">"+e.escape(t.id)}),t.html(a)}})});