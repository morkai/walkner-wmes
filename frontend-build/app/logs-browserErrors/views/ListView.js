define(["underscore","app/viewport","app/core/views/ListView","app/logs-browserErrors/templates/details"],function(e,i,s,t){"use strict";return s.extend({remoteTopics:{"logs.browserErrors.saved":function(e){this.isAnyExpanded()?this.collection.add(e.errors):this.refreshCollection()},"logs.browserErrors.resolved":function(e){var i=this;e.errors.forEach(function(e){var s=i.collection.get(e);s&&i.collection.remove(s)}),this.refreshCollection()}},events:{"click .list-item":function(e){this.toggle(e.currentTarget.dataset.id)},"click .btn-success":function(e){var s=this.$(e.currentTarget).prop("disabled",!0),t=s.closest("tr").prev().attr("data-id");i.msg.saving();var r=this.ajax({method:"POST",url:"/logs/browserErrors/"+t+";resolve"});r.fail(function(){i.msg.savingFailed(),s.prop("disabled",!1)}),r.done(function(){i.msg.saved()})}},columns:[{id:"time",className:"is-min"},{id:"user",className:"is-min"},{id:"appId",className:"is-min"},{id:"location",className:"is-min"},{id:"source",className:"is-min"},{id:"error"}],initialize:function(){s.prototype.initialize.apply(this,arguments),this.listenTo(this.collection,"add remove",e.debounce(this.render.bind(this),1))},serializeActions:function(){return null},afterRender:function(){var e=this;s.prototype.afterRender.apply(e,arguments),Object.keys(e.collection.expanded).forEach(function(i){e.toggle(i)})},isAnyExpanded:function(){return this.$(".is-expanded").length>0},toggle:function(e){var i=this.$('.list-item[data-id="'+e+'"]');i.length&&(i.hasClass("is-expanded")?this.collapse(e,i):this.expand(e,i))},expand:function(e,i){this.collection.expanded[e]=!0,this.renderPartial(t,{error:this.collection.get(e).serializeDetails()}).insertAfter(i),i.addClass("is-expanded")},collapse:function(e,i){delete this.collection.expanded[e],i.removeClass("is-expanded"),i.next().remove()}})});