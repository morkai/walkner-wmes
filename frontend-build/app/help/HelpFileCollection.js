define(["../core/Collection","./HelpFile"],function(e,t){"use strict";return e.extend({model:t,rqlQuery:"limit(0)",comparator:function(e,t){return e.get("name").localeCompare(t.get("name"),void 0,{ignorePunctuation:!0,numeric:!0})},initialize:function(e,t){this.settings=t&&t.settings||null,this.settings&&(this.state={selected:t&&t.selectedFileId||null,expanded:{}},this.rebuildTree(),this.on("reset",this.rebuildTree),this.listenTo(this.settings,"change",this.onSettingsChange))},onSettingsChange:function(e){/rootFileId/.test(e.id)&&this.rebuildTree()},rebuildTree:function(){var e=this;e.root=e.get(e.settings.getValue("rootFileId"))||null,e.root&&(e.forEach(function(e){e.parents=[],e.children=[]}),e.forEach(function(t){t.get("parents").forEach(function(i){var n=e.get(i);n&&(n.children.push(t),t.parents.push(n))})}))},serializeTree:function(){return this.root?this.serializeNode(this.root).children:[]},serializeNode:function(e){return{_id:e.id,children:e.children.map(this.serializeNode,this),name:e.get("name"),description:e.get("description"),kind:e.get("kind"),selected:this.state.selected===e.id,expanded:this.state.expanded[e.id]}},select:function(e){var t=this.state.selected;e!==t&&(this.state.selected=e,this.trigger("selected",e,t))},toggle:function(e,t){var i=this.state.expanded[e]||!1;"boolean"!=typeof t&&(t=!i),t!==i&&(this.state.expanded[e]=t,this.trigger("expanded",e,t))}})});