// Part of <http://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

define(["underscore","../core/Model","../production/util/orderPickerHelpers","../orderStatuses/util/renderOrderStatusLabel"],function(t,e,i,n){"use strict";return e.extend({serializeListItem:function(){return{_id:this.id,completed:this.isCompleted(),confirmed:this.isConfirmed(),delivered:this.isDelivered(),invalid:!this.isValid()}},serializePopover:function(){return t.assign(this.toJSON(),{plan:this.collection.plan.id,completed:this.isCompleted(),statuses:(this.get("statuses")||[]).map(n)})},isValid:function(){return this.isValidOperation()},isValidOperation:function(){var t=this.get("operation");return t&&t.laborTime>0},isCompleted:function(){return this.get("qtyDone")>=this.get("qtyTodo")},isConfirmed:function(){return this.hasStatus("CNF")},isDelivered:function(){return this.hasStatus("DLV")},hasStatus:function(e){return t.includes(this.get("statuses"),e)},getPceTime:function(t){var e=this.get("operation");return e&&e.laborTime&&t?Math.floor(e.laborTime/t/100*3600*1e3):0},setOperation:function(t){this.collection.plan.collection.update("updateOrder",this.collection.plan.id,{_id:this.id,operation:this.constructor.prepareOperation(t)})}},{prepareOperation:function(e){return e?t.pick(e,["no","workCenter","name","qty","machineTime","laborTime"]):null},prepareFromSapOrder:function(t){return{_id:t._id,nc12:t.nc12||"",name:t.description||t.name||"",qtyTodo:t.qty||0,qtyDone:t.qtyDone&&t.qtyDone.total?t.qtyDone.total:0,statuses:t.statuses||[],operation:this.prepareOperation(i.getBestDefaultOperation(t.operations))}},prepareFromMrpOrder:function(t){return{_id:t._id,nc12:t.nc12||"",name:t.name||"",qtyTodo:t.qty||0,qtyDone:0,statuses:[],operation:null}},ORDER_PROPERTIES:["_id","nc12","name","description","qty","qtyDone.total","statuses","operations"]})});