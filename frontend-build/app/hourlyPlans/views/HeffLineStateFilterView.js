// Part of <http://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

define(["underscore","app/user","app/data/orgUnits","app/core/util/idAndLabel","app/core/views/FilterView","app/hourlyPlans/templates/heffLineStateFilter"],function(e,t,i,o,a,r){"use strict";return a.extend({template:r,events:e.assign({"change #-division":"updateProdFlows"},a.prototype.events),defaultFormData:{division:"",prodFlows:[]},termToForm:{division:function(e,t,i){i[e]=t.args[1]}},afterRender:function(){a.prototype.afterRender.call(this),this.$id("division").select2({width:"150px",allowClear:!0,placeholder:" ",data:i.getAllByType("division").filter(function(e){return!e.get("deactivatedAt")&&"prod"===e.get("type")}).map(o)}),this.updateProdFlows()},serializeFormToQuery:function(e){var t=this.$id("division").val(),i=this.$id("prodFlows").val();t.length&&e.push({name:"eq",args:["division",t]}),i.length&&e.push({name:"in",args:["prodFlows",i.split(",")]})},updateProdFlows:function(){var e=this.$id("division").val(),t=[];i.getAllByType("subdivision").forEach(function(a){if(!("assembly"!==a.get("type")||e&&a.get("division")!==e)){var r=i.getProdFlowsForSubdivision(a).filter(function(e){return!e.get("deactivatedAt")}).map(o);t=t.concat(r)}}),this.$id("prodFlows").select2("data",null).select2({width:"800px",allowClear:!0,placeholder:" ",multiple:!0,data:t})}})});