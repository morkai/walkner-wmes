// Part of <http://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

define(["../broker","../router","../viewport","../user","../time","../core/util/showDeleteFormPage","./HourlyPlan","./HourlyPlanCollection"],function(a,l,n,e,r,o,t,i){"use strict";var u="i18n!app/nls/hourlyPlans",s=e.auth("HOURLY_PLANS:VIEW"),p=e.auth("HOURLY_PLANS:MANAGE","PROD_DATA:MANAGE");l.map("/hourlyPlans",s,function(a){n.loadPage(["app/hourlyPlans/HourlyPlanCollection","app/hourlyPlans/pages/HourlyPlanListPage","i18n!app/nls/fte",u],function(l,n){return new n({collection:new l(null,{rqlQuery:a.rql})})})}),l.map("/hourlyPlans;heff",p,function(a){n.loadPage(["app/hourlyPlans/HeffLineStateCollection","app/hourlyPlans/pages/HeffLineStatePage",u],function(l,n){return new n({collection:new l(null,{rqlQuery:a.rql})})})}),l.map("/hourlyPlans;add",p,function(){n.loadPage(["app/hourlyPlans/pages/HourlyPlanAddFormPage",u],function(a){return new a})}),l.map("/hourlyPlans/:date/:division",s,function(l){function n(){a.publish("router.navigate",{url:"/hourlyPlans?sort(-date)&limit(20)&date>="+l.params.date+"&date<"+r.getMoment(+l.params.date).add(1,"days").valueOf()+"&division="+l.params.division,trigger:!0,replace:!0})}var e=new i(null,{rqlQuery:"select(_id)&date="+l.params.date+"&division="+l.params.division});e.on("error",n),e.on("sync",function(){1===e.length?a.publish("router.navigate",{url:"/hourlyPlans/"+e.models[0].id,trigger:!0,replace:!0}):n()}),e.fetch({reset:!0})}),l.map("/hourlyPlans/:id",s,function(a){n.loadPage(["app/hourlyPlans/pages/HourlyPlanDetailsPage",u],function(l){return new l({modelId:a.params.id})})}),l.map("/hourlyPlans/:id;edit",p,function(a){n.loadPage(["app/hourlyPlans/pages/HourlyPlanEditFormPage",u],function(l){return new l({modelId:a.params.id})})}),l.map("/hourlyPlans/:id;print",s,function(a){n.loadPage(["app/hourlyPlans/pages/HourlyPlanDetailsPrintablePage",u],function(l){return new l({modelId:a.params.id})})}),l.map("/hourlyPlans/:id;delete",p,o.bind(null,t))});