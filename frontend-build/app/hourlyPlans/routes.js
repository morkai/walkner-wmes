// Part of <https://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

define(["../broker","../router","../viewport","../user","../time","../core/util/showDeleteFormPage","../core/util/getRelativeDateRange","../core/util/fixRelativeDateInRql","./HourlyPlan","./HourlyPlanCollection"],function(a,e,n,l,r,o,t,i,u,s){"use strict";var p="i18n!app/nls/hourlyPlans",d=l.auth("HOURLY_PLANS:VIEW"),P=l.auth("HOURLY_PLANS:MANAGE","PROD_DATA:MANAGE");e.map("/hourlyPlans",d,function(a){n.loadPage(["app/hourlyPlans/HourlyPlanCollection","app/hourlyPlans/pages/HourlyPlanListPage","i18n!app/nls/fte",p],function(e,n){return new n({collection:new e(null,{rqlQuery:i(a.rql,{property:"date",range:!0,shift:!0})})})})}),e.map("/hourlyPlans;heff",P,function(a){n.loadPage(["app/hourlyPlans/HeffLineStateCollection","app/hourlyPlans/pages/HeffLineStatePage",p],function(e,n){return new n({collection:new e(null,{rqlQuery:a.rql})})})}),e.map("/hourlyPlans;settings",l.auth("PROD_DATA:MANAGE"),function(a){n.loadPage(["app/hourlyPlans/pages/PlanningSettingsPage",p],function(e){return new e({initialTab:a.query.tab})})}),e.map("/hourlyPlans;add",P,function(a){n.loadPage(["app/hourlyPlans/pages/HourlyPlanAddFormPage",p],function(e){var n=t(a.query.date);return new e({model:new u({date:n?n.from.setHours(6):null})})})}),e.map("/hourlyPlans/:date/:division",d,function(e){function n(){a.publish("router.navigate",{url:"/hourlyPlans?sort(-date)&limit(20)&date>="+l+"&date<"+r.getMoment(/^[0-9]+$/.test(l)?+l:l).add(1,"days").valueOf()+"&division="+e.params.division,trigger:!0,replace:!0})}var l=e.params.date,o=new s(null,{rqlQuery:"select(_id)&date="+l+"&division="+e.params.division});o.on("error",n),o.on("sync",function(){1===o.length?a.publish("router.navigate",{url:"/hourlyPlans/"+o.models[0].id,trigger:!0,replace:!0}):n()}),o.fetch({reset:!0})}),e.map("/hourlyPlans/:id",d,function(a){n.loadPage(["app/hourlyPlans/pages/HourlyPlanDetailsPage",p],function(e){return new e({modelId:a.params.id})})}),e.map("/hourlyPlans/:id;edit",P,function(a){n.loadPage(["app/hourlyPlans/pages/HourlyPlanEditFormPage",p],function(e){return new e({modelId:a.params.id})})}),e.map("/hourlyPlans/:id;print",d,function(a){n.loadPage(["app/hourlyPlans/pages/HourlyPlanDetailsPrintablePage",p],function(e){return new e({modelId:a.params.id})})}),e.map("/hourlyPlans/:id;delete",P,o.bind(null,u))});