// Part of <http://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

define(["../core/Collection","./util/shift","./DailyMrpPlanLineOrder"],function(e,t,i){"use strict";return e.extend({model:i,initialize:function(e,t){this.line=t.line},serializeShifts:function(){for(var e={1:[],2:[],3:[]},i=0;i<this.length;++i){var n=this.models[i],r=e[n.shiftNo],o=r[r.length-1],l=o?o.lineOrder.finishMoment.valueOf():t.getShiftStartTime(n.startMoment.valueOf());r.push({_id:n.id,orderNo:n.get("orderNo"),qty:n.get("qty"),margin:100*(n.startMoment.valueOf()-l)/t.SHIFT_DURATION,width:100*n.duration/t.SHIFT_DURATION,incomplete:n.get("incomplete"),lineOrder:n})}var s=[];return e[1].length&&s.push({no:1,orders:e[1]}),e[2].length&&s.push({no:2,orders:e[2]}),e[3].length&&s.push({no:3,orders:e[3]}),s}})});