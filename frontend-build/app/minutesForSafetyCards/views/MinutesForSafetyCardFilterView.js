define(["underscore","app/time","app/core/views/FilterView","app/core/util/forms/dateTimeRange","app/users/util/setUpUserSelect2","app/kaizenOrders/dictionaries","app/minutesForSafetyCards/templates/filter","app/core/util/ExpandableSelect"],function(e,t,r,n,s,i,a){"use strict";return r.extend({template:a,events:e.assign({"click a[data-date-time-range]":n.handleRangeEvent,'change input[name="userType"]':"toggleUserSelect2","keyup select":function(e){if(27===e.keyCode)return e.target.selectedIndex=-1,!1},"dblclick select":function(e){e.target.selectedIndex=-1}},r.prototype.events),defaultFormData:function(){return{section:[],userType:"others",user:null}},termToForm:{date:n.rqlToForm,"owner.id":function(e,t,r){r.userType="owner",r.user=t.args[1]},"confirmer.id":function(e,t,r){r.userType="confirmer",r.user=t.args[1]},users:function(e,t,r){"mine"===t.args[1]?(r.userType="mine",r.user=null):(r.userType="others",r.user=t.args[1])},section:function(e,t,r){r[e]="in"===t.name?t.args[1]:[t.args[1]]}},getTemplateData:function(){return{sections:i.sections.toJSON()}},serializeFormToQuery:function(t){var r=this.$('input[name="userType"]:checked').val(),s=this.$id("user").val();n.formToRql(this,t),"owner"===r||"confirmer"===r?t.push({name:"eq",args:[r+".id",s]}):"mine"===r?t.push({name:"eq",args:["users","mine"]}):s&&t.push({name:"eq",args:["users",s]}),["section"].forEach(function(r){var n=(this.$id(r).val()||[]).filter(function(t){return!e.isEmpty(t)});1===n.length?t.push({name:"eq",args:[r,n[0]]}):n.length&&t.push({name:"in",args:[r,n]})},this)},afterRender:function(){r.prototype.afterRender.call(this),this.$(".is-expandable").expandableSelect(),s(this.$id("user"),{width:"100%",view:this}),this.toggleUserSelect2()},destroy:function(){r.prototype.destroy.call(this),this.$(".is-expandable").expandableSelect("destroy")},toggleUserSelect2:function(){var e=this.$('input[name="userType"]:checked').val();this.$id("user").select2("enable","mine"!==e)}})});