// Part of <https://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

define(["underscore","../time","../user","../core/Model","app/kaizenOrders/dictionaries","app/core/templates/userInfo"],function(e,t,r,i,n,a){"use strict";var o=["date"],s=["createdAt","updatedAt"],u=["creator","updater","owner"];return i.extend({urlRoot:"/minutesForSafetyCards",clientUrlRoot:"#minutesForSafetyCards",topicPrefix:"minutesForSafetyCards",privilegePrefix:"KAIZEN",nlsDomain:"minutesForSafetyCards",labelAttribute:"rid",defaults:function(){return{date:new Date,owner:r.getInfo()}},serialize:function(e){var r=e&&e.longDateTime,i=r?"LL":"L",c=r?"LLLL":"L, LTS",f=this.toJSON();return f.section=n.sections.getLabel(f.section),o.forEach(function(e){f[e]=f[e]?t.format(f[e],i):null}),s.forEach(function(e){f[e]=f[e]?t.format(f[e],c):null}),u.forEach(function(e){f[e]=a({userInfo:f[e]})}),f},serializeRow:function(e){return this.serialize(e)},serializeDetails:function(){return this.serialize({longDateTime:!0})},isCreator:function(){return this.attributes.creator&&this.attributes.creator.id===r.data._id},isOwner:function(){return this.attributes.owner&&this.attributes.owner.id===r.data._id},canEdit:function(){return r.isAllowedTo(this.privilegePrefix+":MANAGE")||this.isCreator()||this.isOwner()},canDelete:function(){return!!r.isAllowedTo(this.privilegePrefix+":MANAGE")||!(!this.isCreator()&&!this.isOwner())&&Date.now()-Date.parse(this.get("date"))<864e5}})});