// Part of <https://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

define(["underscore","../i18n","../time","../user","../core/Model","app/kaizenOrders/dictionaries","app/core/templates/userInfo"],function(t,e,i,r,s,n,a){"use strict";var o=["date"],u=["createdAt","updatedAt"],c=["creator","updater","owner"];return s.extend({urlRoot:"/minutesForSafetyCards",clientUrlRoot:"#minutesForSafetyCards",topicPrefix:"minutesForSafetyCards",privilegePrefix:"KAIZEN",nlsDomain:"minutesForSafetyCards",labelAttribute:"rid",defaults:function(){return{status:"new",date:new Date,owner:r.getInfo()}},serialize:function(t){var r=t&&t.longDateTime,s=r?"LL":"L",l=r?"LLLL":"L, LTS",f=this.toJSON();return f.status=e(this.nlsDomain,"status:"+f.status),f.section=n.sections.getLabel(f.section),o.forEach(function(t){f[t]=f[t]?i.format(f[t],s):null}),u.forEach(function(t){f[t]=f[t]?i.format(f[t],l):null}),c.forEach(function(t){f[t]=a({userInfo:f[t]})}),f},serializeRow:function(t){return this.serialize(t)},serializeDetails:function(){return this.serialize({longDateTime:!0})},isCreator:function(){return this.attributes.creator&&this.attributes.creator.id===r.data._id},isOwner:function(){return this.attributes.owner&&this.attributes.owner.id===r.data._id},canEdit:function(){if(r.isAllowedTo(this.privilegePrefix+":MANAGE"))return!0;var t=this.attributes;return"finished"!==t.status&&"cancelled"!==t.status&&(this.isCreator()||this.isOwner())},canDelete:function(){return!!r.isAllowedTo(this.privilegePrefix+":MANAGE")||"new"===this.get("status")&&(this.isCreator()||this.isOwner())}})});