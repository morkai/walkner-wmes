define(["underscore","jquery","app/i18n","app/time","app/viewport","app/core/View","app/wmes-drilling/templates/list"],function(i,t,e,s,l,n,r){"use strict";return n.extend({template:r,events:{"mousedown .drilling-list-item":function(i){this.lastClickEvent=i},"mouseup .drilling-list-item":function(i){var t=this.lastClickEvent;t&&0===i.button&&((window.parent===window||t.offsetY===i.offsetY&&t.offsetX===i.offsetX&&t.screenX===i.screenX&&t.screenY===i.screenY)&&this.handleItemClick(i.currentTarget.dataset.orderId),this.lastClickEvent=null)}},initialize:function(){this.onScroll=i.debounce(this.onScroll.bind(this),100,!1),this.lastClickEvent=null,this.lastVisibleItem=null,this.listenTo(this.model,"reset",i.after(2,this.render)),this.listenTo(this.model,"change",this.onChange),this.listenTo(this.model,"mrpSelected",this.toggleVisibility)},serialize:function(){return{idPrefix:this.idPrefix,showTimes:this.options.showTimes,isVisible:this.model.isVisible.bind(this.model),orders:this.serializeOrders()}},serializeOrders:function(){var i=this.options.filter,t=this.options.sort,e=this.model.serialize();return i&&(e=e.filter(i)),t&&(e=e.sort(t)),e},afterRender:function(){var i=this.$item(this.lastVisibleItem);i.length&&(this.el.parentNode.scrollTop=i[0].offsetTop)},$item:function(i){return this.$('.drilling-list-item[data-order-id="'+i+'"]')},handleItemClick:function(i){i&&this.model.trigger("focus",i)},onScroll:function(){var i=this.$(".visible");if(i.length){var t=this.el.parentNode;if(t){this.lastVisibleItem=i[0].dataset.orderId;for(var e=t.scrollTop,s=0;s<i.length;++s){var l=i[s];if(l.offsetTop>e)break;this.lastVisibleItem=l.dataset.orderId,e>l.offsetTop+25&&i[s+1]&&(this.lastVisibleItem=i[s+1].dataset.orderId)}}}},onChange:function(i){var t=this.options.filter,e=this.options.sort,s=this.$item(i.id);t||e?!s.length||t(i.serialize())?this.render():s.remove():s.attr("data-status",i.get("status"))},toggleVisibility:function(){var i=this.model;this.$(".drilling-list-item").each(function(){if(this.nextElementSibling){var t=i.get(this.dataset.orderId),e=!t||!i.isVisible(t.serialize());this.classList.toggle("hidden",e),this.classList.toggle("visible",!e)}})}})});