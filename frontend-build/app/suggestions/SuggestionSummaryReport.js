// Copyright (c) 2014, ≈Åukasz Walukiewicz <lukasz@walukiewicz.eu>. Some Rights Reserved.
// Licensed under CC BY-NC-SA 4.0 <http://creativecommons.org/licenses/by-nc-sa/4.0/>.
// Part of the walkner-wmes project <http://lukasz.walukiewicz.eu/p/walkner-wmes>

define(["underscore","../i18n","../time","../core/Model"],function(e,t,n,o){"use strict";return o.extend({urlRoot:"/suggestions/reports/summary",defaults:function(){return{from:0,to:0,section:[],confirmer:[],interval:"week"}},fetch:function(t){return e.isObject(t)||(t={}),t.data=e.extend(t.data||{},e.pick(this.attributes,["from","to","section","confirmer"])),t.data.section=t.data.section.join(","),t.data.confirmer=t.data.confirmer.join(","),o.prototype.fetch.call(this,t)},genClientUrl:function(){return"/suggestionSummaryReport?from="+this.get("from")+"&to="+this.get("to")+"&section="+this.get("section")+"&confirmer="+this.get("confirmer")},parse:function(t){var n={total:{averageDuration:t.averageDuration,count:t.count},averageDuration:[],count:{open:[],finished:[],cancelled:[]},suggestionOwners:{categories:[],open:[],finished:[],cancelled:[]}},o=n.averageDuration,r=n.count,i=n.suggestionOwners;return e.forEach(t.suggestionOwners,function(e){i.categories.push(t.users[e[0]]),i.open.push(e[2]),i.finished.push(e[3]),i.cancelled.push(e[4])}),e.forEach(t.groups,function(e){"number"==typeof e?(o.push({x:e,y:0}),r.open.push({x:e,y:0}),r.finished.push({x:e,y:0}),r.cancelled.push({x:e,y:0})):(o.push({x:e.key,y:e.averageDuration,color:e.averageDuration>5?"#d9534f":"#5cb85c"}),r.open.push({x:e.key,y:e.count.open}),r.finished.push({x:e.key,y:e.count.finished}),r.cancelled.push({x:e.key,y:e.count.cancelled}))}),n}},{fromQuery:function(t){return new this({from:+t.from||void 0,to:+t.to||void 0,section:e.isEmpty(t.section)?[]:t.section.split(","),confirmer:e.isEmpty(t.confirmer)?[]:t.confirmer.split(",")})}})});