define(["underscore","../router","../viewport","../user","../core/util/showDeleteFormPage"],function(e,n,o,s,t){"use strict";var a="css!app/suggestions/assets/main",g="i18n!app/nls/suggestions",u=s.auth(),i=s.auth("LOCAL","USER");n.map("/suggestions/reports/count",u,function(e){o.loadPage(["app/suggestions/SuggestionCountReport","app/suggestions/pages/SuggestionCountReportPage",a,"i18n!app/nls/reports",g],function(n,o){return new o({model:n.fromQuery(e.query)})})}),n.map("/suggestions/reports/summary",u,function(e){o.loadPage(["app/suggestions/SuggestionSummaryReport","app/suggestions/pages/SuggestionSummaryReportPage",a,"i18n!app/nls/reports",g],function(n,o){return new o({model:n.fromQuery(e.query)})})}),n.map("/suggestions/reports/engagement",u,function(e){o.loadPage(["app/suggestions/EngagementReport","app/suggestions/pages/EngagementReportPage",a,"i18n!app/nls/reports",g],function(n,o){return new o({model:n.fromQuery(e.query)})})}),n.map("/suggestions/reports/reward",u,function(e){o.loadPage(["app/suggestions/RewardReport","app/suggestions/pages/RewardReportPage",a,"i18n!app/nls/reports",g],function(n,o){return new o({model:n.fromQuery(e.query)})})}),n.map("/suggestionHelp",function(){o.loadPage(["app/core/View","app/suggestions/templates/help",a,g],function(e,n){return new e({layoutName:"page",template:n})})}),n.map("/suggestions",i,function(e){o.loadPage(["app/suggestions/SuggestionCollection","app/suggestions/pages/SuggestionListPage",a,g],function(n,o){return new o({collection:new n(null,{rqlQuery:e.rql})})})}),n.map("/suggestions/:id",i,function(e){o.loadPage(["app/suggestions/Suggestion","app/suggestions/pages/SuggestionDetailsPage","app/suggestions/views/SuggestionThankYouView",a,g],function(n,s,t){var a=new s({model:new n({_id:e.params.id}),standalone:!!e.query.standalone});return"you"===e.query.thank&&a.once("afterRender",function(){a.broker.publish("router.navigate",{url:"/suggestions/"+a.model.id,trigger:!1,replace:!0}),o.showDialog(new t({model:a.model}))}),a})}),n.map("/suggestions;add",i,function(e){o.loadPage(["app/suggestions/Suggestion","app/suggestions/pages/SuggestionAddFormPage",a,g],function(n,o){var s=null;try{s=JSON.parse(decodeURIComponent(atob(e.query.operator)))}catch(e){}var t=!!e.query.standalone,a="WMES_STANDALONE_CLOSE_TIMER";return t&&void 0===window[a]&&(clearTimeout(window[a]),window.onblur=function(){clearTimeout(window[a]),window[a]=setTimeout(function(){window.close()},6e4)},window.onfocus=function(){clearTimeout(window[a])}),new o({model:new n,standalone:t,operator:s})})}),n.map("/suggestions/:id;edit",u,function(e){o.loadPage(["app/suggestions/Suggestion","app/suggestions/pages/SuggestionEditFormPage",a,g],function(n,o){return new o({model:new n({_id:e.params.id}),standalone:!!e.query.standalone})})}),n.map("/suggestions/:id;delete",u,e.partial(t,"app/suggestions/Suggestion",e,e,{baseBreadcrumb:!0}))});