define(["underscore","../i18n","../time","../user","../core/Model"],function(t,o,n,e,i){"use strict";return i.extend({urlRoot:"/suggestions/reports/reward",nlsDomain:"suggestions",defaults:function(){return{month:null,confirmer:null,superior:null,sections:[],users:[]}},fetch:function(o){return t.isObject(o)||(o={}),o.data=t.assign(o.data||{},t.pick(this.attributes,["month","confirmer","superior","sections"])),o.data.sections=o.data.sections.join(","),i.prototype.fetch.call(this,o)},genClientUrl:function(){return"/suggestions/reports/reward?month="+this.get("month")+"&confirmer="+this.get("confirmer")+"&superior="+this.get("superior")+"&sections="+this.get("sections")},parse:function(t){return t.users.forEach(function(o){o.total=[o.finished[0]+o.kom[0],o.finished[1]+o.kom[1]],o.value=o.finished[1]*t.options.reward.kz+o.kom[1]*t.options.reward.kom,o.sections=o.sections.map(function(o){return t.sections[o]||o})}),{users:t.users}},serializeToCsv:function(){var o=["name;finishedCount;finishedPart;kotmCount;kotmPart;totalCount;totalPart;gratification;sections"];return t.forEach(this.get("users"),function(t){o.push('"'+t.name+'";'+t.finished[0].toLocaleString()+";"+t.finished[1].toLocaleString()+";"+t.kom[0].toLocaleString()+";"+t.kom[1].toLocaleString()+";"+t.total[0].toLocaleString()+";"+t.total[1].toLocaleString()+";"+t.value.toLocaleString()+';"'+t.sections.join(",")+'"')}),o.join("\r\n")}},{fromQuery:function(o){return null!=o.superior&&e.isAllowedTo("SUGGESTIONS:MANAGE","KAIZEN:DICTIONARIES:MANAGE")||(o.superior=e.data._id),new this({month:o.month||n.getMoment().startOf("month").subtract(1,"months").format("YYYY-MM"),confirmer:o.confirmer||null,superior:o.superior,sections:t.isEmpty(o.sections)?[]:o.sections.split(",")})}})});