define(["jquery","app/i18n","app/user","app/viewport","app/core/pages/DetailsPage","app/core/util/pageActions","app/kaizenOrders/dictionaries","../views/SuggestionDetailsView","../views/AttachmentsView","../views/SuggestionHistoryView","../views/KomView","../views/CoordinateView","../views/AcceptView","../views/CompleteView","../views/VerifyView","app/suggestions/templates/detailsPage"],function(e,t,i,s,o,n,a,r,l,d,h,c,m,u,p,b){"use strict";return o.extend({template:b,pageClassName:"page-max-flex",baseBreadcrumb:!0,breadcrumbs:function(){return this.options.standalone?[this.t("BREADCRUMB:base"),this.model.get("rid")+""]:o.prototype.breadcrumbs.call(this)},localTopics:{"suggestions.seen":"onSeen"},actions:function(){var e=[],t=this.model;if(i.isLoggedIn()){t.canKom()&&e.push({id:"kom",icon:"trophy",label:this.t("PAGE_ACTION:kom"),callback:this.kom.bind(this)}),t.canCoordinate()?e.push({id:"coordinate",icon:"gavel",label:this.t("PAGE_ACTION:coordinate"),callback:this.coordinate.bind(this)}):t.canAccept()?e.push({id:"accept",icon:"gavel",label:this.t("PAGE_ACTION:accept"),callback:this.accept.bind(this)}):t.canComplete()?e.push({id:"complete",icon:"gavel",label:this.t("PAGE_ACTION:complete"),callback:this.complete.bind(this)}):t.canVerify()&&e.push({id:"verify",icon:"gavel",label:this.t("PAGE_ACTION:verify"),callback:this.verify.bind(this)}),t.isNotSeen()&&e.push({id:"markAsSeen",icon:"eye",label:this.t("PAGE_ACTION:markAsSeen"),callback:this.markAsSeen.bind(this)});var s=t.get("observer");"subscriber"===s.role?e.push({id:"unobserve",icon:"eye-slash",label:this.t("PAGE_ACTION:unobserve"),callback:this.unobserve.bind(this)}):"viewer"===s.role&&e.push({id:"observe",icon:"eye",label:this.t("PAGE_ACTION:observe"),callback:this.observe.bind(this)}),t.canEdit()&&e.push(n.edit(t,!1)),t.canDelete()&&e.push(n.delete(t,!1))}return e.push({label:this.t("PAGE_ACTION:add"),icon:"plus",href:"#suggestions;add"}),e},initialize:function(){o.prototype.initialize.apply(this,arguments),this.setView("#-props",this.detailsView),this.setView("#-before",this.beforeView),this.setView("#-after",this.afterView),this.setView("#-other",this.otherView),this.setView("#-history",this.historyView)},destroy:function(){o.prototype.destroy.call(this),a.unload(),e("body").removeClass("suggestions-standalone")},defineViews:function(){this.detailsView=new r({model:this.model}),this.beforeView=new l({model:this.model,kind:"before"}),this.afterView=new l({model:this.model,kind:"after"}),this.otherView=new l({model:this.model,kind:"other"}),this.historyView=new d({model:this.model})},load:function(e){return e(this.model.fetch(),a.load())},setUpLayout:function(e){this.listenTo(this.model,"reset change",function(){e.setActions(this.actions,this)})},afterRender:function(){o.prototype.afterRender.call(this),a.load(),e("body").toggleClass("suggestions-standalone",!!this.options.standalone)},markAsSeen:function(e){var t=this,i=e.currentTarget.querySelector(".btn");i.disabled=!0,t.socket.emit("suggestions.markAsSeen",{_id:t.model.id},function(e){e&&(s.msg.show({type:"error",time:3e3,text:t.t("MSG:markAsSeen:failure")}),i.disabled=!1)})},observe:function(e){var t=this,i=e.currentTarget.querySelector(".btn");i.disabled=!0,t.socket.emit("suggestions.observe",{_id:t.model.id,state:!0},function(e){e&&(s.msg.show({type:"error",time:3e3,text:t.t("MSG:observe:failure")}),i.disabled=!1)})},unobserve:function(e){var t=this,i=e.currentTarget.querySelector(".btn");i.disabled=!0,t.socket.emit("suggestions.observe",{_id:t.model.id,state:!1},function(e){e&&(s.msg.show({type:"error",time:3e3,text:t.t("MSG:unobserve:failure")}),i.disabled=!1)})},onSeen:function(e){e===this.model.id&&this.model.markAsSeen()},kom:function(){var e=new h({model:this.model});s.showDialog(e,this.t("kom:title",{rid:this.model.get("rid")}))},coordinate:function(){var e=new c({model:this.model});s.showDialog(e,this.t("coordinate:title",{rid:this.model.get("rid")}))},accept:function(){var e=new m({model:this.model});s.showDialog(e,this.t("accept:title",{rid:this.model.get("rid")}))},complete:function(){var e=new u({model:this.model});s.showDialog(e,this.t("complete:title",{rid:this.model.get("rid")}))},verify:function(){var e=new p({model:this.model});s.showDialog(e,this.t("verify:title",{rid:this.model.get("rid")}))}})});