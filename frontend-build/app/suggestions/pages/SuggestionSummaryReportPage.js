define(["app/highcharts","app/core/View","app/kaizenOrders/dictionaries","../SuggestionSummaryReport","../views/SuggestionSummaryReportFilterView","../views/SuggestionTableAndChartView","../views/SuggestionAverageDurationChartView","../views/SuggestionSummaryCountChartView","../views/SuggestionSummaryPerUserChartView","app/suggestions/templates/summaryReportPage"],function(e,t,i,s,r,o,a,n,u,l){"use strict";return t.extend({layoutName:"page",pageId:"suggestionSummaryReport",template:l,breadcrumbs:function(){return[this.t("BREADCRUMB:reports:base"),this.t("BREADCRUMB:reports:summary")]},actions:function(){return[{label:this.t("PAGE_ACTION:print"),icon:"print",callback:this.togglePrintMode.bind(this)}]},initialize:function(){i.bind(this),this.defineViews(),this.setView(".filter-container",this.filterView),this.setView(".suggestions-report-summary-averageDuration",this.averageDurationView),this.setView(".suggestions-report-summary-count",this.countView),this.setView(".suggestions-report-summary-suggestionOwners",this.perUserView),this.setView(".suggestions-report-summary-categories",this.perCategoryView),this.listenTo(this.model,"filtered",this.onFiltered),this.listenTo(this.model,"change:total",this.updateSubtitles)},defineViews:function(){this.filterView=new r({productFamily:!0,model:this.model}),this.averageDurationView=new a({model:this.model}),this.countView=new n({model:this.model}),this.perUserView=new u({metric:"suggestionOwners",model:this.model,top:15,unlimitedType:"column"}),this.perCategoryView=new u({metric:"categories",model:this.model,unlimitedType:"column"})},destroy:function(){document.body.classList.remove("is-print")},load:function(e){return e(this.model.fetch())},afterRender:function(){this.updateSubtitles()},onFiltered:function(){this.promised(this.model.fetch()),this.broker.publish("router.navigate",{url:this.model.genClientUrl(),trigger:!1,replace:!0})},updateSubtitles:function(){var t=this.model.get("total"),s=(this.model.get("productFamily")||[]).map(function(e){return i.productFamilies.get(e).getLabel()}),r="report:subtitle:summary:averageDuration"+(document.body.classList.contains("is-print")?":short":"");this.$id("averageDuration").html(this.t(r,{averageDuration:e.numberFormat(t.averageDuration,2)})),this.$id("count").html(this.t("report:subtitle:summary:count",t.count)),this.$id("productFamily").html(s.length?this.t("report:subtitle:summary:productFamily",{productFamily:s.join(", ")}):"")},togglePrintMode:function(e){document.body.classList.toggle("is-print");var t=document.body.classList.contains("is-print");e.currentTarget.querySelector(".btn").classList.toggle("active",t),this.averageDurationView.chart.setSize(this.averageDurationView.$el.width(),t?300:400,!1),this.averageDurationView.chart.reflow(),this.perUserView.limit=t?10:-1,this.perUserView.updateTable(),this.perUserView.updateChart(),this.perCategoryView.limit=t?10:-1,this.perUserView.updateTable(),this.perCategoryView.updateChart(),this.updateSubtitles(),t&&window.print()}})});