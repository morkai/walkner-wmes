// Copyright (c) 2014, ≈Åukasz Walukiewicz <lukasz@walukiewicz.eu>. Some Rights Reserved.
// Licensed under CC BY-NC-SA 4.0 <http://creativecommons.org/licenses/by-nc-sa/4.0/>.
// Part of the walkner-wmes project <http://lukasz.walukiewicz.eu/p/walkner-wmes>

define(["underscore","app/i18n","app/core/views/ListView"],function(t,e,s){"use strict";function i(t,e){var s="";return e&&(s+=" "+e),t.observer&&t.observer.notify&&t.observer.changes&&t.observer.changes[this.id]&&(s+=" is-changed"),'class="'+s+'"'}return s.extend({className:"suggestions-list is-clickable",serializeColumns:function(){var s=this.options.simple,n=[{id:"rid",className:"is-min is-number"},{id:"status",tdAttrs:s?"":t.partial(i,t,"is-min"),className:s?"is-min":""},{id:"subject",tdAttrs:i,label:e("suggestions","PROPERTY:subjectAndDescription")}];return s||n.push.apply(n,[{id:"date",tdAttrs:i},{id:"categories",tdAttrs:i},{id:"productFamily",tdAttrs:i},{id:"section",tdAttrs:i},{id:"confirmer",tdAttrs:i},{id:"owners",label:e("suggestions","PROPERTY:owners")}]),n},serializeActions:function(){var t=this.collection;return this.options.simple?null:function(e){var i=t.get(e._id),n=[s.actions.viewDetails(i)];return i.canEdit()&&n.push(s.actions.edit(i)),i.canDelete()&&n.push(s.actions["delete"](i)),n}},afterRender:function(){s.prototype.afterRender.call(this);var t=this;this.$el.popover({selector:".list-item > td",container:this.el,trigger:"hover",placement:function(t,e){return"subject"===e.dataset.id?"auto right":"auto left"},html:!0,content:function(){var e=t.collection.get(this.parentNode.dataset.id);return"subject"===this.dataset.id?e.get("howItIs"):"owners"===this.dataset.id?t.serializeOwnersPopoverContent(e):void 0}})},serializeOwnersPopoverContent:function(t){var e=t.get("owners");if(!(e.length<=1)){for(var s='<ul class="suggestions-list-owners">',i=0;i<e.length;++i)s+="<li>"+e[i].rendered;return s+="</ul>"}}})});