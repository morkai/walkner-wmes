define(["underscore","app/time","app/user","app/viewport","app/core/views/FormView","app/users/util/setUpUserSelect2","app/kaizenOrders/dictionaries","app/suggestions/templates/complete"],function(t,e,i,s,a,n,o,r){"use strict";return a.extend({template:r,dialogClassName:"suggestions-complete-dialog",events:t.assign({"click #-accept":function(){this.status="verification",this.el.reportValidity()&&this.submitForm()},"click #-cancel":function(){this.status="cancelled",this.submitForm()}},a.prototype.events),serializeToForm:function(){return{kaizenImprovements:this.model.get("kaizenImprovements")||"",kaizenEffect:this.model.get("kaizenEffect")||""}},serializeForm:function(t){return t.status=this.status,"verification"===this.status?t.kaizenFinishDate=e.getMoment().startOf("day").toISOString():(t.kaizenFinishDate=null,t.kaizenImprovements="",t.kaizenEffect=""),t},request:function(t){return this.ajax({method:"PUT",url:this.model.url(),data:JSON.stringify(t)})},getFailureText:function(){return this.t("complete:failure")},handleSuccess:function(){s.closeDialog()},submitRequest:function(t,e){var i=this,s=new FormData,n=0;if(this.$('input[type="file"]').each(function(){this.files.length&&(s.append(this.dataset.name,this.files[0]),++n)}),0===n)return a.prototype.submitRequest.call(i,t,e);var o=this.ajax({type:"POST",url:"/suggestions;upload",data:s,processData:!1,contentType:!1});o.done(function(s){e.attachments=s,a.prototype.submitRequest.call(i,t,e)}),o.fail(function(){i.showErrorMessage(i.t("FORM:ERROR:upload")),t.attr("disabled",!1)})}})});