define(["underscore","app/time","app/user","app/viewport","app/core/views/FormView","app/users/util/setUpUserSelect2","app/kaizenOrders/dictionaries","app/suggestions/templates/complete"],function(t,e,i,s,a,n,r,o){"use strict";return a.extend({template:o,dialogClassName:"suggestions-complete-dialog",events:t.assign({"click #-accept":function(){this.status="verification",this.el.reportValidity()&&this.submitForm()},"click #-cancel":function(){this.status="cancelled",this.submitForm(!1)}},a.prototype.events),serializeToForm:function(){return{kaizenImprovements:this.model.get("kaizenImprovements")||"",kaizenEffect:this.model.get("kaizenEffect")||""}},serializeForm:function(t){return t.status=this.status,"verification"===this.status?t.kaizenFinishDate=e.getMoment().startOf("day").toISOString():(t.kaizenFinishDate=null,t.kaizenImprovements="",t.kaizenEffect=""),t},request:function(t){return this.ajax({method:"PUT",url:this.model.url(),data:JSON.stringify(t)})},getFailureText:function(){return this.t("complete:failure")},handleSuccess:function(){s.closeDialog()},submitRequest:function(t,e){var i=this,s=new FormData,n=0;if(i.$('input[type="file"]').each(function(){var t=this.name.replace("attachments.","");for(let e=0;e<this.files.length;++e)s.append(t,this.files[e]),n+=1}),0===n)return a.prototype.submitRequest.call(i,t,e);var r=this.ajax({type:"POST",url:"/suggestions;upload",data:s,processData:!1,contentType:!1});r.done(function(s){e.attachments={added:s},a.prototype.submitRequest.call(i,t,e)}),r.fail(function(){i.showErrorMessage(i.t("FORM:ERROR:upload")),t.attr("disabled",!1)})}})});