// Copyright (c) 2014, ≈Åukasz Walukiewicz <lukasz@walukiewicz.eu>. Some Rights Reserved.
// Licensed under CC BY-NC-SA 4.0 <http://creativecommons.org/licenses/by-nc-sa/4.0/>.
// Part of the walkner-wmes project <http://lukasz.walukiewicz.eu/p/walkner-wmes>

define(["underscore","app/core/views/DetailsView","app/kaizenOrders/dictionaries","app/suggestions/templates/details"],function(t,e,i,n){"use strict";return e.extend({template:n,currentTab:null,events:t.extend({'click a[data-toggle="tab"]':function(t){this.currentTab=t.currentTarget.dataset.tab}},e.prototype.events),serialize:function(){var i=this.model.get("status"),n="new"!==i&&"cancelled"!==i;return t.extend(e.prototype.serialize.call(this),{showKaizenPanel:n,suggestionColumnSize:n?6:12,kaizenColumnSize:n?6:0})},afterRender:function(){e.prototype.afterRender.call(this);var n=this;this.$(".prop[data-dictionary]").each(function(){var e=i[this.dataset.dictionary].get(n.model.get(this.dataset.property));if(e){var a=e.get("description");t.isEmpty(a)||(this.classList.toggle("has-description",!0),this.dataset.description=a)}}),this.$el.popover({container:this.el,selector:".has-description",placement:function(t,e){if(window.innerWidth<=992)return"top";var i=n.$(e).closest(".panel").parent();return i[0]===i.parent().children().last()[0]?"top":"right"},trigger:"hover",content:function(){return this.dataset.description}}),this.$('a[data-tab="'+(this.currentTab||this.options.initialTab)+'"]').click()}})});