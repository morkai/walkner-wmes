define(["require","underscore","app/user","app/viewport","app/core/views/FormView","app/users/util/setUpUserSelect2","app/suggestions/templates/coordinate"],function(t,e,i,s,n,r,o){"use strict";return n.extend({template:o,events:e.assign({"click #-accept":function(){this.status="accepted",this.el.reportValidity()&&this.submitForm()},"click #-reject":function(){this.status="rejected",this.el.reportValidity()&&this.submitForm()}},n.prototype.events),afterRender:function(){n.prototype.afterRender.apply(this,arguments),this.setUpSectionSelect2(),this.setUpUserSelect2()},setUpSectionSelect2:function(){var s=t("app/kaizenOrders/dictionaries"),n=this.model.canManage(),r=[],o=this.options.coordSection?this.options.coordSection._id:null;this.model.get("coordSections").forEach(function(t){var o=s.sections.get(t._id);o?(n||e.any(t.users,function(t){return t.id===i.data._id}))&&r.push({id:o.id,text:o.getLabel()}):n&&r.push({id:t._id,text:t._id})}),1===r.length&&(o=r[0].id);var a=this.$id("section");o&&r.some(function(t){return t.id===o})&&a.val(o),a.select2({width:"100%",data:r}),1===r.length&&a.select2("disable")},setUpUserSelect2:function(){var t=r(this.$id("user"),{view:this});t.select2("data",{id:i.data._id,text:i.getLabel()}),this.model.canManage()||t.select2("disable")},serializeToForm:function(){var s=t("app/kaizenOrders/dictionaries"),n=this.model.get("coordSections").filter(function(t){var n=s.sections.get(t._id);return n&&e.some(n.get("coordinators"),function(t){return t.id===i.data._id})});return{section:1===n.length?n[0]._id:"",comment:1===n.length?n[0].comment:""}},serializeForm:function(t){return{_id:this.$id("section").val(),status:this.status,user:r.getUserInfo(this.$id("user")),time:(new Date).toISOString(),comment:t.comment}},request:function(t){return this.ajax({method:"POST",url:this.model.url()+";coordinate",data:JSON.stringify(t)})},getFailureText:function(){return this.t("coordinate:failure")},handleSuccess:function(){s.closeDialog()}})});