define(["underscore","app/user","app/viewport","app/core/views/FormView","app/users/util/setUpUserSelect2","app/kaizenOrders/dictionaries","app/suggestions/templates/coordinate"],function(t,e,i,s,n,r,o){"use strict";return s.extend({template:o,events:t.assign({"click #-accept":function(){this.status="accepted",this.el.reportValidity()&&this.submitForm()},"click #-reject":function(){this.status="rejected",this.el.reportValidity()&&this.submitForm()}},s.prototype.events),afterRender:function(){s.prototype.afterRender.apply(this,arguments),this.setUpSectionSelect2(),this.setUpUserSelect2()},setUpSectionSelect2:function(){var i=this.model.canManage(),s=[];this.model.get("coordSections").forEach(function(n){var o=r.sections.get(n._id);o?(i||t.any(o.get("coordinators"),function(t){return t.id===e.data._id}))&&s.push({id:o.id,text:o.getLabel()}):i&&s.push({id:n._id,text:n._id})});var n=this.$id("section").select2({width:"100%",data:s});1===s.length&&n.select2("disable")},setUpUserSelect2:function(){var t=n(this.$id("user"),{view:this});t.select2("data",{id:e.data._id,text:e.getLabel()}),this.model.canManage()||t.select2("disable")},serializeToForm:function(){var i=this.model.get("coordSections").filter(function(i){var s=r.sections.get(i._id);return s&&t.some(s.get("coordinators"),function(t){return t.id===e.data._id})});return{section:1===i.length?i[0]._id:"",comment:1===i.length?i[0].comment:""}},serializeForm:function(t){return{_id:this.$id("section").val(),status:this.status,user:n.getUserInfo(this.$id("user")),time:(new Date).toISOString(),comment:t.comment}},request:function(t){return this.ajax({method:"POST",url:this.model.url()+";coordinate",data:JSON.stringify(t)})},getFailureText:function(){return this.t("coordinate:failure")},handleSuccess:function(){i.closeDialog()}})});