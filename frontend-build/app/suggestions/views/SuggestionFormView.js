define(["underscore","jquery","app/i18n","app/time","app/user","app/viewport","app/core/util/buttonGroup","app/core/util/idAndLabel","app/core/util/resultTips","app/core/views/FormView","app/core/templates/userInfo","app/users/util/setUpUserSelect2","app/kaizenOrders/dictionaries","../Suggestion","app/suggestions/templates/form","app/suggestions/templates/formCoordSectionRow","app/suggestions/templates/formResolutionRow","app/suggestions/templates/formAddOwner"],function(e,t,i,s,o,n,r,a,d,l,c,u,h,g,p,f,m,v){"use strict";function O(e){return{id:e.id,text:e.getLabel(),description:e.get("description")}}function S(t){if(e.isEmpty(t.description))return e.escape(t.text);var i='<div class="suggestions-select2">';return i+="<h3>"+e.escape(t.text)+"</h3>",i+="<p>"+e.escape(t.description)+"</p>",i+="</div>"}return l.extend({template:p,events:e.assign({'keydown [role="togglePanel"]':function(e){13===e.keyCode&&(e.preventDefault(),e.stopPropagation(),e.currentTarget.click())},'click [role="togglePanel"]':function(e){var t=this.$(e.currentTarget).closest(".panel"),i=t.attr("data-type");t.hasClass("is-collapsed")?this.expandPanel(i):this.collapsePanel(i)},'change [name="status"]':function(){this.toggleRequiredToFinishFlags(),this.setUpCoordSectionSelect2()},'change [name="section"]':function(){this.setUpConfirmerSelect2()},'change [name="categories"]':function(){this.toggleProductFamily(),this.toggleResolutions()},'change [name="productFamily"]':function(){this.updateProductFamilySubscribers(),"OTHER"===this.$id("productFamily").val()&&(this.setUpProductFamily(),this.$id("kaizenEvent").focus())},'change [type="date"]':function(e){var i=s.getMoment(e.target.value,"YYYY-MM-DD"),n=i.isValid()?i.diff(new Date,"days"):0,r=Math.abs(n),a=this.$(e.target).closest(".form-group"),d=a.find(".help-block");e.target.setCustomValidity(""),r<=7?d.remove():(!o.isAllowedTo("SUGGESTIONS:MANAGE")&&r>60&&e.target.setCustomValidity(this.t("FORM:ERROR:date",{days:60})),d.length||(d=t('<p class="help-block"></p>')),d.text(this.t("FORM:help:date:diff",{dir:n>0?"future":"past",days:r})).appendTo(a))},"click #-productFamily-other":function(){var e=this.$id("productFamily"),t=this.$id("kaizenEvent"),i="OTHER"===e.val();e.select2("destroy").val(i?"":"OTHER"),t.val(""),this.setUpProductFamily(),i?e.select2("open"):t.focus()},"click #-confirmer-other":function(){this.otherConfirmer=!this.otherConfirmer,this.setUpConfirmerSelect2(),this.$id("confirmer").select2("focus")},"change #-confirmer":function(){this.checkOwnerValidity()},"change #-coordSection":function(e){e.added&&(this.addCoordSection({_id:e.added.id}),e.target.value=""),this.setUpCoordSectionSelect2()},'click .btn[data-value="removeCoordSection"]':function(e){this.$(e.currentTarget).closest("tr").remove(),this.setUpCoordSectionSelect2()},'change input[type="file"]':function(){var e=null,t=0;this.$('input[type="file"]').each(function(){this.setCustomValidity(""),t+=this.files.length,(!e||e.length<this.files.length)&&(e=this)}),t>10&&e.setCustomValidity(this.t("FORM:ERROR:tooManyFiles",{max:e}))},"keydown #-resolutionRid":function(e){if("Enter"===e.key)return this.$id("linkResolution").click(),!1},"click #-addResolution":"showAddResolutionDialog","click #-linkResolution":"linkResolution",'click .btn[data-action="unlinkResolution"]':function(e){var t=this.$(e.currentTarget).closest("tr");t.fadeOut("fast",function(){t.remove()})},'change input[name$=".user"], input[name*="Owners"]':function(e){var t=this.$(e.currentTarget);this.updateUsersSuperior(t),this.toggleUsersRequired(t),this.checkOwnerValidity()},'change input[name$=".role"]':function(){this.checkOwnerValidity()},'change input[name*="superior"]':function(){this.checkOwnerValidity()},"click #-addOwner":function(){this.addOwner(),this.$id("addOwner").prop("disabled",3===this.$id("owners")[0].childElementCount)},'click .btn[data-action="removeOwner"]':function(e){var t=this,i=t.$(e.currentTarget).closest(".suggestions-form-owner");i.fadeOut("fast",function(){i.remove(),t.$id("addOwner").prop("disabled",3===t.$id("owners")[0].childElementCount),t.checkOwnerValidity()})}},l.prototype.events),initialize:function(){l.prototype.initialize.apply(this,arguments),this.productFamilyObservers={},this.otherConfirmer=!1,this.resolutionI=0,this.addOwnerI=0,this.listenTo(h.sections,"add remove change",this.onSectionUpdated)},getTemplateData:function(){return{today:s.format(new Date,"YYYY-MM-DD"),statuses:h.kzStatuses,backTo:this.serializeBackTo()}},serializeBackTo:function(){if(void 0!==this.backTo)return this.backTo;var t,i,s={KO_LAST:"kaizenOrders",BOC_LAST:"behaviorObsCards",MFS_LAST:"minutesForSafetyCards"};return e.forEach(s,function(e,s){t||(i=JSON.parse(sessionStorage.getItem(s)||"null"))&&(t=e)}),t?this.backTo={type:t,data:i,submitLabel:this.t("FORM:backTo:"+t+":"+(i._id?"edit":"add")),cancelLabel:this.t("FORM:backTo:"+t+":cancel"),cancelUrl:"#"+t+(i._id?"/"+i._id+";edit":";add")}:(e.forEach(s,function(e){sessionStorage.removeItem(e)}),this.backTo=null)},checkValidity:function(){return!0},checkOwnerValidity:function(){var e,t,i=this,s=i.$id("confirmer").select2("data"),o={total:{},suggestion:{},kaizen:{}};if(this.options.editMode)["suggestion","kaizen"].forEach(function(e){for(var t=0;t<2;++t){var s=i.$id(e+"Owners-"+t).val();if(s){o[e][s]=1,o.total[s]=1;var n=i.$id(e+"Superiors-"+t);n[0].setCustomValidity(n.val()===s?i.t("FORM:owners:superior"):"")}}}),e=i.$id("suggestionOwners-0"),t=i.$id("kaizenOwners-0"),i.$id("kaizenOwners-1")[0].setCustomValidity(Object.keys(o.total).length>3?i.t("FORM:owners:tooMany:overall",{max:3}):"");else{i.$(".suggestions-form-owner").each(function(e,t){var s=i.$(t),n=s.find('input[name$=".user"]').val();if(n){s.find('input[value="suggestion"]:checked').length&&(o.suggestion[n]=1,o.total[n]=1),s.find('input[value="kaizen"]:checked').length&&(o.kaizen[n]=1,o.total[n]=1);var r=s.find('input[name$=".superior"]');r[0].setCustomValidity(r.val()===n?i.t("FORM:owners:superior"):"")}});var n=this.$id("owners");e=n.find('input[value="suggestion"]').first(),t=n.find('input[value="kaizen"]').first(),n.find('input[name$=".user"]').first()[0].setCustomValidity(Object.keys(o.total).length>3?i.t("FORM:owners:tooMany:overall",{max:3}):"")}e[0].setCustomValidity(Object.keys(o.suggestion).length>2?i.t("FORM:owners:tooMany:suggestion",{max:2}):""),t[0].setCustomValidity(Object.keys(o.kaizen).length>2?i.t("FORM:owners:tooMany:kaizen",{max:2}):""),this.$id("confirmer")[0].setCustomValidity(s&&o.total[s.id]?i.t("FORM:owners:confirmer",{kind:o.suggestion[s.id]?"suggestion":"kaizen"}):"")},submitRequest:function(e,t){var s=this,o=new FormData,n=0;if(s.$('input[type="file"]').each(function(){var e=this.name.replace("attachments.","");for(let t=0;t<this.files.length;++t)o.append(e,this.files[t]),n+=1}),0===n)return l.prototype.submitRequest.call(s,e,t);this.$el.addClass("is-uploading");var r=this.ajax({type:"POST",url:"/suggestions;upload",data:o,processData:!1,contentType:!1});r.done(function(i){t.attachments={added:i},l.prototype.submitRequest.call(s,e,t)}),r.fail(function(){s.showErrorMessage(i("suggestions","FORM:ERROR:upload")),e.attr("disabled",!1)}),r.always(function(){s.$el.removeClass("is-uploading")})},handleSuccess:function(){!this.options.editMode&&this.backTo?this.broker.publish("router.navigate",{url:"/"+this.backTo.type+(this.backTo.data._id?"/"+this.backTo.data._id+";edit":";add")+"?suggestion="+this.model.get("rid"),trigger:!0}):this.broker.publish("router.navigate",{url:this.model.genClientUrl()+"?"+(this.options.editMode?"":"&thank=you")+(this.options.standalone?"&standalone=1":""),trigger:!0})},serializeToForm:function(){var t=this.model.toJSON();return g.DATE_PROPERTIES.forEach(function(e){t[e]&&(t[e]=s.format(t[e],"YYYY-MM-DD"))}),t.categories=e.isEmpty(t.categories)?"":t.categories.join(","),t.subscribers="",t.kom&&(t.status="kom"),delete t.owners,delete t.observers,delete t.attachments,delete t.changes,delete t.suggestionOwners,delete t.kaizenOwners,t},serializeForm:function(t){var i=this;if(t.categories=t.categories.split(","),t.confirmer=u.getUserInfo(this.$id("confirmer")),t.subscribers=i.$id("subscribers").select2("data").map(function(e){return{id:e.id,label:e.text}}),g.DATE_PROPERTIES.forEach(function(e){var i=s.getMoment(t[e],"YYYY-MM-DD");t[e]=i.isValid()?i.toISOString():null}),i.options.editMode){var o={},n={};i.model.get("coordSections").forEach(function(e){o[e._id]=e}),i.$id("coordSections").find("tr").each(function(){var e=this.dataset.id,t=h.sections.get(e);n[e]=o[e]||{_id:e,name:t?t.getLabel():e,status:"pending",user:null,time:null,comment:""}}),t.coordSections=e.values(n),t.suggestionSuperiors=[],t.suggestionOwners=[],t.kaizenSuperiors=[],t.kaizenOwners=[],["suggestion","kaizen"].forEach(function(e){for(var s=0;s<2;++s){var o=u.getUserInfo(i.$id(e+"Superiors-"+s)),n=u.getUserInfo(i.$id(e+"Owners-"+s));o&&n&&(1===s&&t[e+"Owners"][0].id===n.id||(t[e+"Superiors"].push(o),t[e+"Owners"].push(n)))}})}else t.coordSections=[],t.suggestionSuperiors=[],t.suggestionOwners=[],t.kaizenSuperiors=[],t.kaizenOwners=[],i.$(".suggestions-form-owner").each(function(){var e=i.$(this),s=u.getUserInfo(e.find('input[name$=".superior"]')),o=u.getUserInfo(e.find('input[name$=".user"]'));s&&o&&(e.find('input[value="suggestion"]:checked').length&&!t.suggestionOwners.some(function(e){return e.id===o.id})&&(t.suggestionSuperiors.push(s),t.suggestionOwners.push(o)),e.find('input[value="kaizen"]:checked').length&&!t.kaizenOwners.some(function(e){return e.id===o.id})&&(t.kaizenSuperiors.push(s),t.kaizenOwners.push(o)))});return"kom"===t.status?(t.status="finished",t.kom=!0):t.kom=!1,i.$id("resolutionsGroup").hasClass("hidden")?t.resolutions=[]:t.resolutions=(t.resolutions||[]).map(function(e){return e.rid=+e.rid,e}),delete t.attachments,t},serializeOwners:function(e){return this.$id(e+"Owners").select2("data").map(function(e){return{id:e.id,label:e.text}}).filter(function(e){return!!e.id})},afterRender:function(){l.prototype.afterRender.call(this),r.toggle(this.$id("status")),u(this.$id("subscribers"),{multiple:!0,noPersonnelId:!0,activeOnly:!this.options.editMode}),this.setUpSectionSelect2(),this.setUpCategorySelect2(),this.setUpProductFamily(),this.setUpConfirmerSelect2(),this.setUpOwners(),this.options.editMode?(this.renderCoordSections(),this.setUpCoordSectionSelect2()):this.setUpCoordSectionsSelect2(),this.setUpResolutions(),this.toggleStatuses(),this.toggleRequiredToFinishFlags(),this.togglePanels(),this.toggleFields(),this.$("input[autofocus]").focus()},setUpSectionSelect2:function(){var t=this.model.get("section"),i=h.sections.get(t),s={};h.sections.forEntryType("suggestions").forEach(function(e){e.get("active")&&e.get("confirmers").length&&(s[e.id]=a(e))}),t&&(s[t]=i?a(i):{id:t,text:t}),this.$id("section").select2({data:e.values(s)})},setUpCategorySelect2:function(){var t=this.model.get("category"),i=h.categories.get(t),s={};h.categories.forEach(function(e){e.get("active")&&e.get("inSuggestion")&&(s[e.id]=O(e))}),t&&(s[t]=i?O(i):{id:t,text:t}),this.$id("categories").select2({allowClear:!0,placeholder:" ",dropdownCssClass:"is-bigdrop",multiple:this.options.editMode&&this.model.get("categories").length>1,data:e.values(s),formatResult:S})},setUpProductFamily:function(){var e=this.$id("productFamily"),t=this.$id("kaizenEvent"),i=this.$id("productFamily-other");if("OTHER"===e.val())i.text(this.t("FORM:productFamily:list")),e.select2("destroy").addClass("hidden"),t.removeClass("hidden");else{var s=this.model.get("productFamily");i.text(this.t("FORM:productFamily:other")),t.addClass("hidden"),e.removeClass("hidden").select2({allowClear:!0,placeholder:" ",data:h.productFamilies.filter(function(e){return e.id===s||e.get("active")}).map(a)})}this.toggleProductFamily(!0)},setUpConfirmerSelect2:function(){var t=h.sections.get(this.$id("section").val()),i=t?t.get("confirmers"):[],s={},n=this.model.get("confirmer"),r=this.$id("confirmer"),a=this.$id("confirmer-other");if(i.forEach(function(e){s[e.id]={id:e.id,text:e.label}}),r.val(""),!t)return r.select2("destroy").addClass("form-control").prop("disabled",!0).attr("placeholder",this.t("FORM:confirmer:section")),void a.addClass("hidden");if(r.removeClass("form-control").prop("disabled",!1).attr("placeholder",null),i.length&&(o.isAllowedTo("SUGGESTIONS:MANAGE")||this.model.isConfirmer())?a.text(this.t("FORM:confirmer:"+(this.otherConfirmer?"list":"other"))).removeClass("hidden"):a.addClass("hidden"),this.otherConfirmer||!i.length)u(r,{placeholder:this.t("FORM:confirmer:search"),noPersonnelId:!0,activeOnly:!this.options.editMode});else{n&&(s[n.id]={id:n.id,text:n.label});var d=e.values(s);d.sort(function(e,t){return e.text.localeCompare(t.text)}),r.select2({width:"100%",allowClear:!1,placeholder:this.t("FORM:confirmer:select"),data:d}),1===d.length&&(n={id:d[0].id,label:d[0].text})}r.select2("container").attr("title",""),n&&r.select2("data",{id:n.id,text:n.label})},setUpOwners:function(){this.options.editMode?this.setUpEditOwners():this.setUpAddOwners()},setUpAddOwners:function(){if(this.addOwner(),o.isLoggedIn()){var e=this.$id("owners").find('input[name$=".user"]'),t=o.getInfo();e.select2("data",{id:t.id,text:t.label}),this.updateUsersSuperior(e,!0),this.toggleUsersRequired(e)}},setUpEditOwners:function(){var e=this;["suggestion","kaizen"].forEach(function(t){for(var i=e.model.get(t+"Owners"),s=e.model.get(t+"Superiors"),o=0;o<2;++o){var n=e.$id(t+"Owners-"+o);e.setUpOwnerUserSelect2(n,{currentUserInfo:i[o]}),e.setUpOwnerSuperiorSelect2(e.$id(t+"Superiors-"+o),{currentUserInfo:s[o]}),i[o]&&e.toggleUsersRequired(n)}})},updateUsersSuperior:function(e,t){var i=this,s=e.val();s&&this.ajax({url:"/suggestions?select(suggestionOwners,kaizenOwners,suggestionSuperiors,kaizenSuperiors,section,confirmer)&sort(-_id)&limit(1)&owners.id="+s}).done(function(o){if(o.totalCount){var n=o.collection[0],r=n.suggestionOwners.findIndex(function(e){return e.id===s}),a=null;-1===r?-1!==(r=n.kaizenOwners.findIndex(function(e){return e.id===s}))&&(a=n.kaizenSuperiors[r]):a=n.suggestionSuperiors[r],e.closest(".row").find('input[name*="uperior"]').select2("data",a?{id:a.id,text:a.label}:null),t&&(i.$id("section").select2("val",n.section).trigger("change"),i.$id("confirmer").select2("data",{id:n.confirmer.id,text:n.confirmer.label}))}})},toggleUsersRequired:function(e){var t=!!e.val();e.closest(".row").find('input[name*="uperior"]').prop("required",t).closest(".form-group").toggleClass("has-required-select2",t).find(".control-label").toggleClass("is-required",t)},addOwner:function(){var e=this.renderPartial(v,{i:this.addOwnerI++});this.$id("owners").append(e),this.setUpOwnerUserSelect2(e.find('input[name$=".user"]')),this.setUpOwnerSuperiorSelect2(e.find('input[name$=".superior"]'))},setUpOwnerUserSelect2:function(e,t){u(e,Object.assign({activeOnly:!0,noPersonnelId:!0},t))},setUpOwnerSuperiorSelect2:function(e,t){u(e,Object.assign({activeOnly:!0,noPersonnelId:!0,rqlQueryDecorator:function(e){var t=h.settings.getValue("superiorFuncs");Array.isArray(t)&&t.length&&e.selector.args.push({name:"in",args:["prodFunction",t]})}},t))},setUpCoordSectionsSelect2:function(){var e=this.$id("coordSections"),t=h.sections.filter(function(e){return e.get("coordinators").length>0}).map(a);e.select2({width:"100%",multiple:!0,allowClear:!0,placeholder:this.t("coordSections:add:placeholder"),data:t})},renderCoordSections:function(){this.$id("coordSections").html(""),this.model.get("coordSections").forEach(this.addCoordSection,this)},setUpCoordSectionSelect2:function(){var e=this.$id("coordSections").find("tr"),t=this.$id("coordSection"),i=h.sections.filter(function(t){return t.get("coordinators").length>0&&0===e.filter('tr[data-id="'+t.id+'"]').length}).map(a);t.select2({width:"300px",placeholder:this.t("coordSections:edit:placeholder"),data:i}),t.select2(0!==i.length&&this.canManageCoordinators()?"enable":"disable")},addCoordSection:function(t){t.status||(t=e.find(this.model.get("coordSections"),function(e){return e._id===t._id})||t);var i=h.sections.get(t._id),o=this.renderPartial(f,{section:{_id:t._id,name:i?i.get("name"):t.name,status:this.t("coordSections:status:"+(t.status||"pending")),user:t.user?c({userInfo:t.user}):"",time:t.time?s.format(t.time,"L, LT"):"",comment:t.comment||""},canManage:this.canManageCoordinators()});this.$id("coordSections").append(o)},canManageCoordinators:function(){if(this.model.canManage())return!0;var e=r.getValue(this.$id("status"));return!("accepted"!==e||!this.model.isConfirmer())||!("new"!==e||!(this.model.isConfirmer()||this.model.isCreator()||this.model.isSuggestionOwner()))},toggleRequiredFlags:function(){this.$(".suggestions-form-typePanel").each(function(){var e=t(this),i=!e.hasClass("hidden");e.find(".is-required").each(function(){e.find("#"+this.htmlFor).prop("required",i)})})},toggleRequiredToFinishFlags:function(){var e=this.$('input[name="status"]:checked').val(),t="finished"===e||"kom"===e,i=this;this.$(".is-requiredToFinish").toggleClass("is-required",t).each(function(){if(this.dataset.required)return i.handleRequiredToFinishFlags(this.dataset.required,t);this.nextElementSibling.classList.contains("select2-container")&&this.parentNode.classList.toggle("has-required-select2",t),t||i.$("#"+this.htmlFor).prop("required",!1)}),t&&this.toggleRequiredFlags()},handleRequiredToFinishFlags:function(e){},toggleStatuses:function(){if(this.options.editMode){if(!this.model.canManage()&&!this.model.isConfirmer()){var e={},t=this.model.get("status"),i=this.$id("status");e[t]=!0,("new"===t&&(this.model.isCreator()||this.model.isSuggestionOwner())||"inProgress"===t&&this.model.isKaizenOwner())&&(e.cancelled=!0),i.find("input").each(function(){this.parentNode.classList.toggle("disabled",!this.checked&&!e[this.value])}),this.$id("statusGroup").removeClass("hidden")}}else this.$id("statusGroup").addClass("hidden")},toggleFields:function(){var e=this;"inProgress"!==e.model.get("status")||e.model.isConfirmer()||e.model.canManage()||(e.$id("section").select2("readonly",!0),e.$id("confirmer").select2("readonly",!0),e.$id("productFamily-other").addClass("hidden"),e.$id("suggestionPanelBody").find(".form-group").each(function(){var t=e.$(this).find("> input, > textarea")[0];-1===t.tabIndex?e.$(t).select2("readonly",!0):t.readOnly=!0}))},isKaizenAvailable:function(){return this.options.editMode},togglePanels:function(){var e=this.isKaizenAvailable();this.$id("panel-kaizen").toggleClass("hidden",!e),e?(this.$id("suggestionOwners").closest(".form-group").removeClass("col-lg-6").addClass("col-lg-12"),this.$id("suggestedKaizenOwners").closest(".form-group").addClass("hidden")):(this.$id("suggestionOwners").closest(".form-group").removeClass("col-lg-12").addClass("col-lg-6"),this.$id("suggestedKaizenOwners").closest(".form-group").removeClass("hidden"))},toggleProductFamily:function(t){var i=e.includes(this.$id("categories").val().split(","),"KON"),s=this.$id("productFamily"),o=s.closest(".form-group"),n=o.find(".control-label");s.prop("required",i),i||(t||s.select2("data",null),this.updateProductFamilySubscribers()),n.toggleClass("is-required",i),o.toggleClass("has-required-select2",i)},updateProductFamilySubscribers:function(){var t=this,i=h.productFamilies.get(this.$id("productFamily").val()),s=i&&i.get("owners")||[],o={},n=[];this.$id("subscribers").select2("data").forEach(function(e){t.productFamilyObservers[e.id]||(o[e.id]=!0,n.push(e))}),t.productFamilyObservers={},e.forEach(s,function(e){o[e.id]||(n.push({id:e.id,text:e.label}),t.productFamilyObservers[e.id]=!0)}),this.$id("subscribers").select2("data",n)},onSectionUpdated:function(){this.setUpSectionSelect2(),this.setUpConfirmerSelect2(),this.options.editMode?this.setUpCoordSectionSelect2():this.setUpCoordSectionsSelect2()},setUpResolutions:function(){this.toggleResolutions(),this.renderResolutions()},toggleResolutions:function(){var e=this.$id("categories").val().split(",").includes("KI"),t=n.currentDialog===this;this.$id("resolutionsGroup").toggleClass("hidden",!e||t)},renderResolutions:function(){this.$id("resolutions").html(""),(this.model.get("resolutions")||[]).forEach(this.addResolution,this)},addResolution:function(e){this.$id("resolutions").append(this.renderPartialHtml(m,{i:++this.resolutionI,resolution:e}))},linkResolution:function(){var e=this,t=parseInt(e.$id("resolutionRid").val(),10);if(isNaN(t)||t<=0||t===e.model.get("rid")||e.$id("resolutions").find('input[name$=".rid"][value="'+t+'"]').length)e.$id("resolutionRid").val("").focus();else{n.msg.loading();var i=this.$id("resolutionsActions").find(".form-control, .btn").prop("disabled",!0),s=this.ajax({url:"/suggestions/"+t+"?select(rid,status,subject)"});s.fail(function(){d.show({type:"error",text:e.t("resolutions:error:"+(404===s.status?"notFound":"failure")),time:2e3,el:e.$id("resolutionsActions")[0]})}),s.done(function(t){t.type="suggestion",e.addResolution(t),i.prop("disabled",!1),e.$id("resolutionRid").val("").focus()}),s.always(function(){n.msg.loaded(),i.prop("disabled",!1)})}},showAddResolutionDialog:function(){var e=this,t=new g,i=new e.constructor({dialogClassName:"suggestions-form-dialog",editMode:!1,model:t,formMethod:"POST",formAction:t.url(),formActionText:e.t("core","FORM:ACTION:add"),failureText:e.t("core","FORM:ERROR:addFailure"),panelTitleText:e.t("core","PANEL:TITLE:addForm")});i.handleSuccess=function(){e.addResolution({_id:t.id,rid:t.get("rid"),type:"suggestion",status:t.get("status"),subject:t.get("subject")}),n.closeDialog()},n.showDialog(i)}})});