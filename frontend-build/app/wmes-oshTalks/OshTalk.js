define(["underscore","../i18n","../time","../user","../core/Model","app/kaizenOrders/dictionaries","app/core/templates/userInfo"],function(t,i,e,a,r,n,s){"use strict";var o=["date"],u=["createdAt","updatedAt"],c=["creator","updater","auditor"];return r.extend({urlRoot:"/oshTalks",clientUrlRoot:"#oshTalks",topicPrefix:"oshTalks",privilegePrefix:"OSH_TALKS",nlsDomain:"wmes-oshTalks",labelAttribute:"rid",serialize:function(t){var a=t&&t.longDateTime,r=a?"LL":"L",l=a?"LLLL":"L, LTS",d=this.toJSON();return d.status=i(this.nlsDomain,"status:"+d.status),d.section=n.sections.getLabel(d.section),o.forEach(function(t){d[t]=d[t]?e.format(d[t],r):null}),u.forEach(function(t){d[t]=d[t]?e.format(d[t],l):null}),c.forEach(function(t){d[t]=s(d[t])}),d.topics=d.topics.map(function(t){return n.topics.getLabel(t,{short:!1})}),d.participants=d.participants.map(function(t){return s(t)}),d},serializeDetails:function(){return this.serialize({longDateTime:!0})},serializeRow:function(t){var i=this.serialize(t),e=i.participants,a=i.topics;return i.participants=e[0],e.length>1&&(i.participants+=" +"+(e.length-1)),i.topics=a[0],a.length>1&&(i.topics+=" +"+(a.length-1)),i},isCreator:function(){return this.attributes.creator&&this.attributes.creator.id===a.data._id},isAuditor:function(){return this.attributes.auditor&&this.attributes.auditor.id===a.data._id}},{can:{manage:function(){return a.isAllowedTo("OSH_TALKS:MANAGE")},add:function(){return!!(this.can||this).manage()||n.isAuditor()},edit:function(t){return!!(this.can||this).manage()||!(!t.isCreator()&&!t.isAuditor())&&Date.now()-Date.parse(t.get("updatedAt"))<864e5},delete:function(t){return!!(this.can||this).manage()||!!t.isCreator()&&Date.now()-Date.parse(t.get("updatedAt"))<288e5}}})});