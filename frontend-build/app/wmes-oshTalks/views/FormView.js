define(["underscore","app/time","app/user","app/core/util/idAndLabel","app/core/util/buttonGroup","app/core/views/FormView","app/users/util/setUpUserSelect2","app/kaizenOrders/dictionaries","../OshTalk","app/wmes-oshTalks/templates/form"],function(t,e,i,a,s,o,n,c,r,l){"use strict";return o.extend({template:l,events:Object.assign({"change #-auditor":function(){this.setUpSectionSelect2()}},o.prototype.events),initialize:function(){o.prototype.initialize.apply(this,arguments)},serializeToForm:function(){var t=this.model.toJSON();return t.date=e.format(t.date||new Date,"YYYY-MM-DD"),t.topics=(t.topics||[]).join(","),delete t.participants,t},serializeForm:function(t){var i=this.$id("auditor").select2("data"),a=e.getMoment(t.date,"YYYY-MM-DD");return t.auditor={id:i.id,label:i.text},t.date=a.isValid()?a.toISOString():null,t.topics=t.topics.split(","),t.participants=n.getUserInfo(this.$id("participants")),t},afterRender:function(){o.prototype.afterRender.call(this),this.setUpAuditorSelect2(),this.setUpSectionSelect2(),this.setUpTopicsSelect2(),this.setUpParticipantsSelect2()},setUpAuditorSelect2:function(){var t=this.model.get("auditor")||i.getInfo(),e={};e[t.id]={id:t.id,text:t.label},c.sections.forEntryType("talks").forEach(function(t){t.get("active")&&t.get("auditors").forEach(function(t){e[t.id]={id:t.id,text:t.label}})}),this.$id("auditor").val(t.id).select2({data:Object.values(e)})},setUpSectionSelect2:function(){var t=r.can.manage(),e=c.sections.get(this.model.get("section")),i=this.$id("auditor").val(),s={};e&&(s[e.id]=a(e)),c.sections.forEntryType("audits").forEach(function(e){e.get("active")&&(t||e.get("auditors").some(function(t){return t.id===i}))&&(s[e.id]=a(e))}),s=Object.values(s);var o=this.$id("section");e?o.val(e.id):1===s.length?o.val(s[0].id):o.val(""),o.select2({data:s})},setUpTopicsSelect2:function(){var t={},e=this.model.get("topics")||[];c.topics.forEach(function(i){(e.includes(i.id)||i.get("active"))&&(t[i.id]={id:i.id,text:i.get("fullName")})}),this.$id("topics").select2({allowClear:!0,multiple:!0,data:Object.values(t)})},setUpParticipantsSelect2:function(){n(this.$id("participants"),{view:this,multiple:!0,currentUserInfo:this.model.get("participants")})}})});