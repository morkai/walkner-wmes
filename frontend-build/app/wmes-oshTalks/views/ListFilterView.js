define(["underscore","app/user","app/core/views/FilterView","app/core/util/idAndLabel","app/core/util/forms/dateTimeRange","app/core/util/forms/dropdownRadio","app/users/util/setUpUserSelect2","app/kaizenOrders/dictionaries","app/wmes-oshTalks/templates/filter","app/core/util/ExpandableSelect"],function(e,t,s,r,i,n,a,o,u){"use strict";return s.extend({template:u,filterList:[],filterMap:{},events:Object.assign({"click a[data-date-time-range]":i.handleRangeEvent,'change input[name="userType"]':function(){this.toggleUserSelect2(!0)},"keyup select":function(e){if(27===e.keyCode)return e.target.selectedIndex=-1,!1},"dblclick select":function(e){e.target.selectedIndex=-1}},s.prototype.events),defaultFormData:function(){return{section:[],userType:"others",user:null}},termToForm:{date:i.rqlToForm,"auditor.id":function(e,t,s){s.userType="auditor",s.user=t.args[1]},"participants.id":function(e,t,s){s.userType="participants",s.user=t.args[1]},users:function(e,s,r){"mine"===s.args[1]?(r.userType="mine",r.user=t.data._id):(r.userType="others",r.user=s.args[1])},section:function(e,t,s){s[e]="in"===t.name?t.args[1]:[t.args[1]]}},getTemplateData:function(){return{sections:o.sections.forEntryType("audits").map(r)}},serializeFormToQuery:function(t){var s=this.$('input[name="userType"]').val(),r=this.$id("user").val();if(i.formToRql(this,t),"mine"===s)t.push({name:"eq",args:["users",s]});else if(r){var n;n="others"===s?"users":s+".id",t.push({name:"eq",args:[n,r]})}["section"].forEach(function(s){var r=this.$id(s).val()||[];"string"==typeof r&&(r=r.split(",")),1===(r=r.filter(function(t){return!e.isEmpty(t)})).length?t.push({name:"eq",args:[s,r[0]]}):r.length&&t.push({name:"in",args:[s,r]})},this)},afterRender:function(){s.prototype.afterRender.call(this),this.$(".is-expandable").expandableSelect(),a(this.$id("user"),{view:this,width:"275px",noPersonnelId:!0}),this.setUpUserType(),this.toggleUserSelect2(!1)},destroy:function(){s.prototype.destroy.call(this),this.$(".is-expandable").expandableSelect("destroy")},setUpUserType:function(){var e=this,t=["mine","others","auditor","participants"].map(function(t){return{value:t,optionLabel:e.t("filter:user:"+t)}});n(e.$id("userType"),{label:e.t("filter:user:others"),options:t})},toggleUserSelect2:function(e){var s=this.$('input[name="userType"]').val(),r="mine"===s||"unseen"===s,i=this.$id("user").select2("enable",!r);!e||!r&&i.val()||i.select2("data",{id:t.data._id,text:t.getLabel()})}})});