// Part of <https://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

define(["underscore","../i18n","../time","../core/Model","../data/colorFactory","./dictionaries"],function(t,e,s,o,i,n){"use strict";return o.extend({urlRoot:"/kaizen/reports/metrics",nlsDomain:"kaizenOrders",defaults:function(){return{from:0,to:0,status:[],sections:[]}},fetch:function(e){return t.isObject(e)||(e={}),e.data=t.extend(e.data||{},t.pick(this.attributes,["from","to","status","sections"])),e.data.status=e.data.status.join(","),e.data.sections=e.data.sections.join(","),o.prototype.fetch.call(this,e)},genClientUrl:function(){return"/kaizenMetricsReport?from="+this.get("from")+"&to="+this.get("to")+"&status="+this.get("status")+"&sections="+this.get("sections")},parse:function(t){var s={total:t.totals},o=Object.keys(t.sections).filter(function(e){var s=t.bySection[e];return s&&(s.ipr||s.ips||s.ipc)}).sort(function(t,e){return t.localeCompare(e)}),n=o.map(function(e){return t.sections[e]});return["ipr","ips","ipc"].forEach(function(r){s[r]={categories:n,series:[{id:r,name:e.bound("kaizenOrders","report:series:"+r),data:o.map(function(e){return{y:t.bySection[e][r],color:i.getColor("section",e)}})}]}}),s}},{fromQuery:function(e){return void 0===e.from&&void 0===e.to&&(e.from=s.getMoment().startOf("month").subtract(3,"months").valueOf()),new this({from:+e.from||void 0,to:+e.to||void 0,status:t.isEmpty(e.status)?[]:e.status.split(","),sections:t.isEmpty(e.sections)?[]:e.sections.split(",")})}})});