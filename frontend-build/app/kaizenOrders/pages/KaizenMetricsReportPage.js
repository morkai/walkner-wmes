// Part of <https://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

define(["app/i18n","app/highcharts","app/core/View","../dictionaries","../KaizenMetricsReport","../views/KaizenMetricsReportFilterView","../views/KaizenMetricsReportChartView","app/kaizenOrders/templates/metricsReportPage"],function(e,t,i,r,s,n,o,a){"use strict";return i.extend({layoutName:"page",template:a,breadcrumbs:[e.bound("kaizenOrders","BREADCRUMBS:base"),e.bound("kaizenOrders","BREADCRUMBS:reports:metrics")],initialize:function(){this.setView("#-filter",new n({model:this.model})),["ipr","ips","ipc"].forEach(function(e,t){this.setView("#-"+e+"-report",new o({metric:e,model:this.model,unit:0===t?"":"%"}))},this),this.listenTo(this.model,"filtered",this.onFiltered),this.listenTo(this.model,"change:total",this.updateSubtitles)},destroy:function(){r.unload()},serialize:function(){return{idPrefix:this.idPrefix,metrics:s.TABLE_AND_CHART_METRICS}},load:function(e){return r.loaded?e(this.model.fetch()):r.load().then(this.model.fetch.bind(this.model))},afterRender:function(){r.load(),this.updateSubtitles()},onFiltered:function(){this.promised(this.model.fetch()),this.broker.publish("router.navigate",{url:this.model.genClientUrl(),trigger:!1,replace:!0})},updateSubtitles:function(){var i=this,r=i.model.get("total");["ipr","ips","ipc"].forEach(function(s){i.$id(s+"-total").html(e("kaizenOrders","report:subtitle:"+s,{value:t.numberFormat(r[s],2)}))})}})});