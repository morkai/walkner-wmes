// Copyright (c) 2014, ≈Åukasz Walukiewicz <lukasz@walukiewicz.eu>. Some Rights Reserved.
// Licensed under CC BY-NC-SA 4.0 <http://creativecommons.org/licenses/by-nc-sa/4.0/>.
// Part of the walkner-wmes project <http://lukasz.walukiewicz.eu/p/walkner-wmes>

define(["underscore","app/core/views/DetailsView","../dictionaries","app/kaizenOrders/templates/details"],function(t,e,i,n){"use strict";var a={100:[12,0,0],"010":[0,12,0],"001":[0,0,12],110:[6,6,0],"011":[0,8,4],101:[6,0,6],111:[4,4,4]};return e.extend({template:n,currentTab:null,events:t.extend({'click a[data-toggle="tab"]':function(t){this.currentTab=t.currentTarget.dataset.tab}},e.prototype.events),serialize:function(){var i=this.model.get("types"),n=t.contains(i,"nearMiss"),s=t.contains(i,"suggestion"),r=t.contains(i,"kaizen"),o=a[(n?"1":"0")+(s?"1":"0")+(r?"1":"0")];return t.extend(e.prototype.serialize.call(this),{multi:!!window.KAIZEN_MULTI||this.model.isMulti(),showNearMissPanel:n,showSuggestionPanel:s,showKaizenPanel:r,nearMissColumnSize:o[0],suggestionColumnSize:o[1],kaizenColumnSize:o[2]})},afterRender:function(){e.prototype.afterRender.call(this);var n=this;this.$(".prop[data-dictionary]").each(function(){var e=i[this.dataset.dictionary].get(n.model.get(this.dataset.property));if(e){var a=e.get("description");t.isEmpty(a)||(this.classList.toggle("has-description",!0),this.dataset.description=a)}}),this.$el.popover({container:this.el,selector:".has-description",placement:function(t,e){if(window.innerWidth<=992)return"top";var i=n.$(e).closest(".panel").parent();return i[0]===i.parent().children().last()[0]?"top":"right"},trigger:"hover",content:function(){return this.dataset.description}}),this.$('a[data-tab="'+(this.currentTab||this.options.initialTab)+'"]').click()}})});