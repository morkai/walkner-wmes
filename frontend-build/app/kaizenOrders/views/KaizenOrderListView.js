// Copyright (c) 2014, ≈Åukasz Walukiewicz <lukasz@walukiewicz.eu>. Some Rights Reserved.
// Licensed under CC BY-NC-SA 4.0 <http://creativecommons.org/licenses/by-nc-sa/4.0/>.
// Part of the walkner-wmes project <http://lukasz.walukiewicz.eu/p/walkner-wmes>

define(["app/i18n","app/core/views/ListView"],function(t,e){"use strict";function i(t){return t.observer.notify&&t.observer.changes&&t.observer.changes[this.id]?'class="is-changed"':""}return e.extend({className:"kaizenOrders-list is-clickable",serializeColumns:function(){var e=[{id:"rid",className:"is-min is-number"}];return window.KAIZEN_MULTI&&e.push("types"),e.push({id:"status",tdAttrs:i},{id:"subject",tdAttrs:i,label:t("kaizenOrders","PROPERTY:subjectAndDescription")},{id:"eventDate",tdAttrs:i},{id:"area",tdAttrs:i},{id:"cause",tdAttrs:i},{id:"risk",tdAttrs:i},{id:"nearMissCategory",tdAttrs:i}),window.KAIZEN_MULTI&&e.push({id:"suggestionCategory",tdAttrs:i}),e.push({id:"section",tdAttrs:i},{id:"confirmer",tdAttrs:i},{id:"owners",label:t("kaizenOrders","PROPERTY:nearMissOwners")}),e},serializeActions:function(){var t=this.collection;return function(i){var s=t.get(i._id),r=[e.actions.viewDetails(s)];return s.canEdit()&&r.push(e.actions.edit(s)),s.canDelete()&&r.push(e.actions["delete"](s)),r}},afterRender:function(){e.prototype.afterRender.call(this);var t=this;this.$el.popover({selector:".list-item > td",container:this.el,trigger:"hover",placement:function(t,e){return"subject"===e.dataset.id?"auto right":"auto left"},html:!0,content:function(){var e=t.collection.get(this.parentNode.dataset.id);return"subject"===this.dataset.id?e.get("description"):"owners"===this.dataset.id?t.serializeOwnersPopoverContent(e):void 0}})},serializeOwnersPopoverContent:function(t){var e=t.get("owners");if(e.length<=1)return void 0;for(var i='<ul class="kaizenOrders-list-owners">',s=0;s<e.length;++s)i+="<li>"+e[s].rendered;return i+="</ul>"}})});