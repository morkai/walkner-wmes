define(["underscore","app/time","app/core/views/FilterView","app/core/util/forms/dateTimeRange","app/users/util/setUpUserSelect2","../dictionaries","app/kaizenOrders/templates/filter"],function(e,s,t,r,n,a,i){"use strict";return t.extend({template:i,events:e.assign({"click a[data-date-time-range]":r.handleRangeEvent,'change input[name="userType"]':"toggleUserSelect2","keyup select":function(e){if(27===e.keyCode)return e.target.selectedIndex=-1,!1},"dblclick select":function(e){e.target.selectedIndex=-1}},t.prototype.events),defaultFormData:function(){return{types:[].concat(a.types),status:[].concat(a.nmStatuses),section:null,area:null,category:null,risk:null,cause:null,userType:"others",user:null}},termToForm:{eventDate:r.rqlToForm,types:function(e,s,t){t[e]=s.args[1]},nearMissCategory:function(e,s,t){t.category="nearMiss."+s.args[1]},suggestionCategory:function(e,s,t){t.category="suggestion."+s.args[1]},"owners.id":function(e,s,t){t.userType="owner",t.user=s.args[1]},"observers.user.id":function(e,s,t){"mine"===s.args[1]?(t.userType="mine",t.user=null):"unseen"===s.args[1]?(t.userType="unseen",t.user=null):(t.userType="others",t.user=s.args[1])},status:function(e,s,t){t.status="in"===s.name?"open":s.args[1]},section:"types",area:"types",risk:"types",cause:"types"},serialize:function(){return e.assign(t.prototype.serialize.call(this),{multi:!!window.KAIZEN_MULTI,types:a.types,statuses:a.nmStatuses,sections:a.sections.toJSON(),areas:a.areas.toJSON(),nearMissCategories:e.invoke(a.categories.inNearMiss(),"toJSON"),suggestionCategories:e.invoke(a.categories.inSuggestion(),"toJSON"),risks:a.risks.toJSON(),causes:a.causes.toJSON()})},serializeFormToQuery:function(e){var s=this.$id("category").val().split("."),t=this.$('input[name="userType"]:checked').val(),n=this.$id("user").val(),a=this.$id("status").val();r.formToRql(this,e),2===s.length&&e.push({name:"eq",args:[s[0]+"Category",s[1]]}),"mine"===t||"unseen"===t?e.push({name:"eq",args:["observers.user.id",t]}):n&&e.push({name:"eq",args:["owner"===t?"owners.id":"observers.user.id",n]}),"open"===a?e.push({name:"in",args:["status",["new","accepted","todo","inProgress","paused"]]}):a&&e.push({name:"eq",args:["status",a]}),["types","section","area","risk","cause"].forEach(function(s){var t=this.$id(s).val();t&&e.push({name:"eq",args:[s,t]})},this)},afterRender:function(){t.prototype.afterRender.call(this),n(this.$id("user"),{view:this}),this.toggleUserSelect2()},toggleUserSelect2:function(){var e=this.$('input[name="userType"]:checked').val();this.$id("user").select2("enable","others"===e||"owner"===e)}})});