// Part of <https://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

define(["underscore","../core/Collection","./KanbanPrintQueue"],function(e,t,n){"use strict";return t.extend({model:n,rqlQuery:"todo=true&sort(createdAt)&limit(15)",initialize:function(){this.expanded=null,this.printing=!1},setUpPubsub:function(e){e.subscribe("kanban.printQueues.*",this.handleMessage.bind(this))},handleMessage:function(e,t){switch(t){case"kanban.printQueues.deleted":this.remove(this.get(e.model._id));break;case"kanban.printQueues.added":case"kanban.printQueues.edited":var n=this.get(e.model._id);n?n.set(e.model):0===this.rqlQuery.skip&&this.add(e.model);break;case"kanban.printQueues.updated":this.handleUpdateMessage(e)}},handleUpdateMessage:function(t){var n=this,i=n.get(t.queue._id);if(i){var s=t.job?[t.job]:t.jobs,a=[];e.forEach(s,function(t){var n=e.find(i.attributes.jobs,function(e){return e._id===t._id});n&&a.push(e.assign(n,t))}),i.set(t.queue),a.length&&i.trigger("change:jobs",a)}},isExpanded:function(e){return this.expanded===e},toggleExpand:function(e,t){e===this.expanded?t||(this.expanded=null):this.expanded=!1!==t?e:null,this.trigger("expand",this.expanded)},getPrintingWhat:function(){return localStorage.getItem("WMES_KANBAN_PRINTING_WHAT")||"job"},setPrintingWhat:function(e){localStorage.setItem("WMES_KANBAN_PRINTING_WHAT",e),this.trigger("printing",e)},getGroupByWorkstations:function(){return"1"===localStorage.getItem("WMES_KANBAN_GROUP_BY_WORKSTATIONS")},setGroupByWorkstations:function(e){return localStorage.setItem("WMES_KANBAN_GROUP_BY_WORKSTATIONS",e?"1":"0")}})});