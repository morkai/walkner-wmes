define(["underscore","../core/Collection","../data/localStorage","./KanbanPrintQueue"],function(e,t,n,i){"use strict";return t.extend({model:i,rqlQuery:"todo=true&sort(createdAt)&limit(15)",initialize:function(){this.expanded=null,this.printing=!1},setUpPubsub:function(e){e.subscribe("kanban.printQueues.*",this.handleMessage.bind(this))},handleMessage:function(e,t){switch(t){case"kanban.printQueues.deleted":this.remove(this.get(e.model._id));break;case"kanban.printQueues.added":this.get(e.model._id)||this.add(e.model);break;case"kanban.printQueues.edited":var n=this.get(e.model._id);n&&n.set(e.model);break;case"kanban.printQueues.updated":this.handleUpdateMessage(e)}},handleUpdateMessage:function(t){var n=this.get(t.queue._id);if(n){var i=t.job?[t.job]:t.jobs,s=[];e.forEach(i,function(t){var i=e.find(n.attributes.jobs,function(e){return e._id===t._id});i&&s.push(e.assign(i,t))}),n.set(t.queue),s.length&&n.trigger("change:jobs",n,s)}},isExpanded:function(e){return this.expanded===e},toggleExpand:function(e,t){e===this.expanded?t||(this.expanded=null):this.expanded=!1!==t?e:null,this.trigger("expand",this.expanded)},getPrintingWhat:function(){return n.getItem("WMES_KANBAN_PRINTING_WHAT")||"job"},setPrintingWhat:function(e){n.setItem("WMES_KANBAN_PRINTING_WHAT",e),this.trigger("printing",e)},getGroupByWorkstations:function(){return"1"===n.getItem("WMES_KANBAN_GROUP_BY_WORKSTATIONS")},setGroupByWorkstations:function(e){return n.setItem("WMES_KANBAN_GROUP_BY_WORKSTATIONS",e?"1":"0")}})});