// Part of <https://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

define(["underscore","../core/Collection","./KanbanPrintQueue"],function(e,n,t){"use strict";return n.extend({model:t,rqlQuery:"todo=true&sort(createdAt)&limit(15)",initialize:function(){this.expanded=null},setUpPubsub:function(e){e.subscribe("kanban.printQueues.*",this.handleMessage.bind(this))},handleMessage:function(e,n){switch(n){case"kanban.printQueues.deleted":this.remove(this.get(e.model._id));break;case"kanban.printQueues.added":case"kanban.printQueues.edited":var t=this.get(e.model._id);t?t.set(e.model):0===this.rqlQuery.skip&&this.add(e.model);break;case"kanban.printQueues.updated":this.handleUpdateMessage(e)}},handleUpdateMessage:function(n){var t=this,i=t.get(n.queue._id);if(i){var s=n.job?[n.job]:n.jobs,a=[];e.forEach(s,function(n){var t=e.find(i.attributes.jobs,function(e){return e._id===n._id});t&&a.push(e.assign(t,n))}),i.set(n.queue),a.length&&i.trigger("change:jobs",a)}},isExpanded:function(e){return this.expanded===e},toggleExpand:function(e,n){e===this.expanded?n||(this.expanded=null):this.expanded=!1!==n?e:null,this.trigger("expand",this.expanded)}})});