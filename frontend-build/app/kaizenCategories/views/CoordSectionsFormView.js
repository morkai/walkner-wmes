define(["app/core/View","app/core/util/idAndLabel","app/data/prodFunctions","app/users/util/setUpUserSelect2","app/kaizenOrders/dictionaries","app/kaizenCategories/templates/formCoordSections","app/kaizenCategories/templates/formCoordSection","i18n!app/nls/kaizenCategories","css!app/kaizenCategories/assets/coordSections"],function(e,t,i,o,n,s,c){"use strict";return e.extend({template:s,nlsDomain:"kaizenCategories",events:{'click [data-action="addCoordSection"]':function(){this.addCoordSection({section:null,filterSections:[],excludeSections:!1,coordinators:!0,funcs:[],mor:"none",users:[]})},'click [data-action="removeCoordSection"]':function(e){var t=this.$(e.target).closest(".kaizen-coordSections-section");t.find('input[tabindex="-1"]').select2("destroy"),t.remove()}},initialize:function(){this.coordSectionI=0},afterRender:function(){(this.model.get("coordSections")||[]).forEach(this.addCoordSection,this)},serializeForm:function(e){const t=this.$('input[name$=".users"]');return e.coordSections=(e.coordSections||[]).filter(e=>!!e.section).map((e,i)=>{const n=(e.funcs||"").split(",").filter(e=>!!e);return{section:e.section,filterSections:(e.filterSections||"").split(",").filter(e=>!!e),excludeSections:!0===e.excludeSections,coordinators:!0===e.coordinators,funcs:n,mor:n.length?e.mor:"none",users:o.getUserInfo(t.eq(i))}}),e},addCoordSection:function(e){var s=this.renderPartial(c,{i:this.coordSectionI++,coordSection:e});this.$id("coordSections").append(s);var r=n.sections.map(t);s.find('input[name$=".section"]').select2({width:"300px",data:[{id:"_section",text:this.t("coordSections:_section")}].concat(r)}),s.find('input[name$=".filterSections"]').select2({width:"300px",multiple:!0,data:r});var a=[{id:"_confirmer",text:this.t("coordSections:_confirmer")},{id:"_superior",text:this.t("coordSections:_superior")}].concat(i.map(t));s.find('input[name$=".funcs"]').select2({width:"300px",multiple:!0,data:a}),o(s.find('input[name$=".users"]'),{width:"300px",multiple:!0,currentUserInfo:e.users})}})});