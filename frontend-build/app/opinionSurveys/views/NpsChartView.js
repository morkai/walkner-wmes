define(["underscore","app/i18n","app/core/View","app/highcharts","app/data/colorFactory","../dictionaries"],function(e,t,i,r,s,a){"use strict";return i.extend({className:"opinionSurveys-report-npsChart",initialize:function(){this.chart=null,this.isLoading=!1;var e=this.model.report;this.listenTo(e,"request",this.onModelLoading),this.listenTo(e,"sync",this.onModelLoaded),this.listenTo(e,"error",this.onModelError),this.listenTo(e,"change:npsResponses",this.render)},destroy:function(){null!==this.chart&&(this.chart.destroy(),this.chart=null)},afterRender:function(){this.timers.createOrUpdateChart&&clearTimeout(this.timers.createOrUpdateChart),this.timers.createOrUpdateChart=setTimeout(this.createOrUpdateChart.bind(this),1)},createOrUpdateChart:function(){this.timers.createOrUpdateChart=null,this.chart?this.updateChart():(this.createChart(),this.isLoading&&this.chart.showLoading())},createChart:function(){this.chart=new r.Chart({chart:{type:"column",renderTo:this.el,height:500},exporting:{filename:t.bound("opinionSurveys","report:npsChart:filename")},title:{text:t.bound("opinionSurveys","report:npsChart:title")},noData:{},tooltip:{shared:!0,valueDecimals:0},legend:{enabled:!1},xAxis:{categories:this.serializeCategories()},yAxis:{min:0,title:{enabled:!1}},series:this.serializeSeries()})},serializeCategories:function(){return["1","2","3","4","5","6","7","8","9","10"]},serializeSeries:function(){var e=this.model.report.get("npsResponses");return[{id:"npsResponses",name:t.bound("opinionSurveys","report:npsChart:series"),data:e,dataLabels:{enabled:!0}}]},updateChart:function(){for(var t=this.chart;t.series.length;)t.series[0].remove(!1);t.xAxis[0].setCategories(this.serializeCategories(),!1),e.forEach(this.serializeSeries(),function(e){t.addSeries(e,!1)}),t.redraw()},onModelLoading:function(){this.isLoading=!0,this.chart&&this.chart.showLoading()},onModelLoaded:function(){this.isLoading=!1,this.chart&&this.chart.hideLoading()},onModelError:function(){this.isLoading=!1,this.chart&&this.chart.hideLoading()}})});