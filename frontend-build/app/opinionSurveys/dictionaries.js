define(["jquery","../broker","../pubsub","../user","../data/createSettings","../opinionSurveyDivisions/OpinionSurveyDivisionCollection","../opinionSurveyEmployers/OpinionSurveyEmployerCollection","../opinionSurveyQuestions/OpinionSurveyQuestionCollection","./OpinionSurveySettingCollection"],function(e,n,i,o,t,l,s,u,r){"use strict";var a=["divisions","employers","questions"],d=null,c=null,f=null,p=t(r),v={actionStatuses:["planned","progress","done","failed","late"],settings:p.acquire(),divisions:new l,employers:new s,questions:new u,loaded:!1,load:function(){return null!==c&&(clearTimeout(c),c=null),v.loaded?null:null!==d?d:((d=e.ajax({url:"/opinionSurveys/dictionaries"})).done(function(e){v.loaded=!0,a.forEach(function(n){v[n].reset(e[n])}),v.settings.reset(e.settings)}),d.fail(y),d.always(function(){d=null}),f=i.sandbox(),a.forEach(function(e){f.subscribe("opinionSurveys."+e+".**",g)}),d)},unload:function(){null!==c&&clearTimeout(c),c=setTimeout(y,3e4)},getLabel:function(e,n){if(!v[e])return n;var i=v[e].get(n);return i?i.getLabel():n}};function y(){c=null,null!==f&&(f.destroy(),f=null),v.loaded=!1,a.forEach(function(e){v[e].reset()}),p.release(),v.settings.reset([])}function g(e,i){var o=i.split("."),t=v[o[1]];if(t){switch(o[1]){case"added":t.add(e.model);break;case"edited":var l=t.get(e.model._id);l&&l.set(e.model);break;case"deleted":t.remove(t.get(e.model._id))}n.publish(i,e)}}return v});