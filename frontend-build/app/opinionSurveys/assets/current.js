function selectOption(e){$('.option.is-selected[data-group="'+e.attr("data-group")+'"]').removeClass("is-selected"),e.addClass("is-selected");var o=serializeValues(),i=0;SURVEY.questions.forEach(function(e){i+="na"===o.answers[e._id]?1:0}),$("#submit").prop("disabled",!o.employer||!o.superior||i===SURVEY.questions.length)}function serializeValues(){var e={comment:$("#comment").val().trim(),employer:$('.is-selected[data-group="employer"]').attr("data-value"),superior:$('.is-selected[data-group="superior"]').attr("data-value"),division:null,answers:{}};return SURVEY.superiors.forEach(function(o){e.superior===o._id&&(e.division=o.division)}),SURVEY.questions.forEach(function(o){e.answers[o._id]=$('.is-selected[data-group="'+o._id+'"]').attr("data-value")}),e}$("body").on("keydown",function(e){if(80===e.keyCode&&e.ctrlKey)return window.location.href="/opinionSurveys/"+SURVEY._id+".pdf",!1}),$("#submit").on("keydown",function(e){if(9===e.keyCode)return $("#comment").focus(),!1}).on("click",function(){$("#submit").prop("disabled",!0);var e=serializeValues(),o={_id:(Date.now().toString(36)+Math.round(1e9+8999999999*Math.random()).toString(36)).toUpperCase(),survey:SURVEY._id,scanTemplate:null,comment:e.comment,employer:e.employer,division:e.division,superior:e.superior,answers:Object.keys(e.answers).map(function(o){return{question:o,answer:e.answers[o]}})},i=$.ajax({method:"POST",url:"/opinionSurveys/responses?guest=1",data:JSON.stringify(o),dataType:"json",accepts:{json:"application/json"},contentType:"application/json"});return i.fail(function(){$("#submit").prop("disabled",!1),alert("Nie udało się wysłać ankiety.")}),i.done(function(){$("body").addClass("closed"),$("#bd").html("<p>Dziękujemy za wypełnienie ankiety!</p>"),window.scrollTo(0,0),setTimeout(function(){window.location.reload()},1e4)}),!1}),$("#bd").on("click",".label",function(e){selectOption($(e.currentTarget).find(".option"))}).on("keyup",".label",function(e){if(13===e.keyCode||32===e.keyCode)return selectOption($(e.currentTarget).find(".option")),!1});