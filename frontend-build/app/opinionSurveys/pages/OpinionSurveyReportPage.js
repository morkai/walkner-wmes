define(["jquery","app/i18n","app/core/View","app/core/util/bindLoadingMessage","../dictionaries","../OpinionSurveyCollection","../OpinionSurveyReport","../OpinionSurveyReportQuery","../views/OpinionSurveyReportFilterView","../views/ResponseCountTableView","../views/ResponseCountByDivisionChartView","../views/ResponseCountBySuperiorChartView","../views/ResponsePercentBySurveyChartView","../views/ResponsePercentByDivisionChartView","../views/AnswerCountBySurveyChartView","../views/AnswerCountBySuperiorChartView","../views/PositiveAnswerPercentBySurveyChartView","../views/PositiveAnswerPercentByDivisionChartView","../views/NpsTableView","../views/NpsChartView","app/opinionSurveys/templates/reportPage"],function(e,i,s,r,t,n,o,u,h,p,y,w,v,a,c,l,C,V,f,d,B){"use strict";return s.extend({layoutName:"page",template:B,breadcrumbs:[i.bound("opinionSurveys","BREADCRUMB:base"),i.bound("opinionSurveys","BREADCRUMB:report")],actions:function(){return[{label:i.bound("opinionSurveys","PAGE_ACTION:settings"),icon:"cogs",privileges:"OPINION_SURVEYS:MANAGE",href:"#opinionSurveys;settings?tab=reports"}]},initialize:function(){this.defineModels(),this.defineViews(),this.setView("#-filter",this.filterView),["responseCount","responseCountByDivision","responseCountBySuperior","responsePercentBySurvey","responsePercentByDivision","answerCountBySurvey","answerCountBySuperior","positiveAnswerPercentBySurvey","positiveAnswerPercentByDivision","npsTable","npsChart"].forEach(function(e){this.setView("#-"+e,this[e+"View"])},this)},defineModels:function(){this.surveys=r(new n(null,{rqlQuery:"sort(-startDate)"}),this),this.query=u.fromQuery(this.options.query),this.report=r(new o(null,{query:this.query}),this),this.listenTo(this.surveys,"reset",this.surveys.buildCacheMaps.bind(this.surveys)),this.listenTo(this.query,"change",this.onQueryChange)},defineViews:function(){var e={model:{surveys:this.surveys,report:this.report}};this.filterView=new h({surveys:this.surveys,query:this.query}),this.responseCountView=new p({model:{surveys:this.surveys,query:this.query,report:this.report}}),this.responseCountByDivisionView=new y(e),this.responseCountBySuperiorView=new w(e),this.responsePercentBySurveyView=new v(e),this.responsePercentByDivisionView=new a(e),this.answerCountBySurveyView=new c(e),this.answerCountBySuperiorView=new l(e),this.positiveAnswerPercentBySurveyView=new C(e),this.positiveAnswerPercentByDivisionView=new V(e),this.npsTableView=new f(e),this.npsChartView=new d(e)},destroy:function(){t.unload()},load:function(i){if(t.loaded)return i(this.surveys.fetch({reset:!0}),this.report.fetch());var s=this;return t.load().then(function(){return e.when(s.surveys.fetch({reset:!0}),s.report.fetch())})},afterRender:function(){t.load()},onQueryChange:function(e,i){i&&i.reset&&(this.broker.publish("router.navigate",{url:this.report.genClientUrl(),replace:!0,trigger:!1}),this.promised(this.report.fetch()))}})});