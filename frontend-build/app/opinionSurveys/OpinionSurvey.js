// Copyright (c) 2014, ≈Åukasz Walukiewicz <lukasz@walukiewicz.eu>. Some Rights Reserved.
// Licensed under CC BY-NC-SA 4.0 <http://creativecommons.org/licenses/by-nc-sa/4.0/>.
// Part of the walkner-wmes project <http://lukasz.walukiewicz.eu/p/walkner-wmes>

define(["underscore","../time","../core/Model","./dictionaries"],function(i,e,s,t){"use strict";return s.extend({urlRoot:"/opinionSurveys/surveys",clientUrlRoot:"#opinionSurveys",topicPrefix:"opinionSurveys.surveys",privilegePrefix:"OPINION_SURVEYS",nlsDomain:"opinionSurveys",labelAttribute:"label",serialize:function(){var i=this.toJSON();return i.startDate=e.format(i.startDate,"LL"),i.endDate=e.format(i.endDate,"LL"),i.superiors=this.serializeSuperiors(),i.employeeCount=this.serializeEmployeeCount(),i},serializeSuperiors:function(){return(this.get("superiors")||[]).map(function(i){var e=t.divisions.get(i.division);return e&&(i.division=e.get("full")),i})},serializeEmployeeCount:function(){return(this.get("employeeCount")||[]).map(function(i){var e=t.divisions.get(i.division);e&&(i.division=e.get("full"));var s=t.employers.get(i.employer);return s&&(i.employer=s.get("short")),i.count=i.count.toLocaleString(),i})},buildCacheMaps:function(){this.cacheMaps||this.on("change",this.buildCacheMaps);var e={employers:{},divisions:{},superiors:{},questions:{}};i.forEach(this.attributes.employers,function(i){e.employers[i._id]=i},this),i.forEach(this.attributes.questions,function(i){e.questions[i._id]=i},this),i.forEach(this.attributes.superiors,function(i){e.superiors[i._id]=i,e.divisions[i.division]||(e.divisions[i.division]=[]),e.divisions[i.division].push(i)},this),this.cacheMaps=e}},{})});