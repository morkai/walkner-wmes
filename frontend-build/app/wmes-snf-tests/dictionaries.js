define(["jquery","../broker","../pubsub","../wmes-snf-programs/ProgramCollection"],function(e,n,r,o){"use strict";var t={program:"programs"},l=null,u=null,a=null,i={programs:new o,loaded:!1,load:function(){return null!==u&&(clearTimeout(u),u=null),i.loaded?null:null!==l?l:((l=e.ajax({url:"/snf/dictionaries"})).done(function(e){i.loaded=!0,d(e)}),l.fail(s),l.always(function(){l=null}),a=r.sandbox(),Object.keys(t).forEach(function(e){a.subscribe("snf."+t[e]+".**",c)}),l)},unload:function(){null!==u&&clearTimeout(u),u=setTimeout(s,3e4)},getLabel:function(e,n){if("string"==typeof e&&(e=this.forProperty(e)||i[e]),!e||Array.isArray(e))return n;var r=e.get(n);return r?r.getLabel():n},forProperty:function(e){return this[t[e]]||null},bind:function(e){var n=this;return e.on("beforeLoad",function(e,r){r.push(n.load())}),e.on("afterRender",n.load.bind(n)),e.once("remove",n.unload.bind(n)),e}};function d(e){e&&e.types&&(i.types=e.types),Object.keys(t).forEach(function(n){var r=t[n];i[r].reset(e?e[r]:[])})}function s(){u=null,null!==a&&(a.destroy(),a=null),i.loaded=!1,d()}function c(e,r){var o=r.split("."),t=i[o[1]];if(t){switch(o[2]){case"added":t.add(e.model);break;case"edited":var l=t.get(e.model._id);l&&l.set(e.model);break;case"deleted":t.remove(t.get(e.model._id))}n.publish(r,e)}}return i});