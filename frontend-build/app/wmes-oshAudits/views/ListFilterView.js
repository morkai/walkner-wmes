define(["underscore","app/user","app/core/views/FilterView","app/core/util/idAndLabel","app/core/util/forms/dateTimeRange","app/core/util/forms/dropdownRadio","app/users/util/setUpUserSelect2","app/kaizenOrders/dictionaries","app/wmes-oshAudits/templates/filter","app/core/util/ExpandableSelect"],function(e,t,s,r,n,i,a,o,u){"use strict";return s.extend({template:u,filterList:[],filterMap:{},events:Object.assign({"click a[data-date-time-range]":n.handleRangeEvent,'change input[name="userType"]':function(){this.toggleUserSelect2(!0)},"keyup select":function(e){if(27===e.keyCode)return e.target.selectedIndex=-1,!1},"dblclick select":function(e){e.target.selectedIndex=-1}},s.prototype.events),defaultFormData:function(){return{status:[],section:[],userType:"others",user:null,anyNok:[!0,!1]}},termToForm:{date:n.rqlToForm,"auditor.id":function(e,t,s){s.userType="auditor",s.user=t.args[1]},"results.owner.id":function(e,t,s){s.userType="owner",s.user=t.args[1]},users:function(e,s,r){"mine"===s.args[1]?(r.userType="mine",r.user=t.data._id):(r.userType="others",r.user=s.args[1])},section:function(e,t,s){s[e]="in"===t.name?t.args[1]:[t.args[1]]},anyNok:function(e,t,s){s[e]=[t.args[1]]},status:"section"},getTemplateData:function(){return{sections:o.sections.forEntryType("audits").map(r)}},serializeFormToQuery:function(t){var s=this.$('input[name="userType"]').val(),r=this.$id("user").val(),i=this.getButtonGroupValue("anyNok");if(n.formToRql(this,t),"mine"===s)t.push({name:"eq",args:["users",s]});else if(r){var a;a="others"===s?"users":"owner"===s?"results.owner.id":s+".id",t.push({name:"eq",args:[a,r]})}1===i.length&&t.push({name:"eq",args:["anyNok","true"===i[0]]}),["status","section"].forEach(function(s){var r=this.$id(s).val()||[];"string"==typeof r&&(r=r.split(",")),1===(r=r.filter(function(t){return!e.isEmpty(t)})).length?t.push({name:"eq",args:[s,r[0]]}):r.length&&t.push({name:"in",args:[s,r]})},this)},afterRender:function(){s.prototype.afterRender.call(this),this.$(".is-expandable").expandableSelect(),a(this.$id("user"),{view:this,width:"275px",noPersonnelId:!0}),this.toggleButtonGroup("anyNok"),this.setUpUserType(),this.toggleUserSelect2(!1)},destroy:function(){s.prototype.destroy.call(this),this.$(".is-expandable").expandableSelect("destroy")},setUpUserType:function(){var e=this,t=["mine","others","auditor","owner"].map(function(t){return{value:t,optionLabel:e.t("filter:user:"+t)}});i(e.$id("userType"),{label:e.t("filter:user:others"),options:t})},toggleUserSelect2:function(e){var s=this.$('input[name="userType"]').val(),r="mine"===s||"unseen"===s,n=this.$id("user").select2("enable",!r);!e||!r&&n.val()||n.select2("data",{id:t.data._id,text:t.getLabel()})}})});