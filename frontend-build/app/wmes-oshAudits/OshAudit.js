define(["underscore","../i18n","../time","../user","../core/Model","app/kaizenOrders/dictionaries","app/core/templates/userInfo"],function(t,e,i,r,s,n,a){"use strict";var o=["date"],u=["createdAt","updatedAt"],c=["creator","updater","auditor"],d={new:"default",inProgress:"info",finished:"success",cancelled:"danger"};return s.extend({urlRoot:"/oshAudits",clientUrlRoot:"#oshAudits",topicPrefix:"oshAudits",privilegePrefix:"OSH_AUDITS",nlsDomain:"wmes-oshAudits",labelAttribute:"rid",serialize:function(t){var r=t&&t.longDateTime,s=r?"LL":"L",d=r?"LLLL":"L, LTS",l=this.toJSON();return l.status=e(this.nlsDomain,"status:"+l.status),l.section=n.sections.getLabel(l.section),o.forEach(function(t){l[t]=l[t]?i.format(l[t],s):null}),u.forEach(function(t){l[t]=l[t]?i.format(l[t],d):null}),c.forEach(function(t){l[t]=a(l[t])}),l.results=l.results.map(function(t){return Object.assign({},t)}),l},serializeDetails:function(){return this.serialize({longDateTime:!0})},serializeRow:function(t){var e=this.serialize(t);return e.className=d[this.get("status")],e.categories=e.results.filter(t=>!1===t.ok).map(t=>t.shortName).join("; "),e.anyNok&&(e.nok=e.results.filter(t=>!!t.comment)[0].comment),e},isCreator:function(){return this.attributes.creator&&this.attributes.creator.id===r.data._id},isAuditor:function(){return this.attributes.auditor&&this.attributes.auditor.id===r.data._id}},{can:{manage:function(){return r.isAllowedTo("OSH_AUDITS:MANAGE")},add:function(){return!!(this.can||this).manage()||n.isAuditor()},edit:function(t){return!!(this.can||this).manage()||(t.isCreator()||t.isAuditor())},delete:function(t){return!!(this.can||this).manage()||!!t.isCreator()&&Date.now()-Date.parse(t.get("updatedAt"))<288e5}}})});