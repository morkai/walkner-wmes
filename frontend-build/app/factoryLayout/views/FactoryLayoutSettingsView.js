define(["underscore","app/data/orgUnits","app/settings/views/SettingsView","app/factoryLayout/templates/settings"],function(t,e,i,s){"use strict";return i.extend({clientUrl:"#factoryLayout;settings",defaultTab:"blacklist",template:s,localTopics:{"divisions.synced":"render","subdivisions.synced":"render"},events:t.assign({"change [data-setting]":function(t){this.updateSetting(t.target.name,t.target.value)}},i.prototype.events),getTemplateData:function(){var i=this.settings;return{divisions:t.map(e.getAllByType("division"),function(t){var e="factoryLayout."+t.id+".color",s=i.get(e);return{property:e,label:t.getLabel(),color:s?s.get("value"):"#FFFFFF"}})}},afterRender:function(){i.prototype.afterRender.call(this),this.setUpBlacklistSelect2("division"),this.setUpBlacklistSelect2("subdivision"),this.setUpBlacklistSelect2("mrpController"),this.setUpBlacklistSelect2("prodFlow"),this.setUpBlacklistSelect2("workCenter"),this.setUpBlacklistSelect2("prodLine"),this.setUpQiKinds()},setUpBlacklistSelect2:function(t){this.$id("blacklist-"+t).select2({multiple:!0,data:e.getAllByType(t).map(function(e){return{id:e.id,text:("subdivision"===t?e.get("division")+" > ":"")+e.getLabel()}})})},setUpQiKinds:function(){var t=this.$id("qiKinds");t.select2({multiple:!0,data:[]}).select2("enable",!1),this.ajax({url:"/qi/kinds"}).done(function(e){t.select2({multiple:!0,data:e.collection.map(function(t){return{id:t._id,text:t.name}})}).select2("enable",!0)})},updateSettingField:function(t){if(/(blacklist|qiKinds)/.test(t.id))return this.$('input[name="'+t.id+'"]').select2("val",t.getValue())}})});