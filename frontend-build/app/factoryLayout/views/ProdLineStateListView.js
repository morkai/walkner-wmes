// Copyright (c) 2014, ≈Åukasz Walukiewicz <lukasz@walukiewicz.eu>. Some Rights Reserved.
// Licensed under CC BY-NC-SA 4.0 <http://creativecommons.org/licenses/by-nc-sa/4.0/>.
// Part of the walkner-wmes project <http://lukasz.walukiewicz.eu/p/walkner-wmes>

define(["underscore","jquery","d3","screenfull","app/viewport","app/core/View","app/factoryLayout/templates/list","./ProdLineStateListItemView"],function(e,i,n,t,s,o,r,h){return o.extend({template:r,events:{},initialize:function(){this.onKeyDown=this.onKeyDown.bind(this),this.onResize=e.debounce(this.onResize.bind(this),16),this.lastWidth=null,i("body").on("keydown",this.onKeyDown),i(window).on("resize",this.onResize),t.onchange=e.debounce(this.onFullscreen.bind(this),16)},destroy:function(){i("body").off("keydown",this.onKeyDown),i(window).off("resize",this.onResize),t.onchange=function(){}},beforeRender:function(){this.stopListening(this.model,"sync",this.render)},afterRender:function(){this.listenToOnce(this.model,"sync",this.render),this.getProdLineStates().forEach(this.renderProdLineState,this)},getProdLineStates:function(){if(this.listOptions.hasDivision())return this.model.prodLineStates.getForDivision(this.listOptions.get("division"));var e=[],i=this.listOptions.get("prodLines");if(Array.isArray(i))for(var n=0,t=i.length;t>n;++n){var s=this.model.prodLineStates.get(i[n]);s&&e.push(s)}return e},renderProdLineState:function(e){this.insertView(new h({model:e,keep:!1})).render()},onKeyDown:function(e){122!==e.which||t.isFullscreen||(e.preventDefault(),t.request(this.el.parentNode))},onResize:function(){window.innerWidth!==this.lastWidth&&(this.lastWidth=window.innerWidth,this.getViews().each(function(e){e.resize()}))},onFullscreen:function(){}})});