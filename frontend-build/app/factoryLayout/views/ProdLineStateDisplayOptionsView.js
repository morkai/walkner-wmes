define(["jquery","underscore","js2form","app/i18n","app/time","app/viewport","app/core/View","app/core/util/buttonGroup","app/core/util/getShiftStartInfo","app/factoryLayout/views/OrgUnitPickerView","app/factoryLayout/templates/displayOptions"],function(t,e,s,i,a,o,l,n,d,r,h){"use strict";return l.extend({template:h,events:{submit:function(t){t.preventDefault(),this.loadHistory()},'change [name="statuses[]"]':function(){this.model.set("statuses",n.getValue(this.$id("statuses")))},'change [name="states[]"]':function(){this.model.set("states",n.getValue(this.$id("states")))},'change [name="blacklisted"]':function(){this.model.set("blacklisted","1"===n.getValue(this.$id("blacklisted")))},"click #-showPicker":function(){var t=new r({model:{orgUnitType:this.model.get("orgUnitType"),orgUnitIds:this.model.get("orgUnitIds")}});this.listenTo(t,"picked",function(t,e){o.closeDialog(),this.model.set({orgUnitType:t,orgUnitIds:e})}),o.showDialog(t,this.t("picker:title"))},"click #-save":function(){this.model.save(),o.msg.show({type:"success",time:1e3,text:this.t("options:saved")})},"click #-resetHistory":function(){this.$id("from").val(""),this.$id("to").val(""),this.$id("shifts").find("input").prop("checked",!0),n.toggle(this.$id("shifts")),this.model.set({from:null,to:null,shifts:["1","2","3"]})}},getTemplateData:function(){return{minDate:window.PRODUCTION_DATA_START_DATE||"",maxDate:d(Date.now()).moment.format("YYYY-MM-DD")}},afterRender:function(){s(this.el,this.serializeFormData()),n.toggle(this.$id("statuses")),n.toggle(this.$id("states")),n.toggle(this.$id("blacklisted")),n.toggle(this.$id("shifts")),this.toggleHistoryData()},serializeFormData:function(){var t=this.model.get("from"),s=this.model.get("to");return{statuses:this.model.get("statuses"),states:this.model.get("states"),blacklisted:this.model.get("blacklisted")?"1":"0",from:e.isNumber(t)?a.format(t,"YYYY-MM-DD"):"",to:e.isNumber(s)?a.format(s,"YYYY-MM-DD"):"",shifts:this.model.get("shifts")}},loadHistory:function(){var t=this.$id("from"),e=this.$id("to"),s=this.$id("shifts"),i=a.getMoment(t.val()),l=a.getMoment(e.val());if(i.isValid()&&l.isValid()){if(i.valueOf()>l.valueOf()){var d=i;i=l,l=d}if(l.valueOf()===i.valueOf())l.add(1,"days");else if(l.valueOf()-i.valueOf()>6048e5)return o.msg.show({type:"warning",time:2500,text:this.t("msg:historyDataRange")});t.val(i.format("YYYY-MM-DD")),e.val(l.format("YYYY-MM-DD"));var r=n.getValue(s);0===r.length&&(r=["1","2","3"],s.find("input").prop("checked",!0),n.toggle(s)),this.model.set({from:i.valueOf(),to:l.valueOf(),shifts:r})}},toggleHistoryData:function(){var t=this.model.isHistoryData();this.$id("statuses").find(".btn").toggleClass("disabled",t),this.$id("states").find(".btn").toggleClass("disabled",t),this.$id("blacklisted").find(".btn").toggleClass("disabled",t),this.$id("save").toggleClass("disabled",t)}})});