define(["underscore","moment","select2","app/broker"],function(n,t,e,r){"use strict";var o={},i=[];function u(n,t,e){try{return o[n][t](e)}catch(e){if(o[n]&&o[n][t])throw e;return r.publish("i18n.missingKey",{domain:n,key:t}),t}}function c(n,t){return void 0!==o[n]&&"function"==typeof o[n][t]}function f(t){var e={};if(null==t)return e;for(var r=Object.keys(t),o=0,i=r.length;o<i;++o){var u=r[o],c=t[u];if(null!==c&&"object"==typeof c)for(var a=f(c),l=Object.keys(a),s=0,g=l.length;s<g;++s)e[u+"->"+l[s]]=String(a[l[s]]);else e[u]="_"===u.charAt(0)?String(c):n.escape(String(c))}return e}return u.config=null,u.translate=u,u.register=function(n,t,e){o[n]=t,"string"==typeof e&&i.push(e),r.publish("i18n.registered",{domain:n,keys:t,moduleId:e})},u.reload=function(o,c){var f="en";n.isObject(u.config)&&(f=u.config.locale,u.config.locale=o),i.forEach(require.undef);var a=[].concat(i);"en"!==o&&a.unshift("moment-lang/"+o),a.unshift("select2-lang/"+o),require(a,function(){t.locale(o),e.lang(o),r.publish("i18n.reloaded",{oldLocale:f,newLocale:o}),n.isFunction(c)&&c()})},u.bound=function(n,t,e){function r(){return u(n,t,e)}return r.toString=r,r},u.has=c,u.flatten=f,u.forDomain=function(n){var t=function(t,e,r){return"object"==typeof e?u(n,t,e):"string"==typeof e||r?u(t,e,r):u(n,t)};return t.translate=t,t.bound=function(n,e,r){function o(){return t(n,e,r)}return o.toString=o,o},t.has=function(t,e){return e?c(t,e):c(n,t)},t.flatten=f,t},window.i18n=u,u});