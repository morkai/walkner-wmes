define(["app/core/View","app/users/util/setUpUserSelect2","app/wmes-osh-common/dictionaries","app/wmes-osh-common/templates/coordinators/form"],function(t,e,i,s){"use strict";return t.extend({template:s,nlsDomain:"wmes-osh-common",events:{"click #-add":function(){this.add({types:[],kinds:[],users:[]})},'click .btn[data-action="remove"]':function(t){const e=this.$(t.target).closest("tr");e.fadeOut("fast",()=>e.find("input").select2("destroy"))}},getTemplateData:function(){return{kinds:!1!==this.options.kinds}},serializeForm:function(){return this.$("tbody").children().map((t,i)=>{const s=this.$(i);return{types:s.find('input[name$="types"]').select2("data").map(t=>t.id),kinds:!1===this.options.kinds?[]:s.find('input[name$="kinds"]').select2("data").map(t=>t.id),users:e.getUserInfo(s.find('input[name$="users"]'))}}).get().filter(t=>t.users.length>0)},afterRender:function(){this.model.get("coordinators").forEach(this.add,this),this.$id("add").click()},add:function({types:t,kinds:s,users:n}){this.$tpl||(this.$tpl=this.$("tbody").children().first().detach());const a=this.$tpl.clone();this.$("tbody").append(a),a.find('input[name$="types"]').val(t.join(",")).select2({width:"370px",multiple:!0,allowClear:!0,placeholder:this.t("coordinators:all"),data:i.entryTypes.map(t=>({id:t,text:this.t(`type:${t}`)}))}),!1!==this.options.kinds&&a.find('input[name$="kinds"]').select2({width:"370px",multiple:!0,allowClear:!0,placeholder:this.t("coordinators:all"),data:i.kinds.map(t=>({id:t.id,text:t.getLabel()}))}).select2("data",s.map(t=>({id:t,text:i.kinds.getLabel(t)}))),e(a.find('input[name$="users"]'),{width:"auto",multiple:!0,currentUserInfo:n})}})});