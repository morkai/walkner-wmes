define(["underscore","jquery","app/viewport","app/core/views/FormView"],function(i,t,n,o){"use strict";return o.extend({events:Object.assign({"click #-cancel":function(){n.currentDialog===this?n.closeDialog():window.history.length?window.history.back():window.location.href=this.model.genClientUrl("base")},change:function(){this.dirty=!0}},o.prototype.events),initialize:function(){o.prototype.initialize.apply(this,arguments),this.dirty=!1,t(document).on(`click.${this.idPrefix}`,"a",this.onLinkClick.bind(this)),t(window).on(`beforeunload.${this.idPrefix}`,this.onWindowBeforeUnload.bind(this)),this.on("afterRender",()=>this.dirty=!1)},destroy:function(){o.prototype.destroy.apply(this,arguments),t(document).off(`.${this.idPrefix}`),t(window).off(`.${this.idPrefix}`)},showUnsavedDialog:function(i){const t=Date.now();window.confirm(this.t("wmes-osh-common","FORM:unsaved"))||Date.now()-t<100?(this.dirty=!1,i.click()):document.body.click()},onLinkClick:function(i){if(!this.dirty||0!==i.button)return;const t=i.currentTarget,n=t.getAttribute("href");return n&&!n.startsWith("javascript")&&"_blank"!==t.target?(this.showUnsavedDialog(t),!1):void 0},onWindowBeforeUnload:function(i){if(this.dirty)return i.originalEvent.returnValue=this.t("wmes-osh-common","FORM:unsaved")}})});