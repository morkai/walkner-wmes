define(["jquery","underscore","js2form","select2","app/i18n","app/data/orgUnits","app/data/localStorage","app/core/View","app/orgUnits/templates/pickerDialog"],function(t,e,i,n,r,o,a,s,c){"use strict";return s.extend({template:c,events:{submit:function(t){t.preventDefault();var e=this.$('input[name="orgUnitType"]:checked').val(),i=this.$id(e).select2("val");this.trigger("picked",e,i)},'change input[type="radio"]':function(t){this.$id(t.currentTarget.value).select2("focus")},"click #-deactivated":function(){var t="1"===(a.getItem("WMES:OrgUnitPicker:deactivated")||"0")?"0":"1";a.setItem("WMES:OrgUnitPicker:deactivated",t),this.$id("deactivated").toggleClass("active","1"===t),this.setUpOrgUnitsSelect2()},"change .orgUnits-picker-orgUnits":function(t){this.$(t.target).closest(".form-group").find('input[type="radio"]').click()}},initialize:function(){this.model.orgUnitTypes||(this.model.orgUnitTypes=["division","subdivision","mrpControllers","prodFlow","workCenter","prodLine"])},getTemplateData:function(){var t=this;return{orgUnits:t.model.orgUnitTypes.map(function(e){return{type:e,label:t.model.resolveLabel(e)}}),deactivated:"1"===a.getItem("WMES:OrgUnitPicker:deactivated")}},afterRender:function(){i(this.el,this.serializeFormData()),this.setUpOrgUnitsSelect2()},onDialogShown:function(){var t=this.$('input[name="orgUnitType"]:checked').val();t?this.$id(t).select2("focus"):this.$('input[name="orgUnitType"]').last().click()},serializeFormData:function(){var t={orgUnitType:this.model.orgUnitType};return t[t.orgUnitType]=this.model.orgUnitIds.join(","),t},setUpOrgUnitsSelect2:function(){this.model.orgUnitTypes.forEach(this.setUpOrgUnitSelect2,this)},setUpOrgUnitSelect2:function(t){var i="1"===a.getItem("WMES:OrgUnitPicker:deactivated"),r=this.createSubdivisionFilter(),s=o.getAllByType(t).filter(function(t){return i||!t.get("deactivatedAt")}).map(function(e){if("division"===t&&"prod"!==e.get("type"))return null;var i,n;if("subdivision"===t){if("storage"===e.get("type"))return null;i=e.get("division")+" > "+e.getLabel()}else"mrpControllers"===t?(i=e.id+": "+e.get("description"),n=e.id):i=e.getLabel();return"division"===t||r(e)?{id:e.id,selection:n,text:i,deactivated:!!e.get("deactivatedAt")}:null}).filter(function(t){return null!==t}).sort(function(t,e){return t.text.localeCompare(e.text)});return this.$id(t).select2({multiple:!0,data:s,formatSelection:function(t){var i=e.escape(t.selection||t.text);return t.deactivated?'<span style="text-decoration: line-through">'+i+"</span>":i},formatResult:function(t,e,i,r){var o=[];return o.push('<span style="text-decoration: '+(t.deactivated?"line-through":"initial")+'">'),n.util.markMatch(t.selection||t.text,i.term,o,r),o.push("</span>"),o.join("")}})},createSubdivisionFilter:function(){var t=this.model.subdivisionFilter;return Array.isArray(t)?function(e){var i=e.getSubdivision(),n=i&&i.get("type");return-1!==t.indexOf(n)}:"function"==typeof t?t:function(){return!0}}})});