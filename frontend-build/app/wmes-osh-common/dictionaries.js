define(["jquery","app/broker","app/pubsub","app/user","app/i18n","app/wmes-osh-workplaces/WorkplaceCollection","app/wmes-osh-divisions/DivisionCollection","app/wmes-osh-buildings/BuildingCollection","app/wmes-osh-locations/LocationCollection","app/wmes-osh-kinds/KindCollection","app/wmes-osh-eventCategories/EventCategoryCollection","app/wmes-osh-reasonCategories/ReasonCategoryCollection","./SettingCollection"],function(e,o,n,i,s,t,r,a,l,u,d,c,p){"use strict";var g={workplace:"workplaces",division:"divisions",building:"buildings",location:"locations",kind:"kinds",eventCategory:"eventCategories",reasonCategory:"reasonCategories"},f=null,y=null,b=null,w={statuses:{nearMiss:[]},priorities:[],kindTypes:[],settings:new p,workplaces:new t,divisions:new r,buildings:new a,locations:new l,kinds:new u,eventCategories:new d,reasonCategories:new c,loaded:!1,load:function(){return null!==y&&(clearTimeout(y),y=null),w.loaded?null:null!==f?f:((f=e.ajax({url:"/osh/dictionaries"})).done(e=>{w.loaded=!0,m(e)}),f.fail(h),f.always(()=>f=null),b=n.sandbox(),Object.keys(g).forEach(e=>{b.subscribe(`osh.${g[e]}.**`,v)}),w.settings.setUpPubsub(b),f)},unload:function(){null!==y&&clearTimeout(y),y=setTimeout(h,3e4)},getLabel:function(e,o,n){if("priority"===e)return s("wmes-osh-common",`priority:${o}`);if("status"===e)return s("wmes-osh-common",`status:${o}`);if("string"==typeof e&&(e=this.forProperty(e)||w[e]),!e||Array.isArray(e))return o;var i=e.get(o);return i?i.getLabel(n):o},getDescription:function(e,o){if("string"==typeof e&&(e=this.forProperty(e)||w[e]),!e||Array.isArray(e))return"";var n=e.get(o);return n&&n.get("description")||""},forProperty:function(e){return this[g[e]]||null},bind:function(e){var o=this;return e.on("beforeLoad",(e,n)=>{n.push(o.load())}),e.on("afterRender",o.load.bind(o)),e.once("remove",o.unload.bind(o)),e}};function m(e){e&&["statuses","priorities","kindTypes"].forEach(o=>{e[o]&&(w[o]=e[o])}),Object.keys(g).forEach(o=>{var n=g[o];Array.isArray(w[n])?w[n]=e?e[n]:[]:w[n]&&w[n].reset&&w[n].reset(e?e[n]:[])}),w.settings.reset(e?e.settings:[])}function h(){y=null,null!==b&&(b.destroy(),b=null),w.loaded=!1,m()}function v(e,n){var i=n.split("."),s=w[i[1]];if(s){switch(i[2]){case"added":s.add(e.model);break;case"edited":var t=s.get(e.model._id);t&&t.set(e.model);break;case"deleted":s.remove(s.get(e.model._id))}o.publish(n,e)}}return w});