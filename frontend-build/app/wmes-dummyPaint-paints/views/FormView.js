define(["app/core/views/FormView","app/wmes-dummyPaint-orders/dictionaries","app/wmes-dummyPaint-paints/templates/form"],function(e,t,i){"use strict";return e.extend({template:i,events:Object.assign({"change #-code":"scheduleDuplicateCheck","change #-family":"scheduleDuplicateCheck"},e.prototype.events),getTemplateData:function(){return{paintCodes:t.paintCodes,paintFamilies:t.paintFamilies}},scheduleDuplicateCheck:function(){this.options.editMode||(this.$id("duplicateKey").addClass("hidden"),this.checkReq&&(this.checkReq.abort(),this.checkReq=null),clearTimeout(this.timers.checkDuplicate),this.timers.checkDuplicate=setTimeout(this.checkDuplicate.bind(this),250),this.$(".btn-primary").prop("disabled",!0))},checkDuplicate:function(){var e=this,t=e.$id("code").val().trim().toUpperCase(),i=e.$id("family").val().trim().toUpperCase();if(!t||!i)return e.$id("duplicateKey").addClass("hidden"),void e.$(".btn-primary").prop("disabled",!1);var a=e.checkReq=e.ajax({method:"GET",url:"/dummyPaint/paints?code="+encodeURIComponent(t)+"&family="+encodeURIComponent(i)});a.fail(function(){e.$id("duplicateKey").addClass("hidden")}),a.done(function(t){1===t.totalCount?e.$id("duplicateKey").attr("href","#dummyPaint/paints/"+t.collection[0]._id+";edit").removeClass("hidden"):e.$id("duplicateKey").addClass("hidden")}),a.done(function(){e.$(".btn-primary").prop("disabled",!1)})},getFailureText:function(t){return t.responseJSON&&t.responseJSON.error&&"DUPLICATE_KEY"===t.responseJSON.error.code?this.t("FORM:ERROR:duplicateKey"):e.prototype.getFailureText.apply(this,arguments)}})});