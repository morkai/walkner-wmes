// Copyright (c) 2014, ≈Åukasz Walukiewicz <lukasz@walukiewicz.eu>. Some Rights Reserved.
// Licensed under CC BY-NC-SA 4.0 <http://creativecommons.org/licenses/by-nc-sa/4.0/>.
// Part of the walkner-wmes project <http://lukasz.walukiewicz.eu/p/walkner-wmes>

define(["underscore","js2form","form2js","app/i18n","app/viewport","app/core/View","app/purchaseOrders/templates/vendorPrintDialog","../labelConfigurations"],function(t,e,r,i,a,n,s,o){"use strict";return n.extend({dialogClassName:"pos-vendorPrintDialog",template:s,events:{"focus .form-control":"toggleRowFocus","blur .form-control":"toggleRowFocus","blur .pos-printDialog-qty":function(t){var e=this.parseQty(t.target.value,void 0!==t.target.dataset.integer);t.target.value=Math.min(t.target.max,e).toLocaleString()},submit:"submitForm"},initialize:function(){this.decimalSeparator=1.1.toLocaleString().substr(1,1)},serialize:function(){return{idPrefix:this.idPrefix,printers:this.options.printers,labelTypes:o.getVendorLabelTypes(),items:this.model}},afterRender:function(){e(this.el,{items:this.model})},toggleRowFocus:function(t){t.currentTarget.parentNode.parentNode.classList.toggle("is-focused")},submitForm:function(){return this.trigger("print",this.serializeFormData()),!1},serializeFormData:function(){var e=r(this.el);return e.items=e.items.filter(function(e){return e.labelCount=this.parseQty(e.labelCount),e.value=t.isString(e.value)?e.value.trim():"",e.unit=t.isString(e.unit)?e.unit.trim():"",e.labelCount>0&&!t.isEmpty(e.value)},this),e},parseQty:function(t,e){var r=String(t).split(this.decimalSeparator),i=parseInt(r[0].replace(/[^0-9]+/g,""),10),a=r.length>1?parseInt(r[1].replace(/[^0-9]+/g,""),10):0;return i=isNaN(i)?"0":i.toString(),a=isNaN(a)?"0":a.toString(),e||"0"===a?"0"===i?0:parseInt(i,10):parseFloat(i+"."+a.substr(0,3))}})});