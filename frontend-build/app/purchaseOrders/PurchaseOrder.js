// Copyright (c) 2014, ≈Åukasz Walukiewicz <lukasz@walukiewicz.eu>. Some Rights Reserved.
// Licensed under CC BY-NC-SA 4.0 <http://creativecommons.org/licenses/by-nc-sa/4.0/>.
// Part of the walkner-wmes project <http://lukasz.walukiewicz.eu/p/walkner-wmes>

define(["underscore","../i18n","../time","../core/Model","./PurchaseOrderItemCollection"],function(e,t,r,i,d){return i.extend({urlRoot:"/purchaseOrders",clientUrlRoot:"#purchaseOrders",topicPrefix:"purchaseOrders",privilegePrefix:"PURCHASE_ORDERS",nlsDomain:"purchaseOrders",labelAttribute:"_id",defaults:{},getFirstScheduledQuantity:function(e){return this.get("items").get(e).get("schedule")[0].qty},parse:function(e,t){return e=i.prototype.parse.call(this,e,t),t.update?(this.get("items").set(e.items),delete e.items):e.items=new d(e.items),e},update:function(e){var t=e.items;t&&(delete e.items,this.get("items").set(t)),this.set(e)},serialize:function(){var e=this.toJSON();e.docDate=r.getMoment(e.docDate).utc().format("LL"),e.vendor&&e.vendor._id?(e.vendorText=e.vendor._id,e.vendor.name.length&&(e.vendorText+=": "+e.vendor.name)):e.vendorText=e.vendor,e.items=e.items?e.items.invoke("serialize"):[];var t=this.get("items").getMinScheduleDate();return e.minScheduleDate=t?r.getMoment(t).utc().format("YYYY-MM-DD"):null,e.className=e.open?"":"success",e.qty=e.qty.toLocaleString(),e.printedQty=e.printedQty.toLocaleString(),e.importedAt&&(e.importedAtText=r.format(e.importedAt,"LLLL")),e.createdAt&&(e.createdAtText=r.format(e.createdAt,"LLLL")),e.updatedAt&&(e.updatedAtText=r.format(e.updatedAt,"LLLL")),e}})});