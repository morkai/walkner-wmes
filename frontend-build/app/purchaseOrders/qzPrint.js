// Part of <https://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

define(["jquery","deployJava","app/broker","app/purchaseOrders/templates/qzPrintInitWarning"],function(n,e,i,r){"use strict";function t(){null===c&&p.length&&(c=p.shift(),a.findPrinter(c.printerName,function(n){return n?c.done(n):void c.append(c.print)}))}function o(){n("body").prepend(r())}function u(){n("#qzPrintInitWarning").remove()}var d=5e3,l=null,p=[],c=null,a={};return a.isLoaded=function(){if(null===l)return!1;try{if(!l.isActive())return!1}catch(n){return!1}return!0},a.isPrinting=function(){return null!==c},a.load=function(){var n={id:"qz",code:"qz.PrintApplet.class",archive:"qz-print.jar",width:1,height:1},i={jnlp_href:"/vendor/qz-print/qz-print_jnlp.jnlp",cache_option:"plugin",disable_logging:"false",initial_focus:"false"};e.versionCheck("1.7+")||e.versionCheck("1.6.0_45+")||!e.versionCheck("1.6+")||delete i.jnlp_href,e.runApplet(n,i,"1.5")},a.findPrinter=function(n,e){if(!this.isLoaded())return e(new Error("PLUGIN_NOT_LOADED"));var i=setTimeout(function(){return window.qzDoneFinding=null,e(new Error("FIND_PRINT_TIMEOUT"))},d);window.qzDoneFinding=function(){clearTimeout(i),window.qzDoneFinding=null;var n=l.getPrinter();return null===n?e(new Error("PRINTER_NOT_FOUND")):e(null,n)},l.findPrinter(n)},a.findPrinters=function(n){if(!this.isLoaded())return n(new Error("PLUGIN_NOT_LOADED"));var e=setTimeout(function(){return window.qzDoneFinding=null,n(new Error("FIND_PRINTERS_TIMEOUT"))},d);window.qzDoneFinding=function(){return clearTimeout(e),window.qzDoneFinding=null,n(null,l.getPrinters().split(",").filter(function(n){return n.length}))},l.findPrinter("\\{dummy_printer\\}")},a.printRaw=function(n,e,i){return this.isLoaded()?(p.push({type:"raw",printerName:n,done:function(n){c=null,i(n)},append:function(n){l.append(e),n()},print:function(){l.print()}}),void t()):i(new Error("PLUGIN_NOT_LOADED"))},a.printPdf=function(n,e,i,r){return this.isLoaded()?(p.push({type:"pdf",printerName:n,done:function(n){c=null,r(n)},append:function(n){l.setPaperSize(i.width,i.height,"mm"),l.setOrientation(i.orientation),l.setAutoSize(!0),l.appendPDF(e),window.qzDoneAppending=function(){window.qzDoneAppending=null,n()}},print:function(){l.printPS()}}),void t()):r(new Error("PLUGIN_NOT_LOADED"))},window.qzReady=function(){l=document.getElementById("qz");try{l.getVersion(),u()}catch(n){l=null,o()}},window.qzDonePrinting=function(){var n=l.getException();n?(n=new Error(n.getLocalizedMessage()),l.clearException(),c.done(n)):null!==c&&c.done()},i.subscribe("router.executing").setLimit(1).on("message",function(){document.getElementById("qzPrintInitWarning")||window.qzReady()}),window.qzPrint=a,a});