// Copyright (c) 2014, ≈Åukasz Walukiewicz <lukasz@walukiewicz.eu>. Some Rights Reserved.
// Licensed under CC BY-NC-SA 4.0 <http://creativecommons.org/licenses/by-nc-sa/4.0/>.
// Part of the walkner-wmes project <http://lukasz.walukiewicz.eu/p/walkner-wmes>

define(["jquery","deployJava","app/purchaseOrders/templates/qzPrintInitWarning"],function(n,i,r){function e(){}function t(){n("body").prepend(r())}var o=5e3,u=null,d=[],l={};return l.isLoaded=function(){if(null===u)return!1;try{if(!u.isActive())return!1}catch(n){return!1}return!0},l.load=function(){var n={id:"qz",code:"qz.PrintApplet.class",archive:"qz-print.jar",width:1,height:1},r={jnlp_href:"/vendor/qz-print/qz-print_jnlp.jnlp",cache_option:"plugin",disable_logging:"false",initial_focus:"false"};i.versionCheck("1.7+")||i.versionCheck("1.6.0_45+")||!i.versionCheck("1.6+")||delete r.jnlp_href,i.runApplet(n,r,"1.5")},l.findPrinter=function(n,i){if(!this.isLoaded())return i(new Error("NOT_LOADED"));var r=setTimeout(function(){return window.qzDoneFinding=null,i(new Error("TIMEOUT"))},o);window.qzDoneFinding=function(){clearTimeout(r),window.qzDoneFinding=null;var n=u.getPrinter();return null===n?i(new Error("NOT_FOUND")):i(null,n)},u.findPrinter(n)},l.findPrinters=function(n){if(!this.isLoaded())return n(new Error("NOT_LOADED"));var i=setTimeout(function(){return window.qzDoneFinding=null,n(new Error("TIMEOUT"))},o);window.qzDoneFinding=function(){return clearTimeout(i),window.qzDoneFinding=null,n(null,u.getPrinters().split(",").filter(function(n){return!!n}))},u.findPrinter("\\{bogus_printer\\}")},l.rawPrint=function(n,i,r){return this.isLoaded()?(d.push({printerName:n,data:i,done:r}),void e()):r(new Error("NOT_LOADED"))},window.qzReady=function(){u=document.getElementById("qz");try{u.getVersion()}catch(n){u=null,t()}},window.qzDonePrinting=function(){var n=u.getException();n&&u.clearException()},window.qzPrint=l,l});