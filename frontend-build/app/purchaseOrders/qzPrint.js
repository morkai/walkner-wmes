// Part of <https://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

define(["jquery","deployJava","app/broker","app/purchaseOrders/templates/qzPrintInitWarning"],function(n,e,i,r){"use strict";function t(){null===p&&l.length&&(p=l.shift(),c.findPrinter(p.printerName,function(n){if(n)return p.done(n);p.append(p.print)}))}function o(){n("body").prepend(r())}function u(){n("#qzPrintInitWarning").remove()}var d=null,l=[],p=null,c={};return c.isLoaded=function(){if(null===d)return!1;try{if(!d.isActive())return!1}catch(n){return!1}return!0},c.isPrinting=function(){return null!==p},c.load=function(){var n={id:"qz",code:"qz.PrintApplet.class",archive:"qz-print.jar",width:1,height:1},i={jnlp_href:"/vendor/qz-print/qz-print_jnlp.jnlp",cache_option:"plugin",disable_logging:"false",initial_focus:"false"};e.versionCheck("1.7+")||e.versionCheck("1.6.0_45+")||!e.versionCheck("1.6+")||delete i.jnlp_href,e.runApplet(n,i,"1.5")},c.findPrinter=function(n,e){if(!this.isLoaded())return e(new Error("PLUGIN_NOT_LOADED"));var i=setTimeout(function(){return window.qzDoneFinding=null,e(new Error("FIND_PRINT_TIMEOUT"))},5e3);window.qzDoneFinding=function(){clearTimeout(i),window.qzDoneFinding=null;var n=d.getPrinter();return null===n?e(new Error("PRINTER_NOT_FOUND")):e(null,n)},d.findPrinter(n)},c.findPrinters=function(n){if(!this.isLoaded())return n(new Error("PLUGIN_NOT_LOADED"));var e=setTimeout(function(){return window.qzDoneFinding=null,n(new Error("FIND_PRINTERS_TIMEOUT"))},5e3);window.qzDoneFinding=function(){return clearTimeout(e),window.qzDoneFinding=null,n(null,d.getPrinters().split(",").filter(function(n){return n.length}))},d.findPrinter("\\{dummy_printer\\}")},c.printRaw=function(n,e,i){if(!this.isLoaded())return i(new Error("PLUGIN_NOT_LOADED"));l.push({type:"raw",printerName:n,done:function(n){p=null,i(n)},append:function(n){d.append(e),n()},print:function(){d.print()}}),t()},c.printPdf=function(n,e,i,r){if(!this.isLoaded())return r(new Error("PLUGIN_NOT_LOADED"));l.push({type:"pdf",printerName:n,done:function(n){p=null,r(n)},append:function(n){d.setPaperSize(i.width,i.height,"mm"),d.setOrientation(i.orientation),d.setAutoSize(!0),d.appendPDF(e),window.qzDoneAppending=function(){window.qzDoneAppending=null,n()}},print:function(){d.printPS()}}),t()},window.qzReady=function(){d=document.getElementById("qz");try{d.getVersion(),u()}catch(n){d=null,o()}},window.qzDonePrinting=function(){var n=d.getException();n?(n=new Error(n.getLocalizedMessage()),d.clearException(),p.done(n)):null!==p&&p.done()},i.subscribe("router.executing").setLimit(1).on("message",function(){document.getElementById("qzPrintInitWarning")||window.qzReady()}),window.qzPrint=c,c});