define(["jquery","deployJava","app/broker","app/purchaseOrders/templates/qzPrintInitWarning"],function(n,e,i,r){"use strict";var t=null,o=[],u=null,d={};function l(){null===u&&o.length&&(u=o.shift(),d.findPrinter(u.printerName,function(n){if(n)return u.done(n);u.append(u.print)}))}return d.isLoaded=function(){if(null===t)return!1;try{if(!t.isActive())return!1}catch(n){return console.error(n),!1}return!0},d.isPrinting=function(){return null!==u},d.load=function(){var n={jnlp_href:"/vendor/qz-print/qz-print_jnlp.jnlp",cache_option:"plugin",disable_logging:"false",initial_focus:"false"};e.versionCheck("1.7+")||e.versionCheck("1.6.0_45+")||!e.versionCheck("1.6+")||delete n.jnlp_href,e.runApplet({id:"qz",code:"qz.PrintApplet.class",archive:"qz-print.jar",width:1,height:1},n,"1.5")},d.findPrinter=function(n,e){if(!this.isLoaded())return e(new Error("PLUGIN_NOT_LOADED"));var i=setTimeout(function(){return window.qzDoneFinding=null,e(new Error("FIND_PRINT_TIMEOUT"))},5e3);window.qzDoneFinding=function(){clearTimeout(i),window.qzDoneFinding=null;var n=t.getPrinter();return null===n?e(new Error("PRINTER_NOT_FOUND")):e(null,n)},t.findPrinter(n)},d.findPrinters=function(n){if(!this.isLoaded())return n(new Error("PLUGIN_NOT_LOADED"));var e=setTimeout(function(){return window.qzDoneFinding=null,n(new Error("FIND_PRINTERS_TIMEOUT"))},5e3);window.qzDoneFinding=function(){return clearTimeout(e),window.qzDoneFinding=null,n(null,t.getPrinters().split(",").filter(function(n){return n.length}))},t.findPrinter("\\{dummy_printer\\}")},d.printRaw=function(n,e,i){if(!this.isLoaded())return i(new Error("PLUGIN_NOT_LOADED"));o.push({type:"raw",printerName:n,done:function(n){u=null,i(n)},append:function(n){t.append(e),n()},print:function(){t.print()}}),l()},d.printPdf=function(n,e,i,r){if(!this.isLoaded())return r(new Error("PLUGIN_NOT_LOADED"));o.push({type:"pdf",printerName:n,done:function(n){u=null,r(n)},append:function(n){t.setPaperSize(i.width,i.height,"mm"),t.setOrientation(i.orientation),t.setAutoSize(!0),t.appendPDF(e),window.qzDoneAppending=function(){window.qzDoneAppending=null,n()}},print:function(){t.printPS()}}),l()},window.qzReady=function(){t=document.getElementById("qz");try{t.getVersion(),n("#qzPrintInitWarning").remove()}catch(e){t=null,n("body").prepend(r())}},window.qzDonePrinting=function(){var n=t.getException();n?(n=new Error(n.getLocalizedMessage()),t.clearException(),u.done(n)):null!==u&&(console.log("Printing done!",u),u.done())},i.subscribe("router.executing").setLimit(1).on("message",function(){document.getElementById("qzPrintInitWarning")||window.qzReady()}),window.qzPrint=d,d});