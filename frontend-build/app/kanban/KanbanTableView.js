// Part of <https://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

define(["underscore","../i18n","../user","../core/Model"],function(t,e,i,n){"use strict";var a=function(){return""},r=function(t){return t},s=function(t){return t&&"?"!==t?"":"kanban-is-invalid"},l={_id:{},nc12:{},description:{tdClassName:s},supplyArea:{tdClassName:s},family:{tdClassName:s},kanbanQtyUser:{rotated:!0},componentQty:{rotated:!0,tdClassName:s},storageBin:{rotated:!0,tdClassName:s},kanbanIdEmpty:{tdClassName:s},kanbanIdFull:{tdClassName:s},lineCount:{rotated:!0},emptyFullCount:{rotated:!0},stock:{rotated:!0},maxBinQty:{rotated:!0,tdClassName:s},minBinQty:{rotated:!0,tdClassName:s},replenQty:{rotated:!0,tdClassName:s},kind:{rotated:!0,tdClassName:function(t){return"kanban-is-editable "+s(t)}},workstations:{rowSpan:1,colSpan:6,sortable:!1,tdClassName:function(t,e,i,n){return"kanban-is-editable "+(!n.workstationsTotal||!t&&n.locations[i]?"kanban-is-invalid":"")}},locations:{rowSpan:1,colSpan:6,sortable:!1,tdClassName:function(t,e,i,n){return"kanban-is-editable "+(!n.workstationsTotal||!t&&n.workstations[i]?"kanban-is-invalid":"")}},discontinued:{rotated:!0,tdClassName:function(){return"kanban-is-editable"},renderValue:function(t){return'<i class="fa fa-'+(t?"check":"times")+'"></i>'}}};return n.extend({urlRoot:"/kanban/tableViews",clientUrlRoot:"#kanban/tableViews",topicPrefix:"kanban.tableViews",privilegePrefix:"KANBAN",nlsDomain:"kanban",defaults:function(){return{name:"",columns:{},filterMode:"and",filters:{},sort:{_id:1}}},initialize:function(){},setUpPubsub:function(t){var e=this;t.subscribe("kanban.tableViews.edited",function(t){t.model._id===e.id&&e.handleEditMessage(t.model)})},getHiddenColumns:function(){return Object.keys(this.attributes.columns)},hasAnyHiddenColumn:function(){return this.getHiddenColumns().length>0},getVisibility:function(t){return!1!==this.attributes.columns[t]},setVisibility:function(t,e){e?delete this.attributes.columns[t]:this.attributes.columns[t]=!1,this.trigger("change:visibility",this,t,{}),this.trigger("change:columns",this,this.attributes.columns,{}),this.trigger("change",this,{save:!0})},getFilterMode:function(){return this.get("filterMode")},setFilterMode:function(t){this.set("filterMode",t,{save:!0})},hasAnyFilter:function(){return Object.keys(this.attributes.filters).length>0},getFilter:function(t){return this.attributes.filters[t]||null},setFilter:function(t,e){this.attributes.filters[t]=e,this.trigger("change:filter",this,t,{}),this.trigger("change:filters",this,this.attributes.filters,{}),this.trigger("change",this,{save:!0})},clearFilters:function(){var t=this,e=t.attributes.filters;t.attributes.filters={},Object.keys(e).forEach(function(e){t.trigger("change:filter",t,e,{})}),t.trigger("change:filters",t,t.attributes.filters,{}),t.trigger("change",t,{save:!0})},getSortOrder:function(t){return this.attributes.sort[t]||0},setSortOrder:function(t,e){var i=this,n=i.attributes.sort;i.attributes.sort={},Object.keys(n).forEach(function(t){i.trigger("change:order",i,t,{})}),i.attributes.sort[t]=e,i.trigger("change:order",i,t,{}),i.trigger("change:sort",i,i.attributes.sort,{}),i.trigger("change",i,{save:!0})},getColumnText:function(t){return(e.has("kanban","column:"+t+":title")?e("kanban","column:"+t+":title"):e("kanban","column:"+t)).replace(/\n/g," ").replace(/<br>/g," ").replace(/\s+/," ")},serializeColumns:function(){var t=this,e={list:[],map:[]};return Object.keys(l).forEach(function(i){var n=t.serializeColumn(i);n.visible&&e.list.push(n),e.map[i]=n}),e},serializeColumn:function(i){var n=t.assign({_id:i,thClassName:"",labelClassName:"",tdClassName:a,valueClassName:a,rowSpan:2,colSpan:1,visible:this.getVisibility(i),sortOrder:this.getSortOrder(i),filter:this.getFilter(i),rotated:!1,sortable:!0,withMenu:!0,label:e.bound("kanban","column:"+i),title:e.has("kanban","column:"+i+":title")?e.bound("kanban","column:"+i+":title"):"",renderValue:r},l[i]),s=[],o=[];return n.withMenu&&s.push("kanban-is-with-menu"),n.filter&&s.push("kanban-is-filtered"),n.sortOrder&&s.push("kanban-is-"+(1===n.sortOrder?"asc":"desc")),n.rotated&&o.push("kanban-is-rotated"),n.thClassName=s.join(" "),n.labelClassName=o.join(" "),n},createSort:function(t){var e=Object.keys(this.attributes.sort)[0],i=this.attributes.sort[e];return function(n,a){n=n.serialize(t)[e];var r=typeof n;return"object"===r?0:(a=a.serialize(t)[e],"number"===r?1===i?n-a:a-n:"string"===r?1===i?n.localeCompare(a):a.localeCompare(n):0)}},createFilter:function(t){this.get("filterMode"),this.get("filters");return function(e){return e=e.serialize(t),!0}},handleEditMessage:function(t){}})});