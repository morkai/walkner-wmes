// Part of <https://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

define(["underscore","jquery","../core/util/uuid","../core/Collection","../core/Model","./layouts"],function(t,i,e,o,n,s){"use strict";return o.extend({model:n,paginate:!1,initialize:function(t,i){this.layouts=i&&i.layouts||[].concat(s),this.on("add remove change reset",this.store)},store:function(){localStorage.setItem("WMES_KANBAN_BUILDER_ENTRIES",JSON.stringify(this.toJSON()))},addFromEntries:function(t){var i=this,o={},n=[];i.forEach(function(t){o[t.get("ccn")]=!0}),t.forEach(function(t){if(!o[t._id]){var s={_id:e(),ccn:t._id,lines:t.lines};i.add(s,{multi:!0}),n.push(s._id)}}),i.trigger("multiAdd",n)},addFromEntry:function(t){var i=this.findWhere({ccn:t._id});i?this.trigger("focus",i):this.add({_id:e(),ccn:t._id,lines:t.lines})},toggleLayout:function(t,i){void 0===i&&(i=-1===this.layouts.indexOf(t)),i?-1===this.layouts.indexOf(t)&&this.layouts.push(t):this.layouts=this.layouts.filter(function(i){return i!==t}),localStorage.setItem("WMES_KANBAN_BUILDER_LAYOUTS",JSON.stringify(this.layouts)),this.trigger("change:layouts",t,i)}},{fromLocalStorage:function(){return new this(JSON.parse(localStorage.getItem("WMES_KANBAN_BUILDER_ENTRIES")||"[]"),{layouts:JSON.parse(localStorage.getItem("WMES_KANBAN_BUILDER_LAYOUTS")||"null")})}})});