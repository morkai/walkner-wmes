define(["underscore","jquery","../core/util/uuid","../core/Collection","../core/Model","../data/localStorage","./layouts"],function(t,i,e,n,o,r,s){"use strict";return n.extend({model:o,paginate:!1,initialize:function(t,i){this.layouts=i&&i.layouts||[].concat(s),this.newStorageBin=!i||void 0===i.newStorageBin||i.newStorageBin,this.on("add remove change reset",this.store)},store:function(){r.setItem("WMES_KANBAN_BUILDER_ENTRIES",JSON.stringify(this.toJSON()))},addFromEntries:function(t){var i=this,n={},o=[];i.forEach(function(t){n[t.get("ccn")]=!0}),t.forEach(function(t){if(!n[t._id]){var r={_id:e(),ccn:t._id,lines:t.lines};i.add(r,{multi:!0}),o.push(r._id)}}),i.trigger("multiAdd",o)},addFromEntry:function(t){var i=this.findWhere({ccn:t._id});i?this.trigger("focus",i):this.add({_id:e(),ccn:t._id,lines:t.lines})},toggleLayout:function(t,i){void 0===i&&(i=-1===this.layouts.indexOf(t)),i?-1===this.layouts.indexOf(t)&&this.layouts.push(t):this.layouts=this.layouts.filter(function(i){return i!==t}),r.setItem("WMES_KANBAN_BUILDER_LAYOUTS",JSON.stringify(this.layouts)),this.trigger("change:layouts",t,i)},toggleNewStorageBin:function(t){void 0===t&&(t=!this.newStorageBin),r.setItem("WMES_KANBAN_BUILDER_NEW_STORAGE_BIN",JSON.stringify(t)),this.trigger("change:newStorageBin",t)}},{fromLocalStorage:function(){return new this(JSON.parse(r.getItem("WMES_KANBAN_BUILDER_ENTRIES")||"[]"),{layouts:JSON.parse(r.getItem("WMES_KANBAN_BUILDER_LAYOUTS")||"null"),newStorageBin:JSON.parse(r.getItem("WMES_KANBAN_BUILDER_NEW_STORAGE_BIN")||"true")})}})});