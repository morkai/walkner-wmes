// Part of <https://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

define(["underscore","jquery","../core/util/uuid","../core/Collection","../core/Model","./layouts"],function(t,e,i,o,n,r){"use strict";return o.extend({model:n,paginate:!1,initialize:function(t,e){this.layouts=e&&e.layouts||[].concat(r),this.newStorageBin=!e||void 0===e.newStorageBin||e.newStorageBin,this.on("add remove change reset",this.store)},store:function(){localStorage.setItem("WMES_KANBAN_BUILDER_ENTRIES",JSON.stringify(this.toJSON()))},addFromEntries:function(t){var e=this,o={},n=[];e.forEach(function(t){o[t.get("ccn")]=!0}),t.forEach(function(t){if(!o[t._id]){var r={_id:i(),ccn:t._id,lines:t.lines};e.add(r,{multi:!0}),n.push(r._id)}}),e.trigger("multiAdd",n)},addFromEntry:function(t){var e=this.findWhere({ccn:t._id});e?this.trigger("focus",e):this.add({_id:i(),ccn:t._id,lines:t.lines})},toggleLayout:function(t,e){void 0===e&&(e=-1===this.layouts.indexOf(t)),e?-1===this.layouts.indexOf(t)&&this.layouts.push(t):this.layouts=this.layouts.filter(function(e){return e!==t}),localStorage.setItem("WMES_KANBAN_BUILDER_LAYOUTS",JSON.stringify(this.layouts)),this.trigger("change:layouts",t,e)},toggleNewStorageBin:function(t){void 0===t&&(t=!this.newStorageBin),localStorage.setItem("WMES_KANBAN_BUILDER_NEW_STORAGE_BIN",JSON.stringify(t)),this.trigger("change:newStorageBin",t)}},{fromLocalStorage:function(){return new this(JSON.parse(localStorage.getItem("WMES_KANBAN_BUILDER_ENTRIES")||"[]"),{layouts:JSON.parse(localStorage.getItem("WMES_KANBAN_BUILDER_LAYOUTS")||"null"),newStorageBin:JSON.parse(localStorage.getItem("WMES_KANBAN_BUILDER_NEW_STORAGE_BIN")||"true")})}})});