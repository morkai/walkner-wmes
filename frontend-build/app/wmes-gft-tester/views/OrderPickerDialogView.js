define(["underscore","app/viewport","app/core/View","app/data/localStorage","app/wmes-gft-tester/templates/orderPickerDialog"],function(t,e,o,i,s){"use strict";return o.extend({template:s,nlsDomain:"wmes-gft-tester",dialogClassName:"production-modal",events:{"focus [data-vkb]":function(t){this.options.vkb&&this.options.vkb.show(t.currentTarget)},"click .btn[data-id]":function(t){this.$id("orderNo").val(t.currentTarget.dataset.id)},submit:function(t){t.preventDefault(),this.$id("submit").prop("disabled",!0).find(".fa-spinner").removeClass("hidden"),this.options.vkb&&this.options.vkb.hide();const o=this.ajax({method:"POST",url:`/gft/stations/${this.model.get("line")}/${this.model.get("station")}`,data:JSON.stringify({orderNo:this.$id("orderNo").val()})});o.fail(()=>{const t=o.responseJSON&&o.responseJSON.error;let i="";i=t?this.t.has(`orderPicker:error:${t.code}`)?this.t(`orderPicker:error:${t.code}`):t.message:this.t("orderPicker:error:generic"),e.msg.show({type:"error",time:3e3,text:i}),this.$id("submit").prop("disabled",!1).find(".fa-spinner").addClass("hidden")}),o.done(()=>{this.timers.closeDialog=setTimeout(()=>e.closeDialog(),6e3),this.listenTo(this.model.order,"change",()=>e.closeDialog())})}},destroy:function(){this.options.vkb&&this.options.vkb.hide()},onDialogShown:function(){this.$id("orderNo").focus()},afterRender:function(){this.$id("orderNo").val(this.options.orderNo||""),this.loadRecentOrders()},loadRecentOrders:function(){const o=this.ajax({url:`/gft/recentOrders/${this.model.get("line")}`});o.fail(()=>{this.$(".fa-spin").removeClass("fa-spin")}),o.done(o=>{const i=this.model.order.get("orderNo");let s="";o.collection.forEach(e=>{if(e.orderNo===i)return;const o=e.orderNo.match(/[0-9]{3}/g).join(" ");s+=`<button type="button" class="btn btn-lg btn-default" data-id="${e.orderNo}">`+`${o} &nbsp; <small>${t.escape(e.productName)}</small>`+"</button>"}),this.$id("list").html(s),e.adjustDialogBackdrop()})}})});