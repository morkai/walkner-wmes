// Copyright (c) 2014, ≈Åukasz Walukiewicz <lukasz@walukiewicz.eu>. Some Rights Reserved.
// Licensed under CC BY-NC-SA 4.0 <http://creativecommons.org/licenses/by-nc-sa/4.0/>.
// Part of the walkner-wmes project <http://lukasz.walukiewicz.eu/p/walkner-wmes>

define(["../core/Collection","./ProdTask"],function(r,e){return r.extend({model:e,rqlQuery:"sort(name)",sort:function(r){function e(r){if(r.children=n[r.id]||[],r.children.length)for(var t=0;t<r.children.length;++t){var i=r.children[t];s.push(i),e(i)}}var t,i=[],n={};for(t=0;t<this.length;++t){var h=this.models[t],a=h.attributes;a.parent?n[a.parent]?n[a.parent].push(h):n[a.parent]=[h]:i.push(h)}var s=[];for(t=0;t<i.length;++t){var l=i[t];s.push(l),e(l)}return this.models=s,r&&!r.silent&&this.trigger("sort",this,r||{}),this},serializeToSelect2:function(r){function e(t){var i=[];if(Array.isArray(t.children))for(var n=0;n<t.children.length;++n){var h=t.children[n];h.id!==r&&i.push({id:h.id,text:h.getLabel(),children:e(h),prodTask:h})}return i}var t=[];return this.sort().forEach(function(i){i.id===r||i.attributes.parent||t.push({id:i.id,text:i.getLabel(),children:e(i),prodTask:i})}),t}})});