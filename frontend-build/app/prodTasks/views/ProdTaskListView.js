// Copyright (c) 2014, ≈Åukasz Walukiewicz <lukasz@walukiewicz.eu>. Some Rights Reserved.
// Licensed under CC BY-NC-SA 4.0 <http://creativecommons.org/licenses/by-nc-sa/4.0/>.
// Part of the walkner-wmes project <http://lukasz.walukiewicz.eu/p/walkner-wmes>

define(["app/i18n","app/core/views/ListView"],function(e,n){return n.extend({columns:["name","parent","tags","fteDiv","inProd","clipColor"],serializeRows:function(){var n=this.collection,r={};n.forEach(function(t){var a=t.toJSON();a.tags=a.tags.length?a.tags.join(", "):"-",a.fteDiv=e("core","BOOL:"+!!a.fteDiv),a.inProd=e("core","BOOL:"+!!a.inProd),a.clipColor&&(a.clipColor='<span class="label" style="background: '+a.clipColor+'">'+a.clipColor+"</span>"),a.parent?(r[a.parent]||(r[a.parent]={parent:null,children:[]}),r[a.parent].children.push(a)):r[a._id]?r[a._id].parent||(r[a._id].parent=a):r[a._id]={parent:a,children:[]};var i=n.get(a.parent);a.parent=i?i.getLabel():"-"});var t=[];return Object.keys(r).forEach(function(e){var n=r[e];t.push(n.parent),t.push.apply(t,n.children)}),t}})});