define(["underscore","app/i18n","app/viewport","app/core/View","app/core/util/idAndLabel","app/mor/templates/watchForm"],function(e,t,i,o,s,d){"use strict";return o.extend({template:d,events:{submit:function(){var e=this,o=e.$id("submit").prop("disabled",!0),s={section:e.model.section._id,user:e.model.watch?e.model.watch.user:e.$id("user").val(),days:[],from:e.$id("from").val(),to:e.$id("to").val()};return e.model.mor[e.model.watch?"editWatch":"addWatch"](s).fail(function(){i.msg.show({type:"error",time:3e3,text:t("mor","watchForm:failure:"+e.model.mode)}),o.prop("disabled",!1)}).done(function(){e.closeDialog()}),!1}},serialize:function(){return{idPrefix:this.idPrefix,mode:this.model.mode,section:this.model.section.name,watch:this.model.watch}},afterRender:function(){var t=e.pluck(this.model.mor.get("watch"),"user");this.$id("user").select2({data:this.model.mor.users.filter(function(i){return!e.contains(t,i.id)}).map(s)}),"edit"===this.model.mode&&this.$id("user").select2("disable",!0).select2("data",{id:this.model.watch.user,text:this.model.mor.users.get(this.model.watch.user).getLabel()})},onDialogShown:function(){this.closeDialog=i.closeDialog.bind(i),this.$id("edit"===this.model.mode?"from":"user").focus()},closeDialog:function(){}})});