define(["jquery","app/viewport","app/core/views/ListView","app/core/util/resultTips","app/wmes-dummyPaint-paints/DpPaint","app/wmes-dummyPaint-paints/views/FormView","i18n!app/nls/wmes-dummyPaint-paints"],function(i,a,s,e,t,n){"use strict";return s.extend({className:"is-colored",remoteTopics:{"dummyPaint.orders.updated":"refreshCollection"},events:Object.assign({'click a[data-action="addPaint"]':function(s){const t=this.$(s.currentTarget);if(t.hasClass("disabled"))return;a.msg.loading(),t.addClass("disabled");const n=this.collection.get(t.closest("tr")[0].dataset.id),d=n.get("paintFamily"),m=n.get("paintCode"),o=this.ajax({url:`/dummyPaint/paints?family=${d}&code=${m}`}),l=this.ajax({url:`/dummyPaint/paints?code=${m}&limit(1)`}),c=i.when(o,l);c.fail(()=>{a.msg.loadingFailed()}),c.done((i,t)=>{if(a.msg.loaded(),1===i[0].totalCount)return e.show({e:s,type:"info",time:1337,text:this.t("addPaint:exists")}),void this.removeAddPaintActions(d,m);this.showAddPaintDialog(n,t[0].totalCount?t[0].collection[0]:null)}),c.always(()=>t.removeClass("disabled"))}},s.prototype.events),serializeColumns:function(){return[{id:"dummyFamily",className:"is-min"},{id:"_id",className:"is-min"},{id:"nc12",className:"is-min"},{id:"name",className:"is-min"},{id:"leadingNo",className:"is-min"},{id:"leadingNc12",className:"is-min"},{id:"leadingName",className:"is-min"},{id:"salesNo",className:"is-min"},{id:"paintSource",className:"is-min"},{id:"productFamily",className:"is-min"},{id:"paintFamily",className:"is-min"},{id:"paintCategory",className:"is-min"},{id:"paintCode",className:"is-min"},{id:"dummyNc12",className:"is-min"},{id:"paintNc12",className:"is-min"},{id:"paintName",className:"is-min"},{id:"changed",className:"is-min"},{id:"error",className:"is-min"},{id:"createdAt",className:"is-min"},{id:"stage",className:"is-min"},{id:"job",className:"is-min"},"-"]},serializeActions:function(){return null},showAddPaintDialog:function(i,s){const e=new t({family:i.get("paintFamily"),code:i.get("paintCode"),nc12:s?s.nc12:"",name:s?s.name:""}),d=new n({dialogClassName:"dp-paints-form-dialog",editMode:!1,model:e,formMethod:"POST",formAction:e.url(),formActionText:this.t("addPaint:submit"),failureText:this.t("core","FORM:ERROR:addFailure"),panelTitleText:this.t("addPaint:title"),onDialogShown:()=>d.$id("nc12").focus(),handleSuccess:()=>{a.closeDialog(),a.msg.show({type:"success",time:2e3,text:this.t("addPaint:success")}),this.removeAddPaintActions(e.get("family"),e.get("code"))}});a.showDialog(d,this.t("addPaint:title"))},removeAddPaintActions:function(i,a){this.$('a[data-action="addPaint"]').each((s,e)=>{const t=this.$(e),n=this.collection.get(t.closest("tr")[0].dataset.id);n.get("paintFamily")===i&&n.get("paintCode")===a&&t.remove()})}})});