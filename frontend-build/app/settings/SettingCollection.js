define(["underscore","jquery","../core/Collection","./Setting"],function(e,t,r,i){"use strict";return r.extend({model:i,rqlQuery:"select(value)",matchSettingId:null,topicSuffix:"**",initialize:function(e,t){t.pubsub&&this.setUpPubsub(t.pubsub)},setUpPubsub:function(t){var r=this,i=Array.isArray(r.topicSuffix)?r.topicSuffix:[r.topicSuffix];e.forEach(i,function(e){t.subscribe("settings.updated."+e,function(e){var t=r.get(e._id);t?t.set(e):r.add(e)})})},fetchIfEmpty:function(e,r){if(!this.isEmpty())return e?e.call(r):null;var i=t.Deferred(),n=this.fetch({reset:!0});return e?(n.done(function(){var n=[].concat(e.call(r));t.when.apply(t,n).then(function(){i.resolve()},function(){i.reject()})}),i.promise()):n},update:function(r,i){if(void 0===(i=this.prepareValue(r,"string"==typeof i?i.trim():i)))return t.Deferred().reject().promise();var n=this.get(r);if(n){if(e.isEqual(n.getValue(),i))return t.Deferred().resolve().promise()}else this.add({_id:r,value:null}),n=this.get(r);return n.save({value:i})},prepareValue:function(e,t){return t},prepareObjectIdValue:function(e){if(null===e||""===e)return null;var t=String(e).toLowerCase();return/^[a-f0-9]{24}$/.test(t)?t:void 0},prepareMultiObjectIdValue:function(e){return String(e).toLowerCase().split(",").filter(function(e){return/^[a-f0-9]{24}$/.test(e)})},prepareMultiSelect2Value:function(e){return String(e||"").split(",").filter(function(e){return e.length>0})},prepareNumericValue:function(e,t,r){var i=parseInt(e,10);if(!isNaN(i))return i<t?t:i>r?r:i},prepareFormValue:function(e,t){return t||""}})});