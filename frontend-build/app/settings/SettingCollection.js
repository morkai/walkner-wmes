// Copyright (c) 2014, ≈Åukasz Walukiewicz <lukasz@walukiewicz.eu>. Some Rights Reserved.
// Licensed under CC BY-NC-SA 4.0 <http://creativecommons.org/licenses/by-nc-sa/4.0/>.
// Part of the walkner-wmes project <http://lukasz.walukiewicz.eu/p/walkner-wmes>

define(["jquery","../core/Collection","./Setting"],function(e,t,i){"use strict";return t.extend({model:i,rqlQuery:"select(value)",matchSettingId:null,topicSuffix:"**",initialize:function(e,t){t.pubsub&&this.setUpPubsub(t.pubsub)},setUpPubsub:function(e){var t=this;e.subscribe("settings.updated."+this.topicSuffix,function(e){var i=t.get(e._id);i?i.set(e):t.add(e)})},update:function(t,i){if(i=this.prepareValue(t,i.trim()),void 0===i)return e.Deferred().reject().promise();var u=this.get(t);if(u){if(u.getValue()===i)return e.Deferred().resolve().promise()}else this.add({_id:t,value:null}),u=this.get(t);return u.save({value:i})},prepareValue:function(e,t){return t}})});