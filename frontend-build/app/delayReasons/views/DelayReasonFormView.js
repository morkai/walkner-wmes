define(["app/data/orgUnits","app/data/prodFunctions","app/core/util/idAndLabel","app/core/views/FormView","app/delayReasons/templates/form"],function(i,t,n,o,e){"use strict";return o.extend({template:e,events:Object.assign({"click #-addNotification":function(){this.addNotification({subdivisions:[],prodFunctions:[]}),this.$id("notifications").children().last().find("input").first().focus()},'click [data-action="removeNotification"]':function(i){var t=this.$(i.target).closest("tr");t.find("input").select2("destroy"),t.remove()}},o.prototype.events),initialize:function(){o.prototype.initialize.apply(this,arguments),this.i=0,this.subdivisions=i.getAllByType("division").map(function(t){var n=t.getLabel();return{text:n,children:i.getChildren(t).map(function(i){return{id:i.id,text:i.getLabel(),divisionText:n}})}}),this.prodFunctions=t.map(n)},afterRender:function(){o.prototype.afterRender.apply(this,arguments),this.$notification=this.$id("notifications").children().first().detach(),(this.model.get("notifications")||[]).forEach(this.addNotification,this),this.addNotification({subdivisions:[],prodFunctions:[]})},addNotification:function(i){var t=this.$notification.clone(),n=++this.i;t.find('input[name$="subdivisions"]').prop("name","notifications["+n+"].subdivisions").val(i.subdivisions.join(",")).select2({width:"500px",placeholder:" ",allowClear:!0,multiple:!0,data:this.subdivisions,formatSelection:function(i,t,n){return n(i.divisionText+" \\ "+i.text)}}),t.find('input[name$="prodFunctions"]').prop("name","notifications["+n+"].prodFunctions").val(i.prodFunctions.join(",")).select2({width:"500px",placeholder:" ",allowClear:!0,multiple:!0,data:this.prodFunctions}),this.$id("notifications").append(t)},serializeForm:function(i){return i.notifications=(i.notifications||[]).map(function(i){return{subdivisions:i.subdivisions.split(",").filter(function(i){return!!i.length}),prodFunctions:i.prodFunctions.split(",").filter(function(i){return!!i.length})}}).filter(function(i){return!!i.prodFunctions.length}),i}})});