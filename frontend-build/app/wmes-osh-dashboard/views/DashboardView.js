define(["app/i18n","app/user","app/core/Model","app/core/View","app/wmes-osh-nearMisses/NearMissCollection","app/wmes-osh-nearMisses/views/ListView","app/wmes-osh-kaizens/KaizenCollection","app/wmes-osh-kaizens/views/ListView","app/wmes-osh-actions/Action","app/wmes-osh-observations/Observation","../views/MetricsView","../views/Top10View","app/wmes-osh-dashboard/templates/dashboard"],function(s,e,i,t,a,n,r,o,l,h,d,u,p){"use strict";return t.extend({template:p,nlsDomain:"wmes-osh-dashboard",events:{"click .osh-dashboard-top-card":function(s){s.currentTarget.classList.toggle("is-flipped")},"mouseenter .osh-dashboard-top-card":function(s){s.currentTarget.classList.add("is-hovered")},"mouseleave .osh-dashboard-top-card":function(s){s.currentTarget.classList.remove("is-hovered")}},initialize:function(){this.defineModels(),this.defineViews(),this.setView("#-nearMiss-metrics",this.nearMissMetricsView),this.setView("#-nearMiss-list",this.nearMissListView),this.setView("#-nearMiss-top10-current",this.nearMissCurrentTop10View),this.setView("#-nearMiss-top10-previous",this.nearMissPreviousTop10View),this.setView("#-kaizen-metrics",this.kaizenMetricsView),this.setView("#-kaizen-list",this.kaizenListView),this.setView("#-kaizen-top10-current",this.kaizenCurrentTop10View),this.setView("#-kaizen-top10-previous",this.kaizenPreviousTop10View),this.load(),this.timers.reload=setInterval(this.load.bind(this),6e5),this.timers.flipTop10=setInterval(this.flipTop10.bind(this),3e4)},defineModels:function(){this.nearMissStats=new i(null,{url:"/osh/nearMisses/stats"}),this.nearMisses=new a(null,{paginate:!1,rqlQuery:"select(rid,status,subject)&sort(-updatedAt)&limit(11)"+`&users.user.id=${e.data._id}`+"&status=in=(new,inProgress,verification,paused)"}),this.kaizenStats=new i(null,{url:"/osh/kaizens/stats"}),this.kaizens=new r(null,{paginate:!1,rqlQuery:"select(rid,status,subject)&sort(-updatedAt)&limit(11)"+`&users.user.id=${e.data._id}`+"&status=in=(new,inProgress,verification,paused)"})},defineViews:function(){const s="#osh/nearMisses?exclude(changes)&sort(-eventDate)&limit(20)&createdAt=ge=${from}&createdAt=lt=${to}&users.user.id=${user}",e="#osh/kaizens?exclude(changes)&sort(-date)&limit(20)&createdAt=ge=${from}&createdAt=lt=${to}&users.user.id=${user}";this.nearMissMetricsView=new d({model:this.nearMissStats,buttonType:"danger",buttonUrl:"#osh/nearMisses;add",buttonLabel:this.t("addButton:nearMiss"),browseUrl:"#osh/nearMisses",sortProperty:"createdAt",openStatuses:"new,inProgress,verification,paused"}),this.nearMissListView=new n({collection:this.nearMisses,simple:!0,noData:this.t("list:noData:nearMiss"),serializeColumns:this.serializeListColumns.bind(this),serializeRow:this.serializeListRow,serializeActions:()=>{}}),this.nearMissCurrentTop10View=new u({model:this.nearMissStats,top10Property:"currentTop10",urlTemplate:s}),this.nearMissPreviousTop10View=new u({model:this.nearMissStats,top10Property:"previousTop10",month:-1,urlTemplate:s}),this.kaizenMetricsView=new d({model:this.kaizenStats,buttonType:"success",buttonUrl:"#osh/kaizens;add",buttonLabel:this.t("addButton:kaizen"),browseUrl:"#osh/kaizens",sortProperty:"createdAt",openStatuses:"new,inProgress,verification,paused"}),this.kaizenListView=new o({collection:this.kaizens,simple:!0,noData:this.t("list:noData:kaizen"),serializeColumns:this.serializeListColumns.bind(this),serializeRow:this.serializeListRow,serializeActions:()=>{}}),this.kaizenCurrentTop10View=new u({model:this.kaizenStats,top10Property:"currentTop10",urlTemplate:e}),this.kaizenPreviousTop10View=new u({model:this.kaizenStats,top10Property:"previousTop10",month:-1,urlTemplate:e})},load:function(){this.promised(this.nearMissStats.fetch()),this.promised(this.nearMisses.fetch({reset:!0})),this.promised(this.kaizenStats.fetch()),this.promised(this.kaizens.fetch({reset:!0}))},getTemplateData:function(){return{can:{addAction:l.can.add(),addObservation:h.can.add()}}},flipTop10:function(){this.$(".osh-dashboard-top-card").each(function(){this.classList.contains("is-hovered")||this.classList.toggle("is-flipped")})},serializeListColumns:function(){return[{id:"rid",label:this.t("list:rid"),className:"is-min is-number"},{id:"status",label:this.t("list:status"),className:"is-min"},{id:"subject",label:this.t("list:subject")}]},serializeListRow:function(s){return s.serializeRow()}})});