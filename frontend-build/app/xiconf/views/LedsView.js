// Copyright (c) 2014, ≈Åukasz Walukiewicz <lukasz@walukiewicz.eu>. Some Rights Reserved.
// Licensed under CC BY-NC-SA 4.0 <http://creativecommons.org/licenses/by-nc-sa/4.0/>.
// Part of the walkner-wmes project <http://lukasz.walukiewicz.eu/p/walkner-wmes>

define(["underscore","jquery","app/i18n","app/core/View","app/dashboard/templates/leds","app/dashboard/templates/led"],function(e,s,i,t,a,n){return t.extend({template:a,initialize:function(){this.offsetTop=0,this.listenTo(this.model,"change:leds",this.render),this.listenTo(this.model,"change:led",this.renderLed)},serialize:function(){return{idPrefix:this.idPrefix,renderLed:n,leds:(this.model.get("leds")||[]).map(this.serializeLed)}},serializeLed:function(e){var s,t,a="";return"checking"===e.status?(s="warning",t="fa-spinner fa-spin"):"checked"===e.status?(s="success",t="fa-thumbs-up"):"waiting"===e.status?(s="default",t="fa-question-circle"):(s="danger",t="fa-thumbs-down",a=i.has("dashboard","leds:error:"+e.status.message)?i("dashboard","leds:error:"+e.status.message,e.status):e.status.message),{className:s,statusIcon:t,serialNumber:e.serialNumber||"????????",name:e.name,nc12:e.nc12,error:a}},renderLed:function(e,i){var t=this.timers,a=s(n(this.serializeLed(i)));this.$id("list").children().eq(e).replaceWith(a),a.addClass("blink"),t["blink"+e]&&clearTimeout(t["blink"+e]),t["blink"+e]=setTimeout(function(){t&&t["blink"+e]&&delete t["blink"+e],a.removeClass("blink")},200)},afterRender:function(){this.offsetTop=this.$id("list").offset().top},resize:function(){this.$id("list")[0].style.maxHeight=window.innerHeight-this.offsetTop-14+"px"}})});