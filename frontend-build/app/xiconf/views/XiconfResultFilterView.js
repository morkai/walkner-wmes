define(["underscore","app/time","app/core/views/FilterView","app/core/util/forms/dateTimeRange","app/xiconf/templates/filter"],function(e,t,r,s,a){"use strict";return r.extend({template:a,events:e.assign({"click a[data-date-time-range]":s.handleRangeEvent},r.prototype.events),defaultFormData:function(){return{srcId:"",serviceTag:"",orderNo:"",nc12Type:"program",nc12:"",result:["success","failure"]}},termToForm:{startedAt:s.rqlToForm,orderNo:function(e,t,r){r[e]=t.args[1].replace(/[^0-9]/g,"")},result:function(e,t,r){"success"!==t.args[1]&&"failure"!==t.args[1]||(r.result=[t.args[1]])},nc12:function(e,t,r){r.nc12Type="program",r.nc12=t.args[1].replace(/[^0-9A-Z]/g,"")},"program._id":function(e,t,r){r.nc12Type="program",r.nc12=t.args[1].replace(/[^0-9A-Za-z]/g,"")},"leds.nc12":function(e,t,r){r.nc12Type="led",r.nc12=t.args[1].replace(/[^0-9A-Z]/g,"")},srcId:function(e,t,r){r[e]=t.args[1]},serviceTag:"srcId"},initialize:function(){this.collection&&this.listenTo(this.collection,"change:srcIds",this.setUpSrcIdSelect2)},afterRender:function(){r.prototype.afterRender.call(this),1===this.formData.result.length?this.$(".xiconf-filter-"+this.formData.result[0]).addClass("active"):this.$(".xiconf-filter-result > label").addClass("active"),this.setUpSrcIdSelect2()},setUpSrcIdSelect2:function(){this.$id("srcId").select2({width:"200px",allowClear:!0,data:(this.collection.srcIds||[]).map(function(e){return{id:e,text:e}})})},serializeFormToQuery:function(e){var t=this.$('input[name="nc12Type"]:checked').val(),r=this.$id("nc12").val().trim(),a=this.$id("serviceTag").val().trim(),i=this.$id("srcId").val(),n=this.$('input[name="result[]"]:checked');if(s.formToRql(this,e),i.length&&e.push({name:"eq",args:["srcId",i]}),this.serializeRegexTerm(e,"orderNo",9,null,!1,!0),/^[0-9A-Z]{9,}$/.test(r)){var c="led"===t?"leds.nc12":/[A-Z]/.test(r)?"program._id":"nc12";12===r.length?e.push({name:"eq",args:[c,r]}):e.push({name:"regex",args:[c,"^"+r]})}/^P[0-9]+$/.test(a)&&e.push({name:"eq",args:["serviceTag",a]}),1===n.length&&e.push({name:"eq",args:["result",n.val()]})}})});