// Part of <https://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

define(["underscore","app/time","app/core/View","app/xiconf/templates/wiring"],function(e,i,t,r){"use strict";return t.extend({template:r,serialize:function(){return{idPrefix:this.idPrefix,probes:this.serializeProbes()}},serializeProbes:function(){var e=this,i=[],t=e.model.get("metrics");if(!t||!t.activeProbes)return i;var r=e.toBits(t.activeProbes,11),n="0"===r[10];return[1,2,3,4].forEach(function(o){var s=[],a="0"===r[2+2*(o-1)];e.toBits(t["probe"+o],7).forEach(function(e,i){s.push({label:"1."+(i+1),on:"1"===e,inactive:a||n&&i>=5})}),a="0"===r[3+2*(o-1)],e.toBits(t["probe"+o+"x"],7).forEach(function(e,i){s.push({label:"2."+(i+1),on:"1"===e,inactive:a||n&&i>=5})}),i.push({n:o,pins:s})}),i},toBits:function(e,i){for(var t=e.toString(2);t.length<i;)t="0"+t;return t.split("").reverse().slice(0,i)}})});