define(["underscore","app/i18n","app/user","app/viewport","app/core/views/ListView","./CorroborateProdDowntimeView","./decorateProdDowntime"],function(t,o,e,i,r,n,s){return r.extend({remoteTopics:{"prodDowntimes.created.*":function(t){this.collection.hasOrMatches(t)&&this.refreshCollection()},"prodDowntimes.deleted.*":function(t){this.collection.hasOrMatches(t)&&this.refreshCollection()},"prodDowntimes.finished.*":function(t){var o=this.collection.get(t._id);o&&o.set("finishedAt",new Date(t.finishedAt))},"prodDowntimes.corroborated.*":function(t){t._id===this.corroboratingId&&i.closeDialog(),this.collection.hasOrMatches(t)&&this.refreshCollection()}},events:{"click .action-corroborate":function(t){t.preventDefault();var e=this;this.broker.subscribe("viewport.dialog.hidden",function(){e.corroboratingId=null}),this.corroboratingId=this.$(t.target).closest("tr").attr("data-id"),i.showDialog(new n({model:this.collection.get(this.corroboratingId)}),o("prodDowntimes","corroborate:title"))}},columns:["rid","mrpControllers","prodFlow","aor","prodLine","reason","startedAt","finishedAt","duration"],initialize:function(){r.prototype.initialize.apply(this,arguments),this.corroboratingId=null,this.listenTo(this.collection,"change",this.render)},serializeRows:function(){return this.collection.map(s)},serializeActions:function(){var t=this.collection;return function(i){var n=t.get(i._id),s=[r.actions.viewDetails(n)];return"undecided"===i.status&&e.isAllowedTo("PROD_DOWNTIMES:MANAGE")&&e.hasAccessToAor(n.get("aor"))&&s.push({id:"corroborate",icon:"gavel",label:o("prodDowntimes","LIST:ACTION:corroborate"),href:n.genClientUrl("corroborate")}),s}},afterRender:function(){r.prototype.afterRender.call(this);var t=this;this.$('.is-withReasonComment > td[data-id="reason"]').popover({container:this.el,trigger:"hover",placement:"auto right",content:function(){var o=t.$(this).closest("tr").attr("data-id");return t.collection.get(o).get("reasonComment")}}).append('<i class="fa fa-info-circle"></i>').on("shown.bs.popover",function(){t.$(this).data("bs.popover").$tip.addClass("prodDowntimes-comment")})}})});