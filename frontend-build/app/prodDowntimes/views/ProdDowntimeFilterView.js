define(["underscore","app/user","app/data/aors","app/data/orgUnits","app/data/downtimeReasons","app/core/views/FilterView","app/core/util/forms/dateTimeRange","app/orgUnits/views/OrgUnitPickerView","app/mrpControllers/util/setUpMrpSelect2","app/prodDowntimes/templates/filter"],function(e,t,a,n,r,i,s,o,l,p){"use strict";return i.extend({template:p,events:e.assign({"click a[data-date-time-range]":s.handleRangeEvent,"change #-alerts":"toggleStatus"},i.prototype.events),defaultFormData:function(){return{aor:null,aorIn:!0,reason:null,reasonIn:!0,status:null,mrp:""}},termToForm:{startedAt:s.rqlToForm,aor:function(e,t,a){"eq"===t.name||"ne"===t.name?(a[e+"In"]="eq"===t.name,a[e]=t.args[1]):"in"!==t.name&&"nin"!==t.name||(a[e+"In"]="in"===t.name,a[e]=t.args[1].join(","))},status:function(e,t,a){a.status=[].concat(t.args[1])},"alerts.active":function(e,t,a){a.alerts=1},"orderData.mrp":function(e,t,a){a.mrp=Array.isArray(t.args[1])?t.args[1].join(","):""},reason:"aor"},initialize:function(){i.prototype.initialize.apply(this,arguments),this.setView("#-orgUnit",new o({filterView:this}))},afterRender:function(){i.prototype.afterRender.call(this),this.$id("aor").select2({width:"256px",allowClear:!0,multiple:!0,data:a.map(function(e){return{id:e.id,text:e.getLabel()}}).sort(function(e,t){return e.text.localeCompare(t.text)})}),this.$id("reason").select2({width:"256px",allowClear:!0,multiple:!0,data:r.map(function(e){return{id:e.id,text:e.id+" - "+(e.get("label")||"?")}}).sort(function(e,t){return e.id.localeCompare(t.id)})}),this.toggleStatus(),l(this.$id("mrp"),{own:!0,view:this,width:"256px"})},serializeFormToQuery:function(e){var t=this.$id("aor").select2("val"),a=this.$id("aorIn").prop("checked"),n=this.$id("reason").select2("val"),r=this.$id("reasonIn").prop("checked"),i=this.$id("alerts").prop("checked"),o=this.fixStatus(),l=this.$id("mrp").val();s.formToRql(this,e),i?e.push({name:"eq",args:["alerts.active",!0]}):1===o.length?e.push({name:"eq",args:["status",o[0]]}):o.length>1&&e.push({name:"in",args:["status",o]}),l&&l.length&&e.push({name:"in",args:["orderData.mrp",l.split(",")]}),1===t.length?e.push({name:a?"eq":"ne",args:["aor",t[0]]}):t.length>1&&e.push({name:a?"in":"nin",args:["aor",t]}),1===n.length?e.push({name:r?"eq":"ne",args:["reason",n[0]]}):n.length>1&&e.push({name:r?"in":"nin",args:["reason",n]})},fixStatus:function(){var e=this.$('input[name="status[]"]'),t=e.filter(":checked");0===t.length&&(t=e.prop("checked",!0));var a=t.map(function(){return this.value}).get();return a.length===e.length?[]:a},toggleStatus:function(){this.$('[name="status[]"]').prop("disabled",this.$id("alerts").prop("checked"))}})});