define(["underscore","app/i18n","app/viewport","app/data/downtimeReasons","app/data/aors","app/core/views/FormView","app/users/util/setUpUserSelect2","app/prodDowntimes/templates/editForm"],function(e,t,s,r,i,a,o,n){return a.extend({template:n,idPrefix:"prodDowntimeEditForm",destroy:function(){this.$('.select2-offscreen[tabindex="-1"]').select2("destroy")},afterRender:function(){a.prototype.afterRender.call(this),this.setUpUserSelect2("master"),this.setUpUserSelect2("leader"),this.setUpUserSelect2("operator"),this.setUpReasonSelect2(),this.setUpAorSelect2(),"undecided"===this.model.get("status")&&(this.$("input[name=status]").attr("disabled",!0),this.$id("decisionComment").attr("disabled",!0)),this.$id("master").select2("focus")},setUpUserSelect2:function(e){var t=o(this.$id(e)),s=this.model.get(e);s&&s.id&&s.label&&t.select2("data",{id:s.id,text:s.label,name:s.label})},setUpReasonSelect2:function(){this.$id("reason").select2({data:r.map(function(e){return{id:e.id,text:e.id+" - "+e.getLabel()}})})},setUpAorSelect2:function(){this.$id("aor").select2({data:i.map(function(e){return{id:e.id,text:e.getLabel()}})})},serializeForm:function(e){return e.master=this.serializeUserInfo("master"),e.leader=this.serializeUserInfo("leader"),e.operator=this.serializeUserInfo("operator"),e.operators=e.operator?[e.operator]:[],e},serializeUserInfo:function(e){var t=this.$id(e).select2("data");return null===t?null:{id:t.id,label:t.name}},handleFailure:function(e){e.responseJSON&&e.responseJSON.error&&"INVALID_CHANGES"===e.responseJSON.error.message?this.$errorMessage=s.msg.show({type:"warning",time:5e3,text:t("prodDowntimes","FORM:ERROR:INVALID_CHANGES")}):a.prototype.handleFailure.apply(this,arguments)}})});