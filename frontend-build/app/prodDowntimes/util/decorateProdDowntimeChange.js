// Copyright (c) 2014, ≈Åukasz Walukiewicz <lukasz@walukiewicz.eu>. Some Rights Reserved.
// Licensed under CC BY-NC-SA 4.0 <http://creativecommons.org/licenses/by-nc-sa/4.0/>.
// Part of the walkner-wmes project <http://lukasz.walukiewicz.eu/p/walkner-wmes>

define(["underscore","app/time","app/i18n","app/data/aors","app/data/downtimeReasons","app/core/templates/userInfo"],function(e,t,r,n,a,s){"use strict";function i(e,i){switch(e){case"startedAt":case"finishedAt":return t.format(i,"YYYY-MM-DD, HH:mm:ss");case"master":case"leader":case"operator":return s({userInfo:i});case"status":return r("prodDowntimes","PROPERTY:status:"+i);case"reason":var o=a.get(i);return o?o.getLabel():i;case"aor":var c=n.get(i);return c?c.getLabel():i;default:return i||""}}var o={"WMES:ALERTS:START":function(e){var t=e.alert;return r("prodDowntimes","comments:alerts:start",{alertName:t.name,recipientCount:t.recipients.length,recipientList:t.recipients.join(", ")})},"WMES:ALERTS:NOTIFY":function(e){var t=e.alert;return r("prodDowntimes","comments:alerts:notify",{alertName:t.name,recipientCount:t.recipients.length,recipientList:t.recipients.join(", ")})},"WMES:ALERTS:FINISH":function(e){return r("prodDowntimes","comments:alerts:finish",{alertName:e.alert.name})}};return function(n){var a=/^WMES:/.test(n.comment)?o[n.comment]:null;return{time:t.toTagData(n.date),user:s({userInfo:n.user}),changes:a?[]:e.map(n.data,function(e,t){return{label:r("prodDowntimes","PROPERTY:"+t),oldValue:i(t,e[0]),newValue:i(t,e[1])}}),comment:a?a(n.data):n.comment.trim()}}});