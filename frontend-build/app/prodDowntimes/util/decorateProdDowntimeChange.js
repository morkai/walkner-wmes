// Part of <https://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

define(["underscore","app/time","app/i18n","app/data/aors","app/data/downtimeReasons","app/core/templates/userInfo"],function(e,t,n,a,r,o){"use strict";function i(e,i){switch(e){case"startedAt":case"finishedAt":return t.format(i,"L, LTS");case"master":case"leader":case"operator":return o({userInfo:i});case"status":return n("PROPERTY:status:"+i);case"reason":var s=r.get(i);return s?s.getLabel():i;case"aor":var c=a.get(i);return c?c.getLabel():i;default:return i||""}}n=n.forDomain("prodDowntimes");var s={"WMES:ALERTS:START":function(e){var t=e.alert;return n("comments:alerts:start",{alertName:t.name,recipientCount:t.recipients.length,recipientList:t.recipients.join(", ")})},"WMES:ALERTS:NOTIFY":function(e){var t=e.alert;return n("comments:alerts:notify",{alertName:t.name,recipientCount:t.recipients.length,recipientList:t.recipients.join(", ")})},"WMES:ALERTS:FINISH":function(e){return n("comments:alerts:finish",{alertName:e.alert.name})},"WMES:SPIGOT:INITIAL":function(e){return n("comments:spigot:initial",{name:e.component.name,nc12:e.component.nc12})},"WMES:SPIGOT:FINAL":function(e){return n("comments:spigot:final",{name:e.component.name,nc12:e.component.nc12})}};return function(a){var r=/^WMES:/.test(a.comment)?s[a.comment]:null;return{time:t.toTagData(a.date),user:o({userInfo:a.user}),changes:r?[]:e.map(a.data,function(e,t){return{label:n("PROPERTY:"+t),oldValue:i(t,e[0]),newValue:i(t,e[1])}}),comment:r?r(a.data):a.comment.trim()}}});