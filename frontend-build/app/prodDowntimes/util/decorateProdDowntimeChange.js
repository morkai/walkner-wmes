// Part of <http://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

define(["underscore","app/time","app/i18n","app/data/aors","app/data/downtimeReasons","app/core/templates/userInfo"],function(e,t,n,a,r,o){"use strict";function s(e,s){switch(e){case"startedAt":case"finishedAt":return t.format(s,"YYYY-MM-DD, HH:mm:ss");case"master":case"leader":case"operator":return o({userInfo:s});case"status":return n("PROPERTY:status:"+s);case"reason":var i=r.get(s);return i?i.getLabel():s;case"aor":var c=a.get(s);return c?c.getLabel():s;default:return s||""}}n=n.forDomain("prodDowntimes");var i={"WMES:ALERTS:START":function(e){var t=e.alert;return n("comments:alerts:start",{alertName:t.name,recipientCount:t.recipients.length,recipientList:t.recipients.join(", ")})},"WMES:ALERTS:NOTIFY":function(e){var t=e.alert;return n("comments:alerts:notify",{alertName:t.name,recipientCount:t.recipients.length,recipientList:t.recipients.join(", ")})},"WMES:ALERTS:FINISH":function(e){return n("comments:alerts:finish",{alertName:e.alert.name})},"WMES:SPIGOT:INITIAL":function(e){return n("comments:spigot:initial",{name:e.component.name,nc12:e.component.nc12})},"WMES:SPIGOT:FINAL":function(e){return n("comments:spigot:final",{name:e.component.name,nc12:e.component.nc12})}};return function(a){var r=/^WMES:/.test(a.comment)?i[a.comment]:null;return{time:t.toTagData(a.date),user:o({userInfo:a.user}),changes:r?[]:e.map(a.data,function(e,t){return{label:n("PROPERTY:"+t),oldValue:s(t,e[0]),newValue:s(t,e[1])}}),comment:r?r(a.data):a.comment.trim()}}});