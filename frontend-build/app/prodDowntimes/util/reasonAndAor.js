define(["underscore","app/data/downtimeReasons","app/data/aors","app/data/subdivisions"],function(s,e,t,n){"use strict";return{reasons:e,aors:t,initialize:function(s){s.reasonsToAorsMap={},s.reasonsList=[],s.aorsList={}},destroy:function(s){s.reasonsToAorsMap=null,s.reasonsList=null,s.aorsList=null},setUpReasons:function(t,o,a){var r={},i=[],u=n.get(a),l=u?u.get("aor"):null,c=o;c||(c=u?e.findBySubdivisionType(u.get("type")):e),c.forEach(function(e){var t={},n=!1;e.get("defaultAor")&&l?(t[l]=!0,n=!0):s.forEach(e.get("aors"),function(s){t[s]=!0,n=!0}),n||(t=null),r[e.id]=t,i.push({id:e.id,text:e.id+" - "+e.get("label"),reason:e,aors:t})}),t.reasonsToAorsMap=r,t.reasonsList=i},setUpAors:function(s){var e=[];t.forEach(function(s){e.push({id:s.id,text:s.get("name"),aor:s})}),s.aorsList=e},getReasonsForAor:function(s,e){if(!e)return s.reasonsList;for(var t=[],n=0;n<s.reasonsList.length;++n){var o=s.reasonsList[n];o.aors&&!o.aors[e]||t.push(o)}return t},getAorsForReason:function(e,n){if(!n)return e.aorsList;var o=e.reasonsToAorsMap[n];if(void 0===o)return[];if(null===o)return e.aorsList;var a=[];return s.forEach(Object.keys(o),function(s){var e=t.get(s);a.push({id:s,text:e.get("name"),aor:e})}),a},setUpReasonSelect2:function(e,t,n){var o=e.$id("reason"),a=this.getReasonsForAor(e,t);o.select2(s.assign({openOnEnter:null,data:a},n)),null===o.select2("data")&&o.select2("val",1===a.length?a[0].id:"")},setUpAorSelect2:function(e,t,n){var o=e.$id("aor"),a=this.getAorsForReason(e,t);o.select2(s.assign({openOnEnter:null,data:a},n)),null===o.select2("data")&&o.select2("val",1===a.length?a[0].id:"")}}});