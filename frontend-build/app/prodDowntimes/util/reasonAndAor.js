// Part of <http://miracle.systems/p/walkner-wmes> licensed under <CC BY-NC-SA 4.0>

define(["underscore","app/data/downtimeReasons","app/data/aors","app/data/subdivisions"],function(e,t,s,n){"use strict";return{initialize:function(e){e.reasonsToAorsMap={},e.reasonsList=[],e.aorsList={}},destroy:function(e){e.reasonsToAorsMap=null,e.reasonsList=null,e.aorsList=null},setUpReasons:function(s,o,r){var a={},i=[],u=n.get(r),l=u?u.get("aor"):null,d=o;d||(d=u?t.findBySubdivisionType(u.get("type")):t),d.forEach(function(t){var s={},n=!1;t.get("defaultAor")&&l?(s[l]=!0,n=!0):e.forEach(t.get("aors"),function(e){s[e]=!0,n=!0}),n||(s=null),a[t.id]=s,i.push({id:t.id,text:t.id+" - "+t.get("label"),aors:s})}),s.reasonsToAorsMap=a,s.reasonsList=i},setUpAors:function(e){var t=[];s.forEach(function(e){t.push({id:e.id,text:e.get("name")})}),e.aorsList=t},getReasonsForAor:function(e,t){if(!t)return e.reasonsList;for(var s=[],n=0;n<e.reasonsList.length;++n){var o=e.reasonsList[n];(!o.aors||o.aors[t])&&s.push(o)}return s},getAorsForReason:function(t,n){if(!n)return t.aorsList;var o=t.reasonsToAorsMap[n];if(void 0===o)return[];if(null===o)return t.aorsList;var r=[];return e.forEach(Object.keys(o),function(e){r.push({id:e,text:s.get(e).get("name")})}),r},setUpReasonSelect2:function(t,s,n){var o=t.$id("reason"),r=this.getReasonsForAor(t,s);o.select2(e.extend({openOnEnter:null,data:r},n)),null===o.select2("data")&&o.select2("val",1===r.length?r[0].id:"")},setUpAorSelect2:function(t,s,n){var o=t.$id("aor"),r=this.getAorsForReason(t,s);o.select2(e.extend({openOnEnter:null,data:r},n)),null===o.select2("data")&&o.select2("val",1===r.length?r[0].id:"")}}});