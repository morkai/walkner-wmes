// Copyright (c) 2014, ≈Åukasz Walukiewicz <lukasz@walukiewicz.eu>. Some Rights Reserved.
// Licensed under CC BY-NC-SA 4.0 <http://creativecommons.org/licenses/by-nc-sa/4.0/>.
// Part of the walkner-wmes project <http://lukasz.walukiewicz.eu/p/walkner-wmes>

define(["underscore","app/data/downtimeReasons","app/data/aors","app/data/subdivisions"],function(e,s,t,n){"use strict";return{initialize:function(e){e.reasonsToAorsMap={},e.reasonsList=[],e.aorsList={}},destroy:function(e){e.reasonsToAorsMap=null,e.reasonsList=null,e.aorsList=null},setUpReasons:function(t,o,r){var a={},i=[],u=n.get(r),l=u?u.get("aor"):null;(o||s).forEach(function(s){var t={},n=!1;s.get("defaultAor")&&l?(t[l]=!0,n=!0):e.forEach(s.get("aors"),function(e){t[e]=!0,n=!0}),n||(t=null),a[s.id]=t,i.push({id:s.id,text:s.id+" - "+s.get("label"),aors:t})}),t.reasonsToAorsMap=a,t.reasonsList=i},setUpAors:function(e){var s=[];t.forEach(function(e){s.push({id:e.id,text:e.get("name")})}),e.aorsList=s},getReasonsForAor:function(e,s){if(!s)return e.reasonsList;for(var t=[],n=0;n<e.reasonsList.length;++n){var o=e.reasonsList[n];(!o.aors||o.aors[s])&&t.push(o)}return t},getAorsForReason:function(s,n){if(!n)return s.aorsList;var o=s.reasonsToAorsMap[n];if(void 0===o)return[];if(null===o)return s.aorsList;var r=[];return e.forEach(Object.keys(o),function(e){r.push({id:e,text:t.get(e).get("name")})}),r},setUpReasonSelect2:function(s,t,n){var o=s.$id("reason"),r=this.getReasonsForAor(s,t);o.select2(e.extend({openOnEnter:null,data:r},n)),null===o.select2("data")&&o.select2("val",1===r.length?r[0].id:"")},setUpAorSelect2:function(s,t,n){var o=s.$id("aor"),r=this.getAorsForReason(s,t);o.select2(e.extend({openOnEnter:null,data:r},n)),null===o.select2("data")&&o.select2("val",1===r.length?r[0].id:"")}}});