// Copyright (c) 2014, ≈Åukasz Walukiewicz <lukasz@walukiewicz.eu>. Some Rights Reserved.
// Licensed under CC BY-NC-SA 4.0 <http://creativecommons.org/licenses/by-nc-sa/4.0/>.
// Part of the walkner-wmes project <http://lukasz.walukiewicz.eu/p/walkner-wmes>

define(["app/i18n","app/user","app/core/util/bindLoadingMessage","app/core/util/pageActions","app/core/pages/FilteredListPage","app/opinionSurveys/OpinionSurveyCollection","app/opinionSurveys/dictionaries","../views/OpinionSurveyActionListView","../views/OpinionSurveyActionFilterView"],function(e,i,n,t,o,r,s,u,a){"use strict";return o.extend({baseBreadcrumb:!0,actions:function(){var e=this.collection;return[t.jump(this,e),t.add(e,function(){return i.isAllowedTo("OPINION_SURVEYS:MANAGE")||"manager"===i.data.prodFunction||"master"===i.data.prodFunction})]},defineModels:function(){o.prototype.defineModels.apply(this,arguments),this.opinionSurveys=n(new r(null,{rqlQuery:"select(label,superiors,questions)&sort(-startDate)"}),this),this.listenToOnce(this.opinionSurveys,"reset",function(){this.opinionSurveys.buildCacheMaps()})},createFilterView:function(){return new a({model:{rqlQuery:this.collection.rqlQuery,opinionSurveys:this.opinionSurveys}})},createListView:function(){return new u({collection:this.collection,opinionSurveys:this.opinionSurveys})},destroy:function(){o.prototype.destroy.call(this),s.unload()},load:function(e){return e(this.collection.fetch({reset:!0}),this.opinionSurveys.fetch({reset:!0}),s.load())},afterRender:function(){o.prototype.afterRender.call(this),s.load()}})});