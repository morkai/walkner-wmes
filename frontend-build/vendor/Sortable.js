/**!
 * Sortable
 * @author	RubaXa   <trash@rubaxa.org>
 * @license MIT
 */

!function(t){"function"==typeof define&&define.amd?define(t):"undefined"!=typeof module&&"undefined"!=typeof module.exports?module.exports=t():window.Sortable=t()}(function(){function t(t,n){this.el=t,this.options=n=n||{};var o={group:Math.random(),store:null,handle:null,draggable:t.children[0]&&t.children[0].nodeName||(/[uo]l/i.test(t.nodeName)?"li":"*"),ghostClass:"sortable-ghost",ignore:"a, img",filter:null};for(var r in o)n[r]=n[r]||o[r];Y.forEach(function(o){n[o]=e(this,n[o]||X),i(t,o.substr(2).toLowerCase(),n[o])}),t[b]=n.group;for(var a in this)"_"===a.charAt(0)&&(this[a]=e(this,this[a]));i(t,"mousedown",this._onTapStart),i(t,"touchstart",this._onTapStart),N&&i(t,"selectstart",this._onTapStart),i(t,"dragover",this._onDragOver),i(t,"dragenter",this._onDragOver),L.push(this._onDragOver),n.store&&this.sort(n.store.get(this))}function e(t,e){var n=I.call(arguments,2);return e.bind?e.bind.apply(e,[t].concat(n)):function(){return e.apply(t,n.concat(I.call(arguments)))}}function n(t,e,n){if("*"===e)return t;if(t){n=n||C,e=e.split(".");var o=e.shift().toUpperCase(),i=new RegExp("\\s("+e.join("|")+")\\s","g");do if(!(""!==o&&t.nodeName!=o||e.length&&((" "+t.className+" ").match(i)||[]).length!=e.length))return t;while(t!==n&&(t=t.parentNode))}return null}function o(t){t.dataTransfer.dropEffect="move",t.preventDefault()}function i(t,e,n){t.addEventListener(e,n,!1)}function r(t,e,n){t.removeEventListener(e,n,!1)}function a(t,e,n){if(t)if(t.classList)t.classList[n?"add":"remove"](e);else{var o=(" "+t.className+" ").replace(/\s+/g," ").replace(" "+e+" ","");t.className=o+(n?" "+e:"")}}function s(t,e,n){if(t&&t.style){if(void 0===n)return C.defaultView&&C.defaultView.getComputedStyle?n=C.defaultView.getComputedStyle(t,""):t.currentStyle&&(n=t.currentStyle),void 0===e?n:n[e];t.style[e]=n+("string"==typeof n?"":"px")}}function l(t,e,n){if(t){var o=t.getElementsByTagName(e),i=0,r=o.length;if(n)for(;r>i;i++)n(o[i],i);return o}return[]}function h(t){return t.draggable=!1}function c(){x=!1}function f(t,e){var n=t.lastElementChild.getBoundingClientRect();return e.clientY-(n.top+n.height)>5}function d(t){for(var e=t.tagName+t.className+t.src+t.href+t.textContent,n=e.length,o=0;n--;)o+=e.charCodeAt(n);return o.toString(36)}var u,p,g,v,m,_,D,y,E,S,b="Sortable"+(new Date).getTime(),w=window,C=w.document,T=w.parseInt,N=!!C.createElement("div").dragDrop,x=!1,A=function(t,e){var n=C.createEvent("Event");return n.initEvent(t,!0,!0),n.item=e,n},O=function(t,e,n){t.dispatchEvent(A(e,n||t))},Y="onAdd onUpdate onRemove onStart onEnd onFilter".split(" "),X=function(){},I=[].slice,L=[];return t.prototype={constructor:t,_applyEffects:function(){a(u,this.options.ghostClass,!0)},_onTapStart:function(t){var e=t.touches&&t.touches[0],r=(e||t).target,a=this.options,s=this.el,c=a.filter;if("function"==typeof c&&c.call(this,r,this))return void O(s,"filter",r);if(c&&(c=c.split(",").filter(function(t){return n(r,t.trim(),s)}),c.length))return void O(s,"filter",r);if(a.handle&&(r=n(r,a.handle,s)),r=n(r,a.draggable,s),r&&"selectstart"==t.type&&"A"!=r.tagName&&"IMG"!=r.tagName&&r.dragDrop(),r&&!u&&r.parentNode===s){E=t,g=this.el,u=r,v=u.nextSibling,y=this.options.group,u.draggable=!0,a.ignore.split(",").forEach(function(t){l(r,t.trim(),h)}),e&&(E={target:r,clientX:e.clientX,clientY:e.clientY},this._onDragStart(E,!0),t.preventDefault()),i(C,"mouseup",this._onDrop),i(C,"touchend",this._onDrop),i(C,"touchcancel",this._onDrop),i(this.el,"dragstart",this._onDragStart),i(this.el,"dragend",this._onDrop),i(C,"dragover",o);try{C.selection?C.selection.empty():window.getSelection().removeAllRanges()}catch(f){}O(u,"start")}},_emulateDragOver:function(){if(S){s(p,"display","none");var t=C.elementFromPoint(S.clientX,S.clientY),e=t,n=this.options.group,o=L.length;if(e)do{if(e[b]===n){for(;o--;)L[o]({clientX:S.clientX,clientY:S.clientY,target:t,rootEl:e});break}t=e}while(e=e.parentNode);s(p,"display","")}},_onTouchMove:function(t){if(E){var e=t.touches[0],n=e.clientX-E.clientX,o=e.clientY-E.clientY,i="translate3d("+n+"px,"+o+"px,0)";S=e,s(p,"webkitTransform",i),s(p,"mozTransform",i),s(p,"msTransform",i),s(p,"transform",i),t.preventDefault()}},_onDragStart:function(t,e){var n=t.dataTransfer;if(this._offUpEvents(),e){var o,r=u.getBoundingClientRect(),a=s(u);p=u.cloneNode(!0),s(p,"top",r.top-T(a.marginTop,10)),s(p,"left",r.left-T(a.marginLeft,10)),s(p,"width",r.width),s(p,"height",r.height),s(p,"opacity","0.8"),s(p,"position","fixed"),s(p,"zIndex","100000"),g.appendChild(p),o=p.getBoundingClientRect(),s(p,"width",2*r.width-o.width),s(p,"height",2*r.height-o.height),i(C,"touchmove",this._onTouchMove),i(C,"touchend",this._onDrop),i(C,"touchcancel",this._onDrop),this._loopId=setInterval(this._emulateDragOver,150)}else n.effectAllowed="move",n.setData("Text",u.textContent),i(C,"drop",this._onDrop);setTimeout(this._applyEffects)},_onDragOver:function(t){if(!x&&y===this.options.group&&(void 0===t.rootEl||t.rootEl===this.el)){var e=this.el,o=n(t.target,this.options.draggable,e);if(0===e.children.length||e.children[0]===p||e===t.target&&f(e,t))e.appendChild(u);else if(o&&o!==u&&void 0!==o.parentNode[b]){m!==o&&(m=o,_=s(o),D=o.getBoundingClientRect());var i,r=D,a=r.right-r.left,l=r.bottom-r.top,h=/left|right|inline/.test(_.cssFloat+_.display),d=o.offsetWidth>u.offsetWidth,g=o.offsetHeight>u.offsetHeight,v=(h?(t.clientX-r.left)/a:(t.clientY-r.top)/l)>.5,E=o.nextElementSibling;x=!0,setTimeout(c,30),i=h?o.previousElementSibling===u&&!d||v&&d:E!==u&&!g||v&&g,i&&!E?e.appendChild(u):o.parentNode.insertBefore(u,i?E:o)}}},_offUpEvents:function(){r(C,"mouseup",this._onDrop),r(C,"touchmove",this._onTouchMove),r(C,"touchend",this._onDrop),r(C,"touchcancel",this._onDrop)},_onDrop:function(t){clearInterval(this._loopId),r(C,"drop",this._onDrop),r(C,"dragover",o),r(this.el,"dragend",this._onDrop),r(this.el,"dragstart",this._onDragStart),r(this.el,"selectstart",this._onTapStart),this._offUpEvents(),t&&(t.preventDefault(),t.stopPropagation(),p&&p.parentNode.removeChild(p),u&&(h(u),a(u,this.options.ghostClass,!1),g.contains(u)?u.nextSibling!==v&&O(u,"update"):(O(g,"remove",u),O(u,"add")),O(u,"end")),g=u=p=v=E=S=m=_=y=null,this.options.store&&this.options.store.set(this))},toArray:function(){for(var t,e=[],n=this.el.children,o=0,i=n.length;i>o;o++)t=n[o],e.push(t.getAttribute("data-id")||d(t));return e},sort:function(t){var e={},n=this.el;this.toArray().forEach(function(t,o){e[t]=n.children[o]}),t.forEach(function(t){e[t]&&(n.removeChild(e[t]),n.appendChild(e[t]))})},closest:function(t,e){return n(t,e||this.options.draggable,this.el)},destroy:function(){var t=this.el,e=this.options;Y.forEach(function(n){r(t,n.substr(2).toLowerCase(),e[n])}),r(t,"mousedown",this._onTapStart),r(t,"touchstart",this._onTapStart),r(t,"selectstart",this._onTapStart),r(t,"dragover",this._onDragOver),r(t,"dragenter",this._onDragOver),Array.prototype.forEach.call(t.querySelectorAll("[draggable]"),function(t){t.removeAttribute("draggable")}),L.splice(L.indexOf(this._onDragOver),1),this._onDrop(),this.el=null}},t.utils={on:i,off:r,css:s,find:l,bind:e,closest:n,toggleClass:a,createEvent:A,dispatchEvent:O},t.version="0.5.0",t});