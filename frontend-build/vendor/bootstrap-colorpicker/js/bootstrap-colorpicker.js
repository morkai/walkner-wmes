/*!
 * Bootstrap Colorpicker
 * (c) 2012 Stefan Petre
 * http://mjaalnir.github.io/bootstrap-colorpicker/
 * http://www.apache.org/licenses/LICENSE-2.0.txt
 */

!function(e){var t=function(e){this.value={h:1,s:1,b:1,a:1},this.setColor(e)};t.prototype={constructor:t,setColor:function(t){t=t.toLowerCase();var n=this;e.each(i.stringParsers,function(e,r){var o=r.re.exec(t),a=o&&r.parse(o),s=r.space||"rgba";return a?(n.value="hsla"===s?i.RGBtoHSB.apply(null,i.HSLtoRGB.apply(null,a)):i.RGBtoHSB.apply(null,a),!1):!0})},setHue:function(e){this.value.h=1-e},setSaturation:function(e){this.value.s=e},setLightness:function(e){this.value.b=1-e},setAlpha:function(e){this.value.a=parseInt(100*(1-e),10)/100},toRGB:function(e,t,n,r){e||(e=this.value.h,t=this.value.s,n=this.value.b),e*=360;var i,o,a,s,l;return e=e%360/60,l=n*t,s=l*(1-Math.abs(e%2-1)),i=o=a=n-l,e=~~e,i+=[l,s,0,0,s,l][e],o+=[s,l,l,s,0,0][e],a+=[0,0,s,l,l,s][e],{r:Math.round(255*i),g:Math.round(255*o),b:Math.round(255*a),a:r||this.value.a}},toHex:function(e,t,n,r){var i=this.toRGB(e,t,n,r);return"#"+(1<<24|parseInt(i.r)<<16|parseInt(i.g)<<8|parseInt(i.b)).toString(16).substr(1)},toHSL:function(e,t,n,r){e||(e=this.value.h,t=this.value.s,n=this.value.b);var i=e,o=(2-t)*n,a=t*n;return a/=o>0&&1>=o?o:2-o,o/=2,a>1&&(a=1),{h:i,s:a,l:o,a:r||this.value.a}}};var n=0,r=function(t,r){n++,this.element=e(t).attr("data-colorpicker-guid",n);var o=r.format||this.element.data("color-format")||"hex";this.format=i.translateFormats[o],this.isInput=this.element.is("input"),this.component=this.element.is(".colorpicker-component")?this.element.find(".add-on, .input-group-addon"):!1,this.picker=e(i.template).attr("data-colorpicker-guid",n).appendTo("body").on("mousedown.colorpicker",e.proxy(this.mousedown,this)),this.isInput?this.element.on({"focus.colorpicker":e.proxy(this.show,this),"keyup.colorpicker":e.proxy(this.update,this)}):this.component?this.component.on({"click.colorpicker":e.proxy(this.show,this)}):this.element.on({"click.colorpicker":e.proxy(this.show,this)}),("rgba"===o||"hsla"===o)&&(this.picker.addClass("alpha"),this.alpha=this.picker.find(".colorpicker-alpha")[0].style),this.component?(this.picker.find(".colorpicker-color").hide(),this.preview=this.element.find("i")[0].style):this.preview=this.picker.find("div:last")[0].style,this.base=this.picker.find("div:first")[0].style,this.update(),e(e.proxy(function(){this.element.trigger("create",[this])},this))};r.prototype={constructor:r,show:function(t){this.picker.show(),this.height=this.component?this.component.outerHeight():this.element.outerHeight(),this.place(),e(window).on("resize.colorpicker",e.proxy(this.place,this)),this.isInput||t&&(t.stopPropagation(),t.preventDefault()),e(document).on({"mousedown.colorpicker":e.proxy(this.hide,this)}),this.element.trigger({type:"showPicker",color:this.color})},update:function(){var e=this.isInput?this.element.prop("value"):this.element.data("color");("undefined"==typeof e||null===e)&&(e="#ffffff"),this.color=new t(e),this.picker.find("i").eq(0).css({left:100*this.color.value.s,top:100-100*this.color.value.b}).end().eq(1).css("top",100*(1-this.color.value.h)).end().eq(2).css("top",100*(1-this.color.value.a)),this.previewColor()},hide:function(){this.picker.hide(),e(window).off("resize",this.place),e(document).off({mousedown:this.hide}),this.isInput?""!==this.element.val()&&this.element.prop("value",this.format.call(this)).trigger("change"):(this.component&&""!==this.element.find("input").val()&&this.element.find("input").prop("value",this.format.call(this)).trigger("change"),this.element.data("color",this.format.call(this))),this.element.trigger({type:"hidePicker",color:this.color})},place:function(){var e=this.component?this.component.offset():this.element.offset();this.picker.css({top:e.top+this.height,left:e.left})},destroy:function(){e(".colorpicker[data-colorpicker-guid="+this.element.attr("data-colorpicker-guid")+"]").remove(),this.element.removeData("colorpicker").removeAttr("data-colorpicker-guid").off(".colorpicker"),this.component!==!1&&this.component.off(".colorpicker"),this.element.trigger("destroy",[this])},setValue:function(e){this.isInput?this.element.prop("value",e):(this.element.find("input").val(e),this.element.data("color",e)),this.update(),this.element.trigger({type:"changeColor",color:this.color})},previewColor:function(){try{this.preview.backgroundColor=this.format.call(this)}catch(e){this.preview.backgroundColor=this.color.toHex()}this.base.backgroundColor=this.color.toHex(this.color.value.h,1,1,1),this.alpha&&(this.alpha.backgroundColor=this.color.toHex())},pointer:null,slider:null,mousedown:function(t){t.stopPropagation(),t.preventDefault();var n=e(t.target),r=n.closest("div");if(!r.is(".colorpicker")){if(r.is(".colorpicker-saturation"))this.slider=e.extend({},i.sliders.saturation);else if(r.is(".colorpicker-hue"))this.slider=e.extend({},i.sliders.hue);else{if(!r.is(".colorpicker-alpha"))return!1;this.slider=e.extend({},i.sliders.alpha)}var o=r.offset();this.slider.knob=r.find("i")[0].style,this.slider.left=t.pageX-o.left,this.slider.top=t.pageY-o.top,this.pointer={left:t.pageX,top:t.pageY},e(document).on({"mousemove.colorpicker":e.proxy(this.mousemove,this),"mouseup.colorpicker":e.proxy(this.mouseup,this)}).trigger("mousemove")}return!1},mousemove:function(e){e.stopPropagation(),e.preventDefault();var t=Math.max(0,Math.min(this.slider.maxLeft,this.slider.left+((e.pageX||this.pointer.left)-this.pointer.left))),n=Math.max(0,Math.min(this.slider.maxTop,this.slider.top+((e.pageY||this.pointer.top)-this.pointer.top)));if(this.slider.knob.left=t+"px",this.slider.knob.top=n+"px",this.slider.callLeft&&this.color[this.slider.callLeft].call(this.color,t/100),this.slider.callTop&&this.color[this.slider.callTop].call(this.color,n/100),this.previewColor(),this.isInput)try{this.element.val(this.format.call(this)).trigger("change")}catch(e){this.element.val(this.color.toHex()).trigger("change")}else try{this.element.find("input").val(this.format.call(this)).trigger("change")}catch(e){this.element.find("input").val(this.color.toHex()).trigger("change")}return this.element.trigger({type:"changeColor",color:this.color}),!1},mouseup:function(t){return t.stopPropagation(),t.preventDefault(),e(document).off({mousemove:this.mousemove,mouseup:this.mouseup}),!1}},e.fn.colorpicker=function(t,n){return this.each(function(){var i=e(this),o=i.data("colorpicker"),a="object"==typeof t&&t;o?"string"==typeof t&&o[t](n):"destroy"!==t&&i.data("colorpicker",o=new r(this,e.extend({},e.fn.colorpicker.defaults,a)))})},e.fn.colorpicker.defaults={},e.fn.colorpicker.Constructor=r;var i={translateFormats:{rgb:function(){var e=this.color.toRGB();return"rgb("+e.r+","+e.g+","+e.b+")"},rgba:function(){var e=this.color.toRGB();return"rgba("+e.r+","+e.g+","+e.b+","+e.a+")"},hsl:function(){var e=this.color.toHSL();return"hsl("+Math.round(360*e.h)+","+Math.round(100*e.s)+"%,"+Math.round(100*e.l)+"%)"},hsla:function(){var e=this.color.toHSL();return"hsla("+Math.round(360*e.h)+","+Math.round(100*e.s)+"%,"+Math.round(100*e.l)+"%,"+e.a+")"},hex:function(){return this.color.toHex()}},sliders:{saturation:{maxLeft:100,maxTop:100,callLeft:"setSaturation",callTop:"setLightness"},hue:{maxLeft:0,maxTop:100,callLeft:!1,callTop:"setHue"},alpha:{maxLeft:0,maxTop:100,callLeft:!1,callTop:"setAlpha"}},RGBtoHSB:function(e,t,n,r){e/=255,t/=255,n/=255;var i,o,a,s;return a=Math.max(e,t,n),s=a-Math.min(e,t,n),i=0===s?null:a===e?(t-n)/s:a===t?(n-e)/s+2:(e-t)/s+4,i=60*((i+360)%6)/360,o=0===s?0:s/a,{h:i||1,s:o,b:a,a:r||1}},HueToRGB:function(e,t,n){return 0>n?n+=1:n>1&&(n-=1),1>6*n?e+6*(t-e)*n:1>2*n?t:2>3*n?e+6*(t-e)*(2/3-n):e},HSLtoRGB:function(e,t,n,r){0>t&&(t=0);var o;o=.5>=n?n*(1+t):n+t-n*t;var a=2*n-o,s=e+1/3,l=e,u=e-1/3,c=Math.round(255*i.HueToRGB(a,o,s)),d=Math.round(255*i.HueToRGB(a,o,l)),p=Math.round(255*i.HueToRGB(a,o,u));return[c,d,p,r||1]},stringParsers:[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,parse:function(e){return[e[1],e[2],e[3],e[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,parse:function(e){return[2.55*e[1],2.55*e[2],2.55*e[3],e[4]]}},{re:/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/,parse:function(e){return[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]}},{re:/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/,parse:function(e){return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)]}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,space:"hsla",parse:function(e){return[e[1]/360,e[2]/100,e[3]/100,e[4]]}}],template:'<div class="colorpicker dropdown-menu"><div class="colorpicker-saturation"><i><b></b></i></div><div class="colorpicker-hue"><i></i></div><div class="colorpicker-alpha"><i></i></div><div class="colorpicker-color"><div /></div></div>'}}(window.jQuery);