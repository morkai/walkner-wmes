define(["require","exports","module"],function(t,i,r){function s(t){this.broker=t,this.subscriptions={},this.removeSubscription=this.removeSubscription.bind(this)}r.exports=s,s.prototype.destroy=function(){var t=this.subscriptions;null!==t&&Object.keys(t).forEach(function(i){t[i].cancel()}),this.subscriptions=null,this.broker=null},s.prototype.sandbox=function(){return new s(this)},s.prototype.publish=function(t,i,r){return this.broker.publish(t,i,r),this},s.prototype.subscribe=function(t,i){var r=this.broker.subscribe(t,i);return r.on("cancel",this.removeSubscription),this.subscriptions[r.getId()]=r,r},s.prototype.unsubscribe=function(t){var i=[],r=this.subscriptions;for(var s in r)r.hasOwnProperty(s)&&r[s].getTopic()===t&&i.push(s);for(var o=0,e=i.length;e>o;++o)r[i[o]].cancel();return this},s.prototype.removeSubscription=function(t){delete this.subscriptions[t.getId()]}});