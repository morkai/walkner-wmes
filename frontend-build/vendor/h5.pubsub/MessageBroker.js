define(["require","exports","module","./Subscriptions","./Subscription","./Sandbox"],function(t,n,e){"use strict";function s(){this.subscriptions=new i(this),this.nextSubscriptionId=0,this.listeners={subscribe:[],cancel:[],"new topic":[],"empty topic":[],message:[]}}var i=t("./Subscriptions"),r=t("./Subscription"),o=t("./Sandbox");e.exports=s,s.prototype.destroy=function(){this.subscriptions.destroy(),this.subscriptions=null,this.listeners=null},s.prototype.sandbox=function(){return new o(this)},s.prototype.publish=function(t,n,e){return"undefined"==typeof e&&(e={}),this.emit("message",t,n,e),this.subscriptions.send(t,n,e),this},s.prototype.subscribe=function(t,n){var e=new r(this.getNextSubscriptionId(),t);return"function"==typeof n&&e.on("message",n),this.subscriptions.add(e),this.emit("subscribe",e),e},s.prototype.unsubscribe=function(t){return this.subscriptions.remove(t),this},s.prototype.count=function(){var t={};if(null===this.subscriptions)return t;var n="";return this.subscriptions.count(n,t),t},s.prototype.on=function(t,n){var e=this.listeners[t],s=typeof e;if("undefined"===s)throw new Error("Unknown event: "+t);return e.push(n),this},s.prototype.off=function(t,n){var e=this.listeners[t],s=typeof e;if("undefined"===s)throw new Error("Unknown event: "+t);var i=e.indexOf(n);return-1!==i&&e.splice(i,1),this},s.prototype.emit=function(t,n){var e=this.listeners[t],s=typeof e;if("undefined"===s)throw new Error("Unknown event: "+t);if(!e.length)return this;var i=arguments.length;i>4&&(n=Array.prototype.slice.call(arguments),n.shift());for(var r=0,o=e.length;o>r;++r){var u=e[r];switch(i){case 4:u(arguments[1],arguments[2],arguments[3]);break;case 3:u(arguments[1],arguments[2]);break;case 2:u(arguments[1]);break;default:u.apply(null,n)}}return this},s.prototype.getNextSubscriptionId=function(){return(this.nextSubscriptionId++).toString(36)}});