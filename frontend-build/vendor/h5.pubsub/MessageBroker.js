define(["require","exports","module","./Subscriptions","./Subscription","./Sandbox"],function(t,i,s){"use strict";function n(){this.subscriptions=new r(this),this.nextSubscriptionId=0,this.listeners={subscribe:[],cancel:[],"new topic":[],"empty topic":[],message:[]}}var r=t("./Subscriptions"),e=t("./Subscription"),o=t("./Sandbox");s.exports=n,n.prototype.destroy=function(){this.subscriptions.destroy(),this.subscriptions=null,this.listeners=null},n.prototype.sandbox=function(){return new o(this)},n.prototype.publish=function(t,i,s){return void 0===s&&(s={}),this.emit("message",t,i,s),this.subscriptions.send(t,i,s),this},n.prototype.subscribe=function(t,i){var s=new e(this.getNextSubscriptionId(),t);return"function"==typeof i&&s.on("message",i),this.subscriptions.add(s),this.emit("subscribe",s),s},n.prototype.unsubscribe=function(t){return this.subscriptions.remove(t),this},n.prototype.count=function(){var t={};if(null===this.subscriptions)return t;return this.subscriptions.count("",t),t},n.prototype.on=function(t,i){var s=this.listeners[t];if(void 0===s)throw new Error("Unknown event: "+t);return s.push(i),this},n.prototype.off=function(t,i){var s=this.listeners[t];if(void 0===s)throw new Error("Unknown event: "+t);var n=s.indexOf(i);return-1!==n&&s.splice(n,1),this},n.prototype.emit=function(t,i){var s=this.listeners[t];if(void 0===s)throw new Error("Unknown event: "+t);if(!s.length)return this;var n=arguments.length;n>4&&(i=Array.prototype.slice.call(arguments),i.shift());for(var r=0,e=s.length;r<e;++r){var o=s[r];switch(n){case 4:o(arguments[1],arguments[2],arguments[3]);break;case 3:o(arguments[1],arguments[2]);break;case 2:o(arguments[1]);break;default:o.apply(null,i)}}return this},n.prototype.getNextSubscriptionId=function(){return(this.nextSubscriptionId++).toString(36)}});