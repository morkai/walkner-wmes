define(function(t,n,i){"use strict";var e=t("./Subscriptions"),s=t("./Subscription"),r=t("./Sandbox");function o(){this.subscriptions=new e(this),this.nextSubscriptionId=0,this.listeners={subscribe:[],cancel:[],"new topic":[],"empty topic":[],message:[]}}i.exports=o,o.prototype.destroy=function(){this.subscriptions.destroy(),this.subscriptions=null,this.listeners=null},o.prototype.sandbox=function(){return new r(this)},o.prototype.publish=function(t,n,i){return void 0===i&&(i={}),this.emit("message",t,n,i),this.subscriptions.send(t,n,i),this},o.prototype.subscribe=function(t,n){var i=new s(this.getNextSubscriptionId(),t);return"function"==typeof n&&i.on("message",n),this.subscriptions.add(i),this.emit("subscribe",i),i},o.prototype.unsubscribe=function(t){return this.subscriptions.remove(t),this},o.prototype.count=function(){var t={};if(null===this.subscriptions)return t;return this.subscriptions.count("",t),t},o.prototype.on=function(t,n){var i=this.listeners[t];if("undefined"===typeof i)throw new Error("Unknown event: "+t);return i.push(n),this},o.prototype.off=function(t,n){var i=this.listeners[t];if("undefined"===typeof i)throw new Error("Unknown event: "+t);var e=i.indexOf(n);return-1!==e&&i.splice(e,1),this},o.prototype.emit=function(t,n){var i=this.listeners[t];if("undefined"===typeof i)throw new Error("Unknown event: "+t);if(!i.length)return this;var e=arguments.length;e>4&&(n=Array.prototype.slice.call(arguments)).shift();for(var s=0,r=i.length;s<r;++s){var o=i[s];switch(e){case 4:o(arguments[1],arguments[2],arguments[3]);break;case 3:o(arguments[1],arguments[2]);break;case 2:o(arguments[1]);break;default:o.apply(null,n)}}return this},o.prototype.getNextSubscriptionId=function(){return(this.nextSubscriptionId++).toString(36)}});