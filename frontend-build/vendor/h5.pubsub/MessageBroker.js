define(["require","exports","module","./Subscriptions","./Subscription","./Sandbox"],function(e,t,n){function r(){this.subscriptions=new i(this),this.nextSubscriptionId=0,this.listeners={subscribe:null,cancel:null,"new topic":null,"empty topic":null,message:null}}var i=e("./Subscriptions"),o=e("./Subscription"),a=e("./Sandbox");n.exports=r,r.prototype.destroy=function(){this.subscriptions.destroy(),this.listeners=null},r.prototype.sandbox=function(){return new a(this)},r.prototype.publish=function(e,t,n){return"undefined"==typeof n&&(n={}),this.emit("message",e,t,n),this.subscriptions.send(e,t,n),this},r.prototype.subscribe=function(e,t){var n=new o(this.getNextSubscriptionId(),e);return"function"==typeof t&&n.on("message",t),this.subscriptions.add(n),this.emit("subscribe",n),n},r.prototype.unsubscribe=function(e){return this.subscriptions.remove(e),this},r.prototype.count=function(){var e="",t={};return this.subscriptions.count(e,t),t},r.prototype.on=function(e,t){var n=this.listeners[e],r=typeof n;if("undefined"===r)throw new Error("Unknown event: "+e);return null===n?this.listeners[e]=t:"function"===r?this.listeners[e]=[n,t]:this.listeners[e].push(t),this},r.prototype.off=function(e,t){var n=this.listeners[e],r=typeof n;if("undefined"===r)throw new Error("Unknown event: "+e);if("function"===r&&n===t)this.listeners[e]=null;else if("object"===r&&null!==n){for(var i=-1,o=n.length,a=0;o>a;++a)if(n[a]===t){i=a;break}-1!==i&&(n.splice(i,1),2===o&&(this.listeners[e]=n[0]))}return this},r.prototype.emit=function(e,t){var n=this.listeners[e],r=typeof n;if("undefined"===r)throw new Error("Unknown event: "+e);if(null===n)return this;var i=arguments.length;if("function"==typeof n){switch(i){case 4:n(arguments[1],arguments[2],arguments[3]);break;case 3:n(arguments[1],arguments[2]);break;case 2:n(arguments[1]);break;default:t=Array.prototype.slice.call(arguments),t.shift(),n.apply(null,t)}return this}i>4&&(t=Array.prototype.slice.call(arguments),t.shift());for(var o=0,a=n.length;a>o;++o){var s=n[o];switch(i){case 4:s(arguments[1],arguments[2],arguments[3]);break;case 3:s(arguments[1],arguments[2]);break;case 2:s(arguments[1]);break;default:s.apply(null,t)}}return this},r.prototype.getNextSubscriptionId=function(){return(this.nextSubscriptionId++).toString(36)}});