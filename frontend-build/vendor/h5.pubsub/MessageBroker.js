define(["require","exports","module","./Subscriptions","./Subscription","./Sandbox"],function(t,n,e){"use strict";function i(){this.subscriptions=new s(this),this.nextSubscriptionId=0,this.listeners={subscribe:[],cancel:[],"new topic":[],"empty topic":[],message:[]}}var s=t("./Subscriptions"),r=t("./Subscription"),o=t("./Sandbox");e.exports=i,i.prototype.destroy=function(){this.subscriptions.destroy(),this.subscriptions=null,this.listeners=null},i.prototype.sandbox=function(){return new o(this)},i.prototype.publish=function(t,n,e){return"undefined"==typeof e&&(e={}),this.emit("message",t,n,e),this.subscriptions.send(t,n,e),this},i.prototype.subscribe=function(t,n){var e=new r(this.getNextSubscriptionId(),t);return"function"==typeof n&&e.on("message",n),this.subscriptions.add(e),this.emit("subscribe",e),e},i.prototype.unsubscribe=function(t){return this.subscriptions.remove(t),this},i.prototype.count=function(){var t={};if(null===this.subscriptions)return t;var n="";return this.subscriptions.count(n,t),t},i.prototype.on=function(t,n){var e=this.listeners[t],i=typeof e;if("undefined"===i)throw new Error("Unknown event: "+t);return e.push(n),this},i.prototype.off=function(t,n){var e=this.listeners[t],i=typeof e;if("undefined"===i)throw new Error("Unknown event: "+t);var s=e.indexOf(n);return s!==-1&&e.splice(s,1),this},i.prototype.emit=function(t,n){var e=this.listeners[t],i=typeof e;if("undefined"===i)throw new Error("Unknown event: "+t);if(!e.length)return this;var s=arguments.length;s>4&&(n=Array.prototype.slice.call(arguments),n.shift());for(var r=0,o=e.length;r<o;++r){var u=e[r];switch(s){case 4:u(arguments[1],arguments[2],arguments[3]);break;case 3:u(arguments[1],arguments[2]);break;case 2:u(arguments[1]);break;default:u.apply(null,n)}}return this},i.prototype.getNextSubscriptionId=function(){return(this.nextSubscriptionId++).toString(36)}});