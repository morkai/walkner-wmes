define(["d3"],function(e){return e.timeline=function(){function t(t){function n(){var t=Math.min(0,Math.max(D.width-u,e.event.translate[0]));_.translate([t,0]),C.attr("transform","translate("+t+",0)"),s(t*F,x)}function O(e){return g.left+(e.starting_time-m)*F}function A(){if(c||S.attr("height"))c?S.attr("height",c):c=S.attr("height");else{if(!b)throw"height of the timeline is not set";c=U.height+U.top-D.top,e.select(t[0][0]).attr("height",c)}}function k(){if(!u&&!D.width)throw"width of the timeline is not set. As of Firefox 27, timeline().with(x) needs to be explicitly set in order to render";u&&D.width||(u?S.attr("width",u):u=S.attr("width"))}var C=t.append("g"),D=t[0][0].getBoundingClientRect(),S=e.select(t[0][0]),I={},N=1,L=0,z=0;k(),(w||0==v&&0==m)&&(C.each(function(e){e.forEach(function(e,t){w&&-1==Object.keys(I).indexOf(t)&&(I[t]=N,N++),0==v&&0==m&&e.times.forEach(function(e){(e.starting_time<L||0==L)&&(L=e.starting_time),e.ending_time>z&&(z=e.ending_time)})})}),0==v&&0==m&&(m=L,v=z));var F=1/(v-m)*(u-g.left-g.right),x=e.time.scale().domain([m,v]).range([g.left,u-g.right]),M=e.svg.axis().scale(x).orient(l).tickFormat(d.format).ticks(d.tickTime,d.tickNumber).tickSize(d.tickSize);if(C.append("g").attr("class","axis").attr("transform","translate(0,"+(g.top+(b+E)*N)+")").call(M),C.each(function(e){e.forEach(function(e,n){function s(){return w?g.top+(b+E)*I[n]:g.top}var l=e.times,u="undefined"!=typeof e.label;C.selectAll("svg").data(l).enter().append(h).attr("x",O).attr("y",s).attr("width",function(e){return(e.ending_time-e.starting_time)*F}).attr("cy",s).attr("cx",O).attr("r",b/2).attr("height",b).attr("class",R).style("fill",function(){return f?p(e[f]):p?p(n):null}).on("mousemove",function(t){r.call(this,t,n,e)}).on("mouseover",function(t,n){i.call(this,t,n,e)}).on("mouseout",function(t,n){o.call(this,t,n,e)}).on("click",function(t){a.call(this,t,n,e)}),u&&t.append("text").attr("class","timeline-label").attr("transform","translate(0,"+(b/2+g.top+(b+E)*I[n])+")").text(u?e.label:e.id),"undefined"!=typeof e.icon&&t.append("image").attr("class","timeline-label").attr("transform","translate(0,"+(g.top+(b+E)*I[n])+")").attr("xlink:href",e.icon).attr("width",g.left).attr("height",b)})}),u>D.width){var _=e.behavior.zoom().x(x).on("zoom",n);t.attr("class","scrollable").call(_)}y&&C.selectAll("text").attr("transform",function(){return"rotate("+y+")translate("+(this.getBBox().width/2+10)+","+this.getBBox().height/2+")"});var U=C[0][0].getBoundingClientRect();if(A(),P){var j=x(new Date);t.append("svg:line").attr("x1",j).attr("y1",T.marginTop).attr("x2",j).attr("y2",c-T.marginBottom).style("stroke",T.color).style("stroke-width",T.width)}}var n=["circle","rect"],r=function(){},i=function(){},o=function(){},a=function(){},s=function(){},l="bottom",u=null,c=null,d={format:e.time.format("%I %p"),tickTime:e.time.hours,tickNumber:1,tickSize:6},p=e.scale.category20(),f=null,h="rect",m=0,v=0,g={left:30,right:30,top:30,bottom:30},w=!1,y=!1,b=20,E=5,P=!1,T={marginTop:25,marginBottom:0,width:1,color:p},R="timeline-item";return t.margin=function(e){return arguments.length?(g=e,t):g},t.orient=function(e){return arguments.length?(l=e,t):l},t.itemHeight=function(e){return arguments.length?(b=e,t):b},t.itemMargin=function(e){return arguments.length?(E=e,t):E},t.height=function(e){return arguments.length?(c=e,t):c},t.width=function(e){return arguments.length?(u=e,t):u},t.display=function(e){return arguments.length&&-1!=n.indexOf(e)?(h=e,t):h},t.tickFormat=function(e){return arguments.length?(d=e,t):d},t.hover=function(e){return arguments.length?(r=e,t):r},t.mouseover=function(e){return arguments.length?(i=e,t):e},t.mouseout=function(e){return arguments.length?(o=e,t):e},t.click=function(e){return arguments.length?(a=e,t):a},t.scroll=function(e){return arguments.length?(s=e,t):s},t.colors=function(e){return arguments.length?(p=e,t):p},t.beginning=function(e){return arguments.length?(m=e,t):m},t.ending=function(e){return arguments.length?(v=e,t):v},t.rotateTicks=function(e){return y=e,t},t.stack=function(){return w=!w,t},t.showToday=function(){return P=!P,t},t.showTodayFormat=function(e){return arguments.length?(T=e,t):T},t.colorProperty=function(e){return arguments.length?(f=e,t):f},t.itemClassName=function(e){return arguments.length?(R=e,t):R},t}});