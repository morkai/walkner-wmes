define(["d3"],function(t){return t.timeline=function(){function n(n){function e(){var n=Math.min(0,Math.max(E.width-s,t.event.translate[0]));I.translate([n,0]),C.attr("transform","translate("+n+",0)"),u(n*j,D)}function z(t){return x.left+(t.starting_time-p)*j}function F(){if(f||M.attr("height"))f?M.attr("height",f):f=M.attr("height");else{if(!y)throw"height of the timeline is not set";f=P.height+P.top-E.top,t.select(n[0][0]).attr("height",f)}}function A(){if(!s&&!E.width)throw"width of the timeline is not set. As of Firefox 27, timeline().with(x) needs to be explicitly set in order to render";s&&E.width||(s?M.attr("width",s):s=M.attr("width"))}var C=n.append("g"),E=n[0][0].getBoundingClientRect(),M=t.select(n[0][0]),N={},O=1,R=0,S=0;A(),(k||0==w&&0==p)&&(C.each(function(t){t.forEach(function(t,n){k&&-1==Object.keys(N).indexOf(n)&&(N[n]=O,O++),0==w&&0==p&&t.times.forEach(function(t){(t.starting_time<R||0==R)&&(R=t.starting_time),t.ending_time>S&&(S=t.ending_time)})})}),0==w&&0==p&&(p=R,w=S));var j=1/(w-p)*(s-x.left-x.right),D=t.time.scale().domain([p,w]).range([x.left,s-x.right]),H=t.svg.axis().scale(D).orient(c).tickFormat(g.format).ticks(g.tickTime,g.tickNumber).tickSize(g.tickSize);if(C.append("g").attr("class","axis").attr("transform","translate(0,"+(x.top+(y+b)*O)+")").call(H),C.each(function(t){t.forEach(function(t,e){function u(){return k?x.top+(y+b)*N[e]:x.top}var c=t.times,s="undefined"!=typeof t.label;C.selectAll("svg").data(c).enter().append(d).attr("x",z).attr("y",u).attr("width",function(t){return(t.ending_time-t.starting_time)*j}).attr("cy",u).attr("cx",z).attr("r",y/2).attr("height",y).attr("class",_).style("fill",function(){return m?h(t[m]):h?h(e):null}).on("mousemove",function(n){r.call(this,n,e,t)}).on("mouseover",function(n,e){i.call(this,n,e,t)}).on("mouseout",function(n,e){a.call(this,n,e,t)}).on("click",function(n){o.call(this,n,e,t)}).each(l),s&&n.append("text").attr("class","timeline-label").attr("transform","translate(0,"+(y/2+x.top+(y+b)*N[e])+")").text(s?t.label:t.id),"undefined"!=typeof t.icon&&n.append("image").attr("class","timeline-label").attr("transform","translate(0,"+(x.top+(y+b)*N[e])+")").attr("xlink:href",t.icon).attr("width",x.left).attr("height",y)})}),s>E.width){var I=t.behavior.zoom().x(D).on("zoom",e);n.attr("class","scrollable").call(I)}v&&C.selectAll("text").attr("transform",function(){return"rotate("+v+")translate("+(this.getBBox().width/2+10)+","+this.getBBox().height/2+")"});var P=C[0][0].getBoundingClientRect();if(F(),B){var q=D(new Date);n.append("svg:line").attr("x1",q).attr("y1",T.marginTop).attr("x2",q).attr("y2",f-T.marginBottom).style("stroke",T.color).style("stroke-width",T.width)}}var e=["circle","rect"],r=function(){},i=function(){},a=function(){},o=function(){},u=function(){},l=function(){},c="bottom",s=null,f=null,g={format:t.time.format("%I %p"),tickTime:t.time.hours,tickNumber:1,tickSize:6},h=t.scale.category20(),m=null,d="rect",p=0,w=0,x={left:30,right:30,top:30,bottom:30},k=!1,v=!1,y=20,b=5,B=!1,T={marginTop:25,marginBottom:0,width:1,color:h},_="timeline-item";return n.margin=function(t){return arguments.length?(x=t,n):x},n.orient=function(t){return arguments.length?(c=t,n):c},n.itemHeight=function(t){return arguments.length?(y=t,n):y},n.itemMargin=function(t){return arguments.length?(b=t,n):b},n.height=function(t){return arguments.length?(f=t,n):f},n.width=function(t){return arguments.length?(s=t,n):s},n.display=function(t){return arguments.length&&-1!=e.indexOf(t)?(d=t,n):d},n.tickFormat=function(t){return arguments.length?(g=t,n):g},n.hover=function(t){return arguments.length?(r=t,n):r},n.mouseover=function(t){return arguments.length?(i=t,n):t},n.mouseout=function(t){return arguments.length?(a=t,n):t},n.click=function(t){return arguments.length?(o=t,n):o},n.scroll=function(t){return arguments.length?(u=t,n):u},n.afterRender=function(t){return arguments.length?(l=t,n):l},n.colors=function(t){return arguments.length?(h=t,n):h},n.beginning=function(t){return arguments.length?(p=t,n):p},n.ending=function(t){return arguments.length?(w=t,n):w},n.rotateTicks=function(t){return v=t,n},n.stack=function(){return k=!k,n},n.showToday=function(){return B=!B,n},n.showTodayFormat=function(t){return arguments.length?(T=t,n):T},n.colorProperty=function(t){return arguments.length?(m=t,n):m},n.itemClassName=function(t){return arguments.length?(_=t,n):_},n}});