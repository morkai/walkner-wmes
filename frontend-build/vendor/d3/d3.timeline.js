define(["d3"],function(t){return t.timeline=function(){function n(n){function e(){var n=Math.min(0,Math.max(N.width-g,t.event.translate[0]));q.translate([n,0]),M.attr("transform","translate("+n+",0)"),l(n*H,I)}function A(t){return v.left+(t.starting_time-x)*H}function C(){if(h||O.attr("height"))h?O.attr("height",h):h=O.attr("height");else{if(!B)throw"height of the timeline is not set";h=G.height+G.top-N.top,t.select(n[0][0]).attr("height",h)}}function E(){if(!g&&!N.width)throw"width of the timeline is not set. As of Firefox 27, timeline().with(x) needs to be explicitly set in order to render";g&&N.width||(g?O.attr("width",g):g=O.attr("width"))}var M=n.append("g"),N=n[0][0].getBoundingClientRect(),O=t.select(n[0][0]),R={},S=1,j=0,D=0;E(),(y||0==k&&0==x)&&(M.each(function(t){t.forEach(function(t,n){y&&-1==Object.keys(R).indexOf(n)&&(R[n]=S,S++),0==k&&0==x&&t.times.forEach(function(t){(t.starting_time<j||0==j)&&(j=t.starting_time),t.ending_time>D&&(D=t.ending_time)})})}),0==k&&0==x&&(x=j,k=D));var H=1/(k-x)*(g-v.left-v.right),I=t.time.scale().domain([x,k]).range([v.left,g-v.right]),P=t.svg.axis().scale(I).orient(f).tickFormat(m.format).ticks(m.tickTime,m.tickNumber).tickSize(m.tickSize);if(M.append("g").attr("class","axis").attr("transform","translate(0,"+(v.top+(B+T)*S)+")").call(P),M.each(function(t){t.forEach(function(t,e){function l(){return y?v.top+(B+T)*R[e]:v.top}var f=t.times,g="undefined"!=typeof t.label;M.selectAll("svg").data(f).enter().append(w).attr("x",A).attr("y",l).attr("width",function(t){return(t.ending_time-t.starting_time)*H}).attr("cy",l).attr("cx",A).attr("r",B/2).attr("height",B).attr("class",F).style("fill",function(){return p?d(t[p]):d?d(e):null}).on("mousemove",function(n){r.call(this,n,e,t)}).on("mouseover",function(n,e){i.call(this,n,e,t)}).on("mouseout",function(n,e){o.call(this,n,e,t)}).on("mousedown",function(n,e){a.call(this,n,e,t)}).on("mouseup",function(n,e){u.call(this,n,e,t)}).on("click",function(n){c.call(this,n,e,t)}).each(s),g&&n.append("text").attr("class","timeline-label").attr("transform","translate(0,"+(B/2+v.top+(B+T)*R[e])+")").text(g?t.label:t.id),"undefined"!=typeof t.icon&&n.append("image").attr("class","timeline-label").attr("transform","translate(0,"+(v.top+(B+T)*R[e])+")").attr("xlink:href",t.icon).attr("width",v.left).attr("height",B)})}),g>N.width){var q=t.behavior.zoom().x(I).on("zoom",e);n.attr("class","scrollable").call(q)}b&&M.selectAll("text").attr("transform",function(){return"rotate("+b+")translate("+(this.getBBox().width/2+10)+","+this.getBBox().height/2+")"});var G=M[0][0].getBoundingClientRect();if(C(),_){var J=I(new Date);n.append("svg:line").attr("x1",J).attr("y1",z.marginTop).attr("x2",J).attr("y2",h-z.marginBottom).style("stroke",z.color).style("stroke-width",z.width)}}var e=["circle","rect"],r=function(){},i=function(){},o=function(){},a=function(){},u=function(){},c=function(){},l=function(){},s=function(){},f="bottom",g=null,h=null,m={format:t.time.format("%I %p"),tickTime:t.time.hours,tickNumber:1,tickSize:6},d=t.scale.category20(),p=null,w="rect",x=0,k=0,v={left:30,right:30,top:30,bottom:30},y=!1,b=!1,B=20,T=5,_=!1,z={marginTop:25,marginBottom:0,width:1,color:d},F="timeline-item";return n.margin=function(t){return arguments.length?(v=t,n):v},n.orient=function(t){return arguments.length?(f=t,n):f},n.itemHeight=function(t){return arguments.length?(B=t,n):B},n.itemMargin=function(t){return arguments.length?(T=t,n):T},n.height=function(t){return arguments.length?(h=t,n):h},n.width=function(t){return arguments.length?(g=t,n):g},n.display=function(t){return arguments.length&&-1!=e.indexOf(t)?(w=t,n):w},n.tickFormat=function(t){return arguments.length?(m=t,n):m},n.hover=function(t){return arguments.length?(r=t,n):r},n.mouseover=function(t){return arguments.length?(i=t,n):t},n.mouseout=function(t){return arguments.length?(o=t,n):t},n.mousedown=function(t){return arguments.length?(a=t,n):t},n.mouseup=function(t){return arguments.length?(u=t,n):t},n.click=function(t){return arguments.length?(c=t,n):c},n.scroll=function(t){return arguments.length?(l=t,n):l},n.afterRender=function(t){return arguments.length?(s=t,n):s},n.colors=function(t){return arguments.length?(d=t,n):d},n.beginning=function(t){return arguments.length?(x=t,n):x},n.ending=function(t){return arguments.length?(k=t,n):k},n.rotateTicks=function(t){return b=t,n},n.stack=function(){return y=!y,n},n.showToday=function(){return _=!_,n},n.showTodayFormat=function(t){return arguments.length?(z=t,n):z},n.colorProperty=function(t){return arguments.length?(p=t,n):p},n.itemClassName=function(t){return arguments.length?(F=t,n):F},n}});