define(["d3"],function(t){return t.timeline=function(){function n(n){function e(){var n=Math.min(0,Math.max(C.width-c,t.event.translate[0]));H.translate([n,0]),A.attr("transform","translate("+n+",0)"),u(n*R,j)}function _(t){return w.left+(t.starting_time-d)*R}function z(){if(s||E.attr("height"))s?E.attr("height",s):s=E.attr("height");else{if(!v)throw"height of the timeline is not set";s=I.height+I.top-C.top,t.select(n[0][0]).attr("height",s)}}function F(){if(!c&&!C.width)throw"width of the timeline is not set. As of Firefox 27, timeline().with(x) needs to be explicitly set in order to render";c&&C.width||(c?E.attr("width",c):c=E.attr("width"))}var A=n.append("g"),C=n[0][0].getBoundingClientRect(),E=t.select(n[0][0]),M={},N=1,O=0,S=0;F(),(x||0==p&&0==d)&&(A.each(function(t){t.forEach(function(t,n){x&&-1==Object.keys(M).indexOf(n)&&(M[n]=N,N++),0==p&&0==d&&t.times.forEach(function(t){(t.starting_time<O||0==O)&&(O=t.starting_time),t.ending_time>S&&(S=t.ending_time)})})}),0==p&&0==d&&(d=O,p=S));var R=1/(p-d)*(c-w.left-w.right),j=t.time.scale().domain([d,p]).range([w.left,c-w.right]),D=t.svg.axis().scale(j).orient(l).tickFormat(g.format).ticks(g.tickTime,g.tickNumber).tickSize(g.tickSize);if(A.append("g").attr("class","axis").attr("transform","translate(0,"+(w.top+(v+y)*N)+")").call(D),A.each(function(t){t.forEach(function(t,e){function u(){return x?w.top+(v+y)*M[e]:w.top}var l=t.times,c="undefined"!=typeof t.label;A.selectAll("svg").data(l).enter().append(m).attr("x",_).attr("y",u).attr("width",function(t){return(t.ending_time-t.starting_time)*R}).attr("cy",u).attr("cx",_).attr("r",v/2).attr("height",v).attr("class",T).style("fill",function(){return h?f(t[h]):f?f(e):null}).on("mousemove",function(n){r.call(this,n,e,t)}).on("mouseover",function(n,e){i.call(this,n,e,t)}).on("mouseout",function(n,e){a.call(this,n,e,t)}).on("click",function(n){o.call(this,n,e,t)}),c&&n.append("text").attr("class","timeline-label").attr("transform","translate(0,"+(v/2+w.top+(v+y)*M[e])+")").text(c?t.label:t.id),"undefined"!=typeof t.icon&&n.append("image").attr("class","timeline-label").attr("transform","translate(0,"+(w.top+(v+y)*M[e])+")").attr("xlink:href",t.icon).attr("width",w.left).attr("height",v)})}),c>C.width){var H=t.behavior.zoom().x(j).on("zoom",e);n.attr("class","scrollable").call(H)}k&&A.selectAll("text").attr("transform",function(){return"rotate("+k+")translate("+(this.getBBox().width/2+10)+","+this.getBBox().height/2+")"});var I=A[0][0].getBoundingClientRect();if(z(),b){var P=j(new Date);n.append("svg:line").attr("x1",P).attr("y1",B.marginTop).attr("x2",P).attr("y2",s-B.marginBottom).style("stroke",B.color).style("stroke-width",B.width)}}var e=["circle","rect"],r=function(){},i=function(){},a=function(){},o=function(){},u=function(){},l="bottom",c=null,s=null,g={format:t.time.format("%I %p"),tickTime:t.time.hours,tickNumber:1,tickSize:6},f=t.scale.category20(),h=null,m="rect",d=0,p=0,w={left:30,right:30,top:30,bottom:30},x=!1,k=!1,v=20,y=5,b=!1,B={marginTop:25,marginBottom:0,width:1,color:f},T="timeline-item";return n.margin=function(t){return arguments.length?(w=t,n):w},n.orient=function(t){return arguments.length?(l=t,n):l},n.itemHeight=function(t){return arguments.length?(v=t,n):v},n.itemMargin=function(t){return arguments.length?(y=t,n):y},n.height=function(t){return arguments.length?(s=t,n):s},n.width=function(t){return arguments.length?(c=t,n):c},n.display=function(t){return arguments.length&&-1!=e.indexOf(t)?(m=t,n):m},n.tickFormat=function(t){return arguments.length?(g=t,n):g},n.hover=function(t){return arguments.length?(r=t,n):r},n.mouseover=function(t){return arguments.length?(i=t,n):t},n.mouseout=function(t){return arguments.length?(a=t,n):t},n.click=function(t){return arguments.length?(o=t,n):o},n.scroll=function(t){return arguments.length?(u=t,n):u},n.colors=function(t){return arguments.length?(f=t,n):f},n.beginning=function(t){return arguments.length?(d=t,n):d},n.ending=function(t){return arguments.length?(p=t,n):p},n.rotateTicks=function(t){return k=t,n},n.stack=function(){return x=!x,n},n.showToday=function(){return b=!b,n},n.showTodayFormat=function(t){return arguments.length?(B=t,n):B},n.colorProperty=function(t){return arguments.length?(h=t,n):h},n.itemClassName=function(t){return arguments.length?(T=t,n):T},n}});