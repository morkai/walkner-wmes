define(["d3"],function(t){return t.timeline=function(){function n(n){function e(t,n){return k.left+(t.starting_time-v)*S}var F=n.append("g"),A=n[0][0].getBoundingClientRect(),C=t.select(n[0][0]),E={},N=1,O=0,R=0;!function(){if(!s&&!A.width)throw"width of the timeline is not set. As of Firefox 27, timeline().with(x) needs to be explicitly set in order to render";s&&A.width||(s?C.attr("width",s):s=C.attr("width"))}(),(y||0==x&&0==v)&&(F.each(function(t,n){t.forEach(function(t,n){y&&-1==Object.keys(E).indexOf(n)&&(E[n]=N,N++),0==x&&0==v&&t.times.forEach(function(t,n){(t.starting_time<O||0==O)&&(O=t.starting_time),t.ending_time>R&&(R=t.ending_time)})})}),0==x&&0==v&&(v=O,x=R));var S=1/(x-v)*(s-k.left-k.right),j=t.time.scale().domain([v,x]).range([k.left,s-k.right]),D=t.svg.axis().scale(j).orient(f).tickFormat(m.format).ticks(m.tickTime,m.tickNumber).tickSize(m.tickSize);if(F.append("g").attr("class","axis").attr("transform","translate(0,"+(k.top+(B+T)*N)+")").call(D),F.each(function(t,u){t.forEach(function(t,u){function f(t,n){return y?k.top+(B+T)*E[u]:k.top}var s=t.times,g=void 0!==t.label;F.selectAll("svg").data(s).enter().append(w).attr("x",e).attr("y",f).attr("width",function(t,n){return(t.ending_time-t.starting_time)*S}).attr("cy",f).attr("cx",e).attr("r",B/2).attr("height",B).attr("class",M).style("fill",function(n,e){return p?d(t[p]):d?d(u):null}).on("mousemove",function(n,e){i.call(this,n,u,t)}).on("mouseover",function(n,e){r.call(this,n,e,t)}).on("mouseout",function(n,e){o.call(this,n,e,t)}).on("mousedown",function(n,e){a.call(this,n,e,t)}).on("mouseup",function(n,e){c.call(this,n,e,t)}).on("click",function(n,e){l.call(this,n,u,t)}).each(h),g&&n.append("text").attr("class","timeline-label").attr("transform","translate(0,"+(B/2+k.top+(B+T)*E[u])+")").text(g?t.label:t.id),void 0!==t.icon&&n.append("image").attr("class","timeline-label").attr("transform","translate(0,"+(k.top+(B+T)*E[u])+")").attr("xlink:href",t.icon).attr("width",k.left).attr("height",B)})}),Math.ceil(s)>Math.ceil(A.width)){var H=t.behavior.zoom().x(j),I=function(){var n=Math.min(0,Math.max(A.width-s,t.event.translate[0]));H.translate([n,0]),F.attr("transform","translate("+n+",0)"),u(n*S,j)};H.on("zoom",I),n.attr("class","scrollable").call(H)}b&&F.selectAll("text").attr("transform",function(t){return"rotate("+b+")translate("+(this.getBBox().width/2+10)+","+this.getBBox().height/2+")"});var P=F[0][0].getBoundingClientRect();if(function(){if(g||C.attr("height"))g?C.attr("height",g):g=C.attr("height");else{if(!B)throw"height of the timeline is not set";g=P.height+P.top-A.top,t.select(n[0][0]).attr("height",g)}}(),_){var q=j(new Date);n.append("svg:line").attr("x1",q).attr("y1",z.marginTop).attr("x2",q).attr("y2",g-z.marginBottom).style("stroke",z.color).style("stroke-width",z.width)}}var e=["circle","rect"],i=function(){},r=function(){},o=function(){},a=function(){},c=function(){},l=function(){},u=function(){},h=function(){},f="bottom",s=null,g=null,m={format:t.time.format("%I %p"),tickTime:t.time.hours,tickNumber:1,tickSize:6},d=t.scale.category20(),p=null,w="rect",v=0,x=0,k={left:30,right:30,top:30,bottom:30},y=!1,b=!1,B=20,T=5,_=!1,z={marginTop:25,marginBottom:0,width:1,color:d},M="timeline-item";return n.margin=function(t){return arguments.length?(k=t,n):k},n.orient=function(t){return arguments.length?(f=t,n):f},n.itemHeight=function(t){return arguments.length?(B=t,n):B},n.itemMargin=function(t){return arguments.length?(T=t,n):T},n.height=function(t){return arguments.length?(g=t,n):g},n.width=function(t){return arguments.length?(s=t,n):s},n.display=function(t){return arguments.length&&-1!=e.indexOf(t)?(w=t,n):w},n.tickFormat=function(t){return arguments.length?(m=t,n):m},n.hover=function(t){return arguments.length?(i=t,n):i},n.mouseover=function(t){return arguments.length?(r=t,n):t},n.mouseout=function(t){return arguments.length?(o=t,n):t},n.mousedown=function(t){return arguments.length?(a=t,n):t},n.mouseup=function(t){return arguments.length?(c=t,n):t},n.click=function(t){return arguments.length?(l=t,n):l},n.scroll=function(t){return arguments.length?(u=t,n):u},n.afterRender=function(t){return arguments.length?(h=t,n):h},n.colors=function(t){return arguments.length?(d=t,n):d},n.beginning=function(t){return arguments.length?(v=t,n):v},n.ending=function(t){return arguments.length?(x=t,n):x},n.rotateTicks=function(t){return b=t,n},n.stack=function(){return y=!y,n},n.showToday=function(){return _=!_,n},n.showTodayFormat=function(t){return arguments.length?(z=t,n):z},n.colorProperty=function(t){return arguments.length?(p=t,n):p},n.itemClassName=function(t){return arguments.length?(M=t,n):M},n}});