/**
 * @license Map plugin v0.2 for Highcharts
 *
 * (c) 2011-2014 Torstein Honsi
 *
 * License: www.highcharts.com/license
 */

!function(e){function t(e,t,n){for(var r,i=4,o=[];i--;)r=t.rgba[i]+(e.rgba[i]-t.rgba[i])*(1-n),o[i]=3===i?r:Math.round(r);return"rgba("+o.join(",")+")"}function n(e,t,n,r,i,o,a,s,l){var u=e["stroke-width"]%2/2;return t-=u,n-=u,["M",t+o,n,"L",t+r-a,n,"C",t+r-a/2,n,t+r,n+a/2,t+r,n+a,"L",t+r,n+i-s,"C",t+r,n+i-s/2,t+r-s/2,n+i,t+r-s,n+i,"L",t+l,n+i,"C",t+l/2,n+i,t,n+i-l/2,t,n+i-l,"L",t,n+o,"C",t,n+o/2,t+o/2,n,t+o,n,"Z"]}var r,i=e.Axis,o=e.Chart,a=e.Color,s=e.Point,l=e.Pointer,u=e.Legend,c=e.Series,d=e.SVGRenderer,p=e.VMLRenderer,h=d.prototype.symbols,f=e.each,m=e.extend,g=e.extendClass,v=e.merge,y=e.pick,b=e.numberFormat,w=e.getOptions(),E=e.seriesTypes,P=w.plotOptions,T=e.wrap,R=function(){};m(w.lang,{zoomIn:"Zoom in",zoomOut:"Zoom out"}),w.mapNavigation={buttonOptions:{alignTo:"plotBox",align:"left",verticalAlign:"top",x:0,width:18,height:18,style:{fontSize:"15px",fontWeight:"bold",textAlign:"center"},theme:{"stroke-width":1}},buttons:{zoomIn:{onclick:function(){this.mapZoom(.5)},text:"+",y:0},zoomOut:{onclick:function(){this.mapZoom(2)},text:"-",y:28}}},e.splitPath=function(e){var t;for(e=e.replace(/([A-Za-z])/g," $1 "),e=e.replace(/^\s*/,"").replace(/\s*$/,""),e=e.split(/[ ,]+/),t=0;t<e.length;t++)/[a-zA-Z]/.test(e[t])||(e[t]=parseFloat(e[t]));return e},e.maps={},T(i.prototype,"getSeriesExtremes",function(e){var t,n,r=this.isXAxis,i=[];r&&f(this.series,function(e,t){e.useMapGeometry&&(i[t]=e.xData,e.xData=[])}),e.call(this),r&&(t=y(this.dataMin,Number.MAX_VALUE),n=y(this.dataMax,Number.MIN_VALUE),f(this.series,function(e,r){e.useMapGeometry&&(t=Math.min(t,y(e.minX,t)),n=Math.max(n,y(e.maxX,t)),e.xData=i[r])}),this.dataMin=t,this.dataMax=n)}),T(i.prototype,"setAxisTranslation",function(e){var t,n,i,o,a,s=this.chart,l=s.plotWidth/s.plotHeight,u=s.xAxis[0];e.call(this),s.options.chart.preserveAspectRatio&&"yAxis"===this.coll&&u.transA!==r&&(this.transA=u.transA=Math.min(this.transA,u.transA),t=s.mapRatio=l/((u.max-u.min)/(this.max-this.min)),i=1>t?this:u,n=(i.max-i.min)*i.transA,i.pixelPadding=i.len-n,i.minPixelPadding=i.pixelPadding/2,o=i.fixTo,o&&(a=o[1]-i.toValue(o[0],!0),a*=i.transA,Math.abs(a)>i.minPixelPadding&&(a=0),i.minPixelPadding-=a))}),T(i.prototype,"render",function(e){e.call(this),this.fixTo=null}),m(l.prototype,{onContainerDblClick:function(e){var t=this.chart;e=this.normalize(e),t.options.mapNavigation.enableDoubleClickZoomTo?t.pointer.inClass(e.target,"highcharts-tracker")&&t.hoverPoint.zoomTo():t.isInsidePlot(e.chartX-t.plotLeft,e.chartY-t.plotTop)&&t.mapZoom(.5,t.xAxis[0].toValue(e.chartX),t.yAxis[0].toValue(e.chartY),e.chartX,e.chartY)},onContainerMouseWheel:function(e){var t,n=this.chart;e=this.normalize(e),t=e.detail||-(e.wheelDelta/120),n.isInsidePlot(e.chartX-n.plotLeft,e.chartY-n.plotTop)&&n.mapZoom(t>0?2:.5,n.xAxis[0].toValue(e.chartX),n.yAxis[0].toValue(e.chartY),t>0?void 0:e.chartX,t>0?void 0:e.chartY)}}),T(l.prototype,"init",function(e,t,n){e.call(this,t,n),y(n.mapNavigation.enableTouchZoom,n.mapNavigation.enabled)&&(this.pinchX=this.pinchHor=this.pinchY=this.pinchVert=!0)}),T(l.prototype,"pinchTranslate",function(e,t,n,r,i,o,a,s,l){var u;e.call(this,t,n,r,i,o,a,s,l),"map"===this.chart.options.chart.type&&(u=o.scaleX>o.scaleY,this.pinchTranslateDirection(!u,r,i,o,a,s,l,u?o.scaleX:o.scaleY))});var x=e.ColorAxis=function(){this.init.apply(this,arguments)};m(x.prototype,i.prototype),m(x.prototype,{defaultColorAxisOptions:{lineWidth:0,gridLineWidth:1,tickPixelInterval:72,startOnTick:!0,endOnTick:!0,offset:0,marker:{animation:{duration:50},color:"gray",width:.01},labels:{overflow:"justify"},minColor:"#EFEFFF",maxColor:"#102d4c"},init:function(e,t){var n,r="vertical"!==e.options.legend.layout;n=v(this.defaultColorAxisOptions,{side:r?2:1,reversed:!r},t,{isX:r,opposite:!r,showEmpty:!1,title:null}),i.prototype.init.call(this,e,n),t.dataClasses&&this.initDataClasses(t),this.isXAxis=!0,this.horiz=r},initDataClasses:function(e){var n,r=this.chart,i=0,o=this.options;this.dataClasses=n=[],f(e.dataClasses,function(s,l){var u;s=v(s),n.push(s),s.color||("category"===o.dataClassColor?(u=r.options.colors,s.color=u[i++],i===u.length&&(i=0)):s.color=t(a(o.minColor),a(o.maxColor),l/(e.dataClasses.length-1)))})},setOptions:function(e){i.prototype.setOptions.call(this,e),this.options.crosshair=this.options.marker,this.stops=e.stops||[[0,this.options.minColor],[1,this.options.maxColor]],f(this.stops,function(e){e.color=a(e[1])}),this.coll="colorAxis"},setAxisSize:function(){var e=this.legendSymbol,t=this.chart;e&&(this.left=e.x,this.top=e.y,this.width=e.width,this.height=e.height,this.right=t.chartWidth-this.left-this.width,this.bottom=t.chartHeight-this.top-this.height,this.len=this.horiz?this.width:this.height,this.pos=this.horiz?this.left:this.top)},toColor:function(e,n){var i,o,a,s,l,u,c=this.stops,d=this.dataClasses;if(d){for(u=d.length;u--;)if(l=d[u],o=l.from,a=l.to,(o===r||e>=o)&&(a===r||a>=e)){s=l.color,n&&(n.dataClass=u);break}}else{for(this.isLog&&(e=this.val2lin(e)),i=1-(this.max-e)/(this.max-this.min),u=c.length;u--&&!(i>c[u][0]););o=c[u]||c[u+1],a=c[u+1]||o,i=1-(a[0]-i)/(a[0]-o[0]||1),s=t(o.color,a.color,i)}return s},getOffset:function(){var e=this.legendGroup;e&&(i.prototype.getOffset.call(this),this.axisGroup.parentGroup||(this.axisGroup.add(e),this.gridGroup.add(e),this.labelGroup.add(e),this.added=!0))},setLegendColor:function(){var e,t=this.horiz,n=this.options;e=t?[0,0,1,0]:[0,0,0,1],this.legendColor={linearGradient:{x1:e[0],y1:e[1],x2:e[2],y2:e[3]},stops:n.stops||[[0,n.minColor],[1,n.maxColor]]}},drawLegendSymbol:function(e,t){var n,r=e.padding,i=e.options,o=this.horiz,a=y(i.symbolWidth,o?200:12),s=y(i.symbolHeight,o?12:200),l=y(i.labelPadding,o?10:30);this.setLegendColor(),t.legendSymbol=this.chart.renderer.rect(0,e.baseline-11,a,s).attr({zIndex:1}).add(t.legendGroup),n=t.legendSymbol.getBBox(),this.legendItemWidth=a+r+(o?0:l),this.legendItemHeight=s+r+(o?l:0)},setState:R,visible:!0,setVisible:R,getSeriesExtremes:function(){var e;this.series.length&&(e=this.series[0],this.dataMin=e.valueMin,this.dataMax=e.valueMax)},drawCrosshair:function(e,t){var n,r=!this.cross,o=t&&t.plotX,a=t&&t.plotY,s=this.pos,l=this.len;t&&(n=this.toPixels(t.value),s>n?n=s-2:n>s+l&&(n=s+l+2),t.plotX=n,t.plotY=this.len-n,i.prototype.drawCrosshair.call(this,e,t),t.plotX=o,t.plotY=a,!r&&this.cross&&this.cross.attr({fill:this.crosshair.color}).add(this.labelGroup))},getPlotLinePath:function(e,t,n,r,o){return o?this.horiz?["M",o-4,this.top-6,"L",o+4,this.top-6,o,this.top,"Z"]:["M",this.left,o,"L",this.left-6,o+6,this.left-6,o-6,"Z"]:i.prototype.getPlotLinePath.call(this,e,t,n,r)},update:function(e,t){i.prototype.update.call(this,e,t),this.legendItem&&(this.setLegendColor(),this.chart.legend.colorizeItem(this,!0))},getDataClassLegendSymbols:function(){var t,n=this,i=this.chart,o=[],a=i.options.legend,s=a.valueDecimals,l=a.valueSuffix||"";return f(this.dataClasses,function(a,u){var c=!0,d=a.from,p=a.to;t="",d===r?t="< ":p===r&&(t="> "),d!==r&&(t+=b(d,s)+l),d!==r&&p!==r&&(t+=" - "),p!==r&&(t+=b(p,s)+l),o.push(e.extend({chart:i,name:t,options:{},drawLegendSymbol:e.LegendSymbolMixin.drawRectangle,visible:!0,setState:R,setVisible:function(){c=this.visible=!c,f(n.series,function(e){f(e.points,function(e){e.dataClass===u&&e.setVisible(c)})}),i.legend.colorizeItem(this,c)}},a))}),o}}),T(u.prototype,"getAllItems",function(e){var t=[],n=this.chart.colorAxis[0];return n&&(n.options.dataClasses?t=t.concat(n.getDataClassLegendSymbols()):t.push(n),f(n.series,function(e){e.options.showInLegend=!1})),t.concat(e.call(this))}),m(o.prototype,{renderMapNavigation:function(){var e,t,n,r,i,o=this,a=this.options.mapNavigation,s=a.buttons,l=function(){this.handler.call(o)};if(y(a.enableButtons,a.enabled)&&!o.renderer.forExport)for(e in s)s.hasOwnProperty(e)&&(n=v(a.buttonOptions,s[e]),r=n.theme,i=r.states,t=o.renderer.button(n.text,0,0,l,r,i&&i.hover,i&&i.select,0,"zoomIn"===e?"topbutton":"bottombutton").attr({width:n.width,height:n.height,title:o.options.lang[e],zIndex:5}).css(n.style).add(),t.handler=n.onclick,t.align(m(n,{width:t.width,height:2*t.height}),null,n.alignTo))},fitToBox:function(e,t){return f([["x","width"],["y","height"]],function(n){var r=n[0],i=n[1];e[r]+e[i]>t[r]+t[i]&&(e[i]>t[i]?(e[i]=t[i],e[r]=t[r]):e[r]=t[r]+t[i]-e[i]),e[i]>t[i]&&(e[i]=t[i]),e[r]<t[r]&&(e[r]=t[r])}),e},mapZoom:function(e,t,n,r,i){var o=this,a=o.xAxis[0],s=a.max-a.min,l=y(t,a.min+s/2),u=s*e,c=o.yAxis[0],d=c.max-c.min,p=y(n,c.min+d/2),h=d*e,f=r?(r-a.pos)/a.len:.5,m=i?(i-c.pos)/c.len:.5,g=l-u*f,v=p-h*m,b=o.fitToBox({x:g,y:v,width:u,height:h},{x:a.dataMin,y:c.dataMin,width:a.dataMax-a.dataMin,height:c.dataMax-c.dataMin});r&&(a.fixTo=[r-a.pos,t]),i&&(c.fixTo=[i-c.pos,n]),void 0!==e?(a.setExtremes(b.x,b.x+b.width,!1),c.setExtremes(b.y,b.y+b.height,!1)):(a.setExtremes(void 0,void 0,!1),c.setExtremes(void 0,void 0,!1)),o.redraw()}}),T(o.prototype,"getAxes",function(e){var t=this.options,n=t.colorAxis;e.call(this),this.colorAxis=[],n&&(e=new x(this,n))}),T(o.prototype,"render",function(t){var n=this,r=n.options.mapNavigation;t.call(n),n.renderMapNavigation(),(y(r.enableDoubleClickZoom,r.enabled)||r.enableDoubleClickZoomTo)&&e.addEvent(n.container,"dblclick",function(e){n.pointer.onContainerDblClick(e)}),y(r.enableMouseWheelZoom,r.enabled)&&e.addEvent(n.container,void 0===document.onmousewheel?"DOMMouseScroll":"mousewheel",function(e){return n.pointer.onContainerMouseWheel(e),!1})}),P.map=v(P.scatter,{allAreas:!0,animation:!1,nullColor:"#F8F8F8",borderColor:"silver",borderWidth:1,marker:null,stickyTracking:!1,dataLabels:{format:"{point.value}",verticalAlign:"middle"},turboThreshold:0,tooltip:{followPointer:!0,pointFormat:"{point.name}: {point.value}<br/>"},states:{normal:{animation:!0},hover:{brightness:.2}}});var k=g(s,{applyOptions:function(e,t){var n,r=s.prototype.applyOptions.call(this,e,t),i=this.series,o=i.options,a=o.joinBy;return o.mapData&&(n=a?i.getMapData(a,r[a]):o.mapData[r.x],n?(i.xyFromShape&&(r.x=n._midX,r.y=n._midY),m(r,n)):r.value=r.value||null),r},setVisible:function(e){var t=this,n=e?"show":"hide";f(["graphic","dataLabel"],function(e){t[e]&&t[e][n]()})},onMouseOver:function(e){clearTimeout(this.colorInterval),s.prototype.onMouseOver.call(this,e)},onMouseOut:function(){var e=this,n=+new Date,r=a(e.options.color),i=a(e.pointAttr.hover.fill),o=e.series.options.states.normal.animation,l=o&&(o.duration||500);l&&4===r.rgba.length&&4===i.rgba.length&&"select"!==e.state&&(delete e.pointAttr[""].fill,clearTimeout(e.colorInterval),e.colorInterval=setInterval(function(){var o=(new Date-n)/l,a=e.graphic;o>1&&(o=1),a&&a.attr("fill",t(i,r,o)),o>=1&&clearTimeout(e.colorInterval)},13)),s.prototype.onMouseOut.call(e)},zoomTo:function(){var e=this,t=e.series;t.xAxis.setExtremes(e._minX,e._maxX,!1),t.yAxis.setExtremes(e._minY,e._maxY,!1),t.chart.redraw()}});E.map=g(E.scatter,{type:"map",pointAttrToOptions:{stroke:"borderColor","stroke-width":"borderWidth",fill:"color",dashstyle:"dashStyle"},pointClass:k,pointArrayMap:["value"],axisTypes:["xAxis","yAxis","colorAxis"],optionalAxis:"colorAxis",trackerGroups:["group","markerGroup","dataLabelsGroup"],getSymbol:R,supportsDrilldown:!0,getExtremesFromAll:!0,useMapGeometry:!0,parallelArrays:["x","y","value"],getBox:function(t){var n,r=Number.MIN_VALUE,i=Number.MAX_VALUE,o=Number.MIN_VALUE,a=Number.MAX_VALUE;f(t||[],function(t){if(t.path){"string"==typeof t.path&&(t.path=e.splitPath(t.path));var s=t.path||[],l=s.length,u=!1,c=Number.MIN_VALUE,d=Number.MAX_VALUE,p=Number.MIN_VALUE,h=Number.MAX_VALUE;if(!t._foundBox){for(;l--;)"number"!=typeof s[l]||isNaN(s[l])||(u?(c=Math.max(c,s[l]),d=Math.min(d,s[l])):(p=Math.max(p,s[l]),h=Math.min(h,s[l])),u=!u);t._midX=d+(c-d)*(t.middleX||.5),t._midY=h+(p-h)*(t.middleY||.5),t._maxX=c,t._minX=d,t._maxY=p,t._minY=h,t._foundBox=!0}r=Math.max(r,t._maxX),i=Math.min(i,t._minX),o=Math.max(o,t._maxY),a=Math.min(a,t._minY),n=!0}}),n&&(this.minY=Math.min(a,y(this.minY,Number.MAX_VALUE)),this.maxY=Math.max(o,y(this.maxY,Number.MIN_VALUE)),this.minX=Math.min(i,y(this.minX,Number.MAX_VALUE)),this.maxX=Math.max(r,y(this.maxX,Number.MIN_VALUE)))},getExtremes:function(){c.prototype.getExtremes.call(this,this.valueData),this.chart.hasRendered&&this.isDirtyData&&this.getBox(this.options.data),this.valueMin=this.dataMin,this.valueMax=this.dataMax,this.dataMin=this.minY,this.dataMax=this.maxY},translatePath:function(e){var t,n=this,r=!1,i=n.xAxis,o=n.yAxis,a=i.min,s=i.transA,l=i.minPixelPadding,u=o.min,c=o.transA,d=o.minPixelPadding,p=[];if(e)for(t=e.length;t--;)"number"==typeof e[t]?(p[t]=r?(e[t]-a)*s+l:(e[t]-u)*c+d,r=!r):p[t]=e[t];return p},setData:function(e,t){var n=this.options,r=n.mapData,i=n.joinBy,o=[];this.getBox(e),this.getBox(r),n.allAreas&&r&&(e=e||[],i&&f(e,function(e){o.push(e[i])}),o="|"+o.join("|")+"|",f(r,function(t){i&&-1!==o.indexOf("|"+t[i]+"|")||e.push(v(t,{value:null}))})),c.prototype.setData.call(this,e,t)},getMapData:function(e,t){var n=this.options,r=n.mapData,i=this.mapMap,o=r.length;if(i||(i=this.mapMap={}),void 0!==i[t])return r[i[t]];if(void 0!==t)for(;o--;)if(r[o][e]===t)return i[t]=o,r[o]},translateColors:function(){var e=this,t=this.options.nullColor,n=this.colorAxis;f(this.data,function(r){var i,o=r.value;i=null===o?t:n?n.toColor(o,r):r.color||e.color,i&&(r.color=r.options.color=i)})},drawGraph:R,drawDataLabels:R,translate:function(){var e=this,t=e.xAxis,n=e.yAxis;e.generatePoints(),f(e.data,function(r){r.plotX=t.toPixels(r._midX,!0),r.plotY=n.toPixels(r._midY,!0),(e.isDirtyData||e.chart.renderer.isVML)&&(r.shapeType="path",r.shapeArgs={d:e.translatePath(r.path),"vector-effect":"non-scaling-stroke"})}),e.translateColors()},drawPoints:function(){var e,t,n,r=this,i=r.xAxis,o=r.yAxis,a=r.group,s=r.chart,l=s.renderer,u=function(t,n){var r=t.dataMin,i=t.dataMax,o=r-(i-r)*(n-1)/2,a=t.min-t.minPixelPadding/t.transA,s=a-o,l=(i-r-t.max+t.min)*n,u=s/l;return t.len*(1-e)*u};r.transformGroup||(r.transformGroup=l.g().attr({scaleX:1,scaleY:1}).add(a)),r.isDirtyData||l.isVML?(r.group=r.transformGroup,E.column.prototype.drawPoints.apply(r),r.group=a,f(r.points,function(e){s.hasRendered&&e.graphic&&e.graphic.attr("fill",e.options.color)}),this.transA=i.transA):(e=i.transA/this.transA,e>.99&&1.01>e?(t=0,n=0,e=1):(t=u(i,Math.max(1,r.chart.mapRatio)),n=u(o,1/Math.min(1,r.chart.mapRatio))),this.transformGroup.animate({translateX:t,translateY:n,scaleX:e,scaleY:e})),c.prototype.drawDataLabels.call(r)},render:function(){var e=this,t=c.prototype.render;e.chart.renderer.isVML&&e.data.length>3e3?setTimeout(function(){t.call(e)}):t.call(e)},animate:function(e){var t=this.chart,n=this.options.animation,r=this.group,i=this.xAxis,o=this.yAxis,a=i.pos,s=o.pos;t.renderer.isSVG&&(n===!0&&(n={duration:1e3}),e?r.attr({translateX:a+i.len/2,translateY:s+o.len/2,scaleX:.001,scaleY:.001}):(r.animate({translateX:a,translateY:s,scaleX:1,scaleY:1},n),this.animate=null))},animateDrilldown:function(e){var t,n=this.chart.plotBox,r=this.chart.drilldownLevels[this.chart.drilldownLevels.length-1],i=r.bBox,o=this.chart.options.drilldown.animation;e||(t=Math.min(i.width/n.width,i.height/n.height),r.shapeArgs={scaleX:t,scaleY:t,translateX:i.x,translateY:i.y},f(this.points,function(e){e.graphic.attr(r.shapeArgs).animate({scaleX:1,scaleY:1,translateX:0,translateY:0},o)}),this.animate=null)},drawLegendSymbol:e.LegendSymbolMixin.drawRectangle,animateDrillupFrom:function(e){E.column.prototype.animateDrillupFrom.call(this,e)},animateDrillupTo:function(e){E.column.prototype.animateDrillupTo.call(this,e)}}),P.mapline=v(P.map,{lineWidth:1,fillColor:"none"}),E.mapline=g(E.map,{type:"mapline",pointAttrToOptions:{stroke:"color","stroke-width":"lineWidth",fill:"fillColor"},drawLegendSymbol:E.line.prototype.drawLegendSymbol}),P.mappoint=v(P.scatter,{dataLabels:{enabled:!0,format:"{point.name}",color:"black",style:{textShadow:"0 0 5px white"}}}),E.mappoint=g(E.scatter,{type:"mappoint"}),E.bubble&&(P.mapbubble=v(P.bubble,{tooltip:{pointFormat:"{point.name}: {point.z}"}}),E.mapbubble=g(E.bubble,{pointClass:g(s,{applyOptions:k.prototype.applyOptions}),xyFromShape:!0,type:"mapbubble",pointArrayMap:["z"],getMapData:E.map.prototype.getMapData,getBox:E.map.prototype.getBox,setData:E.map.prototype.setData})),h.topbutton=function(e,t,r,i,o){return n(o,e,t,r,i,o.r,o.r,0,0)},h.bottombutton=function(e,t,r,i,o){return n(o,e,t,r,i,0,0,o.r,o.r)},e.Renderer===p&&f(["topbutton","bottombutton"],function(e){p.prototype.symbols[e]=h[e]}),e.Map=function(e,t){var n,r={endOnTick:!1,gridLineWidth:0,lineWidth:0,minPadding:0,maxPadding:0,startOnTick:!1,title:null,tickPositions:[]};return n=e.series,e.series=null,e=v({chart:{panning:"xy",type:"map"},xAxis:r,yAxis:v(r,{reversed:!0})},e,{chart:{inverted:!1,alignTicks:!1,preserveAspectRatio:!0}}),e.series=n,new o(e,t)}}(Highcharts);