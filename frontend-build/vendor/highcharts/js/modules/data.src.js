/**
 * @license Data plugin for Highcharts
 *
 * (c) 2012-2014 Torstein Honsi
 *
 * License: www.highcharts.com/license
 */

!function(e){var t=e.each,n=function(e,t){this.init(e,t)};e.extend(n.prototype,{init:function(e,t){this.options=e,this.chartOptions=t,this.columns=e.columns||this.rowsToColumns(e.rows)||[],this.columns.length?this.dataFound():(this.parseCSV(),this.parseTable(),this.parseGoogleSpreadsheet())},getColumnDistribution:function(){var n=this.chartOptions,r=function(t){return(e.seriesTypes[t||"line"].prototype.pointArrayMap||[0]).length},i=n&&n.chart&&n.chart.type,o=[];t(n&&n.series||[],function(e){o.push(r(e.type||i))}),this.valueCount={global:r(i),individual:o}},dataFound:function(){this.parseTypes(),this.findHeaderRow(),this.parsed(),this.complete()},parseCSV:function(){var e,n,r=this,i=this.options,o=i.csv,a=this.columns,s=i.startRow||0,l=i.endRow||Number.MAX_VALUE,u=i.startColumn||0,c=i.endColumn||Number.MAX_VALUE,d=0;o&&(n=o.replace(/\r\n/g,"\n").replace(/\r/g,"\n").split(i.lineDelimiter||"\n"),e=i.itemDelimiter||(-1!==o.indexOf("	")?"	":","),t(n,function(n,i){var o,p=r.trim(n),h=0===p.indexOf("#"),f=""===p;i>=s&&l>=i&&!h&&!f&&(o=n.split(e),t(o,function(e,t){t>=u&&c>=t&&(a[t-u]||(a[t-u]=[]),a[t-u][d]=e)}),d+=1)}),this.dataFound())},parseTable:function(){var e,n=this.options,r=n.table,i=this.columns,o=n.startRow||0,a=n.endRow||Number.MAX_VALUE,s=n.startColumn||0,l=n.endColumn||Number.MAX_VALUE;r&&("string"==typeof r&&(r=document.getElementById(r)),t(r.getElementsByTagName("tr"),function(n,r){e=0,r>=o&&a>=r&&t(n.childNodes,function(t){("TD"===t.tagName||"TH"===t.tagName)&&e>=s&&l>=e&&(i[e]||(i[e]=[]),i[e][r-o]=t.innerHTML,e+=1)})}),this.dataFound())},parseGoogleSpreadsheet:function(){var e,t,n=this,r=this.options,i=r.googleSpreadsheetKey,o=this.columns,a=r.startRow||0,s=r.endRow||Number.MAX_VALUE,l=r.startColumn||0,u=r.endColumn||Number.MAX_VALUE;i&&jQuery.getJSON("https://spreadsheets.google.com/feeds/cells/"+i+"/"+(r.googleSpreadsheetWorksheet||"od6")+"/public/values?alt=json-in-script&callback=?",function(r){var i,c,d=r.feed.entry,p=d.length,h=0,f=0;for(c=0;p>c;c++)i=d[c],h=Math.max(h,i.gs$cell.col),f=Math.max(f,i.gs$cell.row);for(c=0;h>c;c++)c>=l&&u>=c&&(o[c-l]=[],o[c-l].length=Math.min(f,s-a));for(c=0;p>c;c++)i=d[c],e=i.gs$cell.row-1,t=i.gs$cell.col-1,t>=l&&u>=t&&e>=a&&s>=e&&(o[t-l][e-a]=i.content.$t);n.dataFound()})},findHeaderRow:function(){var e=0;t(this.columns,function(t){"string"!=typeof t[0]&&(e=null)}),this.headerRow=0},trim:function(e){return"string"==typeof e?e.replace(/^\s+|\s+$/g,""):e},parseTypes:function(){for(var e,t,n,r,i,o=this.columns,a=o.length;a--;)for(e=o[a].length;e--;)t=o[a][e],n=parseFloat(t),r=this.trim(t),r==n?(o[a][e]=n,n>31536e6?o[a].isDatetime=!0:o[a].isNumeric=!0):(i=this.parseDate(t),0!==a||"number"!=typeof i||isNaN(i)?o[a][e]=""===r?null:r:(o[a][e]=i,o[a].isDatetime=!0))},dateFormats:{"YYYY-mm-dd":{regex:"^([0-9]{4})-([0-9]{2})-([0-9]{2})$",parser:function(e){return Date.UTC(+e[1],e[2]-1,+e[3])}}},parseDate:function(e){var t,n,r,i,o=this.options.parseDate;if(o&&(t=o(e)),"string"==typeof e)for(n in this.dateFormats)r=this.dateFormats[n],i=e.match(r.regex),i&&(t=r.parser(i));return t},rowsToColumns:function(e){var t,n,r,i,o;if(e)for(o=[],n=e.length,t=0;n>t;t++)for(i=e[t].length,r=0;i>r;r++)o[r]||(o[r]=[]),o[r][t]=e[t][r];return o},parsed:function(){this.options.parsed&&this.options.parsed.call(this,this.columns)},complete:function(){var t,n,r,i,o,a,s,l,u=this.columns,c=this.options;if(c.complete){for(this.getColumnDistribution(),u.length>1&&(t=u.shift(),0===this.headerRow&&t.shift(),t.isDatetime?n="datetime":t.isNumeric||(n="category")),a=0;a<u.length;a++)0===this.headerRow&&(u[a].name=u[a].shift());for(i=[],a=0,l=0;a<u.length;l++){for(r=e.pick(this.valueCount.individual[l],this.valueCount.global),o=[],s=0;s<u[a].length;s++)o[s]=[t[s],void 0!==u[a][s]?u[a][s]:null],r>1&&o[s].push(void 0!==u[a+1][s]?u[a+1][s]:null),r>2&&o[s].push(void 0!==u[a+2][s]?u[a+2][s]:null),r>3&&o[s].push(void 0!==u[a+3][s]?u[a+3][s]:null),r>4&&o[s].push(void 0!==u[a+4][s]?u[a+4][s]:null);i[l]={name:u[a].name,data:o},a+=r}c.complete({xAxis:{type:n},series:i})}}}),e.Data=n,e.data=function(e,t){return new n(e,t)},e.wrap(e.Chart.prototype,"init",function(n,r,i){var o=this;r&&r.data?e.data(e.extend(r.data,{complete:function(a){r.series&&t(r.series,function(t,n){r.series[n]=e.merge(t,a.series[n])}),r=e.merge(a,r),n.call(o,r,i)}}),r):n.call(o,r,i)})}(Highcharts);