/**
   * Grouped Categories v1.1.3 (2017-03-27)
   *
   * (c) 2012-2016 Black Label
   *
   * License: Creative Commons Attribution (CC)
   */

!function(t){"object"==typeof module&&module.exports?module.exports=t:"function"==typeof define&&define.amd?define([],function(){return t}):t(Highcharts)}(function(t){"use strict";function e(t){return JSON.parse(JSON.stringify(t))}function i(t,i){return this.userOptions=e(t),this.name=t.name||t,this.parent=i,this}function s(t){for(var e=t.length,i=0;e--;)i+=t[e];return i}function r(t,e,s){for(t.unshift(new i(e,s));s;)s.leaves=s.leaves?s.leaves+1:1,s=s.parent}function a(t,e,i,s,o){var n,l=t.length;for(o=o||0,i.depth=i.depth?i.depth:0;l--;)n=t[l],n.categories?(s&&(n.parent=s),a(n.categories,e,i,n,o+1)):r(e,n,s);i.depth=c(i.depth,o)}function o(t,e,i){e[0]===e[2]&&(e[0]=e[2]=h(e[0])-i%2/2),e[1]===e[3]&&(e[1]=e[3]=h(e[1])+i%2/2),t.push("M",e[0],e[1],"L",e[2],e[3])}function n(t,e){return t.getPosition(t.axis.horiz,e,t.axis.tickmarkOffset)}function l(t,e,i){for(var s,r=t.length;r--;)s=t[r][e],s&&l(s,e,i),i(t[r])}var h=Math.round,p=Math.min,c=Math.max,d=t.merge,u=t.pick,g=t.each,f=window.HighchartsAdapter&&window.HighchartsAdapter.inArray||t.inArray,b=t.Axis.prototype,x=t.Tick.prototype,y=b.init,v=b.render,k=b.setCategories,G=x.getLabelSize,m=x.addLabel,z=x.destroy,S=x.render;i.prototype.toString=function(){for(var t=[],e=this;e;)t.push(e.name),e=e.parent;return t.join(", ")},b.init=function(t,e){y.call(this,t,e),"object"==typeof e&&e.categories&&this.setupGroups(e)},b.setupGroups=function(t){var i=e(t.categories),s=[],r={},o=this.options.labels,n=o.groupedOptions,l=o.style;a(i,s,r),this.categoriesTree=i,this.categories=s,this.isGrouped=0!==r.depth,this.labelsDepth=r.depth,this.labelsSizes=[],this.labelsGridPath=[],this.tickLength=t.tickLength||this.tickLength||null,this.tickWidth=u(t.tickWidth,this.isXAxis?1:0),this.directionFactor=[-1,1,1,-1][this.side],this.options.lineWidth=u(t.lineWidth,1),this.groupFontHeights=[];for(var h=0;h<=r.depth;h++){var p=n&&n[h-1],c=p&&n[h-1].style?d(l,n[h-1].style):l;this.groupFontHeights[h]=Math.round(.3*this.chart.renderer.fontMetrics(c?c.fontSize:0).b)}},b.render=function(){if(this.isGrouped&&(this.labelsGridPath=[]),void 0===this.originalTickLength&&(this.originalTickLength=this.options.tickLength),this.options.tickLength=this.isGrouped?.001:this.originalTickLength,v.call(this),!this.isGrouped)return this.labelsGrid&&this.labelsGrid.attr({visibility:"hidden"}),!1;var t,e=this,i=e.options,s=e.top,r=e.left,a=r+e.width,n=s+e.height,h=e.hasVisibleSeries||e.hasData,p=e.labelsDepth,c=e.labelsGrid,d=e.horiz,u=e.labelsGridPath,g=!1===i.drawHorizontalBorders?p+1:0,f=e.opposite?d?s:a:d?n:r,b=e.tickWidth;for(e.userTickLength&&(p-=1),c||(c=e.labelsGrid=e.chart.renderer.path().attr({strokeWidth:b,"stroke-width":b,stroke:i.tickColor||""}).add(e.axisGroup),i.tickColor||c.addClass("highcharts-tick"));g<=p;)f+=e.groupSize(g),t=d?[r,f,a,f]:[f,s,f,n],o(u,t,b),g++;return c.attr({d:u,visibility:h?"visible":"hidden"}),e.labelGroup.attr({visibility:h?"visible":"hidden"}),l(e.categoriesTree,"categories",function(t){var i=t.tick;return!!i&&(i.startAt+i.leaves-1<e.min||i.startAt>e.max?(i.label.hide(),i.destroyed=0):i.label.attr({visibility:h?"visible":"hidden"}),!0)}),!0},b.setCategories=function(t,e){this.categories&&this.cleanGroups(),this.setupGroups({categories:t}),this.categories=this.userOptions.categories=t,k.call(this,this.categories,e)},b.cleanGroups=function(){var t,e=this.ticks;for(t in e)e[t].parent&&delete e[t].parent;l(this.categoriesTree,"categories",function(t){var e=t.tick;return!!e&&(e.label.destroy(),g(e,function(t,i){delete e[i]}),delete t.tick,!0)}),this.labelsGrid=null},b.groupSize=function(t,e){var i=this.labelsSizes,r=this.directionFactor,a=!!this.options.labels.groupedOptions&&this.options.labels.groupedOptions[t-1],o=0;return a&&(o=-1===r?a.x?a.x:0:a.y?a.y:0),void 0!==e&&(i[t]=c(i[t]||0,e+10+Math.abs(o))),!0===t?s(i)*r:i[t]?i[t]*r:0},x.addLabel=function(){var t,e=this,i=e.axis;return m.call(e),!(!i.categories||!(t=i.categories[e.pos]))&&(e.label&&e.label.attr("text",e.axis.labelFormatter.call({axis:i,chart:i.chart,isFirst:e.isFirst,isLast:e.isLast,value:t.name,pos:e.pos})),i.isGrouped&&i.options.labels.enabled&&e.addGroupedLabels(t),!0)},x.addGroupedLabels=function(t){for(var e,i=this,s=this.axis,r=s.chart,a=s.options.labels,o=a.useHTML,n=a.style,l=a.groupedOptions,h={align:"center",rotation:a.rotation,x:0,y:0},p=s.horiz?"height":"width",c=0;i;){if(c>0&&!t.tick){this.value=t.name;var u=a.formatter?a.formatter.call(this,t):t.name,g=l&&l[c-1],f=g?d(h,l[c-1]):h,b=g&&l[c-1].style?d(n,l[c-1].style):n;delete f.style,e=r.renderer.text(u,0,0,o).attr(f).css(b).add(s.labelGroup),i.startAt=this.pos,i.childCount=t.categories.length,i.leaves=t.leaves,i.visible=this.childCount,i.label=e,i.labelOffsets={x:f.x,y:f.y},t.tick=i}i&&s.groupSize(c,i.label.getBBox()[p]),t=t.parent,i=t?i.parent=t.tick||{}:null,c++}},x.render=function(t,e,i){S.call(this,t,e,i);var s=this.axis.categories[this.pos];if(this.axis.isGrouped&&s&&!(this.pos>this.axis.max)){var r,a,l,h,d,u,g=this,b=g,x=g.axis,y=g.pos,v=g.isFirst,k=x.max,G=x.min,m=x.horiz,z=x.labelsGridPath,L=x.groupSize(0),A=x.tickWidth,O=n(g,y),w=m?O.y:O.x,F=x.chart.renderer.fontMetrics(x.options.labels.style?x.options.labels.style.fontSize:0).b,M=1,T=m&&O.x===x.pos+x.len||!m&&O.y===x.pos?-1:0;for(v&&(r=m?[x.left,O.y,x.left,O.y+x.groupSize(!0)]:x.isXAxis?[O.x,x.top,O.x+x.groupSize(!0),x.top]:[O.x,x.top+x.len,O.x+x.groupSize(!0),x.top+x.len],o(z,r,A)),m&&x.left<O.x?o(z,[O.x-T,O.y,O.x-T,O.y+L],A):!m&&x.top<=O.y&&o(z,[O.x,O.y+T,O.x+L,O.y+T],A),L=w+L;b.parent;){b=b.parent;var H=function(t){var e=0;return v?(e=f(t.name,t.parent.categories),e=e<0?0:e):e}(s),C=b.labelOffsets.x,W=b.labelOffsets.y;l=n(g,c(b.startAt-1,G-1)),h=n(g,p(b.startAt+b.leaves-1-H,k)),u=b.label.getBBox(!0),a=x.groupSize(M),T=m&&h.x===x.pos+x.len||!m&&h.y===x.pos?-1:0,d=m?{x:(l.x+h.x)/2+C,y:L+x.groupFontHeights[M]+a/2+W/2}:{x:L+a/2+C,y:(l.y+h.y-u.height)/2+F+W},isNaN(d.x)||isNaN(d.y)||(b.label.attr(d),z&&(m&&x.left<h.x?o(z,[h.x-T,L,h.x-T,L+a],A):!m&&x.top<=h.y&&o(z,[L,h.y+T,L+a,h.y+T],A))),L+=a,M++}}},x.destroy=function(){for(var t=this.parent;t;)t.destroyed=t.destroyed?t.destroyed+1:1,t=t.parent;z.call(this)},x.getLabelSize=function(){if(!0===this.axis.isGrouped){var t=G.call(this)+10;return this.axis.labelsSizes[0]<t&&(this.axis.labelsSizes[0]=t),s(this.axis.labelsSizes)}return G.call(this)}});