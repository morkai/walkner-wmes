!function(t){"object"==typeof module&&module.exports?module.exports=t:"function"==typeof define&&define.amd?define(function(){return t}):t(Highcharts)}(function(t){"use strict";var i=Math.round,e=Math.min,s=Math.max,r=t.merge,a=t.pick,o=t.each,n=window.HighchartsAdapter&&window.HighchartsAdapter.inArray||t.inArray,h=t.Axis.prototype,l=t.Tick.prototype,p=h.init,d=h.render,c=h.setCategories,u=l.getLabelSize,g=l.addLabel,f=l.destroy,b=l.render;function x(t){return JSON.parse(JSON.stringify(t))}function y(t,i){return this.userOptions=x(t),this.name=t.name||t,this.parent=i,this}function v(t){for(var i=t.length,e=0;i--;)e+=t[i];return e}function k(t,i,e){for(t.unshift(new y(i,e));e;)e.leaves=e.leaves?e.leaves+1:1,e=e.parent}function G(t,e,s){e[0]===e[2]&&(e[0]=e[2]=i(e[0])-s%2/2),e[1]===e[3]&&(e[1]=e[3]=i(e[1])+s%2/2),t.push("M",e[0],e[1],"L",e[2],e[3])}function m(t,i){return t.getPosition(t.axis.horiz,i,t.axis.tickmarkOffset)}function z(t,i,e){for(var s,r=t.length;r--;)(s=t[r][i])&&z(s,i,e),e(t[r])}y.prototype.toString=function(){for(var t=[],i=this;i;)t.push(i.name),i=i.parent;return t.join(", ")},h.init=function(t,i){p.call(this,t,i),"object"==typeof i&&i.categories&&this.setupGroups(i)},h.setupGroups=function(t){var i=x(t.categories),e=[],o={},n=this.options.labels,h=n.groupedOptions,l=n.style;!function t(i,e,r,a,o){var n,h=i.length;for(o=o||0,r.depth=r.depth?r.depth:0;h--;)(n=i[h]).categories?(a&&(n.parent=a),t(n.categories,e,r,n,o+1)):k(e,n,a);r.depth=s(r.depth,o)}(i,e,o),this.categoriesTree=i,this.categories=e,this.isGrouped=0!==o.depth,this.labelsDepth=o.depth,this.labelsSizes=[],this.labelsGridPath=[],this.tickLength=t.tickLength||this.tickLength||null,this.tickWidth=a(t.tickWidth,this.isXAxis?1:0),this.directionFactor=[-1,1,1,-1][this.side],this.options.lineWidth=a(t.lineWidth,1),this.groupFontHeights=[];for(var p=0;p<=o.depth;p++){var d=h&&h[p-1]&&h[p-1].style?r(l,h[p-1].style):l;this.groupFontHeights[p]=Math.round(.3*this.chart.renderer.fontMetrics(d?d.fontSize:0).b)}},h.render=function(){if(this.isGrouped&&(this.labelsGridPath=[]),void 0===this.originalTickLength&&(this.originalTickLength=this.options.tickLength),this.options.tickLength=this.isGrouped?.001:this.originalTickLength,d.call(this),!this.isGrouped)return this.labelsGrid&&this.labelsGrid.attr({visibility:"hidden"}),!1;var t=this,i=t.options,e=t.top,s=t.left,r=s+t.width,a=e+t.height,o=t.hasVisibleSeries||t.hasData,n=t.labelsDepth,h=t.labelsGrid,l=t.horiz,p=t.labelsGridPath,c=!1===i.drawHorizontalBorders?n+1:0,u=t.opposite?l?e:r:l?a:s,g=t.tickWidth;for(t.userTickLength&&(n-=1),h||(h=t.labelsGrid=t.chart.renderer.path().attr({strokeWidth:g,"stroke-width":g,stroke:i.tickColor||""}).add(t.axisGroup),i.tickColor||h.addClass("highcharts-tick"));c<=n;)u+=t.groupSize(c),G(p,l?[s,u,r,u]:[u,e,u,a],g),c++;return h.attr({d:p,visibility:o?"visible":"hidden"}),t.labelGroup.attr({visibility:o?"visible":"hidden"}),z(t.categoriesTree,"categories",function(i){var e=i.tick;return!!e&&(e.startAt+e.leaves-1<t.min||e.startAt>t.max?(e.label.hide(),e.destroyed=0):e.label.attr({visibility:o?"visible":"hidden"}),!0)}),!0},h.setCategories=function(t,i){this.categories&&this.cleanGroups(),this.setupGroups({categories:t}),this.categories=this.userOptions.categories=t,c.call(this,this.categories,i)},h.cleanGroups=function(){var t,i=this.ticks;for(t in i)i[t].parent&&delete i[t].parent;z(this.categoriesTree,"categories",function(t){var i=t.tick;return!!i&&(i.label.destroy(),o(i,function(t,e){delete i[e]}),delete t.tick,!0)}),this.labelsGrid=null},h.groupSize=function(t,i){var e=this.labelsSizes,r=this.directionFactor,a=!!this.options.labels.groupedOptions&&this.options.labels.groupedOptions[t-1],o=0;return a&&(o=-1===r?a.x?a.x:0:a.y?a.y:0),void 0!==i&&(e[t]=s(e[t]||0,i+10+Math.abs(o))),!0===t?v(e)*r:e[t]?e[t]*r:0},l.addLabel=function(){var t,i=this.axis;return g.call(this),!(!i.categories||!(t=i.categories[this.pos]))&&(this.label&&this.label.attr("text",this.axis.labelFormatter.call({axis:i,chart:i.chart,isFirst:this.isFirst,isLast:this.isLast,value:t.name,pos:this.pos})),i.isGrouped&&i.options.labels.enabled&&this.addGroupedLabels(t),this.label.textPxLength=this.label.getBBox().width,!0)},l.addGroupedLabels=function(t){for(var i,e=this,s=this.axis,a=s.chart,o=s.options.labels,n=o.useHTML,h=o.style,l=o.groupedOptions,p={align:"center",rotation:o.rotation,x:0,y:0},d=s.horiz?"height":"width",c=0;e;){if(c>0&&!t.tick){this.value=t.name;var u=o.formatter?o.formatter.call(this,t):t.name,g=l&&l[c-1],f=g?r(p,l[c-1]):p,b=g&&l[c-1].style?r(h,l[c-1].style):h;delete f.style,i=a.renderer.text(u,0,0,n).attr(f).css(b).add(s.labelGroup),e.startAt=this.pos,e.childCount=t.categories.length,e.leaves=t.leaves,e.visible=this.childCount,e.label=i,e.labelOffsets={x:f.x,y:f.y},t.tick=e}e&&s.groupSize(c,e.label.getBBox()[d]),e=(t=t.parent)?e.parent=t.tick||{}:null,c++}},l.render=function(t,i,r){b.call(this,t,i,r);var a=this.axis.categories[this.pos];if(this.axis.isGrouped&&a&&!(this.pos>this.axis.max)){var o,h,l,p,d,c,u,g=this,f=this.axis,x=this.pos,y=this.isFirst,v=f.max,k=f.min,z=f.horiz,S=f.labelsGridPath,L=f.groupSize(0),A=f.tickWidth,O=m(this,x),w=z?O.y:O.x,F=f.chart.renderer.fontMetrics(f.options.labels.style?f.options.labels.style.fontSize:0).b,M=1,T=z&&O.x===f.pos+f.len||!z&&O.y===f.pos?-1:0;for(y&&G(S,z?[f.left,O.y,f.left,O.y+f.groupSize(!0)]:f.isXAxis?[O.x,f.top,O.x+f.groupSize(!0),f.top]:[O.x,f.top+f.len,O.x+f.groupSize(!0),f.top+f.len],A),z&&f.left<O.x?G(S,[O.x-T,O.y,O.x-T,O.y+L],A):!z&&f.top<=O.y&&G(S,[O.x,O.y+T,O.x+L,O.y+T],A),L=w+L;g.parent;){g=g.parent;var H=(c=a,u=void 0,u=0,y?u=(u=n(c.name,c.parent.categories))<0?0:u:u),B=g.labelOffsets.x,C=g.labelOffsets.y;h=m(this,s(g.startAt-1,k-1)),l=m(this,e(g.startAt+g.leaves-1-H,v)),d=g.label.getBBox(!0),o=f.groupSize(M),T=z&&l.x===f.pos+f.len||!z&&l.y===f.pos?-1:0,p=z?{x:(h.x+l.x)/2+B,y:L+f.groupFontHeights[M]+o/2+C/2}:{x:L+o/2+B,y:(h.y+l.y-d.height)/2+F+C},isNaN(p.x)||isNaN(p.y)||(g.label.attr(p),S&&(z&&f.left<l.x?G(S,[l.x-T,L,l.x-T,L+o],A):!z&&f.top<=l.y&&G(S,[L,l.y+T,L+o,l.y+T],A))),L+=o,M++}}},l.destroy=function(){for(var t=this.parent;t;)t.destroyed=t.destroyed?t.destroyed+1:1,t=t.parent;f.call(this)},l.getLabelSize=function(){if(!0===this.axis.isGrouped){var t=u.call(this)+10;return this.axis.labelsSizes[0]<t&&(this.axis.labelsSizes[0]=t),v(this.axis.labelsSizes)}return u.call(this)}});