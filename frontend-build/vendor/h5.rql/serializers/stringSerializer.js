define(["require","exports","module","../specialTerms","../autoConvertedMap"],function(e,n){function r(e,n){var r=[],o=n&&n.doubleEncode?c:l;return s(r,e.fields),t(r,e.sort),u(r,e.limit,e.skip),a(r,o,e.selector),r.join("").substr(1)}function s(e,n){var r=Object.keys(n);0!==r.length&&e.push(n[r[0]]?"&select(":"&exclude(",r.join(","),")")}function t(e,n){var r=Object.keys(n),s=r.length;if(0!==s){e.push("&sort(");for(var t=0;s>t;++t){var u=r[t];-1===n[u]&&e.push("-"),e.push(u),s-1>t&&e.push(",")}e.push(")")}}function u(e,n,r){-1!==n&&(e.push("&limit(",n),0!==r&&e.push(",",r),e.push(")"))}function a(e,n,r){var s=r.args.length;if(0!==s)if("and"===r.name)for(var t=0;s>t;++t){var u=r.args[t];g.hasOwnProperty(u.name)||(e.push("&"),o(e,n,u,s))}else e.push("&"),o(e,n,r,s,!0)}function o(e,n,r,s,t){if(Array.isArray(r))return p(e,n,r),void 0;if(null===r||"object"!=typeof r||"string"!=typeof r.name||!Array.isArray(r.args))return h(e,n,r),void 0;if(d.hasOwnProperty(r.name)&&r.args.length>1)return o(e,n,r.args[0],0),e.push(d[r.name]),o(e,n,r.args[1],0),void 0;var u=",";"and"===r.name?u="&":"or"===r.name&&t!==!0&&(u="|"),i(e,n,u,r,s)}function i(e,n,r,s,t){var u=s.args.length;","===r?e.push(s.name,"("):1!==t&&e.push("(");for(var a=0;u>a;++a)o(e,n,s.args[a],u),u-1>a&&e.push(r);(","===r||-1!==t)&&e.push(")")}function p(e,n,r){e.push("(");for(var s=0,t=r.length;t>s;++s)o(e,n,r[s],t),t-1>s&&e.push(",");e.push(")")}function h(e,n,r){switch(typeof r){case"undefined":e.push("undefined");break;case"boolean":e.push(r?"true":"false");break;case"number":e.push(r.toString(10));break;case"object":f(e,n,r);break;default:0===r.length?e.push("string:"):isNaN(+r)?v.hasOwnProperty(r)?e.push("string:",r):e.push(n(r)):e.push("string:",r.toString())}}function f(e,n,r){if(null===r)e.push("null");else if(r instanceof Date)e.push("epoch:",r.getTime().toString());else if(r instanceof RegExp){var s=r.toString(),t=s.lastIndexOf("/");""===s.substr(t+1)&&(s=s.substr(1,t-1)),e.push("re:",n(s))}else"function"==typeof r.convertToRqlValue?e.push(r.convertToRqlValue(n)):e.push(n(r.toString()))}function l(e){return e=encodeURIComponent(e),/[\(\)]/.test(e)&&(e=e.replace(/\(/g,"%28").replace(/\)/g,"%29")),e}function c(e){return l(l(e))}var g=e("../specialTerms"),v=e("../autoConvertedMap");n.fromQuery=r;var d={eq:"=",ne:"!=",le:"<=",ge:">=",lt:"<",gt:">","in":"=in=",nin:"=nin="}});