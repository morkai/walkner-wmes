/*! Copyright (c) 2011 by Jonas Mosbech - https://github.com/jmosbech/StickyTableHeaders
	MIT license info: https://github.com/jmosbech/StickyTableHeaders/blob/master/license.txt */

!function(e,i){function t(t,a){var s=this;s.$el=e(t),s.el=t,s.id=l++,s.$el.bind("destroyed",e.proxy(s.teardown,s)),s.$clonedHeader=null,s.$originalHeader=null,s.isSticky=!1,s.hasBeenSticky=!1,s.leftOffset=null,s.topOffset=null,s.init=function(){s.options=e.extend({},n,a),s.$el.each(function(){var i=e(this);i.css("padding",0),s.$scrollableArea=e(s.options.scrollableArea),s.$originalHeader=e("thead:first",this),s.$clonedHeader=s.$originalHeader.clone(),i.trigger("clonedHeader."+o,[s.$clonedHeader]),s.$clonedHeader.addClass("tableFloatingHeader"),s.$clonedHeader.css("display","none"),s.$originalHeader.addClass("tableFloatingHeaderOriginal"),s.$originalHeader.after(s.$clonedHeader),s.$printStyle=e('<style type="text/css" media="print">.tableFloatingHeader{display:none !important;}.tableFloatingHeaderOriginal{position:static !important;}</style>'),e("head").append(s.$printStyle)}),s.updateWidth(),s.toggleHeaders(),s.bind()},s.destroy=function(){s.$el.unbind("destroyed",s.teardown),s.teardown()},s.teardown=function(){s.isSticky&&s.$originalHeader.css("position","static"),e.removeData(s.el,"plugin_"+o),s.unbind(),s.$clonedHeader.remove(),s.$originalHeader.removeClass("tableFloatingHeaderOriginal"),s.$originalHeader.css("visibility","visible"),s.$printStyle.remove(),s.el=null,s.$el=null},s.bind=function(){s.$scrollableArea.on("scroll."+o,s.toggleHeaders),s.isWindowScrolling()||(e(i).on("scroll."+o+s.id,s.setPositionValues),e(i).on("resize."+o+s.id,s.toggleHeaders)),s.$scrollableArea.on("resize."+o,s.toggleHeaders),s.$scrollableArea.on("resize."+o,s.updateWidth)},s.unbind=function(){s.$scrollableArea.off("."+o,s.toggleHeaders),s.isWindowScrolling()||(e(i).off("."+o+s.id,s.setPositionValues),e(i).off("."+o+s.id,s.toggleHeaders)),s.$scrollableArea.off("."+o,s.updateWidth),s.$el.off("."+o),s.$el.find("*").off("."+o)},s.toggleHeaders=function(){s.$el&&s.$el.each(function(){var i,t=e(this),o=s.isWindowScrolling()?isNaN(s.options.fixedOffset)?s.options.fixedOffset.outerHeight():s.options.fixedOffset:s.$scrollableArea.offset().top+(isNaN(s.options.fixedOffset)?0:s.options.fixedOffset),l=t.offset(),n=s.$scrollableArea.scrollTop()+o,a=s.$scrollableArea.scrollLeft(),d=s.isWindowScrolling()?n>l.top:o>l.top,r=(s.isWindowScrolling()?n:0)<l.top+t.height()-s.$clonedHeader.height()-(s.isWindowScrolling()?0:o);d&&r?(i=l.left-a+s.options.leftOffset,s.$originalHeader.css({position:"fixed","margin-top":0,left:i,"z-index":1}),s.isSticky=!0,s.leftOffset=i,s.topOffset=o,s.$clonedHeader.css("display",""),s.setPositionValues(),s.updateWidth()):s.isSticky&&(s.$originalHeader.css("position","static"),s.$clonedHeader.css("display","none"),s.isSticky=!1,s.resetWidth(e("td,th",s.$clonedHeader),e("td,th",s.$originalHeader)))})},s.isWindowScrolling=function(){return s.$scrollableArea[0]===i},s.setPositionValues=function(){var t=e(i).scrollTop(),o=e(i).scrollLeft();!s.isSticky||0>t||t+e(i).height()>e(document).height()||0>o||o+e(i).width()>e(document).width()||s.$originalHeader.css({top:s.topOffset-(s.isWindowScrolling()?0:t),left:s.leftOffset-(s.isWindowScrolling()?0:o)})},s.updateWidth=function(){if(s.isSticky){s.$originalHeaderCells||(s.$originalHeaderCells=e("th,td",s.$originalHeader)),s.$clonedHeaderCells||(s.$clonedHeaderCells=e("th,td",s.$clonedHeader));var i=s.getWidth(s.$clonedHeaderCells);s.setWidth(i,s.$clonedHeaderCells,s.$originalHeaderCells),s.$originalHeader.css("width",s.$clonedHeader.width())}},s.getWidth=function(i){var t=[];return i.each(function(i){var o,l=e(this);o="border-box"===l.css("box-sizing")?l.outerWidth():l.width(),t[i]=o}),t},s.setWidth=function(e,i,t){i.each(function(i){var o=e[i];t.eq(i).css({"min-width":o,"max-width":o})})},s.resetWidth=function(i,t){i.each(function(i){var o=e(this);t.eq(i).css({"min-width":o.css("min-width"),"max-width":o.css("max-width")})})},s.updateOptions=function(i){s.options=e.extend({},n,i),s.updateWidth(),s.toggleHeaders()},s.init()}var o="stickyTableHeaders",l=0,n={fixedOffset:0,leftOffset:0,scrollableArea:i};e.fn[o]=function(i){return this.each(function(){var l=e.data(this,"plugin_"+o);l?"string"==typeof i?l[i].apply(l):l.updateOptions(i):"destroy"!==i&&e.data(this,"plugin_"+o,new t(this,i))})}}(jQuery,window);