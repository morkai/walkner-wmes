<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Plan dla linii <%= lines %> na dzień <%- time.utc.format(date, 'LL') %></title>
  <style>
    @page {
      size: A4 portrait;
      margin: 10mm;
    }
    * {
      margin: 0;
      padding: 0;
      line-height: 1;
      box-sizing: border-box;
    }
    body {
      margin: 15px;
      font-family: Verdana, sans-serif;
      font-size: 12px;
      text-rendering: optimizeLegibility;
      color: #000;
      background: #FFF;
      text-align: center;
    }
    .page {
      margin: auto;
      text-align: left;
      width: 21cm;
      padding: 10mm;
    }
    header {
      padding-bottom: 5mm;
      margin-bottom: 5mm;
      font-size: 32px;
      font-weight: bold;
      text-align: left;
      border-bottom: 1px solid #000;
    }
    footer {
      display: flex;
      padding-top: 5mm;
      margin-top: 5mm;
      border-top: 1px solid #000;
      font-size: 10px;
    }
    footer p:first-child {
      margin-bottom: 3px;
    }
    footer > div:first-child {
      flex: 1 1 auto;
    }
    footer > div:last-child {
      flex: 1 1 auto;
      text-align: right;
    }
    .props {
      float: right;
      display: flex;
    }
    .prop {
      margin-left: 5mm;
    }
    .prop > span:first-child {
      display: block;
      margin-bottom: 3px;
      font-size: 16px;
      font-weight: bold;
    }
    .prop > span:last-child {
      display: block;
      font-size: 16px;
      font-weight: normal;
    }
    table {
      width: 100%;
      font-size: 12px;
      border-collapse: collapse;
    }
    th {
      text-align: left;
      padding-right: 10px;
      white-space: nowrap;
    }
    td {
      padding-top: 8px;
      padding-right: 10px;
      white-space: nowrap;
      width: 1%;
    }
    th:last-child,
    td:last-child {
      padding-right: 0;
    }
    .name {
      width: auto;
    }
    .name > span {
      display: block;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: <%- showTimes ? 340 : 400 %>px;
    }
    .comment {
      width: auto;
    }
    .comment > span {
      display: block;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 535px;
      line-height: 12px;
    }
    .is-done td {
      vertical-align: top;
      font-size: 10px;
      line-height: 10px;
      padding-bottom: 2px;
    }
    .is-done .comment {
      padding-bottom: 0;
    }
    .qty,
    .time {
      text-align: right;
    }
    .is-incomplete {
      color: darkorange;
    }
    .is-completed {
      color: green;
    }
    .is-surplus {
      color: #E00;
    }
    .nextShift {
      padding-bottom: 10px;
      border-bottom: 1px solid #000;
    }
    .nextShift + tr > td {
      padding-top: 10px;
    }
    h2 {
      margin-top: 5mm;
      margin-bottom: 5mm;
      padding-bottom: 5mm;
      border-bottom: 1px solid #000;
    }
    .hourlyPlan th {
      padding-left: 10px;
      padding-right: 10px;
      text-align: center;
    }
    .hourlyPlan td {
      padding-left: 10px;
      padding-right: 10px;
      width: 1%;
      text-align: center;
    }
    .hourlyPlan th:first-child,
    .hourlyPlan td:first-child {
      padding-left: 0;
      text-align: left;
    }
    .hourlyPlan th:last-child,
    .hourlyPlan td:last-child {
      width: auto;
      text-align: right;
      font-weight: normal;
    }
    .with-quantityDone th,
    .with-quantityDone td {
      padding-right: 0;
    }
    #info {
      position: fixed;
      top: 0;
      left: 0;
      padding: 7px;
      width: 100%;
      background: #FFD1D1;
      border-bottom: 1px solid #F8ACAC;
      font-size: 28px;
      text-align: center;
    }
    @media print {
      body {
        margin: 0;
      }
      .page {
        width: 100%;
        padding: 0;
      }
      .page + .page {
        page-break-before: always;
      }
      .bd {
        height: 900px;
      }
      #info {
        display: none;
      }
    }
    @font-face {
      font-family: 'wmes-planning';
      src: url('data:application/octet-stream;base64,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') format('woff');
    }
    i[class^="icon-"]:before, [class*=" icon-"]:before {
      font-family: "wmes-planning";
      font-style: normal;
      font-weight: normal;
      speak: none;
      display: inline-block;
      text-decoration: inherit;
      width: 1em;
      margin-right: .2em;
      text-align: center;
      font-variant: normal;
      text-transform: none;
      line-height: 1em;
      margin-left: .2em;
    }
    .icon-hard:before { content: '\e800'; }
    .icon-small:before { content: '\e801'; }
    .icon-easy:before { content: '\f123'; }
    .icon-ps:before { content: '\f1fc'; }
    .icon-ps[data-status="unknown"] {
      display: none;
    }
    .icon-ps[data-status="started"] {
      color: #5bc0de;
    }
    .icon-ps[data-status="partial"] {
      color: #f0ad4e;
    }
    .icon-ps[data-status="finished"] {
      color: #449d44;
    }
    .icon-ps[data-status="cancelled"] {
      color: #d9534f;
    }
  </style>
</head>
<body>
<div id="info">
  Wciśnij <kbd>Ctrl+P</kbd>, aby rozpocząć drukowanie.
</div>
<% pages.forEach(function(page) { %>
<section class="page">
  <header>
    <div class="props">
      <div class="prop">
        <span>Data:</span>
        <span><%= time.format(date, 'dd, LL') %></span>
      </div>
      <div class="prop">
        <span>MRP:</span>
        <span><%= page.mrp %> %></span>
      </div>
      <div class="prop">
        <span>Linia:</span>
        <span><%= page.line %></span>
      </div>
      <div class="prop">
        <span>Obsada:</span>
        <span><%- page.workerCount %></span>
      </div>
    </div>
    Plan dnia
  </header>
  <section class="bd">
    <% if (page.orders.length) { %>
    <table>
      <thead>
        <th>Lp.</th>
        <th>Nr zlecenia</th>
        <th>12NC</th>
        <th>Wyrób</th>
        <th class="qty">Ilość</th>
        <% if (showTimes) { %>
        <th>Czas</th>
        <% } %>
      </thead>
      <tbody>
      <% page.orders.forEach(function(order) { %>
      <% if (order.nextShift) { %>
      <tr class="nextShift">
        <td colspan="6"></td>
      </tr>
      <% } %>
      <tr class="<%- order.no ? '' : 'is-done' %>">
        <% if (order.no) { %>
        <td class="no"><%- order.no %>.</td>
        <td class="orderNo"><%- order.orderNo %></td>
        <td class="nc12"><%- order.nc12 %></td>
        <td class="name">
          <span>
            <i class="icon-<%- order.kind %>"></i>
            <i class="icon-ps" data-status="<%- order.psStatus %>"></i>
            <%= order.name %>
          </span>
        </td>
        <% } else { %>
        <td class="no">&nbsp;</td>
        <td class="comment" colspan="3">
          <span>
            <%= order.delayReason %>
            <i><%= order.comment %></i>
          </span>
        </td>
        <% } %>
        <td class="qty <%- order.qtyClass || '' %>"><%- order.qtyPlan %>/<%- order.qtyTodo %></td>
        <% if (showTimes) { %>
        <td class="time">
          <% if (order.startAt) { %>
          <%- time.utc.format(order.startAt, 'HH:mm') %>-<%- time.utc.format(order.finishAt, 'HH:mm') %>
          <% } else { %>
          --:--:--
          <% } %>
        </td>
        <% } %>
      </tr>
      <% }) %>
      </tbody>
    </table>
    <% } %>
    <% if (page.hourlyPlan) { %>
    <h2>Plan godzinowy</h2>
    <table class="hourlyPlan <%- done ? 'with-quantityDone' : '' %>">
      <thead>
      <tr>
        <th>Zmiana</th>
        <th>1</th>
        <th>2</th>
        <th>3</th>
        <th>4</th>
        <th>5</th>
        <th>6</th>
        <th>7</th>
        <th>8</th>
        <th>
          <i class="icon-small"></i> małe&nbsp;&nbsp;
          <i class="icon-easy"></i> łatwe&nbsp;&nbsp;
          <i class="icon-hard"></i> trudne
        </th>
      </tr>
      </thead>
      <tbody>
      <tr>
        <td>I</td>
        <% for (var h = 0; h < 8; ++h) { %>
        <td>
          <% if (page.quantityDone) { %>
          <%- pad(page.quantityDone[h]) %>/<%- page.hourlyPlan[h] %>
          <% } else { %>
          <%- page.hourlyPlan[h] %>
          <% } %>
        </td>
        <% } %>
        <td>
          <% if (done) { %>
          zlecenie nie robione na danej linii i zmianie,
          <% } %>
        </td>
      </tr>
      <tr>
        <td>II</td>
        <% for (var h = 8; h < 16; ++h) { %>
        <td>
          <% if (page.quantityDone) { %>
          <%- pad(page.quantityDone[h]) %>/<%- page.hourlyPlan[h] %>
          <% } else { %>
          <%- page.hourlyPlan[h] %>
          <% } %>
        </td>
        <% } %>
        <td>
          <% if (done) { %>
          <span class="is-incomplete">zlecenie rozpoczęte</span>,
          <span class="is-completed">zlecenie zrobione</span>,
          <% } %>
        </td>
      </tr>
      <tr>
        <td>III</td>
        <% for (var h = 16; h < 24; ++h) { %>
        <td>
          <% if (page.quantityDone) { %>
          <%- pad(page.quantityDone[h]) %>/<%- page.hourlyPlan[h] %>
          <% } else { %>
          <%- page.hourlyPlan[h] %>
          <% } %>
        </td>
        <% } %>
        <td>
          <% if (done) { %>
          <span class="is-surplus">zlecenie z nadwyżką</span>
          <% } %>
        </td>
      </tr>
      </tbody>
    </table>
    <% } %>
  </section>
  <footer>
    <div>
      <p>Plan dla linii <%= page.line %> na dzień <%- time.utc.format(date, 'LL') %>.</p>
      <p>Wydrukowano w <%- time.format(Date.now(), 'LLLL') %> przez <%= user.getLabel() %> za pomocą systemu WMES.</p>
    </div>
    <div>
      Strona <%- page.pageNo %> z <%- page.pageCount %>
    </div>
  </footer>
</section>
<% }) %>
</body>
</html>
